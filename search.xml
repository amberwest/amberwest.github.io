<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[oracleåºåˆ—]]></title>
    <url>%2Famberwest.github.io%2F2019%2F04%2F14%2Foracle%E5%BA%8F%E5%88%97%E7%9A%84%E5%88%9B%E5%BB%BA%2F</url>
    <content type="text"><![CDATA[åˆ›å»ºåºåˆ—oracleå¯ä»¥ç”¨sequenceå…³é”®å­—åˆ›å»ºåºåˆ—ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š 12345678create sequence [user.]sequence_nameincrement by nstart with nmaxvalue | nomaxvalueminvalue | nominvaluecycle | nocyclecache | nocacheorder | noorader å‚æ•°è¯´æ˜ï¼š userï¼šä¹Ÿå°±æ˜¯schemaï¼Œå¦‚æœæ²¡æœ‰è¡¨æ˜ï¼Œåˆ™é»˜è®¤æ˜¯ç”¨å½“å‰çš„ incrementï¼šé»˜è®¤1ï¼Œå³æ¯æ¬¡å¢åŠ çš„æ­¥é•¿ã€‚-1åˆ™æ˜¯å‡å°‘ start withï¼šå¼€å§‹çš„æ•°å­—ã€‚å¦‚æœæœ‰è®¾å®šæœ€å°å€¼minvalueï¼Œåˆå§‹å€¼ä¸€å®šä¸èƒ½å°äºminvalue maxvalueï¼šä¸ºåºåˆ—æŒ‡å®šå¯ç”Ÿæˆçš„æœ€å¤§å€¼ minvalueï¼šæŒ‡å®šåºåˆ—çš„æœ€å°å€¼ nocycleï¼šä¸€ç›´ç´¯åŠ ï¼Œä¸å¾ªç¯ cacheï¼šé¢„åˆ†é…ï¼Œå¯ä»¥åŠ å¿«è®¿é—®é€Ÿåº¦ã€‚å‚æ•°å¯æ¥å—æœ€å°å€¼ä¸º2ã€‚åœ¨å¾ªç¯åºåˆ—ä¸­ï¼Œcacheå€¼å¿…é¡»å°äºcycleçš„å€¼ã€‚cacheæœ€å¤§å€¼è¦å°äº(ceil(maxvalue-minvalue))/abs(increment) 1234567create sequence seqminvalue 1maxvalue 10000start with 1increment by 1nocyclecache 10; è·å–åºåˆ—çš„æ—¶å€™ä½¿ç”¨nextvalï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¬¬ä¸€æ¬¡è¿”å›çš„å…¶å®æ˜¯åˆå§‹å€¼ï¼Œä¹‹åè¿”å›çš„æ˜¯æ¯æ¬¡å®Œæˆincrementåçš„å€¼ã€‚å¦‚ï¼š 1select seq.nextval from dual; ä¿®æ”¹åºåˆ—ä¿®æ”¹åºåˆ—è¿˜æ˜¯ç”¨alterï¼Œä¸è¿‡å‘¢ï¼Œå¹¶ä¸èƒ½ä¿®æ”¹startå‚æ•°ï¼Œéœ€è¦æƒ³è¦ä¿®æ”¹startå€¼ï¼Œéœ€è¦åˆ é™¤åºåˆ—å†é‡æ–°åˆ›å»ºã€‚ 1alter sequence [user.]sequence_name; åˆ é™¤åºåˆ—åˆ é™¤è‡ªç„¶ç”¨drop 1drop sequence sequence_name; å‚è€ƒæ–‡ç« create sequence]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>oracle</tag>
        <tag>sequence</tag>
        <tag>åºåˆ—</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysqlä¸­çš„isnullã€ifnullå’Œnullif]]></title>
    <url>%2Famberwest.github.io%2F2019%2F03%2F10%2Fmysql%E4%B8%AD%E7%9A%84isnull%E3%80%81ifnull%E5%92%8Cnullif%2F</url>
    <content type="text"><![CDATA[å…³äºifnullå’Œnullifä¸¤ä¸ªå‡½æ•°åˆšçœ‹çš„æ—¶å€™æœ‰ç‚¹æ··æ·†ï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹ã€‚ IFNULL(*expr1*,*expr2*)ï¼šå¦‚æœexpr1ä¸ä¸ºNULLåˆ™è¿”å›expr1ï¼Œå¦åˆ™è¿”å›expr2ã€‚ 12345678select ifnull(1, &apos;yes&apos;);&gt; 1select ifnull(0, &apos;yes&apos;);&gt; 0select ifnull(null, &apos;yes&apos;);&gt; yesselect ifnull(1/0, &apos;yes&apos;);&gt; yes NULLIF(*expr1*,*expr2*)ï¼šå¦‚æœexpr1=expr2æ—¶è¿”å›NULLï¼Œå¦åˆ™è¿”å›expr1ã€‚ 1234select nullif(1, 1);&gt; NULLselect nullif(1, 0);&gt; 1 isnull(expr)ï¼šå¦‚æœexprä¸ºNULLè¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚ 1234select isnull(null);&gt; 1select isnull(1);&gt; 0 æœ€åç”¨å‘˜å·¥è¡¨å°†è¿™ä¸‰ä¸ªå‡½æ•°éƒ½åˆ©ç”¨èµ·æ¥ï¼šåˆ¤æ–­å‘˜å·¥æ˜¯å¦æœ‰è·å¾—å¥–é‡‘ï¼Œæ²¡æœ‰è·å¾—å¥–é‡‘çš„å‘˜å·¥å¯ä»¥å¾—åˆ°100å…ƒçš„å®‰æ…°å¥–é‡‘ã€‚åœ¨ifnullå‡½æ•°ä¸­è¿˜ä½¿ç”¨äº†nullifå‡½æ•°ï¼Œç›´æ¥ç”¨ifnull(comm,100)çš„è¯ï¼Œå‘˜å·¥TURNERçš„å¥–é‡‘ä¸º0å…ƒå°†ä¸èƒ½è·å¾—å®‰æ…°é‡‘ã€‚ 12345678910111213141516171819select ename, comm, isnull(comm), nullif(comm, 0), ifnull(nullif(comm, 0), 100) from emp;&gt;&gt;&gt;+--------+---------+--------------+-----------------+------------------------------+| ename | comm | isnull(comm) | nullif(comm, 0) | ifnull(nullif(comm, 0), 100) |+--------+---------+--------------+-----------------+------------------------------+| SMITH | NULL | 1 | NULL | 100.00 || ALLEN | 300.00 | 0 | 300.00 | 300.00 || WARD | 500.00 | 0 | 500.00 | 500.00 || JOENS | NULL | 1 | NULL | 100.00 || MARTIN | 1400.00 | 0 | 1400.00 | 1400.00 || BLAKE | NULL | 1 | NULL | 100.00 || CLARK | NULL | 1 | NULL | 100.00 || SCOTT | NULL | 1 | NULL | 100.00 || TURNER | 0.00 | 0 | NULL | 100.00 || ADAMS | NULL | 1 | NULL | 100.00 || JAMES | NULL | 1 | NULL | 100.00 || FORD | NULL | 1 | NULL | 100.00 || MILLER | NULL | 1 | NULL | 100.00 |+--------+---------+--------------+-----------------+------------------------------+ å‚è€ƒèµ„æ–™ï¼š control flow functions Comparison Functions and Operators]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>isnull</tag>
        <tag>ifnull</tag>
        <tag>nullif</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é€šè¿‡å€¼åˆ—è¡¨é€‰æ‹©pandas DataFrameä¸­çš„è¡Œ]]></title>
    <url>%2Famberwest.github.io%2F2019%2F03%2F07%2F%E9%80%9A%E8%BF%87%E5%80%BC%E5%88%97%E8%A1%A8%E9%80%89%E6%8B%A9pandas-DataFrame%E4%B8%AD%E7%9A%84%E8%A1%8C%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯ç³»åˆ—æ–‡ç« ï¼Œæˆ‘ä¼šæŒ‰ç…§stackoverflowä¸Špandasç›¸å…³é—®é¢˜æŠ•ç¥¨æ•°æ’åºè¿›è¡Œæ•´ç†å­¦ä¹ ã€‚ä¸å­¦ä¹ æ˜¯ä¼šå˜å’¸é±¼çš„ï½ åŸé—®é¢˜ï¼šUse a list of values to select rows from a pandas dataframe [duplicate] å¦‚ä¸‹ï¼š 123456789101112import pandas as pddf = pd.DataFrame(&#123;'A' : [5,6,3,4], 'B' : [1,2,3, 5]&#125;)df""" A B0 5 11 6 22 3 33 4 5""" ç°åœ¨æ ¹æ®åˆ—è¡¨[3,6]ä»dfä¸­é€‰æ‹©å‡ºå¯¹åº”çš„è¡Œï¼Œå¯ä»¥ä½¿ç”¨isinï¼š 1234567df1 = df[df['A'].isin([3,6])]df1""" A B1 6 22 3 3""" å¦‚æœæ˜¯æ ¹æ®ç‰¹å®šçš„å€¼æ¥ç­›é€‰è¡Œè®°å½•ï¼Œåˆ™æ˜¯ï¼š 123456df2 = d[d['A']==3]df2""" A B2 3 3"""]]></content>
      <categories>
        <category>ä»Šå¤©ä½ å­¦pandasäº†å—</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>select</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¿å­˜DataFrameåˆ°csvæ–‡ä»¶]]></title>
    <url>%2Famberwest.github.io%2F2019%2F03%2F06%2F%E4%BF%9D%E5%AD%98DataFrame%E5%88%B0csv%E6%96%87%E4%BB%B6%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯ç³»åˆ—æ–‡ç« ï¼Œæˆ‘ä¼šæŒ‰ç…§stackoverflowä¸Špandasç›¸å…³é—®é¢˜æŠ•ç¥¨æ•°æ’åºè¿›è¡Œæ•´ç†å­¦ä¹ ã€‚ä¸å­¦ä¹ æ˜¯ä¼šå˜å’¸é±¼çš„ï½ åŸé—®é¢˜ï¼šPandas writing dataframe to csv fileï¼Œå¦‚é¢˜ï¼Œå°†dataframeå†™å…¥åˆ°csvæ–‡ä»¶å¯ä»¥ä½¿ç”¨to_csvæ–¹æ³•ã€‚ 123df.to_csv( [&apos;path_or_buf=None&apos;, &quot;sep=&apos;,&apos;&quot;, &quot;na_rep=&apos;&apos;&quot;, &apos;float_format=None&apos;, &apos;columns=None&apos;, &apos;header=True&apos;, &apos;index=True&apos;, &apos;index_label=None&apos;, &quot;mode=&apos;w&apos;&quot;, &apos;encoding=None&apos;, &apos;compression=None&apos;, &apos;quoting=None&apos;, &apos;quotechar=\&apos;&quot;\&apos;&apos;, &quot;line_terminator=&apos;\\n&apos;&quot;, &apos;chunksize=None&apos;, &apos;tupleize_cols=None&apos;, &apos;date_format=None&apos;, &apos;doublequote=True&apos;, &apos;escapechar=None&apos;, &quot;decimal=&apos;.&apos;&quot;],) è§£é‡Šå‡ ä¸ªå¸¸ç”¨çš„å‚æ•°ï¼Œè¯¦ç»†ä¿¡æ¯æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š path_or_bufï¼šè·¯å¾„ï¼Œstringç±»å‹ã€‚dfä¿å­˜ä¸ºcsvæ–‡ä»¶çš„è·¯å¾„ï¼Œç›¸å¯¹è·¯å¾„æˆ–è€…ç»å¯¹è·¯å¾„ã€‚ sepï¼šåˆ†éš”ç¬¦ï¼Œé»˜è®¤æ˜¯â€œï¼Œâ€ï¼Œå¯ä»¥è‡ªç”±è®¾ç½®ã€‚ na_repï¼šç©ºå€¼æ›¿æ¢ï¼Œé»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²ã€‚ float_formatï¼šfloatç±»å‹æ•°å­—çš„æ ¼å¼è®¾ç½®ã€‚å¦‚float_format=â€%.2fâ€ã€‚ columnsï¼šåºåˆ—ã€‚é€‰æ‹©è¦å†™å…¥çš„åˆ—ã€‚ headerï¼šé»˜è®¤ä¸ºTrueï¼ˆSeriesé»˜è®¤ä¸ºFalseï¼‰ï¼Œå¯ä»¥æ˜¯stringå’Œlistã€‚åˆ—åã€‚ indexï¼šé»˜è®¤Trueï¼Œå³è¡Œåã€‚ modeï¼šé»˜è®¤ä¸ºwï¼Œå³å†™æ¨¡å¼ã€‚ encodingï¼šç¼–ç æ–¹å¼ã€‚ chunksizeï¼šä¸€æ¬¡å†™å…¥è¡Œæ•°ã€‚ ä¾‹å­å¦‚ä¸‹ï¼š 1234567891011121314151617181920import pandas as pdimport numpy as npdf = pd.DataFrame(&#123;'A': 'foo bar foo bar foo bar foo foo'.split(), 'B': 'one one two one two two one one'.split(), 'C': np.arange(8), 'D': np.arange(8) * 2&#125;)df""" A B C D0 foo one 0 01 bar one 1 22 foo two 2 43 bar one 3 64 foo two 4 85 bar two 5 106 foo one 6 127 foo one 7 14"""# ç›´æ¥ä¿å­˜df.to_csv('out.csv', sep='\t', encoding='utf-8', index=False)]]></content>
      <categories>
        <category>ä»Šå¤©ä½ å­¦pandasäº†å—</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>csv</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ é™¤DataFrameä¸­æŸåˆ—å€¼ä¸ºNaNçš„è®°å½•/è¡Œ]]></title>
    <url>%2Famberwest.github.io%2F2019%2F03%2F05%2F%E5%88%A0%E9%99%A4DataFrame%E4%B8%AD%E6%9F%90%E5%88%97%E5%80%BC%E4%B8%BANaN%E7%9A%84%E8%AE%B0%E5%BD%95-%E8%A1%8C%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯ç³»åˆ—æ–‡ç« ï¼Œæˆ‘ä¼šæŒ‰ç…§stackoverflowä¸Špandasç›¸å…³é—®é¢˜æŠ•ç¥¨æ•°æ’åºè¿›è¡Œæ•´ç†å­¦ä¹ ã€‚ä¸å­¦ä¹ æ˜¯ä¼šå˜å’¸é±¼çš„ï½ åŸé—®é¢˜ï¼šHow to drop row of Pandas DataFrame whose value in certain columns is NaN å¦‚é¢˜ã€‚æˆ‘ä»¬å…ˆåˆ›å»ºæ•°æ® 1234567891011import pandas as pdimport numpy as npinput_rows = [[1,2,3], [2,3,4], [np.nan, 2, np.nan, 5], [np.nan, 5, 7]]df = pd.DataFrame(input_rows, columns=['a', 'b', 'c', 'd'])out: a b c d 0 1.0 2 3.0 NaN 1 2.0 3 4.0 NaN 2 NaN 2 NaN 5.0 3 NaN 5 7.0 NaN 1ï¼‰DataFrame.dropna 12# åˆ é™¤æ‰€æœ‰å¸¦æœ‰NaNçš„è¡Œdf.dropna() å…³äºdropna(axis=0, how=&#39;any&#39;, thresh=None, subset=None, inplace=False)å‚æ•°çš„è¯´æ˜ï¼š axisï¼šé»˜è®¤æ˜¯0ï¼Œå³åˆ é™¤è¡Œã€‚1æˆ–è€…columnsåˆ™æ˜¯åˆ é™¤åˆ— howï¼šåˆ é™¤æ–¹å¼ã€‚anyåˆ é™¤è‡³å°‘æœ‰ä¸€ä¸ªNaNçš„è¡Œ/åˆ—ï¼›allåˆ é™¤å…¨éƒ¨éƒ½æ˜¯NaNçš„è¡Œ/åˆ— threshï¼šé˜ˆå€¼ã€‚intï¼Œåˆ é™¤çš„è¡Œ/åˆ—è‡³å°‘æœ‰nä¸ªNaNå€¼ subsetï¼šåˆ—è¡¨ã€‚columnsæˆ–è€…indexï¼Œåªåˆ é™¤æŒ‡å®šåˆ—/è¡Œ 2ï¼‰pandas.notnull 1df = df[pd.notnull(df['a'])] 3ï¼‰pandas.isnull 1df = df[~pd.isnull(df['d'])] 4ï¼‰numpy.isnan 1df = df[~np.isnan(df['a'])] 5ï¼‰query 1df = df.query('a == a')]]></content>
      <categories>
        <category>ä»Šå¤©ä½ å­¦pandasäº†å—</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>drop</tag>
        <tag>åˆ é™¤</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ”¹å˜pandasä¸­åˆ—çš„æ•°æ®ç±»å‹]]></title>
    <url>%2Famberwest.github.io%2F2019%2F03%2F05%2F%E6%94%B9%E5%8F%98pandas%E4%B8%AD%E5%88%97%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯ç³»åˆ—æ–‡ç« ï¼Œæˆ‘ä¼šæŒ‰ç…§stackoverflowä¸Špandasç›¸å…³é—®é¢˜æŠ•ç¥¨æ•°æ’åºè¿›è¡Œæ•´ç†å­¦ä¹ ã€‚ä¸å­¦ä¹ æ˜¯ä¼šå˜å’¸é±¼çš„ï½ åŸé—®é¢˜ï¼šchange data type of columns in pandasï¼Œå¦‚ä½•å°†åˆ—çš„æ•°æ®è½¬ä¸ºåˆé€‚çš„ç±»å‹ï¼Œå¦‚å°†ä¸‹ä¾‹ä¸­æ•°å­—ä»stringç±»å‹è½¬ä¸ºfloatã€‚ 1234567891011121314151617181920import pandas as pda = [['a', '1.2', '4.2'], ['b', '70', '0.03'], ['x', '5', '0']]df = pd.DataFrame(a, columns=['aa', 'bb', 'cc'])# df''' aa bb cc0 a 1.2 4.21 b 70 0.032 x 5 0'''df.dtypes'''aa objectbb objectcc objectdtype: object''' 1ï¼‰pd.to_numericæ–¹æ³• 12# ä¸æ”¹å˜åŸæœ¬çš„æ•°æ®df['bb'] = pd.to_numeric(df['bb']) pd.to_numeric()æ–¹æ³•ä¸èƒ½å¯¹DataFrameæ ¼å¼çš„æ•°æ®ç›´æ¥è½¬æ¢ï¼Œæ‰€ä»¥å¦‚æœæœ‰å¤šä¸ªcolumnéœ€è¦è½¬æ¢ï¼Œå¯ä»¥ä½¿ç”¨applyæ–¹æ³•ã€‚ 12# applyè¿”å›å¤„ç†ä¹‹åçš„ç»“æœï¼Œå¹¶ä¸æ”¹å˜åŸæœ¬çš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦èµ‹å€¼df[['bb', 'cc']] = df[['bb', 'cc']].apply(pd.to_numeric) pd.to_numeric(arg, errors=&#39;raise&#39;, downcast=None)çš„å‚æ•°è¯´æ˜ï¼š argï¼šlistã€tupleã€ä¸€ç»´æ•°ç»„ã€Series errorsï¼š{â€˜ignoreâ€™, â€˜raiseâ€™, â€˜coerceâ€™}ï¼Œé»˜è®¤æ˜¯raiseï¼Œæœ‰é”™è¯¯ç›´æ¥æŠ›å‡ºã€‚ignoreå°†è¿”å›ä¸èƒ½è¢«è½¬æ¢çš„åŸå§‹æ•°æ®ï¼›coerceå°†ä¸èƒ½è¢«è½¬æ¢ä¸ºæ•°å­—ç±»å‹çš„æ•°æ®è®¾ç½®ä¸ºNaN downcastï¼š{â€˜integerâ€™, â€˜signedâ€™, â€˜unsignedâ€™, â€˜floatâ€™} , é»˜è®¤æ˜¯noneã€‚å¦‚æœè®¾ç½®äº†æŸä¸€ç±»å‹çš„æ•°æ®ï¼Œé‚£ä¹ˆpandasä¼šå°†åŸå§‹æ•°æ®è½¬ä¸ºèƒ½å­˜å‚¨çš„æœ€å°å­å‹æ€ã€‚å¦‚floatçš„å­å‹æ€æœ‰float16ï¼Œfloat32ï¼Œfloat64ï¼Œæ‰€ä»¥è®¾ç½®äº†downcast=floatï¼Œåˆ™ä¼šå°†æ•°æ®è½¬ä¸ºèƒ½å¤Ÿä»¥è¾ƒå°‘byteså»å­˜å‚¨ä¸€ä¸ªæµ®ç‚¹æ•°çš„float16ã€‚å¦å¤–ï¼Œdowncastå‚æ•°å’Œerrorså‚æ•°æ˜¯åˆ†å¼€çš„ï¼Œå¦‚æœdowncastè¿‡ç¨‹ä¸­å‡ºé”™ï¼Œå³ä½¿errorsè®¾ç½®ä¸ºignoreä¹Ÿä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ å…³äºdowncastå‚æ•°ç”¨æ³•ï¼Œä¾‹å­å¦‚ä¸‹ï¼š 123456789# è¿™ä¸ªä¾‹å­æ˜¯ç”¨concatæ–¹æ³•å°†å¤„ç†ä¹‹åfloatç±»å‹æ•°æ®å—å’Œéfloatç±»å‹çš„æ•°æ®å—åˆå¹¶# ä¹Ÿå°±æ˜¯åªå¯¹dataä¸­floatç±»å‹çš„æ•°æ®è¿›è¡Œå¤„ç†data = pd.concat( [ data.select_dtypes( include=['float'] ) .apply( pd.to_numeric, downcast='float' ), # applyä¸­æ¥æ”¶downcastå‚æ•°ä¼ é€’ç»™to_numeric data.select_dtypes( exclude=['float'] ) ], axis=1 ) 2ï¼‰astype()æ–¹æ³• astypeæ˜¯pandaså¯¹è±¡çš„æ–¹æ³•ï¼Œå¯ä»¥å°†DataFrameå’ŒSeriesè½¬ä¸ºæŒ‡å®šçš„ç±»å‹ã€‚ 1234567891011# ä»¥ä¸‹ä¾‹å­ä¸ä»¥ä¸Šé¢æ•°æ®ä¸ºä¾‹# å°†å…¨éƒ¨çš„åˆ—éƒ½è½¬ä¸ºintdf = df.astype(int)# å°†ä¸åŒç±»å‹çš„åˆ—ç”¨å­—å…¸åˆ†åˆ«è®¾ç½®df = df.astype(&#123;'a': int, 'b': complex&#125;)# è½¬æ¢Seriesçš„ç±»å‹s = s.astype(np.float16)# è½¬æ¢Seriesä¸ºpython stringç±»å‹s = s.astype(str) # è½¬æ¢Seriesä¸ºåºåˆ—ç±»å‹s = s.astype('category') astypeä¹Ÿä¼šè½¬æ¢å‡ºé”™ï¼šs.astype(np.unit8) 3ï¼‰infer_objects()æ–¹æ³• è¯¥æ–¹æ³•ä¸æ¥å—ä»»ä½•å‚æ•°ï¼Œå°è¯•å°†objectç±»å‹çš„æ•°æ®è½¬ä¸ºæ›´åˆé€‚çš„æ ¼å¼ã€‚ä¸èƒ½è¢«è½¬æ¢çš„æ•°æ®åˆ™ä¿æŒåŸæ ·ã€‚ 123456789df = df.infer_objects()# åªæˆåŠŸä¿®æ”¹äº†bbåˆ—df.dtypes'''aa objectbb float64cc objectdtype: object''']]></content>
      <categories>
        <category>ä»Šå¤©ä½ å­¦pandasäº†å—</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>æ•°æ®ç±»å‹</tag>
        <tag>data type</tag>
        <tag>astype</tag>
        <tag>to_numeric</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·»åŠ ä¸€è¡Œæ•°æ®åˆ°DataFrame]]></title>
    <url>%2Famberwest.github.io%2F2019%2F03%2F04%2F%E6%B7%BB%E5%8A%A0%E4%B8%80%E8%A1%8C%E6%95%B0%E6%8D%AE%E5%88%B0DataFrame%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯ç³»åˆ—æ–‡ç« ï¼Œæˆ‘ä¼šæŒ‰ç…§stackoverflowä¸Špandasç›¸å…³é—®é¢˜æŠ•ç¥¨æ•°æ’åºè¿›è¡Œæ•´ç†å­¦ä¹ ã€‚ä¸å­¦ä¹ æ˜¯ä¼šå˜å’¸é±¼çš„ï½ åŸé—®é¢˜ï¼šAdd one row to pandas DataFrameï¼Œè¦æ±‚ä¸€è¡Œä¸€è¡Œåœ°æ·»åŠ æ•°æ®åˆ°å·²æœ‰çš„ç©ºç™½DataFrameä¸­ã€‚ 12345import pandas as pdimport numpy as np# åˆ›å»ºç©ºç™½DataFramedf = pd.DataFrame(columns=['lib', 'qty1', 'qty2']) 1ï¼‰ä½¿ç”¨loc 123for i in range(4): df.loc[i] = [np.random.randint(-1, 1) for n in range(3)] # df.loc[i] = 5 æ·»åŠ ä¸€æ¡æ•°æ®éƒ½ä¸º5çš„è®°å½• 2ï¼‰ä½¿ç”¨append 12345df.append(&#123;'lib': 2, 'qty1': 3, 'qty2': 4&#125;, ignore_index=True) # appendä¹Ÿå¯ä»¥ç›´æ¥æ·»åŠ DataFramedf2 = pd.DataFrame([[1,2,3], [2,3,4]], columns=['lib', 'qty1', 'qty2'])df.append(df2, ignore_index=True) # ignore_indexè®¾ç½®ä¸ºTrueï¼Œindexå°†ä¼šå¿½ç•¥df2çš„index 3ï¼‰é‡æ–°ç”ŸæˆDataFrame å¾ªç¯å°†è¦æ·»åŠ çš„æ•°æ®ä»¥å­—å…¸çš„å½¢å¼ä¿å­˜åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œåœ¨ç”¨åˆ—è¡¨åˆ›å»ºå‡ºDataFrame 123456row_list = [] input_rows = [[1,2,3], [2,3,4]] # å¾…æ’å…¥æ•°æ®for row in input_rows: dict1 = dict(lib=row[0], qty1=row[1], qty2=row[2]) # å°†æ•°æ®è½¬ä¸ºå­—å…¸ row_list.append(dict1) # ä¿å­˜åˆ°åˆ—è¡¨ä¸­df = pd.DataFrame(row_list)]]></content>
      <categories>
        <category>ä»Šå¤©ä½ å­¦pandasäº†å—</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>æ·»åŠ è¡Œ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•æ”¹å˜DataFrameåˆ—çš„é¡ºåº]]></title>
    <url>%2Famberwest.github.io%2F2019%2F03%2F03%2F%E5%A6%82%E4%BD%95%E6%94%B9%E5%8F%98DataFrame%E5%88%97%E7%9A%84%E9%A1%BA%E5%BA%8F%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯ç³»åˆ—æ–‡ç« ï¼Œæˆ‘ä¼šæŒ‰ç…§stackoverflowä¸Špandasç›¸å…³é—®é¢˜æŠ•ç¥¨æ•°æ’åºè¿›è¡Œæ•´ç†å­¦ä¹ ã€‚ä¸å­¦ä¹ æ˜¯ä¼šå˜å’¸é±¼çš„ï½ åŸé—®é¢˜ï¼šHow to change the orders of DataFrame columns è¿˜æ˜¯ç”¨ä¹‹å‰çš„æ•°æ®ï¼š 12345import pandas as pddf = pd.DataFrame(&#123;'A': 'foo bar foo bar foo bar foo foo'.split(), 'B': 'one one two three two two one three'.split(), 'C': np.arange(8), 'D': np.arange(8) * 2&#125;) è§£å†³æ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯æ”¹å˜åŸæœ¬DataFrameçš„åˆ—åçš„ä½ç½®å³å¯ã€‚ 1ï¼‰ç›´æ¥ç”¨æ”¹å˜åˆ—åä½ç½®çš„åˆ—è¡¨ 1df1 = df[['C', 'A', 'B', 'D']] 2ï¼‰ä½¿ç”¨columnsæ–¹æ³•ï¼Œç”¨åˆ—åä¸‹æ ‡æ¥ä»£æ›¿ 12new_columns = [3, 2, 1, 0]df2 = df[df.columns[new_columns]] 3ï¼‰ä½¿ç”¨insertæ–¹æ³• é¢˜ä¸»æ–°å¢äº†ä¸€åˆ—æ•°æ®ï¼Œå¸Œæœ›èƒ½å¤Ÿæ”¾åˆ°ç¬¬ä¸€åˆ—çš„ä½ç½® 1df.insert(0, 'new_column_name', df['D'].mean()) 4ï¼‰ä½¿ç”¨reindex 1234df['new_column'] = df['D'].mean()df4 = df.reindex(['new_column'] + list(df.columns[:-1]), axis=1) # axis='columns'ï¼Œå¦‚æœæ²¡æœ‰axiså‚æ•°ï¼Œåˆ™å¿…é¡»åœ¨åˆ—è¡¨å‰åŠ ä¸Šcolumnsdf5 = df.reindex(columns=['new_column'] + list(df.columns[:-1]))]]></content>
      <categories>
        <category>ä»Šå¤©ä½ å­¦pandasäº†å—</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>æ”¹å˜é¡ºåº</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è·å–DataFrameçš„è¡Œæ•°]]></title>
    <url>%2Famberwest.github.io%2F2019%2F03%2F03%2F%E8%8E%B7%E5%8F%96DataFrame%E7%9A%84%E8%A1%8C%E6%95%B0%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯ç³»åˆ—æ–‡ç« ï¼Œæˆ‘ä¼šæŒ‰ç…§stackoverflowä¸Špandasç›¸å…³é—®é¢˜æŠ•ç¥¨æ•°æ’åºè¿›è¡Œæ•´ç†å­¦ä¹ ã€‚ä¸å­¦ä¹ æ˜¯ä¼šå˜å’¸é±¼çš„ï½ åŸé—®é¢˜ï¼šHow do I get a row count of a Pandas DataFrame å¦‚ä¸‹ï¼š 12345678910import pandas as pddf = pd.DataFrame(&#123;'A': 'foo bar foo bar foo bar foo foo'.split(), 'B': 'one one two three two two one three'.split(), 'C': np.arange(8), 'D': np.arange(8) * 2&#125;)# æ–¹æ³•ä¸€ï¼šä½¿ç”¨shaperow_count, column_count = df.shape# æ–¹æ³•äºŒï¼šä½¿ç”¨lenå‡½æ•°row_count = len(df)]]></content>
      <categories>
        <category>ä»Šå¤©ä½ å­¦pandasäº†å—</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>è¡Œæ•°</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é€‰æ‹©DataFrameä¸­çš„å¤šåˆ—æ•°æ®]]></title>
    <url>%2Famberwest.github.io%2F2019%2F03%2F03%2F%E9%80%89%E6%8B%A9DataFrame%E4%B8%AD%E7%9A%84%E5%A4%9A%E5%88%97%E6%95%B0%E6%8D%AE%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯ç³»åˆ—æ–‡ç« ï¼Œæˆ‘ä¼šæŒ‰ç…§stackoverflowä¸Špandasç›¸å…³é—®é¢˜æŠ•ç¥¨æ•°æ’åºè¿›è¡Œæ•´ç†å­¦ä¹ ã€‚ä¸å­¦ä¹ æ˜¯ä¼šå˜å’¸é±¼çš„ï½ åŸé—®é¢˜ï¼šselecting multiple columns in pandas dataframeï¼Œå¦‚é¢˜ï¼Œé€‰æ‹©DataFrameä¸­çš„å¤šåˆ—æ•°æ®ã€‚ å‡è®¾åŸå§‹æ•°æ®å¦‚ä¸‹ï¼š 123456import pandas as pdimport numpy as npdf = pd.DataFrame(&#123;'A': 'foo bar foo bar foo bar foo foo'.split(), 'B': 'one one two three two two one three'.split(), 'C': np.arange(8), 'D': np.arange(8) * 2&#125;) 1ï¼‰ä¼ é€’åŒ…å«åˆ—åçš„åˆ—è¡¨ æ³¨ï¼šè¦æœ‰[] 1df1 = df[['A','C']] 2ï¼‰ä½¿ç”¨ilocæ–¹æ³• æ³¨ï¼šç´¢å¼•æ˜¯ä»0å¼€å§‹ï¼Œå¹¶ä¸”ä¸åŒ…æ‹¬æœ€å¤§å€¼ 1df2 = df.iloc[:, 0:2] # å–å‰ä¸¤åˆ—æ•°æ® 3ï¼‰ä½¿ç”¨locæ–¹æ³• 12df3 = df.loc[:, 'A':'C'] #ä»Aåˆ—åˆ°Cåˆ—ï¼Œæ€»å…±å–ä¸‰åˆ—æ•°æ®df3 = df.loc[0:4, ['A', 'B', 'C']] # ä¹Ÿå¯ä»¥ç›´æ¥å†™å‡ºæ‰€è¦çš„åˆ—åï¼Œæ³¨æ„è¦åŠ ä¸Š[]ï¼›0:4æ˜¯å–å‰å››åˆ—ï¼Œå› ä¸ºæ²¡æœ‰é‡æ–°è®¾ç½®è¡Œç´¢å¼•ï¼Œæ‰€ä»¥çœ‹èµ·æ¥åƒæ˜¯ç›´æ¥ç”¨çš„ç´¢å¼•ï¼Œå…¶å®è¿™é‡Œæ˜¯ç´¢å¼•çš„åå­— 4ï¼‰ä½¿ç”¨columns 12df4 = df[df.columns[2:4]] # å–ç¬¬3å’Œ4åˆ—rows = df.loc[df.index[:3]] # ç±»ä¼¼çš„ï¼Œä½¿ç”¨indexå¯ä»¥å–æ•´è¡Œæ•°æ®ï¼Œæ•ˆæœè·Ÿdf[:3]ä¸€æ ·]]></content>
      <categories>
        <category>ä»Šå¤©ä½ å­¦pandasäº†å—</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>ç­›é€‰</tag>
        <tag>column</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åœ¨å·²æœ‰çš„DataFrameä¸Šå¢åŠ æ–°åˆ—]]></title>
    <url>%2Famberwest.github.io%2F2019%2F02%2F26%2F%E5%9C%A8%E5%B7%B2%E6%9C%89%E7%9A%84DataFrame%E4%B8%8A%E5%A2%9E%E5%8A%A0%E6%96%B0%E5%88%97%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯ç³»åˆ—æ–‡ç« ï¼Œæˆ‘ä¼šæŒ‰ç…§stackoverflowä¸Špandasç›¸å…³é—®é¢˜æŠ•ç¥¨æ•°æ’åºè¿›è¡Œæ•´ç†å­¦ä¹ ã€‚ä¸å­¦ä¹ æ˜¯ä¼šå˜å’¸é±¼çš„ï½ åŸé—®é¢˜ï¼šadding new column to existing DataFrame in Python pandasï¼Œæ·»åŠ æ–°çš„åˆ—åˆ°åŸæœ‰æ•°æ®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†å‡ ç§æƒ…å†µæ¥çœ‹ã€‚ å‡è®¾åŸå§‹æ•°æ®å¦‚ä¸‹ï¼š 123456import pandas as pdimport numpy as npdf = pd.DataFrame(&#123;'num_legs': [4, 2], 'num_wings': [0, 2]&#125;, index=['dog', 'hawk'])slen = len(df['num_legs']) 1ï¼‰ç›´æ¥èµ‹å€¼ 123456789df['a'] = pd.Series(np.random.randn(slen), index=df.index) # indexè¦è®°å¾—æ·»åŠ df['b'] = None # æ·»åŠ ä¸€åˆ—å€¼ä¸ºNonedf['c'] = [2, 4] # æ·»åŠ åˆ—è¡¨æ•°æ®# c1å’Œc3åˆ—çš„é¡ºåºæ˜¯ä¸€æ ·çš„ï¼Œ c2åˆ™ä¸ä¹‹ç›¸åï¼Œå…·ä½“çœ‹ä¸‹æ–‡df['c1'] = ['no', 'yes']df.index = [1, 0]df['c2'] = pd.Series(['no', 'yes'])df['c3'] = pd.Series(['no', 'yes'], index=df.index) 2ï¼‰locæ–¹æ³• 12df.loc[:,'d'] = pd.Series(np.random.randn(slen), index=df.index)df.loc[:, 'd'] = [2, 4] 3ï¼‰insertæ–¹æ³• insertæ–¹æ³•ä½¿ç”¨çš„åˆ—åä¸èƒ½æœ‰é‡å¤å€¼ï¼Œè¿æ›´æ–°éƒ½ä¸èƒ½ 12df.insert(len(df.columns), 'e', pd.Series(np.random.randn(slen)), index=df.index)df.insert(len(df.columns), 'ee', [1,2]) 4ï¼‰assignæ–¹æ³• assignæ–¹æ³•å‚æ•°å¯ä»¥æ˜¯Seriesã€æ ‡é‡ã€åˆ—è¡¨ï¼Œè¿˜å¯ä»¥åŒæ—¶æ·»åŠ å¤šåˆ— 12df = df.assign(f=df.num_wings.mean()) # å°†num_wingsè¿™åˆ—çš„å¹³å‡å€¼ä½œä¸ºæ–°å¢åˆ—fçš„ç»“æœdf = df.assign(A=df.num_wings.sum(), B=[1,2]) # æ–°å¢åˆ—Aå’ŒB 5ï¼‰concatæ–¹æ³• 1pd.concat([df, pd.Series(['yes', 'yes']).rename('t')], axis=1) # å¢åŠ åˆ—t æ³¨æ„ç‚¹ï¼š æ¯ä¸ªæ–¹æ³•çš„å‚æ•°éƒ½å¯ä»¥æ˜¯Seriesã€æ ‡é‡ã€åˆ—è¡¨ insertæ–¹æ³•ä¸­æ–°å¢çš„åˆ—åä¸èƒ½è·Ÿå·²æœ‰çš„ä¸€æ ·ï¼Œå³ä½¿æ›´æ–°åˆšåˆšæ–°å¢çš„åˆ—ä¹Ÿä¼šå‡ºé”™ df[&#39;a&#39;]=pd.Series([&#39;no&#39;, &#39;yes&#39;]çš„indexé¡ºåºå¦‚æœè¢«ä¿®æ”¹ï¼Œé»˜è®¤æ˜¯ä»¥Seriesçš„indexä¸ºå‡†ï¼Œå¯ä»¥é€šè¿‡index=df.indexæ¥æŒ‡å®šæŒ‰ç…§åŸå§‹DataFrameçš„indexé¡ºåº]]></content>
      <categories>
        <category>ä»Šå¤©ä½ å­¦pandasäº†å—</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>column</tag>
        <tag>assign</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è·å–DataFrameåˆ—åçš„åˆ—è¡¨å½¢å¼]]></title>
    <url>%2Famberwest.github.io%2F2019%2F02%2F26%2F%E8%8E%B7%E5%8F%96DataFrame%E5%88%97%E5%90%8D%E7%9A%84%E5%88%97%E8%A1%A8%E5%BD%A2%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯ç³»åˆ—æ–‡ç« ï¼Œæˆ‘ä¼šæŒ‰ç…§stackoverflowä¸Špandasç›¸å…³é—®é¢˜æŠ•ç¥¨æ•°æ’åºè¿›è¡Œæ•´ç†å­¦ä¹ ã€‚ä¸å­¦ä¹ æ˜¯ä¼šå˜å’¸é±¼çš„ï½ åŸé—®é¢˜ï¼šget list from DataFrame column headersï¼Œå…·ä½“æ–¹æ³•æœ‰å¦‚ä¸‹å‡ ç§ï¼š 12345678910111213141516171819202122import pandas as pddf = pd.DataFrame(&#123;'num_legs': [4, 2], 'num_wings': [0, 2]&#125;, index=['dog', 'hawk']) # 1list(df)# 2list(df.columns.values)# 3 df.columns.values.tolist()# 4df.keys.tolist()# 5[c for c in df]# 6list(df.columns)]]></content>
      <categories>
        <category>ä»Šå¤©ä½ å­¦pandasäº†å—</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>column</tag>
        <tag>tolist</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ é™¤DataFrameä¸­çš„åˆ—]]></title>
    <url>%2Famberwest.github.io%2F2019%2F02%2F24%2F%E5%88%A0%E9%99%A4DataFrame%E4%B8%AD%E7%9A%84%E5%88%97%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯ç³»åˆ—æ–‡ç« ï¼Œæˆ‘ä¼šæŒ‰ç…§stackoverflowä¸Špandasç›¸å…³é—®é¢˜æŠ•ç¥¨æ•°æ’åºè¿›è¡Œæ•´ç†å­¦ä¹ ã€‚ä¸å­¦ä¹ æ˜¯ä¼šå˜å’¸é±¼çš„ï½ åŸé¢˜ç›®ï¼šDelete column from Pandasï¼Œé¢˜ä¸»ç”¨äº†del df[&#39;name&#39;]å¯ä»¥æˆåŠŸåˆ é™¤æ•°æ®ï¼Œä½†æ˜¯del df.nameå´ä¸èƒ½å¤Ÿï¼Œæ ¹æ®ç­”æ¡ˆï¼Œè¿™æ˜¯å› ä¸ºpythonè¯­æ³•çš„é™åˆ¶ï¼Œè€Œä¸”åœ¨pandasä¼šå¼•èµ·æ··ä¹±ï¼ˆcolumnåå­—è·Ÿpandaså·²æœ‰å±æ€§ç›¸åŒçš„æƒ…å†µä¸‹ï¼‰ï¼Œå‰è€…åœ¨pythonä¸­ç›¸å½“äºè°ƒç”¨äº†df.__delitem__(name)ã€‚ æˆ‘ä»¬å¯ä»¥ç”¨dropæ–¹æ³•æ¥å®ç°ã€‚ 123456import pandas as pddf = pd.DataFrame(&#123;'num_legs': [4, 2], 'num_wings': [0, 2]&#125;, index=['dog', 'hawk'])new_df = df.drop(labels='num_legs', axis='columns') å…³äºdropæ–¹æ³•å‚æ•°çš„è¯´æ˜ï¼š 1df.drop([&apos;labels=None&apos;, &apos;axis=0&apos;, &apos;index=None&apos;, &apos;columns=None&apos;, &apos;level=None&apos;, &apos;inplace=False&apos;, &quot;errors=&apos;raise&apos;&quot;]) lablesï¼šæ‰€è¦åˆ é™¤çš„è¡Œ/åˆ—ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯åˆ—è¡¨ï¼Œä¾axisè€Œå®š axisï¼šæŒ‡å®šè¦åˆ é™¤çš„æ–¹å‘ã€‚0æˆ–indexåˆ é™¤çš„æ˜¯è¡Œï¼Œ1æˆ–columnsåˆ é™¤åˆ— indexï¼šåˆ¶å®šè¦åˆ é™¤è¡Œçš„ç´¢å¼• columnsï¼šæŒ‡å®šè¦åˆ é™¤çš„åˆ—ï¼Œæœ‰è¿™ä¸ªå‚æ•°ä¸éœ€è¦å†è®¾ç½®axis levelï¼šå¤šé‡ç´¢å¼•ä¸‹ä½¿ç”¨]]></content>
      <categories>
        <category>ä»Šå¤©ä½ å­¦pandasäº†å—</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>drop</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•è¿­ä»£DataFrameä¸­çš„è¡Œ]]></title>
    <url>%2Famberwest.github.io%2F2019%2F02%2F24%2F%E5%A6%82%E4%BD%95%E8%BF%AD%E4%BB%A3DataFrame%E4%B8%AD%E7%9A%84%E8%A1%8C%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯ç³»åˆ—æ–‡ç« ï¼Œæˆ‘ä¼šæŒ‰ç…§stackoverflowä¸Špandasç›¸å…³é—®é¢˜æŠ•ç¥¨æ•°æ’åºè¿›è¡Œæ•´ç†å­¦ä¹ ã€‚ä¸å­¦ä¹ æ˜¯ä¼šå˜å’¸é±¼çš„ï½ åŸé—®é¢˜ï¼šHow to iterate over the columns in DataFrame in Pandas å¦‚é¢˜æ‰€ç¤ºï¼Œå°±æ˜¯å¯¹DataFrameçš„è¡Œè¿›è¡Œè¿­ä»£ï¼Œå¯ä»¥ç”¨DataFrame.iterrows()æˆ–DataFrame.itertuples()ã€‚ 12345678910111213141516import pandas as pdimport numpy as npdf = pd.DataFrame(&#123;'num_legs': [4, 2], 'num_wings': [0, 2]&#125;, index=['dog', 'hawk'])# rowæ˜¯Seriesfor index, row in df.iterrows(): print(row) print(row['num_legs'])# index=Falseåˆ™indexä¸ä½œä¸ºtupleçš„ç¬¬ä¸€ä¸ªå…ƒç´ è¿”å›for row in df.itertuples(index=False): print(row) print(getattr(row, 'num_legs')) # row[0] æˆ– row.num_legs print(np.asarray(row)) # å°†nametupledè½¬ä¸ºåˆ—è¡¨ ç±»ä¼¼çš„ï¼Œå¯¹DataFrameçš„åˆ—è¿›è¡Œè¿­ä»£åˆ™å¯ä»¥ç”¨DataFrame.iteritems()æ–¹æ³•ã€‚ä¸‰è€…çš„åŒºåˆ«å¦‚ä¸‹ï¼š DataFrame.iteritems()ä¸æ¥å—ä»»ä½•å‚æ•°ï¼Œè¿”å›ç»“æœæ˜¯å…ƒç»„(column name, Series) DataFrame.iterrows()ä¹Ÿä¸æ¥å—ä»»ä½•å‚æ•°ï¼Œè¿”å›ç»“æœä¹Ÿæ˜¯å…ƒç»„(index, Series) DataFrame.itertuples(index=True, name=&#39;Pandas&#39;)ä»¥nametupledçš„å½¢å¼è¿­ä»£è¿”å›DataFrameçš„è¡Œã€‚æ•ˆç‡æ¯”DataFrame.iterrows()å¿«ä¸€äº›]]></content>
      <categories>
        <category>ä»Šå¤©ä½ å­¦pandasäº†å—</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>è¿­ä»£</tag>
        <tag>iterrows</tag>
        <tag>iteritems</tag>
        <tag>itertuples</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨pandasç­›é€‰å‡ºæŒ‡å®šåˆ—å€¼æ‰€å¯¹åº”çš„è¡Œ]]></title>
    <url>%2Famberwest.github.io%2F2019%2F02%2F23%2F%E4%BD%BF%E7%94%A8pandas%E7%AD%9B%E9%80%89%E5%87%BA%E6%8C%87%E5%AE%9A%E5%88%97%E5%80%BC%E6%89%80%E5%AF%B9%E5%BA%94%E7%9A%84%E8%A1%8C%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯ç³»åˆ—æ–‡ç« ï¼Œæˆ‘ä¼šæŒ‰ç…§stackoverflowä¸Špandasç›¸å…³é—®é¢˜æŠ•ç¥¨æ•°æ’åºè¿›è¡Œæ•´ç†å­¦ä¹ ã€‚ä¸å­¦ä¹ æ˜¯ä¼šå˜å’¸é±¼çš„ï½ åŸé—®é¢˜ï¼šSelect rows from a DataFrame based on values in a column in pandasã€‚æ ¹æ®é—®é¢˜æè¿°ï¼Œå¸Œæœ›é€šè¿‡pandaså®ç°ç±»ä¼¼mysqlæŸ¥æ‰¾è¯­å¥çš„åŠŸèƒ½ï¼š 1select * from table where column_name = some_value; pandasä¸­è·å–æ•°æ®çš„æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š å¸ƒå°”ç´¢å¼• ä½ç½®ç´¢å¼• æ ‡ç­¾ç´¢å¼• ä½¿ç”¨API å‡è®¾æ•°æ®å¦‚ä¸‹: 123456import pandas as pdimport numpy as npdf = pd.DataFrame(&#123;'A': 'foo bar foo bar foo bar foo foo'.split(), 'B': 'one one two three two two one three'.split(), 'C': np.arange(8), 'D': np.arange(8) * 2&#125;) å¸ƒå°”ç´¢å¼•è¯¥æ–¹æ³•å…¶å®å°±æ˜¯æ‰¾å‡ºæ¯ä¸€è¡Œä¸­ç¬¦åˆæ¡ä»¶çš„çœŸå€¼(true value)ï¼Œå¦‚æ‰¾å‡ºåˆ—Aä¸­æ‰€æœ‰å€¼ç­‰äºfoo 1df[df['A'] == 'foo'] # åˆ¤æ–­ç­‰å¼æ˜¯å¦æˆç«‹ ä½ç½®ç´¢å¼•ä½¿ç”¨ilocæ–¹æ³•ï¼Œæ ¹æ®ç´¢å¼•çš„ä½ç½®æ¥æŸ¥æ‰¾æ•°æ®çš„ã€‚è¿™ä¸ªä¾‹å­éœ€è¦å…ˆæ‰¾å‡ºç¬¦åˆæ¡ä»¶çš„è¡Œæ‰€åœ¨ä½ç½® 123456mask = df['A'] == 'foo'pos = np.flatnonzero(mask) # è¿”å›çš„æ˜¯array([0, 2, 4, 6, 7])df.iloc[pos]#å¸¸è§çš„ilocç”¨æ³•df.iloc[:3,1:3] æ ‡ç­¾ç´¢å¼•å¦‚ä½•DataFrameçš„è¡Œåˆ—éƒ½æ˜¯æœ‰æ ‡ç­¾çš„ï¼Œé‚£ä¹ˆä½¿ç”¨locæ–¹æ³•å°±éå¸¸åˆé€‚äº†ã€‚ 12345678df.set_index('A', append=True, drop=False).xs('foo', level=1) # xsæ–¹æ³•é€‚ç”¨äºå¤šé‡ç´¢å¼•DataFrameçš„æ•°æ®ç­›é€‰# æ›´ç›´è§‚ç‚¹çš„åšæ³•df.index=df['A'] # å°†Aåˆ—ä½œä¸ºDataFrameçš„è¡Œç´¢å¼•df.loc['foo', :]# ä½¿ç”¨å¸ƒå°”df.loc[df['A']=='foo'] å…³äºlocå’Œilocçš„åŒºåˆ«ï¼Œå®˜ç½‘æ˜¯è¿™ä¹ˆè¯´çš„ï¼š DataFrame.loc Access a group of rows and columns by label(s) or a boolean array. DataFrame.iloc Purely integer-location based indexing for selection by position. ä½¿ç”¨APIpd.DataFrame.queryæ–¹æ³•åœ¨æ•°æ®é‡å¤§çš„æ—¶å€™ï¼Œæ•ˆç‡æ¯”å¸¸è§„çš„æ–¹æ³•æ›´é«˜æ•ˆã€‚ 1234df.query('A=="foo"')# å¤šæ¡ä»¶df.query('A=="foo" | A=="bar"') æ•°æ®æå–ä¸æ­¢å‰é¢æåˆ°çš„æƒ…å†µï¼Œç¬¬ä¸€ä¸ªç­”æ¡ˆå°±ç»™å‡ºäº†ä»¥ä¸‹å‡ ç§å¸¸è§æƒ…å†µï¼š 1ã€ç­›é€‰å‡ºåˆ—å€¼ç­‰äºæ ‡é‡çš„è¡Œï¼Œç”¨== 1df.loc[df['column_name'] == some_value] 2ã€ç­›é€‰å‡ºåˆ—å€¼å±äºæŸä¸ªèŒƒå›´å†…çš„è¡Œï¼Œç”¨isin 1df.loc[df['column_name'].isin(some_values)] # some_valuesæ˜¯å¯è¿­ä»£å¯¹è±¡ 3ã€å¤šç§æ¡ä»¶é™åˆ¶æ—¶ä½¿ç”¨&amp;ï¼Œ&amp;çš„ä¼˜å…ˆçº§é«˜äº&gt;=æˆ–&lt;=ï¼Œæ‰€ä»¥è¦æ³¨æ„æ‹¬å·çš„ä½¿ç”¨ 1df.loc[(df['column_name'] &gt;= A) &amp; (df['column_name'] &lt;= B)] 4ã€ç­›é€‰å‡ºåˆ—å€¼ä¸ç­‰äºæŸä¸ª/äº›å€¼çš„è¡Œ 123df.loc[df['column_name'] != 'some_value']df.loc[~df['column_name'].isin('some_values')] #~å–å]]></content>
      <categories>
        <category>ä»Šå¤©ä½ å­¦pandasäº†å—</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>ç­›é€‰</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•ç”¨pandaså¯¹åˆ—é‡å‘½å]]></title>
    <url>%2Famberwest.github.io%2F2019%2F02%2F21%2F%E5%A6%82%E4%BD%95%E7%94%A8pandas%E5%AF%B9%E5%88%97%E9%87%8D%E5%90%8D%2F</url>
    <content type="text"><![CDATA[è¿™æ˜¯ç³»åˆ—æ–‡ç« ï¼Œæˆ‘ä¼šæŒ‰ç…§stackoverflowä¸Špandasç›¸å…³é—®é¢˜æŠ•ç¥¨æ•°æ’åºè¿›è¡Œæ•´ç†å­¦ä¹ ã€‚ä¸å­¦ä¹ æ˜¯ä¼šå˜å’¸é±¼çš„ï½ åŸé—®é¢˜ï¼šrenaming columns in pandasï¼Œæ ¹æ®é—®é¢˜æè¿°ï¼Œéœ€è¦å¯¹å·²æœ‰çš„DataFrameçš„åˆ—é‡æ–°å‘½åï¼Œå»æ‰å‰é¢çš„$ç¬¦å·ã€‚ 123import pandas as pddf = pd.DataFrame([&#123;'$a':1, '$b':2, '$c':3&#125;]) æ–¹æ³•ä¸€ï¼Œä¸é€‚ç”¨äºæœ‰å¾ˆå¤šåˆ—çš„æˆ–è€…åªä¿®æ”¹ä¸ªåˆ«åˆ—åçš„DataFrame 1df.columns = ['a', 'b', 'c'] # ç›´æ¥åœ¨åŸå§‹æ•°æ®ä¸Šè¿›è¡Œä¿®æ”¹ æ–¹æ³•äºŒï¼Œrenameæ–¹æ³•é€‚ç”¨äºåªä¿®æ”¹ä¸ªåˆ«åˆ—åæˆ–è€…åˆ—åæœ‰ä¸€å®šè§„å¾‹çš„DataFrame 1234567df2=df.rename(columns=&#123;'$a':'a', '$b':'b'&#125;) # ä¸ä¿®æ”¹åŸå§‹æ•°æ®df.rename(columns=&#123;'$a':'a', '$b':'b'&#125;, inplace=True) # ä¿®æ”¹åŸå§‹æ•°æ®df.rename(&#123;'$a':'a', '$b':'b'&#125;, axis='columns', inplace=True) # pandas 0.21çš„æ–°æ–¹æ³•ï¼ŒæŒ‡å®šaxis='coloumns'æˆ–è€…1# åˆ—åæœ‰è§„å¾‹ï¼Œæ–¹æ³•å¯ä»¥æœ‰å¾ˆå¤šdf.rename(columns=lambda x: x[1:], inplace=True)df.rename(columns=lambda x: x.lstrip('$'), inplace=Tru) æ–¹æ³•ä¸‰ï¼Œstræ–¹æ³• 1df.columns = df.columns.str.replace('$','')]]></content>
      <categories>
        <category>ä»Šå¤©ä½ å­¦pandasäº†å—</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>é‡å‘½å</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•å»é™¤pandas groupbyæ¯ä¸ªåˆ†ç»„æœ€å¤§æœ€å°å€¼å†æ±‚æè¿°æ€§ç»Ÿè®¡]]></title>
    <url>%2Famberwest.github.io%2F2019%2F01%2F18%2F%E5%A6%82%E4%BD%95%E5%8E%BB%E9%99%A4pandas-groupby%E6%AF%8F%E4%B8%AA%E5%88%86%E7%BB%84%E6%9C%80%E5%A4%A7%E6%9C%80%E5%B0%8F%E5%80%BC%E5%86%8D%E6%B1%82%E6%8F%8F%E8%BF%B0%E6%80%A7%E7%BB%9F%E8%AE%A1%2F</url>
    <content type="text"><![CDATA[å¦‚é¢˜ï¼Œä¹‹å‰åœ¨å¤„ç†æ•°æ®çš„æ—¶å€™ï¼Œä¸€ç›´æƒ³ä¸åˆ°å¥½çš„æ–¹æ³•ã€‚æœ‰äººå»ºè®®å°†æ•°æ®å¯¼å…¥mysqlå†åšå¤„ç†ï¼Œå—¯ï¼Œå¯¼å…¥ä¹‹åï¼Œå‘ç°æˆ‘å¾ˆå°‘ç”¨mysqlï¼Œä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥šè¦æ€ä¹ˆåšğŸ˜¢æœ€åç›´æ¥ä¸Šstackoverflowå‘é—®ã€‚è¿™çœŸæ˜¯ä¸ªè‰¯å¿ƒç½‘ç«™å•Šï½ åŸå§‹æ•°æ®å¦‚ä¸‹ï¼š 123456789101112data = &#123;'class': ['a', 'a', 'a', 'a', 'a', 'b', 'b', 'b', 'b', 'b'], 'num': [-10,18,12,15,50, 10,60,51,54,100]&#125;df = pd.DataFrame(data)df.groupby('class').describe()outputï¼šnum count mean std min 25% 50% 75% maxclass a 5.0 17.0 21.494185 -10.0 12.0 15.0 18.0 50.0b 5.0 55.0 31.984371 10.0 51.0 54.0 60.0 100.0 åšæ³•1: 12mask = df['num'].ne(df['max'])&amp;df['num'].ne(df['min']) # DataFrame.ne() not equalå§ï¼Œåæ­£ä¸ç¬¦åˆæ¡ä»¶çš„è¿”å›Trueï¼Œ&amp;æ˜¯å¹¶é›†ï¼Œå³è¿”å›åŒæ—¶ä¸ç­‰äºæœ€å¤§å’Œæœ€å°å€¼çš„True/Falsedf[mask].groupby('class')['num'].describe() # è¿™é‡Œç®€åŒ–äº†ï¼Œdf[mask]å¾—åˆ°çš„å°±æ˜¯ç¬¦åˆæ¡ä»¶çš„DataFrame åšæ³•2ï¼š 12345df.groupby('class').apply(lambda x: x.drop([x['num'].idxmax(),x['num'].idxmin()])).rename_axis([None,None]).groupby('class').describe() # åŸç­”æ¡ˆdf.groupby('class').apply(lambda x: x.drop([x['num'].idxmax(), x['num'].idxmin()])['num']).groupby('class').describe() # è·ŸåŸç­”æ¡ˆä¸å¤ªä¸€æ ·df.groupby('class').apply(lambda x: x.drop([x['num'].idxmax(), x['num'].idxmin()])['num']).reset_index(level=0).groupby('class')['num'].describe() # å…¶å®dropä¹‹åæ•°æ®å˜æˆäº†ä»¥classä¸ºindexï¼Œå¹¶ä¸”åŸæœ¬çš„rangeIndexè¿˜åœ¨ å½“æ—¶çŸ¥é“idxmax()æ–¹æ³•ï¼Œå°±æ˜¯ä¸çŸ¥é“è¦æ€ä¹ˆè·Ÿgroupbyç»“åˆèµ·æ¥ï¼Œå¤„ç†ä¹‹åçš„æ•°æ®æ ¼å¼åˆä¼šå˜æˆä»€ä¹ˆæ ·ï¼Ÿåˆè¦åšä½•å¤„ç†ï¼Ÿè¯´åˆ°åº•è¿˜æ˜¯å¯¹pandasä¸ç†Ÿã€‚ æ›´è¯¦ç»†çš„åšæ³•å¯ä»¥å‚è€ƒåŸå§‹ç­”æ¡ˆ]]></content>
      <categories>
        <category>pandas</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>groupby</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è§£å†³matplotlibä¸­æ–‡ä¹±ç ]]></title>
    <url>%2Famberwest.github.io%2F2019%2F01%2F18%2F%E8%A7%A3%E5%86%B3matplotlib%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%2F</url>
    <content type="text"><![CDATA[å…³äºmatplotlibä¸­æ–‡æ˜¾ç¤ºçš„é—®é¢˜ï¼Œæœ€å¸¸è§çš„è§£å†³æ–¹æ³•å°±æ˜¯ï¼š 12plt.rcParams['font.sans-serif']=['SimHei']plt.rcParams['axes.unicode_minus']=False ä½†æ˜¯æ¯æ¬¡éƒ½è¦å†™è¿™ä¸¤å¥è¯ä¹Ÿæ˜¯æŒºéº»çƒ¦çš„ã€‚æœ€æƒ¨çš„æ˜¯ï¼Œå¦‚æœä½¿ç”¨pyenvè¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œä¸Šé¢é‚£ä¸¤å¥è¯ä¹Ÿä¸ç®¡ç”¨äº†ï¼Œå› ä¸ºä¸åŒç‰ˆæœ¬çš„pythonä¸‹å¯èƒ½æ²¡æœ‰å­—ä½“æ–‡ä»¶ã€‚æ‰€ä»¥ï¼Œæˆ‘å‚è€ƒçŸ¥ä¹ä¸Šmatplotlibå›¾ä¾‹ä¸­æ–‡ä¹±ç ? - åœ¨ä¸åœ¨çš„å›ç­” - çŸ¥ä¹çš„åšæ³•ï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ ä¸‹è½½å­—ä½“æ–‡ä»¶ ç‚¹å‡»è¿›å…¥ä¸‹è½½é»‘ä½“æ–‡ä»¶ æŸ¥çœ‹æ‰€ä½¿ç”¨çš„ç‰ˆæœ¬ 123&gt;&gt;pyenv activate test(testæ˜¯æ‰€åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒ)&gt;&gt;which python/Users/test/.pyenv/shims/pythonï¼ˆåœ¨è¿™ä¸ªè·¯å¾„ä¸‹æ‰¾åˆ°matplotlibå¯¹åº”çš„å­—ä½“æ–‡ä»¶å¤¹ï¼‰ å°†å­—ä½“æ–‡ä»¶æ”¾åœ¨matplotlib/mpl-data/fonts/ttf/ä¸‹ 1mv ~/Downloads/SimHei.ttf /Users/amber/.pyenv/versions/amber/lib/python3.5/site-packages/matplotlib/mpl-data/fonts/ttf/ ä¿®æ”¹matplotlib/mpl-dataä¸‹çš„matplotlibrcæ–‡ä»¶ åœ¨å‘½ä»¤ä¸­è¾“å…¥vim matplotlibrcè¿›å…¥æ–‡ä»¶ï¼Œåœ¨å½“å‰æ¨¡å¼ï¼ˆå‘½ä»¤è¡Œæ¨¡å¼ï¼‰ï¼Œä½¿ç”¨:/font.familyè¿›è¡Œæœç´¢ï¼Œå¿«é€Ÿå®šä½ã€‚ 123font.family : sans-serif # å–æ¶ˆæ³¨é‡Šfont.sans-serif : SimHei, DejaVu Sans, Bitstream Vera Sans, Computer Modern Sans Serif, Lucida Grande, Verdana, Geneva, Lucid, Arial, Helvetica, Avant Garde, sans-serif # æ·»åŠ SimHeiå­—ä½“axes.unicode_minus : False #å°†Trueä¿®æ”¹ä¸ºFalseï¼Œæ­£ç¡®æ˜¾ç¤ºè´Ÿå· åœ¨pythonè„šæœ¬ä¸­é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ è¿è¡Œä»¥ä¸‹è„šæœ¬å°±å¯ä»¥äº† 12from matplotlib.font_manager import _rebuild_rebuild() æˆ‘æ²¡æœ‰åœ¨å­—ä½“å†Œä¸­å¯ç”¨é»‘ä½“å¥½åƒä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ã€‚å“ï¼Œå…¨éƒ¨æ”¹ç”¨pyenvç®¡ç†pythonç‰ˆæœ¬ä¹‹åå°±ä¸€ç›´è§£å†³ä¸äº†æ˜¾ç¤ºä¸­æ–‡çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸€ç›´éƒ½æ²¡æƒ³è¿‡æ˜¯è¿™ä¸ªé—®é¢˜ã€‚å—¯ï¼Œä»¥æ­¤ä¸ºæˆ’ï¼Œé‡åˆ°é—®é¢˜è¦å…¨é¢æ€è€ƒã€‚]]></content>
      <categories>
        <category>matplotlib</category>
      </categories>
      <tags>
        <tag>matplotlib</tag>
        <tag>ä¸­æ–‡ä¹±ç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[matplotlibï¼šå›¾åƒå…ƒç´ ]]></title>
    <url>%2Famberwest.github.io%2F2018%2F12%2F12%2Fmatplotlib%EF%BC%9A%E5%9B%BE%E5%83%8F%E5%85%83%E7%B4%A0%2F</url>
    <content type="text"><![CDATA[æ ‡å‡†é¢œè‰²ç¼©å†™ bï¼š è“è‰² gï¼š ç»¿ rï¼š çº¢ cï¼š é’ mï¼š å“çº¢ yï¼š é»„ kï¼š é»‘ wï¼š ç™½ æ ‡å‡†æ ·å¼å­—ç¬¦ å®çº¿æ ·å¼ â€“ çŸ­åˆ’çº¿æ ·å¼ -. ç‚¹å®çº¿æ ·å¼ : è™šçº¿æ ·å¼ . ç‚¹æ ‡è®° , åƒç´ æ ‡è®° o åœ†æ ‡è®° v å‘ä¸‹ä¸‰è§’å½¢æ ‡è®° ^ å‘ä¸Šä¸‰è§’å½¢æ ‡è®° &lt; å‘å·¦ä¸‰è§’å½¢æ ‡è®° &gt; å‘å³ä¸‰è§’å½¢æ ‡è®° 1 Tri_downæ ‡è®° 2 Tri_upæ ‡è®° 3 Tri_leftæ ‡è®° 4 Tri_rightæ ‡è®° s æ–¹å½¢æ ‡è®° p äº”è¾¹å½¢æ ‡è®° * æ˜Ÿå· h å…­è§’å½¢æ ‡è®°1 H å…­è§’å½¢æ ‡è®°2 + åŠ å· x Xæ ‡è®° D è±å½¢æ ‡è®° d ç»†è±å½¢æ ‡è®° | å‚ç›´æ ‡è®° 12345678910111213141516import numpy as npimport matplotlib as mplimport matplotlib.pyplot as pltnp.random.seed(1000)y = np.random.standard_normal(20)x = range(len(y))plt.figure(figsize=(7,4))plt.plot(y.cumsum(), 'b', lw=1.5)plt.plot(y.cumsum(), 'ms')plt.grid(True)plt.axis('tight')plt.xlabel('index')plt.ylabel('value')plt.title('A simple plot') å›¾ä¾‹locå‚æ•°plt.legend(*args,**kwargs)æœ‰å¾ˆå¤šå‚æ•°ï¼Œå¸¸ç”¨çš„å°±æ˜¯locå‚æ•°ï¼Œå¯ä»¥æ˜¯æ•°å­—ï¼Œä¹Ÿå¯ä»¥æ˜¯è‹±æ–‡ï¼Œè¿˜å¯ä»¥ç›´æ¥ç”¨è¡¨ç¤ºä½ç½®çš„å…ƒç»„ã€‚å¦‚ï¼šplt.legend(loc=&#39;best&#39;) or plt.legend(loc=(0.5, 0.8)) ç©ºç™½ è‡ªåŠ¨ 0 æœ€ä½³ best 1 å³ä¸Š upper right 2 å·¦ä¸Š upper left 3 å·¦ä¸‹ lower left 4 å³ä¸‹ lower right 5 å³ right 6 ä¸­å·¦ center left 7 ä¸­å³ center right 8 ä¸­ä¸‹ lower center 9 ä¸­ä¸Š upper center 10 ä¸­ center ä¾‹å­ä¸­é™¤äº†å¸¸ç”¨çš„locå‚æ•°ï¼Œè¿˜è®¾ç½®äº†å…¶ä»–çš„æ ·å¼ï¼Œå…·ä½“çš„ä½¿ç”¨æŒ‡å—å¯ä»¥å‚è€ƒå®˜ç½‘ 123456789101112131415161718import matplotlib.pyplot as pltimport numpy as npax = plt.subplot(111)t1 = np.arange(0.0, 1.0, 0.01)for n in [1, 2, 3, 4]: plt.plot(t1, t1**n, label="n=%d"%(n,)) # è®¾ç½®æ¯ä¸ªplotå¯¹åº”çš„å›¾ä¾‹leg = plt.legend(loc='best', ncol=2, # ä¸¤è¡Œ mode="expand", # æ°´å¹³å¡«å……æ•´ä¸ªAxesåŒºåŸŸï¼Œé»˜è®¤ä¸ºnoneã€‚å¦‚æœbbox_to_anchorè®¾ç½®äº†legendçš„sizeåˆ™ä¼šè¦†ç›–mode shadow=True, # è®¾ç½®legendæ¡†çš„é˜´å½± fancybox=True # è®¾ç½®ä¸ºFalseå˜åŒ–ä¸å¤§ )leg.get_frame().set_alpha(0.5) # è·å–legendæ¡†å¹¶è®¾ç½®é€æ˜åº¦plt.show() textæ–¹æ³•ç»™plotæ·»åŠ æ–‡æœ¬å¯ä»¥ä½¿ç”¨plt.text()æ–¹æ³•ï¼Œå®Œæ•´å‚æ•°æŸ¥çœ‹Textç±» matplotlib.text.Text(x=0, y=0, text=â€™â€™, color=None, verticalalignment=â€™baselineâ€™, horizontalalignment=â€™leftâ€™, multialignment=None, fontproperties=None, rotation=None, linespacing=None, rotation_mode=None, usetex=None, wrap=False, *\kwargs*) å¸¸ç”¨å‚æ•°ï¼š xï¼Œyï¼šæ˜¯æ–‡æœ¬sæ”¾ç½®ä½ç½® sï¼šè¦æ·»åŠ çš„æ–‡æœ¬ä¿¡æ¯ fontdictï¼šè®¾ç½®æ–‡æœ¬æ ·å¼ï¼Œä½¿ç”¨è¯¥å‚æ•°æ˜¯dictå½¢å¼fontdict={&#39;fontsize&#39;: 12}ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨å…³é”®å­—å‚æ•°å¦‚ï¼šfontsize=12 12345678910111213141516171819202122232425262728293031323334353637383940import matplotlib.pyplot as pltfig = plt.figure()# è¿™é‡Œæ˜¯suptitleï¼Œè€Œä¸æ˜¯subtitlefig.suptitle('bold figure suptitle', fontsize=14, fontweight='bold')# ç»™Figureæ·»åŠ Axeså¯¹è±¡ax = fig.add_subplot(111)# è°ƒæ•´axçš„ä½ç½®ï¼Œå‚æ•°æœ‰left=None, bottom=None, right=None, top=None,wspace=None, hspace=Nonefig.subplots_adjust(top=0.85) ax.set_title('axes title')ax.set_xlabel('xlabel')ax.set_ylabel('ylabel')ax.text(3, 8, 'boxed italics text in data coords', style='italic', # styleæœ‰ä¸‰ç§é€‰æ‹©ï¼Œ'normal', 'italic', 'oblique' bbox=&#123;'facecolor':'red', 'alpha':0.5, 'pad':10&#125; # ç»™æ–‡æœ¬åŠ ä¸Šè¾¹æ¡†ï¼Œå¹¶è®¾ç½®æ ·å¼ )ax.text(2, 6, r'an equation: $E=mc^2$', # è®°å¾—å¸¦ä¸Šr fontdict=&#123;'fontsize': 15&#125; # ä¹Ÿå¯ä»¥ç›´æ¥ç”¨fontsize=15 )# unicodeä¹Ÿèƒ½è¯†åˆ«ax.text(3, 2, 'unicode: Institut f\374r Festk\366rperphysik')ax.text(0.95, 0.01, 'colored text in axes coords', verticalalignment='bottom', horizontalalignment='right', transform=ax.transAxes, color='green', fontsize=15)ax.plot([2], [1], 'o') # é»˜è®¤é¢œè‰²ä¸ºbax.annotate('annotate', xy=(2, 1), xytext=(3, 4), arrowprops=dict(facecolor='black', shrink=0.05))ax.axis([0, 10, 0, 10]) # è®¾ç½®xè½´å’Œyè½´çš„èŒƒå›´[xmin, xmax, ymin, ymax]plt.show() å¯¹äºæ•°å­¦è¡¨è¾¾å¼ï¼Œå¯ä»¥ç”¨LaTeXè¯­æ³•ç›´æ¥ç¼–è¾‘ 1234567891011121314import numpy as npimport matplotlib.pyplot as pltt = np.arange(0.0, 2.0, 0.01)s = np.sin(2*np.pi*t)plt.plot(t,s)plt.title(r'$\alpha_i &gt; \beta_i$', fontsize=20)plt.text(1, -0.6, r'$\sum_&#123;i=0&#125;^\infty x_i$', fontsize=20)plt.text(0.6, 0.6, r'$\mathcal&#123;A&#125;\mathrm&#123;sin&#125;(2 \omega t)$', fontsize=20)plt.text(0.3, 0.98, r'$local\ max$', fontsize=12, horizontalalignment='left', verticalalignment='center', )plt.xlabel('time (s)')plt.ylabel('volts (mV)')plt.show() scalesç›´æ¥çœ‹ä¾‹å­ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556import numpy as npimport matplotlib.pyplot as pltfrom matplotlib.ticker import NullFormatter # useful for `logit` scale# Fixing random state for reproducibilitynp.random.seed(19680801)# make up some data in the interval ]0, 1[y = np.random.normal(loc=0.5, scale=0.4, size=1000)y = y[(y &gt; 0) &amp; (y &lt; 1)]y.sort()x = np.arange(len(y))# plot with various axes scalesplt.figure(1)# linearplt.subplot(221)plt.plot(x, y)plt.yscale('linear')plt.title('linear')plt.grid(True)# logplt.subplot(222)plt.plot(x, y)plt.yscale('log')plt.title('log')plt.grid(True)# symmetric logplt.subplot(223)plt.plot(x, y - y.mean())plt.yscale('symlog', linthreshy=0.01)plt.title('symlog')plt.grid(True)# logitplt.subplot(224)plt.plot(x, y)plt.yscale('logit')plt.title('logit')plt.grid(True)# Format the minor tick labels of the y-axis into empty strings with# `NullFormatter`, to avoid cumbering the axis with too many labels.plt.gca().yaxis.set_minor_formatter(NullFormatter())# Adjust the subplot layout, because the logit one may take more space# than usual, due to y-tick labels like "1 - 10^&#123;-3&#125;"plt.subplots_adjust(top=0.92, bottom=0.08, left=0.10, right=0.90, # è°ƒæ•´å­å›¾çš„å¸ƒå±€ hspace=0.35, wspace=0.35 # è®¾ç½®å­å›¾ä¹‹é—´çš„è·ç¦» )plt.show()]]></content>
      <categories>
        <category>matplotlib</category>
      </categories>
      <tags>
        <tag>matplotlib, text,</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[matplotlibï¼šboxplotç®±çº¿å›¾]]></title>
    <url>%2Famberwest.github.io%2F2018%2F12%2F12%2Fmatplotlib%EF%BC%9Aboxplot%E7%AE%B1%E5%BD%A2%E5%9B%BE%2F</url>
    <content type="text"><![CDATA[ç®±çº¿å›¾ä¸€èˆ¬ç”¨æ¥çœ‹æ•°æ®çš„åˆ†å¸ƒï¼Œæ¯”å¦‚å››åˆ†ä½æ•°ï¼Œå¼‚å¸¸ç‚¹ç­‰ã€‚ç®€å•çš„æ•°æ®ä¿¡æ¯ä¹Ÿå¯ä»¥ç”¨DataFrame.describe()è¿›è¡ŒæŸ¥çœ‹ã€‚ boxplotå‚æ•°çœ‹ä¸‹ç®±çº¿å›¾çš„ç›¸å…³å‚æ•°ï¼š Axes.boxplot(x, notch=None, sym=None, vert=None, whis=None, positions=None, widths=None, patch_artist=None, bootstrap=None, usermedians=None, conf_intervals=None, meanline=None, showmeans=None, showcaps=None, showbox=None, showfliers=None, boxprops=None, labels=None, flierprops=None, medianprops=None, meanprops=None, capprops=None, whiskerprops=None, manage_xticks=True, autorange=False, zorder=None, **, data=None*) å…·ä½“å‚æ•°ï¼š x ï¼š æ•°ç»„æˆ–è€…å‘é‡åºåˆ—ï¼ŒæŒ‡å®šè¦ç»˜åˆ¶ç®±çº¿å›¾çš„æ•°æ® notchï¼šæ˜¯å¦æ˜¯å‡¹å£ç®±çº¿å›¾ï¼Œé»˜è®¤ä¸ºå¦ã€‚å‡¹å£è¡¨ç¤ºä¸­å€¼é™„è¿‘çš„ç½®ä¿¡åŒºé—´ã€‚bootstrapæœ‰å…³å¦‚ä½•è®¡ç®—æ§½å£ä½ç½®çš„ä¿¡æ¯ symï¼šæŒ‡å®šå¼‚å¸¸ç‚¹çš„å½¢çŠ¶ï¼Œé»˜è®¤æ˜¯+å·æ˜¾ç¤ºã€‚ä¸æƒ³æ˜¾ç¤ºï¼Œä¼ å…¥ç©ºå­—ç¬¦ä¸²(â€˜â€™) vertï¼šæ˜¯å¦å°†æ¡†å‚ç›´æ˜¾ç¤ºï¼Œé»˜è®¤ä¸ºTrue whisï¼šæŒ‡å®šä¸Šä¸‹é¡»è·Ÿä¸Šä¸‹å››åˆ†ä½çš„è·ç¦»ï¼Œé»˜è®¤æ˜¯1.5å€å››åˆ†ä½å·® bootstrapï¼šæ˜¯å¦ä¸ºå‡¹å£ä½ç½®çš„ä¸­ä½æ•°è®¾ç½®ç½®ä¿¡åŒºé—´ usermediansï¼šè®¾ç½®æ¯ä¸ªå…ƒç´ çš„ä¸­ä½æ•°ï¼Œé»˜è®¤ç”±matplotlibè®¡ç®— positionsï¼šè®¾ç½®æ¡†çš„ä½ç½® widthsï¼šè®¾ç½®æ¯ä¸ªæ¡†çš„å®½åº¦ï¼Œæ ‡é‡æˆ–è€…åºåˆ—ï¼Œé»˜è®¤0.5 patch_artistï¼šé»˜è®¤æ˜¯ç”¨äºŒç»´çº¿æ€§ç»˜åˆ¶ï¼ˆLine2D artistï¼‰ labelsï¼šåºåˆ—ï¼Œé•¿åº¦ä¸xä¸€æ ·ï¼Œä¸ºæ¯ä¸ªæ•°æ®é›†è®¾ç½®æ ‡ç­¾ manage_xticksï¼šè°ƒæ•´xlimå’Œxtickçš„ä½ç½®ï¼Œé»˜è®¤True autorangeï¼šæ˜¯å¦ç”¨çº¿çš„å½¢å¼æ¥è¡¨ç¤ºå‡å€¼ï¼Œé»˜è®¤æ˜¯ç‚¹ zorderï¼šè®¾ç½®ç®±çº¿å›¾çš„zorder showcapsï¼šåœ¨ç®±çº¿å›¾ä¸¤ç«¯æ˜¾ç¤ºé‚£ä¸¤æ¡çº¿ï¼Œé»˜è®¤True showboxï¼šæ˜¯å¦æ˜¾ç¤ºä¸­é—´çš„æ¡†ï¼Œé»˜è®¤True showfliersï¼šæ˜¯å¦æ˜¾ç¤ºå¼‚å¸¸å€¼ï¼Œé»˜è®¤True showmeansï¼šæ˜¯å¦æ˜¾ç¤ºå‡å€¼ï¼Œé»˜è®¤False cappropsï¼šæŒ‡å®šä¸¤ç«¯çº¿çš„æ ·å¼ï¼Œdict boxpropsï¼šæŒ‡å®šæ¡†çš„æ ·å¼ï¼Œdict whiskerpropsï¼šæŒ‡å®šé¡»çš„æ ·å¼ï¼Œdict medianpropsï¼šè®¾ç½®ä¸­å€¼çš„æ ·å¼ï¼Œdictï¼ŒNone meanpropsï¼šè®¾ç½®å‡å€¼æ ·å¼ï¼Œdictï¼ŒNone boxplotä¾‹å­123456789101112131415161718192021222324import numpy as npimport matplotlib.pyplot as plt# Fixing random state for reproducibilitynp.random.seed(19680801)# fake up some dataspread = np.random.rand(50) * 100center = np.ones(25) * 50flier_high = np.random.rand(10) * 100 + 100flier_low = np.random.rand(10) * -100# å°†å¤šä¸ªarrayæŒ‰æŒ‡å®šaxisï¼ˆé»˜è®¤ä¸º0ï¼‰åˆå¹¶data = np.concatenate((spread, center, flier_high, flier_low))fig1, ax1 = plt.subplots()ax1.set_title('Box Plot')ax1.boxplot(data, showmeans=True, # æ˜¾ç¤ºå‡å€¼ showfliers=True, # æ˜¾ç¤ºå¼‚å¸¸ç‚¹ flierprops=dict(markerfacecolor='g', marker='D'), # å¼‚å¸¸å€¼æ ·å¼ notch=True, # é»˜è®¤95%çš„ç½®ä¿¡åŒºé—´ï¼Œåœ¨ä¸­å€¼é™„è¿‘ patch_artist=True, #ä½¿ç”¨è‡ªå®šä¹‰é¢œè‰²å¡«å……ç›’å½¢å›¾ï¼Œä¸€å®šè¦å…ˆè®¾ç½®æ‰å¯ä»¥å®šä¹‰é¢œè‰² boxprops = &#123;'color':'black','facecolor':'lightgrey'&#125;, ) æ›´å¤šå…³äºpropså‚æ•°è®¾ç½®æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ æ°´å¹³ç®±çº¿å›¾ 12345fig5, ax5 = plt.subplots()ax5.set_title('Horizontal Boxes')ax5.boxplot(data, vert=False, # æ°´å¹³æ˜¾ç¤º flierprops=dict(markerfacecolor='r', marker='s'), # è®¾ç½®å¼‚å¸¸å€¼ ) è·å–å¹¶æ˜¾ç¤ºå¼‚å¸¸å€¼ 1234567891011121314def show_flier(ax, x, y): for i in range(len(x)): ax.annotate('(%s, %.1f)' % (x[i], y[i]), (x[i],y[i]), xytext=(-0.2+x[i], 0.1+y[i]))fig4, ax4 = plt.subplots()ax4.set_title('Hide Outlier Points')f = ax4.boxplot(data[2], showfliers=True, # ä¸€å®šè¦è®¾ç½®ä¸ºTrueï¼Œä¸ç„¶ä¸ä¼šæ˜¾ç¤ºå¼‚å¸¸å€¼ whis=0.75)for i in f['fliers']: show_flier(ax4, i.get_xdata(), i.get_ydata()) # print(i.get_xdata(), i.get_ydata()) # print(i.get_xydata()) ç›´æ¥è¿”å›äºŒç»´æ•°ç»„]]></content>
      <categories>
        <category>matplotlib</category>
      </categories>
      <tags>
        <tag>matplotlib, boxplot, ç®±çº¿å›¾</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[matplotlibï¼šannotateæ ‡æ³¨]]></title>
    <url>%2Famberwest.github.io%2F2018%2F12%2F12%2Fmatplotlib%EF%BC%9Aannotate%E6%B3%A8%E9%87%8A%2F</url>
    <content type="text"><![CDATA[ç»™å›¾ç‰‡æ·»åŠ æ³¨é‡Šæˆ–è€…æ ‡å‡ºæŸä¸ªæ•°å€¼ï¼Œéœ€è¦ç”¨åˆ°annotateã€‚Figureå¯¹è±¡(plt.annotate)å’ŒAxeså¯¹è±¡(ax.annotate)éƒ½æœ‰annotate()æ–¹æ³•ï¼Œå‚æ•°ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ annotateå‚æ•°å…ˆçœ‹ä¸‹Axes.ax.annotate(*args, **kwargs)çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯matplotlib.axes.Axes.annotateï¼š sï¼šstrï¼Œæ³¨é‡Šæ–‡æœ¬å†…å®¹ xyï¼šå…ƒç»„ï¼Œè¢«æ ‡æ³¨çš„åæ ‡ç‚¹ xytextï¼šå…ƒç»„ï¼Œå¯é€‰ã€‚æ³¨é‡Šæ–‡æœ¬sçš„æ”¾ç½®ä½ç½®ï¼Œé»˜è®¤æ˜¯xy xycoordsï¼šstrï¼ŒArtistï¼ŒTransformï¼Œå¯è°ƒç”¨å¯¹è±¡æˆ–è€…å…ƒç»„ï¼Œxyçš„åæ ‡ç³»ã€‚å‚æ•°å¦‚ä¸‹ï¼š figure pointsï¼šåœ¨figureå·¦ä¸‹æ–¹çš„ç‚¹ figure pixelsï¼šåœ¨figureå·¦ä¸‹æ–¹çš„åƒç´  figure fractionï¼šfigureå·¦ä¸‹è§’çš„æ•°å­—éƒ¨åˆ† axes pointsï¼šåœ¨axeså·¦ä¸‹è§’çš„ç‚¹ axes pixelsï¼šåœ¨axeså·¦ä¸‹è§’çš„åƒç´  axes fractionï¼šåœ¨axeså·¦ä¸‹è§’çš„æ•°å­—éƒ¨åˆ† dataï¼šé»˜è®¤é€‰é¡¹ï¼Œä½¿ç”¨è¢«æ ‡æ³¨å¯¹è±¡çš„åæ ‡ç³» polarï¼šæåæ ‡ç³»ï¼Œ(theta,r) if not native â€˜dataâ€™ coordinates textcoordsï¼šstrï¼ŒArtistï¼ŒTransformï¼Œå¯è°ƒç”¨å¯¹è±¡æˆ–è€…å…ƒç»„ï¼Œxytextç»™å®šçš„åæ ‡ç³»ï¼Œå¯èƒ½è·Ÿxyçš„åæ ‡ç³»ä¸åŒã€‚å‚æ•°å¦‚ä¸‹ï¼š offset pointsï¼šè·ç¦»xyå€¼çš„åç§»é‡ï¼ˆç‚¹ï¼‰ offset pixelsï¼šè·ç¦»xyå€¼çš„åç§»é‡ï¼ˆåƒç´ ï¼‰ é»˜è®¤è·Ÿxycoordsçš„å‚æ•°ä¸€è‡´ arrowpropsï¼šdictï¼Œç»˜åˆ¶æ–‡æœ¬xytextå’Œåæ ‡ç‚¹xyä¹‹é—´çš„ç®­å¤´ã€‚ä¸åŒ…å«arrowstyleå‚æ•°ã€‚å…¶ä»–å‚æ•°å¦‚ä¸‹ widthï¼šç‚¹çš„ç®­å¤´å®½åº¦ headlengthï¼šç®­å¤´åº•éƒ¨çš„å®½åº¦ï¼Œä»¥ç£…ä¸ºå•ä½ shrinkï¼šå°æ•°ï¼Œä»ä¸¤ç«¯æ”¶ç¼©åˆ°æ€»é•¿åº¦çš„ä¸€éƒ¨åˆ† å¦‚æœå«æœ‰arrowstyleå‚æ•°ï¼Œé‚£ä¹ˆä¸Šé¢çš„å‚æ•°éƒ½å¤±æ•ˆã€‚å…·ä½“æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œè¿˜æœ‰å„ç§ä¾‹å­ annotation_clipï¼šæ§åˆ¶æ³¨é‡Šåœ¨AxesåŒºåŸŸå¤–æ˜¯å¦å¯è§ã€‚Trueï¼Œåªå½“ç‚¹xyåœ¨AxesèŒƒå›´å†…æ‰æ˜¾ç¤ºæ³¨é‡Šæ–‡æœ¬ï¼ŒFalseåˆ™ä¸€ç›´éƒ½å¯è§ã€‚é»˜è®¤ä¸ºNoneï¼Œå½“xycoords=â€dataâ€æ—¶ï¼Œç›¸å½“äºTrue annotateåŸºæœ¬ä¾‹å­æ¥è‡ªå®˜æ–¹ä¾‹å­ 1234567891011121314151617import numpy as npimport matplotlib.pyplot as pltfig, ax = plt.subplots()t = np.arange(0.0, 5.0, 0.01)s = np.cos(2*np.pi*t)line = ax.plot(t, s, lw=2) # çº¿# æ–‡æœ¬å†…å®¹æ˜¯local maxï¼Œæ ‡æ³¨çš„ç‚¹æ˜¯xy=(2,1)ï¼Œæ–‡æœ¬æ”¾ç½®çš„ä½ç½®æ˜¯(3,1.5),shrinkæ˜¯ç®­å¤´åˆ°æ–‡æœ¬çš„è·ç¦»æ‰€å æ€»é•¿åº¦çš„æ¯”ä¾‹# æ¢æˆ0.5ï¼Œä¼šçœ‹åˆ°ç®­å¤´åªæœ‰ä»ç‚¹(2,1)å¼€å§‹çš„é‚£å‰åŠèŠ‚ï¼Œfacecoloræ˜¯ç®­å¤´å¡«å……è‰²ax.annotate('local max', xy=(2, 1), xytext=(3, 1.5), arrowprops=dict(facecolor='black', shrink=0.05), )ax.set_ylim(-2, 2)plt.show() Annotate Transformå¦ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„ä¾‹å­ï¼Œé“¾æ¥æ ·å¼(connection style)å¯ä»¥å‚è€ƒå®˜ç½‘ 12345678910111213141516171819202122232425262728293031323334353637import numpy as npimport matplotlib.pyplot as pltx = np.arange(0, 10, 0.005)y = np.exp(-x/2.) * np.sin(2*np.pi*x)fig, ax = plt.subplots()ax.plot(x, y)ax.set_xlim(0, 10)ax.set_ylim(-1, 1)xdata, ydata = 5, 0xdisplay, ydisplay = ax.transData.transform_point((xdata, ydata))print(xdisplay, ydisplay)# æ³¨é‡Šæ–‡æœ¬çš„å¤–æ¡†å’Œåº•è‰²bbox = dict(boxstyle="round", fc="0.8")# è®¾ç½®ç®­å¤´æ ·å¼arrowprops = dict( arrowstyle = "-&gt;", connectionstyle = "angle,angleA=0,angleB=90,rad=10")offset = 72# (xdata, ydata)æ˜¯æ³¨é‡Šçš„ä½ç½®ï¼Œxytextæ˜¯æ–‡æœ¬çš„ä½ç½®ï¼Œéƒ½æ˜¯å…ƒç»„ax.annotate('data = (%.1f, %.1f)'%(xdata, ydata), (xdata, ydata), xytext=(-2*offset, offset), textcoords='offset points', bbox=bbox, arrowprops=arrowprops)disp = ax.annotate('display = (%.1f, %.1f)'%(xdisplay, ydisplay), (xdisplay, ydisplay), xytext=(0.5*offset, -offset), xycoords='figure pixels', textcoords='offset points', bbox=bbox, arrowprops=arrowprops)plt.show()]]></content>
      <categories>
        <category>matplotlib</category>
      </categories>
      <tags>
        <tag>matplotlib</tag>
        <tag>annotate</tag>
        <tag>æ ‡æ³¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€è½¬ã€‘matplotlibï¼šä½¿ç”¨matplotlibè¿›è¡Œpythonç»˜å›¾ï¼ˆæŒ‡å—ï¼‰]]></title>
    <url>%2Famberwest.github.io%2F2018%2F12%2F11%2Fmatplotlib%EF%BC%9A%E4%BD%BF%E7%94%A8matplotlib%E8%BF%9B%E8%A1%8Cpython%E7%BB%98%E5%9B%BE%EF%BC%88%E6%8C%87%E5%8D%97%EF%BC%89%2F</url>
    <content type="text"><![CDATA[åœ¨pythonä¸­ç”»å›¾è‚¯å®šå°‘ä¸äº†matplotlibåº“ï¼Œå‡ è¡Œä»£ç å°±å¯ä»¥å°†ç”»å‡ºåŸºæœ¬å›¾æ¥ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æ—¶å€™è¿˜æ˜¯è¦å»æŸ¥é˜…æ–‡æ¡£æˆ–è€…å»stackover flowæŸ¥æ‰¾ï¼Œå› ä¸ºè¿™ä¸ªåº“çœŸçš„å¤ªåºå¤§äº†ã€‚æœ€è¿‘åˆšå¥½çœ‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œå¯¹matplotlibçš„ä¸€äº›æ¦‚å¿µè§£é‡Šçš„å¾ˆå¥½ï¼Œä¹Ÿæœ‰å¯¹åº”çš„ä¾‹å­ï¼Œæ‰€ä»¥æ ¹æ®æ–‡ç« åšä¸ªç®€åŒ–ç‰ˆç¿»è¯‘ï¼Œæ›´è¯¦ç»†çš„å†…å®¹å¯ä»¥æŸ¥çœ‹åŸæ–‡ã€‚ matplotlibå¯¹è±¡çš„å±‚æ¬¡ç»“æœä½¿ç”¨è¿‡matplotlibï¼Œåº”è¯¥éƒ½ç”¨è¿‡è¿™è¡Œä»£ç plt.plot([1,2,3])ã€‚è¿™ä¸€è¡Œéšè—äº†ä¸€ä¸ªäº‹å®ï¼šä¸€ä¸ªplotå®é™…ä¸Šæ˜¯åµŒå¥—pythonå¯¹è±¡çš„å±‚æ¬¡ç»“æœï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªå›¾ä¸‹é¢éƒ½æœ‰ä¸€ä¸ªmatplotlibå¯¹è±¡çš„æ ‘å½¢ç»“æ„ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸€ä¸ªFigureå¯¹è±¡æ˜¯matplotlibå›¾åƒæœ€å¤–å±‚çš„ä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªAxeså¯¹è±¡(å®é™…ç»˜å›¾çš„ç›’çŠ¶å®¹å™¨)ã€‚å®¹æ˜“å¼•èµ·æ··æ·†çš„ä¸€ä¸ªåŸå› ï¼šAxeså®é™…ä¸Šæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„plotæˆ–è€…graphï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æ‰€è®¤ä¸ºçš„axis/è½´çš„å¤æ•°ã€‚Axeså¯¹è±¡ä¹‹ä¸‹å°±æ˜¯å›¾è¡¨çš„â€œå…ƒç´ â€ï¼Œä¾‹å¦‚ï¼šåˆ»åº¦çº¿ã€çº¿æ¡ã€å›¾ä¾‹ã€æ–‡æœ¬æ¡†ã€åˆ»åº¦ã€æ ‡ç­¾ç­‰ï¼Œéƒ½æ˜¯Axeså¯¹è±¡å¯æ“ä½œçš„pythonå¯¹è±¡ã€‚ æ–‡ä¸­ä»£ç éƒ½æ˜¯åœ¨jupyter notebookä¸­è¿è¡Œçš„ï¼Œæœ€åçš„æ³¨é‡Šå†…å®¹æ˜¯è¾“å‡ºç»“æœï¼Œå› ä¸ºæ‡’å¾—æˆªå›¾äº†ã€‚ã€‚ã€‚ é€šè¿‡ä¾‹å­æ¥é‡æ–°è®¤è¯†matplotlibå§ï¼š 12345678import matplotlib.pyplot as pltimport pandas as pdimport numpy as npfig, _ = plt.subplots()type(fig)# matplotlib.figure.Figure ä¾‹å­ä¸­ä»plt.subplots()ä¸­åˆ›å»ºäº†ä¸¤ä¸ªå˜é‡ï¼Œä¸€ä¸ªfigæ˜¯é¡¶çº§çš„Figureå¯¹è±¡ï¼Œå¦ä¸€ä¸ªæ˜¯æš‚æ—¶ä¸éœ€è¦ç”¨åˆ°çš„â€œä¸€æ¬¡æ€§â€å˜é‡ï¼Œç”¨ä¸‹åˆ’çº¿è¡¨ç¤ºã€‚ä½¿ç”¨å±æ€§è¡¨ç¤ºæ³•ï¼Œå¯ä»¥è½»æ¾éå†å±‚çº§ç»“æ„å¹¶æŸ¥çœ‹ç¬¬ä¸€ä¸ªAxeså¯¹è±¡çš„yè½´çš„ç¬¬ä¸€ä¸ªåˆ»åº¦ 1234one_tick = fig.axes[0].yaxis.get_major_ticks()[0]one_tick# &lt;matplotlib.axis.YTick at 0x7f0b569acac8&gt; ä¾‹å­ä¸­ï¼Œfigï¼ˆä¸€ä¸ªFigureç±»å®ä¾‹ï¼‰æœ‰å¤šä¸ªAxesï¼ˆä¸€ä¸ªåˆ—è¡¨ï¼Œè¿™é‡Œå–ç¬¬ä¸€ä¸ªï¼‰ã€‚æ¯ä¸ªAxeséƒ½æœ‰ä¸€ä¸ªyaxiså’Œxaxisï¼Œæ¯ä¸ªéƒ½æœ‰ä¸€ä¸ªâ€œmajor ticksâ€çš„é›†åˆï¼Œä¾‹å­ä¸­å–ç¬¬ä¸€ä¸ªã€‚ å„ä¸ªéƒ¨åˆ†å¯ä»¥å‚è€ƒä¸‹å›¾ï¼š ä¸Šå›¾çš„ä»£ç å®ç° statefulå’Œstatelessåœ¨è¿›ä¸€æ­¥äº†è§£matplotlibä¹‹å‰ï¼Œéœ€è¦æ˜ç™½stateful(åŸºäºçŠ¶æ€ï¼ŒçŠ¶æ€æœº)å’Œæ— çŠ¶æ€(é¢å‘å¯¹è±¡ï¼ŒOO)æ¥å£ä¹‹é—´çš„åŒºåˆ«ã€‚ å‡ ä¹æ‰€æœ‰æ¥è‡ªpyplotçš„å‡½æ•°ï¼Œå¦‚plt.plot()ï¼Œè¦ä¹ˆéšå¼åœ°æŒ‡å‘ç°æœ‰çš„Figureå¯¹è±¡å’ŒAxeså¯¹è±¡ï¼Œè¦ä¹ˆä¸å­˜åœ¨æ—¶ç›´æ¥åˆ›å»ºæ–°çš„Figureå’ŒAxeså¯¹è±¡ã€‚matplotlibæ–‡æ¡£æ˜¯è¿™æ ·è¯´çš„ï¼š ã€ä½¿ç”¨pyplotã€‘ç®€å•çš„å‡½æ•°æ˜¯ç”¨æ¥ä¸ºå½“å‰Figureå¯¹è±¡çš„Axeså›¾åƒæ·»åŠ å…ƒç´ çš„ï¼ˆçº¿æ¡ï¼Œå›¾ç‰‡ï¼Œæ–‡æœ¬ç­‰ï¼‰ã€å¼ºè°ƒæ·»åŠ ã€‘ â€œplt.plotï¼ˆï¼‰æ˜¯ä¸€ä¸ªéšå¼è·Ÿè¸ªå½“å‰æ•°å­—çš„çŠ¶æ€æœºç•Œé¢ï¼â€åœ¨è‹±è¯­ä¸­ï¼Œè¿™æ„å‘³ç€ï¼š æœ‰çŠ¶æ€æ¥å£ä½¿ç”¨plt.plotï¼ˆï¼‰å’Œå…¶ä»–é¡¶çº§pyplotå‡½æ•°è¿›è¡Œè°ƒç”¨ã€‚åœ¨ç»™å®šçš„æ—¶é—´å†…åªæœ‰ä¸€ä¸ªå›¾æˆ–è½´å¯ä»¥æ“ä½œï¼Œä¸éœ€è¦æ˜ç¡®åœ°å¼•ç”¨å®ƒã€‚ ç›´æ¥ä¿®æ”¹åº•å±‚å¯¹è±¡æ˜¯é¢å‘å¯¹è±¡çš„æ–¹æ³•ã€‚æˆ‘ä»¬é€šå¸¸é€šè¿‡è°ƒç”¨Axeså¯¹è±¡çš„æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼ŒAxeså¯¹è±¡æ˜¯è¡¨ç¤ºç»˜å›¾æœ¬èº«çš„å¯¹è±¡ã€‚ æ•´ä¸ªè¿‡ç¨‹çš„æµç¨‹å°±åƒä¸‹å›¾æ‰€ç¤ºï¼š ç”¨ä»£ç æ¥è¡¨ç¤ºä¸Šè¿°æµç¨‹ï¼š 12345678# plt.plot()è·å–å½“å‰è½´çš„ä¸€ä¸ªæµç¨‹è¡¨ç¤ºï¼Œç¼©ç®€ç‰ˆdef plot(*args, **kwargs): ax = plt.gca() return ax.plot(*args, **kwargs)def gca(**kwargs): """è·å–å½“å‰Figureä¸­çš„Axeså¯¹è±¡""" return plt.gcf().gca(**kwargs) è°ƒç”¨plt.plot()åªæ˜¯è·å–å½“å‰Figureçš„å½“å‰Axeså¯¹è±¡ï¼Œè¿™ä¹Ÿå°±æ˜¯æœ‰çŠ¶æ€æ¥å£æ€»æ˜¯â€œéšå¼è·Ÿè¸ªâ€å®ƒæƒ³è¦å¼•ç”¨çš„å›¾ã€‚ pyplotæ˜¯ä¸€ç³»åˆ—å‡½æ•°çš„é›†åˆï¼Œè¿™äº›å‡½æ•°å®é™…ä¸Šåªæ˜¯matplotlibé¢å‘å¯¹è±¡æ¥å£çš„åŒ…è£…å™¨ã€‚ä¾‹å¦‚ï¼Œplt.title()åœ¨é¢å¯¹å¯¹è±¡æ–¹æ³•ä¸­æœ‰ç›¸åº”çš„setterå’Œgetteræ–¹æ³•ï¼šax.set_title()å’Œax.get_title()ã€‚è°ƒç”¨plt.title()ç­‰åŒäºgca().set_title(s, *args, **kwargs)ï¼Œè¿™è¡Œä»£ç åŒ…å«äº†ä»¥ä¸‹æ“ä½œï¼š gca()è·å–å¹¶è¿”å›å½“å‰Axes set_title()æ˜¯ä¸€ä¸ªsetteræ–¹æ³•ï¼Œç”¨äºè®¾ç½®è¯¥Axeså¯¹è±¡çš„æ ‡é¢˜ã€‚è¿™é‡Œæˆ‘ä»¬å°±ä¸éœ€è¦æ˜ç¡®æŒ‡å®šä»»ä½•å¯¹è±¡çš„plt.title() ç±»ä¼¼åœ°ï¼Œå…¶ä»–é¡¶çº§å‡½æ•°ï¼Œå¦‚plt.grid()ï¼Œplt.legend()å’Œplt.ylabels()ï¼Œéƒ½æ˜¯è·Ÿplt.title()ä¸€æ ·çš„æ“ä½œï¼Œå…ˆæ˜¯è·å–å½“å‰Axesï¼Œgca()è°ƒç”¨å½“å‰Axesçš„ä¸€äº›æ–¹æ³•ã€‚ ç†è§£plt.subplots()æ¥ä¸‹æ¥ä¸»è¦æ˜¯ä¾èµ–äºæ— çŠ¶æ€/é¢å‘å¯¹è±¡æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•å¯å®šåˆ¶æ€§æ›´é«˜ï¼Œå›¾å½¢å˜å¾—æ›´åŠ å¤æ‚æ›´æ´¾å¾—ä¸Šç”¨åœºã€‚åœ¨é¢å‘å¯¹è±¡ä½¿ç”¨å•ä¸ªAxesåˆ›å»ºå¯¹è±¡è§„å®šæ˜¯ä½¿ç”¨plt.subplots()ã€‚è¿™æ˜¯é¢å‘å¯¹è±¡ä½¿ç”¨pyplotåˆ›å»ºFigureå’ŒAxesçš„å”¯ä¸€æ—¶é—´ã€‚ 12345# æ²¡æœ‰ä¼ é€’ä»»ä½•å‚æ•°ï¼Œé»˜è®¤æ˜¯è°ƒç”¨subplots(nrows=1, ncols=1)ï¼Œæ‰€ä»¥è¿”å›ä¸€ä¸ªFigureå’Œä¸€ä¸ªAxesfig, ax = plt.subplots()type(ax)# matplotlib.axes._subplots.AxesSubplot æˆ‘ä»¬å¯ä»¥ç”¨axçš„å®ä¾‹æ–¹æ³•æ¥æ“ä½œç»˜å›¾ï¼Œæ¥ä¸‹æ¥ç”¨ä¸‰ä¸ªæ—¶é—´åºåˆ—çš„å †ç§¯é¢ç§¯å›¾æ¥è¯´æ˜ 1234567891011rng = np.arange(50)rnd = np.random.randint(0, 10, size=(3, rng.size))yrs = 1950 + rngfig, ax = plt.subplots(figsize=(5,3))ax.stackplot(yrs, rng+rnd, labels=['Eastasia', 'Eurasia', 'Oceania'])ax.set_title('Combined debt growth over time')ax.legend(loc='upper left')ax.set_ylabel('Total debt')ax.set_xlim(xmin=yrs[0], xmax=yrs[-1])fig.tight_layout() # tight_layout()ä½œä¸ºä¸€ä¸ªæ•´ä½“åº”ç”¨äºå›¾å½¢å¯¹è±¡æ¥æ¸…ç†ç©ºç™½å¡«å…… å¦‚æœæ˜¯ä¸€ä¸ªFigureä¸­åŒ…å«å¤šä¸ªAxes/å­å›¾å‘¢ï¼Ÿä¸‹é¢ç”¨ç¦»æ•£å‡åŒ€åˆ†å¸ƒç»˜åˆ¶ä¸¤ä¸ªç›¸å…³æ•°ç»„ï¼Œè·Ÿä¸Šä¸€ä¸ªä¾‹å­çš„ä¸åŒç‚¹å¯ä»¥æŸ¥çœ‹ä»£ç é‡Œçš„æ³¨é‡Š 12345678910111213141516x = np.random.randint(low=1, high=11, size=50)y = x + np.random.randint(1, 5, size=x.size)data = np.column_stack((x, y)) # column_stackå°†å¤šä¸ªä¸€ç»´arrayä½œä¸ºcolumnè½¬ä¸ºå¤šç»´æ•°ç»„# 1.åˆ›å»ºä¸€ä¸ªFigureå’Œä¸¤ä¸ªAxesï¼Œä¹Ÿå¯ä»¥ç”¨fig, axs = plt.subplots(1, 2, figsize=(8,4))# 2.åˆ†åˆ«å¤„ç†ä¸¤ä¸ªå­å›¾fig, (ax1, ax2) = plt.subplots(nrows=1, ncols=2, figsize=(8, 4))ax1.scatter(x, y, marker='o', c='r', edgecolor='b') # edgecolorè®¾ç½®markerè¾¹ç¼˜é¢œè‰²ax1.set_xlabel('$x$') # åŠ äº†$ç¬¦å·ï¼Œxï¼Œyä¼šå˜æˆæ–œä½“ax1.set_ylabel('$y$') # labelå®šä¹‰ä¸¤ç»„æ•°æ®å¯¹åº”çš„æ ‡ç­¾ï¼ŒDataFrameä¸€èˆ¬ä¸éœ€è¦ï¼Œå› ä¸ºæœ‰columnsax2.hist(data, bins=np.arange(data.min(), data.max()), label=('x', 'y')) ax2.legend(loc=(0.7, 0.8))ax2.set_title('Frequencies of $x$ and $y$')ax2.yaxis.tick_right() # å°†ax2çš„yè½´tickè®¾ç½®åœ¨å³è¾¹ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¤šä¸ªAxeséƒ½æ˜¯åŒ…å«åœ¨ç»™å®šçš„Figureä¸­çš„ã€‚å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œfig.axesèƒ½è·å–åˆ°æ‰€æœ‰çš„Axeså¯¹è±¡åˆ—è¡¨ 12(fig.axes[0] is ax1, fig.axes[1] is ax2) # è¿™é‡Œçš„fig.axesä¸­çš„axesæ˜¯å°å†™# (True, True) æˆ‘ä»¬è¿˜å¯ä»¥åˆ›å»ºä¸€ä¸ªåŒ…å«2*2Axeså¯¹è±¡çš„ç½‘æ ¼å›¾å½¢Figure 1234567891011121314fig, ax = plt.subplots(nrows=2, ncols=2, figsize=(7, 7))type(ax) # å¯ä»¥çœ‹åˆ°ï¼Œaxæ˜¯numpyçš„æ•°ç»„ç±»å‹# numpy.ndarrayax""" array([[&lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f0b541b29b0&gt;, &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f0b547d2710&gt;], [&lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f0b548efc88&gt;, &lt;matplotlib.axes._subplots.AxesSubplot object at 0x7f0b5451e240&gt;]], dtype=object)"""ax.shape# (2, 2) axæ˜¯æ•°ç»„ç±»å‹ï¼Œéœ€è¦ä½¿ç”¨flattenå‡½æ•°å°†æ•°ç»„å¹³å±•ä¸ºä¸€ç»´çš„æ‰èƒ½ä½¿ç”¨ 123ax1, ax2, ax3, ax4 = ax.flatten()# or((ax1, ax2), (ax3, ax4)) = ax ä¸ºäº†å±•ç¤ºæ›´å¤šçš„ç”¨æ³•ï¼Œæ¥ä¸‹æ¥ä½¿ç”¨åŠ åˆ©ç¦å°¼äºšå·çš„æˆ¿ä»·æ•°æ® 12345678910111213141516171819202122232425262728293031# è·å–æ•°æ®ã€‚åŸæ–‡æ˜¯é€šè¿‡ä»£ç ä¸‹è½½è§£å‹æ•°æ®çš„housing = np.loadtxt('CaliforniaHousing/cal_housing.data', delimiter=',')y = housing[:, -1]pop, age = housing[:, [4, 7]].T # popåœ°åŒºäººå£ï¼Œageæ˜¯æˆ¿å­çš„å¹³å‡å±‹é¾„def add_titlebox(ax, text): """åœ¨Axesä¸­æ·»åŠ æ–‡æœ¬""" ax.text(.55, .8, text, horizontalalignment='center', transform=ax.transAxes, bbox=dict(facecolor='white', alpha=0.6), fontsize=12.5) return ax# åˆ›å»ºå¸¦æœ‰å¤šä¸ªAxesçš„Figureç½‘æ ¼gridsize = (3, 2)fig = plt.figure(figsize=(12, 8))ax1 = plt.subplot2grid(gridsize, (0, 0), colspan=2, rowspan=2) # ax1å ç”¨ä¸¤è¡Œä¸¤åˆ—ax2 = plt.subplot2grid(gridsize, (2, 0)) # ax2åœ¨ç¬¬ä¸‰è¡Œç¬¬ä¸€åˆ—ax3 = plt.subplot2grid(gridsize, (2, 1)) # ax3åœ¨ç¬¬ä¸‰è¡Œç¬¬äºŒåˆ—# ax1æ˜¯æ•£ç‚¹å›¾ï¼Œå¹¶å¸¦æœ‰colormapï¼Œå…¶ä»–ä¸¤ä¸ªå›¾ä¸ºç›´æ–¹å›¾ï¼ˆæŸ¥çœ‹æ•°æ®åˆ†å¸ƒï¼‰ax1.set_title('Home value as a function of home age and area population', fontsize=14)# cæ˜¯colorï¼Œyçš„åºåˆ—æ˜ å°„åˆ°cmapï¼Œè¿™æ ·yçš„å€¼ä¸cmapçš„é¢œè‰²å¯ä»¥ä¸€ä¸€å¯¹åº”ä¸Šï¼Œcmapé€‰æ‹©é¢œè‰²å˜åŒ–ï¼Œè·Ÿå‚æ•°cç»“åˆä½¿ç”¨sctr = ax1.scatter(x=age, y=pop, c=y, cmap='RdYlGn') plt.colorbar(sctr, ax=ax1, format='$%d')ax2.hist(age, bins='auto') # binså¯ä»¥æ˜¯æ•´æ•°ï¼Œåºåˆ—æˆ–è€…â€˜autoâ€™ax3.hist(pop, bins='auto', log=True) # logæ ‡ç­¾æ˜¾ç¤ºä¸ºlogå½¢å¼add_titlebox(ax2, 'Histogram: home age')add_titlebox(ax3, 'Histogram: area population (log scl.)') è·Ÿcolor mapä¸ä¸€æ ·çš„æ˜¯ï¼Œcolorbar()æ˜¯ç”±Figureç›´æ¥è°ƒç”¨ï¼Œè€Œä¸æ˜¯Axeså¯¹è±¡ï¼Œå¹¶ä¸”ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ•£ç‚¹å›¾çš„è¿”å›ç»“æœï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯å°†yå€¼æ˜ å°„åˆ°color mapã€‚åœ¨yè½´ä¸Šï¼Œæˆ¿ä»·å¹¶æ²¡æœ‰å¤ªå¤§çš„å˜åŒ–(é¢œè‰²)ï¼Œxè½´ä¸Šåˆ™ç”±æ˜æ˜¾å˜åŒ–ï¼Œè¯´æ˜å±‹é¾„æ˜¯æˆ¿å±‹ä»·å€¼çš„ä¸€ä¸ªæ›´å¤§çš„å†³å®šå› ç´  å±å¹•åé¢çš„â€œFiguresâ€æ¯æ¬¡è°ƒç”¨plt.subplots()æˆ–è€…plt.figure()(åªåˆ›å»ºFigureï¼Œæ²¡æœ‰Axes)ï¼Œéƒ½ä¼šåœ¨å†…å­˜é‡Œæ–°å»ºä¸€ä¸ªFigureå¯¹è±¡ã€‚åœ¨ç»ˆç«¯è¿è¡Œçš„ç»“æœè·ŸåŸæ–‡ä¸€æ ·ï¼Œå¦‚æœæ˜¯åœ¨jupyter notebookåˆ™æ¯ä¸€æ¬¡è¿”å›idéƒ½ä¸åŒã€‚ 12345678910&gt;&gt;&gt; fig1, ax1 = plt.subplots()&gt;&gt;&gt; id(fig1)4525375272&gt;&gt;&gt; id(plt.gcf()) # fig1æ˜¯å½“å‰Figureå¯¹è±¡4525375272&gt;&gt;&gt; fig2, ax2 = plt.subplots()&gt;&gt;&gt; id(fig2) == id(plt.gcf()) # å½“å‰Figureå¯¹è±¡å·²ç»æ›´æ”¹ä¸ºfig2True&gt;&gt;&gt; plt.get_fignums()[1, 2] å¯ä»¥é€šè¿‡plt.figure()è·å–åˆ°å­˜åœ¨å†…å­˜ä¸­çš„Figure 12345def get_all_figures(): return [plt.figure(i) for i in plt.get_fignums()]get_all_figures()# [&lt;Figure size 640x480 with 1 Axes&gt;, &lt;Figure size 640x480 with 1 Axes&gt;] ä½¿ç”¨plt.close()æ–¹æ³•åˆ™å¯ä»¥å…³é—­å¯¹åº”çš„figure 12plt.close(num) # å…³é—­åºå·ä¸ºnumçš„Figureplt.close('all') # å…³é—­å…¨éƒ¨ imshowå’Œmatshowé™¤äº†plt.plot()å¯ä»¥ç»˜å›¾ä¹‹åï¼Œè¿˜æœ‰å…¶ä»–çš„æ–¹æ³•ï¼Œå¦‚ï¼šimshow()å’Œmatshow()ã€‚åè€…æ˜¯å‰è€…çš„å°è£…ã€‚åªè¦åŸå§‹æ•°å€¼æ•°ç»„å¯ä»¥æ˜¾ç¤ºä¸ºå½©è‰²ç½‘æ ¼ï¼Œå°±å¯ä»¥ä½¿ç”¨ã€‚ ä¾‹å­ï¼š 123456789101112131415161718192021222324252627# åˆ›å»ºä¸¤ä¸ªæ•°ç»„x = np.diag(np.arange(2, 12))[::-1]x[np.diag_indices_from(x[::-1])] = np.arange(2, 12)x2 = np.arange(x.size).reshape(x.shape)# ä½¿ç”¨å­—å…¸å‚æ•°ï¼Œå°†æ‰€æœ‰çš„è½´æ ‡ç­¾å’Œåˆ»åº¦éƒ½ä¸æ˜¾ç¤ºsides = ('left', 'right', 'top', 'bottom')nolabels = &#123;s: False for s in sides&#125;nolabels.update(&#123;'label%s' % s: False for s in sides&#125;)from mpl_toolkits.axes_grid1.axes_divider import make_axes_locatable# ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ¥ç¦ç”¨ç½‘æ ¼ï¼Œå¹¶åœ¨æ¯ä¸ªAxesä¸Šä½¿ç”¨matshow()with plt.rc_context(rc=&#123;'axes.grid': False&#125;): fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(8, 4)) ax1.matshow(x) img2 = ax2.matshow(x2, cmap='RdYlGn_r') # åŠ ä¸Š_rå°±æ˜¯å°†é¢œè‰²åè½¬ for ax in (ax1, ax2): ax.tick_params(axis='both', which='both', **nolabels) for i, j in zip(*x.nonzero()): ax1.text(j, i, x[i,j], color='white', ha='center', va='center') # å°†colorbarä½œä¸ºå›¾ä¸­çš„æ–°è½´ divider = make_axes_locatable(ax2) cax = divider.append_axes('right', size='5%', pad=0) plt.colorbar(img2, cax=cax, ax=[ax1, ax2]) fig.suptitle('Heatmaps with `Axes.matshow`', fontsize=16) pandasä¸­çš„ç»˜å›¾pandasçš„DataFrameå’ŒSeriesä¸Šçš„plot()æ˜¯plt.plot()çš„å°è£…ï¼Œæ‰€ä»¥åœ¨pandasç»˜å›¾ä¹Ÿæ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚å¦‚æœDataFrameçš„ç´¢å¼•æ˜¯mdateï¼Œpandasè°ƒç”¨gcf().autofmt_xdate()æ¥è·å–å½“å‰çš„å›¾å¹¶è‡ªåŠ¨æ ¼å¼åŒ–xè½´ã€‚plt.plot()æ˜¯åŸºäºçŠ¶æ€çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯éšå¼çš„çŸ¥é“å½“å‰çš„Figureå’ŒAxesï¼Œpandasä¹Ÿæ˜¯éµå¾ªè¿™ç‚¹è¿›è¡Œæ‰©å±•çš„ã€‚ 12345678s = pd.Series(np.arange(5), index=list('abcde'))ax = s.plot()type(ax)# matplotlib.axes._subplots.AxesSubplotid(plt.gca()) == id(ax)# True æ¥ä¸‹æ¥ç”¨ä¸€ä¸ªæ—¶é—´åºåˆ—çš„ä¾‹å­æ¥çœ‹ä¸€ä¸‹pandasä¸­çš„ç”»å›¾ 123456789101112131415161718192021222324import matplotlib.transforms as mtransformsvix = pd.read_csv('VIXCLS.csv', index_col=0, parse_dates=True, na_values='.', infer_datetime_format=True, squeeze=True).dropna()ma = vix.rolling('90d').mean()state = pd.cut(ma, bins=[-np.inf, 14, 18, 24, np.inf], labels=range(4))cmap = plt.get_cmap('RdYlGn_r')ma.plot(color='black', linewidth=1.5, marker='', figsize=(8, 4), label='VIX 90d MA')ax = plt.gca()ax.set_xlabel('')ax.set_ylabel('90d moving average: CBOE VIX')ax.set_title('Volatility Regime State')ax.grid(False)ax.set_xlim(xmin=ma.index[0], xmax=ma.index[-1])trans = mtransforms.blended_transform_factory(ax.transData, ax.transAxes)for i, color in enumerate(cmap([0.2, 0.4, 0.6, 0.8])): ax.fill_between(ma.index, 0, 1, where=state==i, facecolor=color, transform=trans)ax.axhline(vix.mean(), linestyle='dashed', color='xkcd:dark grey', alpha=0.6, label='Full-period mean', marker='')ax.legend(loc='upper center') ä¸Šé¢çš„ä¾‹å­ä¸­æœ‰ä¸€äº›ç‚¹éœ€è¦äº†è§£ä¸€ä¸‹ï¼š maæ˜¯VIXæŒ‡æ•°çš„90å¤©ç§»åŠ¨å¹³å‡çº¿ï¼Œè¡¡é‡è¿‘æœŸè‚¡å¸‚æ³¢åŠ¨çš„å¸‚åœºé¢„æœŸã€‚stateæ˜¯å°†ç§»åŠ¨å¹³å‡çº¿åˆ†ç±»ä¸ºä¸åŒçš„stateã€‚é«˜VIXè¢«è¡¨ç¤ºå¸‚åœºä¸­ææƒ§ç¨‹åº¦åŠ å‰§ã€‚ cmapæ˜¯color mapï¼Œmatplotlibå¯¹è±¡ã€‚å®ƒå®è´¨ä¸Šæ˜¯æµ®ç‚¹æ•°åˆ°RGBAé¢œè‰²çš„æ˜ å°„ã€‚â€™_ræ˜¯é¢œè‰²åè½¬ã€‚ pandasè°ƒç”¨ma.plot()ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨äº†plt.plot()ã€‚å› æ­¤ä¸ºäº†ç»§æ‰¿é¢å‘å¯¹è±¡ï¼Œéœ€è¦é€šè¿‡ax=plt.gca()æ¥æ˜¾ç¤ºå¼•ç”¨å½“å‰çš„Axeså¯¹è±¡ã€‚ æœ€åä¸€æ®µä»£ç æ˜¯åˆ›å»ºäº†ä¸æ¯ä¸ªçŠ¶æ€å¯¹åº”çš„é¢œè‰²å¡«å……å—ã€‚cmap([0.2, 0.4, 0.6, 0.8])æ˜¯æŒ‡æ²¿ç€color mapçš„å…‰è°±ï¼Œåœ¨20%ï¼Œ40%ï¼Œ60%ï¼Œ80%çš„ä½ç½®è·å–RGBAåºåˆ—ã€‚ä½¿ç”¨enumerate()å°†æ¯ä¸ªRGBAé¢œè‰²è·Ÿstateä¸€ä¸€å¯¹åº”ã€‚ åŸæ–‡æœ€åè¿˜ç»™å‡ºäº†å¾ˆå¤šä¸é”™çš„é“¾æ¥æ¨èï¼Œå€¼å¾—å­¦ä¹ ã€‚]]></content>
      <categories>
        <category>matplotlib</category>
      </categories>
      <tags>
        <tag>matplotlib, ç”»å›¾</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ©ç”¨pandasè·å–å‰kä¸ªæ•°æ®]]></title>
    <url>%2Famberwest.github.io%2F2018%2F11%2F29%2Fpandas%EF%BC%9A%E8%8E%B7%E5%8F%96%E5%89%8Dk%E4%B8%AA%E6%95%B0%E6%8D%AE%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘åœ¨çœ‹SQLï¼Œä»€ä¹ˆæ¯ç§‘æˆç»©å‰ä¸‰åï¼Œçœ‹å¾—æˆ‘å¥½æ‡µã€‚pandaså…¶å®ä¹Ÿæœ‰ä¸ªnlargestæ–¹æ³•å¯ä»¥ç®€å•å®ç°è¿™ä¸€éœ€æ±‚ nlargestæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œdf.nlargest(n, columns, keep=&#39;first&#39;)ï¼Œè¿”å›columnså‰né¡¹çš„æ•°æ®ï¼Œé»˜è®¤æ˜¯é™åºã€‚ æ•°æ®ï¼š 12345678910import pandas as pdraw_df = &#123; 'subject': ['chinese', 'chinese','chinese','chinese','english','english', 'english', 'english','math','math', 'math', 'math'], 'grade': ['first', 'first', 'second', 'second', 'first', 'first', 'second', 'second', 'first', 'first', 'second', 'second'], 'teacher': ['a', 'a', 'a', 'a', 'b', 'b', 'b', 'b', 'c', 'c', 'c', 'c'], 'student': [10, 12, 14, 23,10, 12, 14, 23,10, 12, 14, 23], 'avg_score': [56, 56, 45, 76, 77, 85, 68, 79, 73, 76, 70, 85]&#125;df = pd.DataFrame(raw_df)df è·å–å¹³å‡åˆ†æœ€é«˜çš„å‰ä¸‰é¡¹ï¼š å› ä¸ºnlargestå‡½æ•°æ²¡æœ‰é€†åºï¼Œå¦‚æœè¦å–å¹³å‡åˆ†æœ€ä½çš„ä¸‰é¡¹ï¼Œå¯ä»¥å€ŸåŠ©è¾…åŠ©é¡¹ï¼Œaxis=1æ˜¯åœ¨åˆ—æ–¹å‘ä¸Šåˆ é™¤å¤šä½™çš„é¡¹ å¦‚æœæƒ³è¦è·å¾—æ¯ä¸ªç§‘ç›®çš„æœ€é«˜åˆ†ï¼Œç›´æ¥ç”¨groupbyï¼Œç„¶åå†å–æœ€å¤§å€¼å³å¯ã€‚groupbyä¸­æœ‰ä¸ªas_index=Trueè®¾ç½®ä¸ºFalseï¼Œé‚£ä¹ˆåˆ†ç»„çš„åˆ—å°±ä½œä¸ºæ™®é€šçš„åˆ—ï¼Œè€Œä¸æ˜¯indexã€‚ å¦‚æœæƒ³è¦å–å¾—æ¯ä¸ªç§‘ç›®çš„å¹³å‡åˆ†çš„å‰2åï¼Œå†åˆ†ç»„ä¹‹åå¯ä»¥ä½¿ç”¨applyæ–¹æ³•å°†nlargeståº”ç”¨åˆ°æ¯ä¸ªå°ç»„ å¦‚æœè¿˜æƒ³åœ¨æ­¤åŸºç¡€ä¸Šè®¡ç®—å…¶ä»–çš„ï¼Œæ¯”å¦‚æ±‚å’Œå•Šï¼Œæ±‚å¹³å‡å€¼å•Šï¼Œåªè¦ç»§ç»­ä¿®æ”¹ä¸€ä¸‹å°±å¯ä»¥ å…³äºgroupbyä¹‹åçš„æƒ…å†µ groupbyçš„ç›¸å…³å‚æ•° 1Signature: df.groupby(by=None, axis=0, level=None, as_index=True, sort=True, group_keys=True, squeeze=False, observed=False, **kwargs)]]></content>
      <categories>
        <category>pandas</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>nlargest</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç”¨pyinstallæ‰“åŒ…pythoné¡¹ç›®ä¸ºexeæ–‡ä»¶åŠå…¶é—®é¢˜æ€»ç»“]]></title>
    <url>%2Famberwest.github.io%2F2018%2F11%2F12%2F%E7%94%A8pyinstall%E6%89%93%E5%8C%85python%E9%A1%B9%E7%9B%AE%E4%B8%BAexe%E6%96%87%E4%BB%B6%E5%8F%8A%E5%85%B6%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93%2F</url>
    <content type="text"><![CDATA[ä¸ºäº†å¯ä»¥åœ¨æ²¡æœ‰å®‰è£…pythonçš„ç¯å¢ƒä¸‹è¿è¡Œç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦å°†ç¨‹åºæ‰“åŒ…ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿™æ¬¡ç”¨çš„pyinstallæ¨¡å—ï¼Œæ“ä½œæ–¹ä¾¿ï¼ˆè™½ç„¶å‰é¢ä¹Ÿè¸©äº†å¥½å¤šå‘ï¼‰ï¼Œå‘çš„ä¸€ç‚¹å°±æ˜¯ï¼Œæƒ³è¦åœ¨ä»€ä¹ˆå¹³å°ä¸‹ä½¿ç”¨ï¼Œå°±éœ€è¦åœ¨å¯¹åº”çš„å¹³å°ä¸Šè¿›è¡Œæ‰“åŒ…ã€‚æ¯”å¦‚è¯´è¿™æ¬¡å§ï¼Œå› ä¸ºè¦åœ¨Windowsç³»ç»Ÿä¸‹ä½¿ç”¨ï¼Œæˆ‘åªèƒ½ä¸´æ—¶æ­ä¸ªWindowsè™šæ‹Ÿæœºè¿›è¡Œæ‰“åŒ…ã€‚ å®‰è£…å®‰è£…å¾ˆç®€å•ï¼Œç›´æ¥ç”¨pipå‘½ä»¤ 1pip install pyinstall æ‰“åŒ…ä¸ç®¡æ˜¯ç®€å•è¿˜æ˜¯å¤æ‚çš„é¡¹ç›®ï¼Œåªéœ€è¦å¯¹å…¥å£æ–‡ä»¶ï¼ˆå¯åŠ¨æ•´ä¸ªé¡¹ç›®çš„pyæ–‡ä»¶ï¼‰è¿›è¡Œæ‰“åŒ…å³å¯ã€‚ appç›®å½•ä¸‹åªæœ‰ä¸€ä¸ªæ–‡ä»¶p.pyï¼Œå†…å®¹å¦‚ä¸‹ 1print('test pyinstaller') è¿›å…¥appæ ¹ç›®å½•ï¼Œæ‰“åŒ… 1pyinstaller p.py è¿è¡Œå‘½ä»¤ä¹‹åï¼Œçœ‹åˆ°ä»¥ä¸‹è¾“å‡ºå°±è¯´æ˜æˆåŠŸäº† 123456â€¦4583 INFO: Building EXE from EXE-00.toc completed successfully.4585 INFO: checking COLLECT4586 INFO: Building COLLECT because COLLECT-00.toc is non existent4586 INFO: Building COLLECT COLLECT-00.toc5412 INFO: Building COLLECT COLLECT-00.toc completed successfully. è¿™æ—¶å€™appç›®å½•ä¸‹å¤šäº†ä¸¤ä¸ªæ–‡ä»¶å¤¹å’Œspecæ–‡ä»¶ï¼Œå…¶ä¸­specæ–‡ä»¶æ˜¯æœ€å…ˆç”Ÿæˆçš„ï¼Œpyinstallerå†æ ¹æ®è¿™ä¸ªæ–‡ä»¶è¿›è¡Œæ‰“åŒ…ã€‚æ‰€ä»¥å¯¹äºæ¯”è¾ƒå¤æ‚çš„é¡¹ç›®ï¼Œå¯ä»¥å…ˆç”Ÿæˆspecï¼Œä¿®æ”¹é‡Œé¢å¯¹åº”çš„é…ç½®ï¼Œæ¯”å¦‚æ·»åŠ å…¶ä»–éœ€è¦çš„å¤šåª’ä½“æ–‡ä»¶ç­‰ åŒå‡»distä¸‹çš„på¯æ‰§è¡Œæ–‡ä»¶å°±å¯ä»¥æ­£å¸¸è¿è¡Œç¨‹åºäº† åœ¨æ‰“åŒ…ç¨‹åºçš„æ—¶å€™å¯ä»¥æŒ‡å®šå‚æ•°onefileï¼Œè¿™æ ·æ‰“åŒ…å‡ºæ¥çš„distä¸‹å°±åªæœ‰ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸è¿‡è¿è¡Œé€Ÿåº¦å¯èƒ½ä¼šç¨å¾®æ…¢ä¸€ç‚¹ 1pyinstaller --onefile p.py è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶æ—¶ä¼šå‡ºç°ç»ˆç«¯çª—å£ï¼Œå¦‚æœä¸å¸Œæœ›çœ‹åˆ°ï¼Œå¯ä»¥ä½¿ç”¨wå‚æ•° 1pyinstall --onefile -w p.py å…¶ä»–æ›´è¯¦ç»†çš„ä½¿ç”¨å’Œé…ç½®ï¼ŒæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ å¯èƒ½é‡åˆ°çš„é—®é¢˜ OSError: Python library not found: Python, libpython3.5m.dylib, libpython3.5.dylib, .Python æˆ‘æ˜¯åœ¨pyenvåˆ›å»ºçš„ç¯å¢ƒä¸‹å®‰è£…ä½¿ç”¨pyinstallæ¨¡å—çš„ï¼Œä¹‹æ‰€ä»¥ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºpythonåœ¨å®‰è£…pyenvæ—¶æ²¡æœ‰æ‰§è¡Œ--enabled-sharedã€‚é‡æ–°å®‰è£…å³å¯ 12345678# æ£€æŸ¥echo $&#123;PYENV_ROOT&#125;/versions/3.5.3/Python.framework# æ›´æ–°env PYTHON_CONFIGURE_OPTS="--enable-shared" pyenv install 3.5.0# é‡æ–°æ‰“åŒ…pyinstaller --onefile p.py AttributeError: â€˜strâ€™ object has no attribute â€˜itemsâ€™ å…³äº†pycharmç¼–è¾‘å™¨å°±ä¸æŠ¥é”™äº†ã€‚ã€‚ã€‚ windowsä¸‹è·¯å¾„é—®é¢˜ å› ä¸ºé¡¹ç›®æ˜¯åœ¨unixä¸‹å¼€å‘çš„ï¼Œæµ‹è¯•æ—¶åœ¨Windowsä¸‹è¿›è¡Œçš„ï¼Œå½“æ—¶ä¹Ÿæ²¡æŠ¥é”™ï¼Œå°±æ˜¯æ‰¾ä¸åˆ°è¿è¡Œä¹‹åä¿å­˜çš„æ•°æ®æ–‡ä»¶ã€‚åé¢æƒ³äº†æƒ³ï¼Œå¯èƒ½è¿˜æ˜¯è·¯å¾„çš„é—®é¢˜ã€‚æ‰€ä»¥å°†ä»£ç éœ€è¦ç”¨åˆ°çš„è·¯å¾„çš„ä»£ç éƒ½æ”¹äº†æˆç±»ä¼¼E:/dataè¿™æ ·çš„è·¯å¾„ã€‚æœç„¶å°±å¯ä»¥äº†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒWindowsä¸‹çš„è·¯å¾„ä¸€èˆ¬æ˜¯E:\dataï¼Œä½†æ˜¯\æ˜¯è½¬ä¹‰ç¬¦ï¼Œæ‰€ä»¥è¦ä¹ˆå†™æˆä¸Šé¢é‚£æ ·ï¼Œè¦ä¹ˆè¿›è¡Œåè½¬ä¹‰ï¼Œæ¯”å¦‚ï¼šE:\\data å‚è€ƒusing spec files pyenv issue Python 3.5 - missing libpython3.5m.so (shared library)]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>pyinstall</tag>
        <tag>exe</tag>
        <tag>æ‰“åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mongodb shellä¸mongodb serverç‰ˆæœ¬ä¸ä¸€è‡´å¼•èµ·çš„é—®é¢˜]]></title>
    <url>%2Famberwest.github.io%2F2018%2F11%2F06%2Fmongodb-shell%E4%B8%8Emongodb-server%E7%89%88%E6%9C%AC%E4%B8%8D%E4%B8%80%E8%87%B4%E5%BC%95%E8%B5%B7%E7%9A%84%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘ä»æœåŠ¡å™¨çš„mongodbå¯¼å‡ºæ•°æ®æ—¶é‡åˆ°é—®é¢˜Unrecgonized field &#39;snapshot&#39;ï¼Œä¸€å¼€å§‹ä»¥ä¸ºæ˜¯æˆ‘æŠŠè¦æå–çš„å­—æ®µåç»™å†™é”™äº†ï¼Œå‰å‰ååå¯¹äº†å¥½å‡ æ¬¡ï¼Œè¿˜æ˜¯æœ‰é”™ã€‚å…·ä½“é”™è¯¯æç¤ºçœ‹ä¸‹å›¾ï¼š é”™è¯¯åŸå› å…¶å®è¿™å°±æ˜¯å› ä¸ºæœ¬åœ°çš„mongodb shellç‰ˆæœ¬è·ŸæœåŠ¡å™¨mongodb serverç‰ˆæœ¬ä¸ä¸€è‡´é€ æˆçš„ã€‚ä¸€ç›´éƒ½æ²¡æœ‰æ³¨æ„åˆ°è¿™ä¸ªé—®é¢˜ï¼Œæ˜¯å› ä¸ºæ¯æ¬¡è¿œç¨‹è¿æ¥mongoï¼Œéƒ½èƒ½å¤Ÿæ­£å¸¸è¿›è¡ŒæŸ¥è¯¢ã€åˆ é™¤æ“ä½œã€‚ä»å›¾ç‰‡ä¸Šä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œç‰ˆæœ¬ä¸åŒï¼Œè€Œä¸”ä¹Ÿæœ‰warningã€‚ è§£å†³æ–¹æ³•é™ä½ç‰ˆæœ¬å¯¹äºè¿™ä¸ªæƒ…å†µï¼Œç½‘ä¸Šå¤§éƒ¨åˆ†éƒ½æ˜¯é€šè¿‡é™ä½å…¶ä¸­ä¸€ä¸ªçš„ç‰ˆæœ¬ï¼Œå†æ¢æˆå¯¹åº”ç‰ˆæœ¬çš„ã€‚ä¸è¿‡è¿‡ç¨‹æœ‰ç‚¹åå·ï¼Œæ¢äº†æœ¬åœ°çš„mongo shellï¼Œè¿å¸¦mongoä¹Ÿè¦æ›´æ–°ï¼Œéº»çƒ¦ï¼Œè€Œä¸”åœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¸æ˜¯é‚£ä¹ˆé¡ºåˆ©ã€‚ã€‚ã€‚ æƒ³é€šè¿‡é™ä½mongodb serverçš„ç‰ˆæœ¬ï¼Œç»“æœéœ€è¦éªŒè¯ éªŒè¯ä¹‹åè¿˜æ˜¯ä¸è¡Œ å°±ç®—éªŒè¯è¿‡äº†ï¼Œè¿˜è¦é‡æ–°å®‰è£…é…ç½®ä¸€éï¼Œæƒ³æƒ³éƒ½å¿ƒç´¯ã€‚ pythonè„šæœ¬è™½ç„¶ç›´æ¥è¿æ¥æ‹¿ä¸åˆ°æ•°æ®ï¼Œä½†æ˜¯å¯ä»¥ç”¨pymongoå»è¿æ¥æ•°æ®åº“ï¼Œè¯»å‡ºæ•°æ®ä¿å­˜åˆ°excelä¸­ã€‚ 123456789101112131415161718192021from pymongo import MongoClientimport pandas as pd# å‡è®¾æ•°æ®åº“ã€è´¦å·ã€å¯†ç éƒ½æ˜¯houseuri = "mongodb://house:house@193.111.222.33:27017/?authSource=house"client = MongoClient(uri)db = client['house']table = db['houseâ€™]data = table.find(&#123;&#125;, &#123;'_id': 0&#125;)df = pd.DataFrame()data_list = []for i, item in enumerate(data): data_list.append(item)# for key in item.keys():# print(item)# value = str(item[key]) if isinstance(item[key], list) else item[key]# df.loc[i, key] = item[key]df = pd.DataFrame(data_list)df.to_excel('house.xlsx', header=True, startrow=0, index=False) è¿œç¨‹ä¼ è¾“æ‡’å¾—å†™ä»£ç å¯ä»¥ç™»å½•ç™»å½•æœåŠ¡å™¨ï¼Œåœ¨æœåŠ¡å™¨ä¸Šå…ˆå¯¼å‡ºæ•°æ®ï¼Œç„¶åå†ç”¨scpä¼ è¾“åˆ°æœ¬åœ° 12345# è¿œç¨‹æœåŠ¡å™¨ ssh username:ipmongoexport --username house --password house --db house --collection house --type=csv --fields url,address,area,city,district,house_disposal,house_type,pay_type,pics,phone,rent,rent_type,title --out ~/house.csv# åœ¨æœ¬åœ°è¿œç¨‹è¿æ¥å¹¶ä¸‹è½½scp username@193.111.222.33:/home/amber/house.csv ~/Desktop/house.csv å‚è€ƒæ–‡ç« mongoexport downgrade]]></content>
      <tags>
        <tag>mongodb</tag>
        <tag>ç‰ˆæœ¬ä¸ä¸€è‡´</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨dockerç®¡ç†jupyter]]></title>
    <url>%2Famberwest.github.io%2F2018%2F11%2F06%2F%E4%BD%BF%E7%94%A8docker%E7%AE%A1%E7%90%86jupyter%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨dockeræ¥ç®¡ç†jupyterï¼Œå¯ä»¥æ‘†è„±å„ç§çƒ¦äººçš„ç¯å¢ƒä¾èµ–ï¼Œæ¯”å¦‚tabulaéœ€è¦Javaç¯å¢ƒï¼Œæˆ‘æœ¬åœ°å·²æœ‰çš„Javaè·Ÿtabulaåˆå¯¹åº”ä¸ä¸Šï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚ ä½¿ç”¨ä¹Ÿæ˜¯éå¸¸æ–¹ä¾¿ï¼Œåªæœ‰ä¸¤ç‚¹è¦æ±‚ï¼š é€‰æ‹©åˆé€‚çš„jupyter notebook é€‰æ‹©å¯åŠ¨dockeré•œåƒçš„è·¯å¾„/æ–‡ä»¶å¤¹ï¼Œä¹Ÿæ˜¯ç”¨æ¥å­˜æ”¾jpynbæ–‡ä»¶çš„ æ¥ä¸‹æ¥åˆ†å‡ æ­¥èµ°ï¼š é€‰æ‹©notebook pyspark-notebookæ˜¯å¸¦æœ‰Javaç¯å¢ƒçš„ï¼Œæ‰€ä»¥è¿™æ¬¡ç”¨çš„æ˜¯è¿™ä¸ª é…ç½®æ–‡ä»¶ å¯åŠ¨docker jupyterçš„å‘½ä»¤æ¯”è¾ƒé•¿ï¼Œéœ€è¦æŒ‡å®šnotebookã€ç«¯å£ç­‰ä¿¡æ¯ï¼Œæ‰€ä»¥å°±ç›´æ¥å†™å…¥é…ç½®æ–‡ä»¶docker-compose.ymlï¼Œæ–¹ä¾¿å¯åŠ¨ã€‚ å¦‚æœå¯åŠ¨å¤±è´¥ï¼Œå¯èƒ½æ˜¯ç«¯å£è¢«å ç”¨ï¼Œå¯ä»¥å°è¯•å…¶ä»–ç«¯å£ï¼Œæ¯”å¦‚&quot;9999:8888&quot;ã€‚å…¶ä¸­å­˜æ”¾çš„è·¯å¾„è·Ÿæœ¬åœ°é€‰æ‹©è·¯å¾„çš„å¹¶æ²¡æœ‰å½±å“ã€‚dockeré¢„è£…çš„æ˜¯Linuxç³»ç»Ÿï¼Œç”¨æˆ·jovyanä¸‹çš„workç›®å½•å°±ç›¸å½“äºä½ å¯åŠ¨dockerçš„ç›®å½•ä¸‹ã€‚ 123456789101112version: '3'services: notebook: image: jupyter/pyspark-notebook volumes: - $PWD:/home/jovyan/work ports: - "8888:8888" environment: - JUPYTER_LAB_ENABLE=yes command: "start.sh jupyter lab" å¯åŠ¨ 12cd Notebook # å­˜æ”¾é…ç½®æ–‡ä»¶å’Œjpynbdocker-compose up å…³é—­jupyter 1docker-compose down åœ¨æµè§ˆå™¨æ‰“å¼€ æ ¹æ®æ—¥å¿—ä¿¡æ¯ï¼Œåœ¨æµè§ˆå™¨æ‰“å¼€é“¾æ¥å°±å¯ä»¥äº† è‡³æ­¤ï¼Œå°±å¯ä»¥åƒå¾€å¸¸ä¸€æ ·ä½¿ç”¨jupyteräº†ã€‚éšæ—¶éšåœ°ï¼Œç¯å¢ƒå´©äº†ï¼Œç›´æ¥åˆ äº†é‡æ–°æ‹‰ä¸ªé•œåƒå°±å¯ä»¥ã€‚ éœ€è¦æ³¨æ„çš„ï¼šé…ç½®æ–‡ä»¶ä¸èƒ½æ˜¯éšè—æ–‡ä»¶ï¼Œåå­—ä¹Ÿä¸èƒ½æ”¹åŠ¨ å‚è€ƒæ–‡ç« ï¼š jupyter-docker-stacks JupyterLab]]></content>
  </entry>
  <entry>
    <title><![CDATA[Jupyterlabä¸èƒ½è°ƒç”¨asyncio event loop]]></title>
    <url>%2Famberwest.github.io%2F2018%2F11%2F06%2FJupyterlab%E4%B8%8D%E8%83%BD%E8%B0%83%E7%94%A8asyncio-event-loop%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘åœ¨Jupyterlabä¸Šä½¿ç”¨asyncioæ—¶ï¼Œä¸€ç›´æŠ¥é”™ï¼Œè¯´æ˜¯event loopå·²ç»åœ¨è¿è¡Œäº†ï¼Œä½†æˆ‘ä¹‹å‰æ ¹æœ¬å°±æ²¡æœ‰å¯åŠ¨ã€‚ä¸Šç½‘ç€äº†ä¸€éï¼Œæ‰çŸ¥é“æ˜¯å› ä¸ºtornadoçš„ç‰ˆæœ¬è¿‡é«˜å¯¼è‡´çš„ã€‚å› ä¸ºä½¿ç”¨Jupyter Docker Stackså¯åŠ¨çš„Jupyterlabé»˜è®¤æ˜¯æœ€æ–°ç‰ˆæœ¬çš„ï¼Œpythonä¹Ÿæ˜¯3.6ï¼Œæ‰€æœ‰éœ€è¦å°†tornadoçš„ç‰ˆæœ¬ç¨å¾®é™ä½ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚ å®‰è£…ä½ç‰ˆæœ¬çš„tornado 1pip install tornado==4.5.3 é‡å¯kernel ä¹Ÿå°±æ˜¯é‡æ–°å¯åŠ¨jupyter notebook å‚è€ƒæ–‡ç« ï¼š Canâ€™t invoke asyncio event_loop after tornado 5.0 update]]></content>
      <tags>
        <tag>docker</tag>
        <tag>jupyter</tag>
        <tag>loop</tag>
        <tag>asyncio</tag>
        <tag>å¼‚æ­¥</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[pandas.to_datetimeçš„formatå‚æ•°ä¸èµ·ä½œç”¨]]></title>
    <url>%2Famberwest.github.io%2F2018%2F11%2F05%2Fpandas-to-datetime%E7%9A%84format%E5%8F%82%E6%95%B0%E4%B8%8D%E8%B5%B7%E4%BD%9C%E7%94%A8%2F</url>
    <content type="text"><![CDATA[ä¹‹å‰ç”¨pandaså¤„ç†æ—¥æœŸä¹‹åï¼Œæƒ³è¦ä¿å­˜ç»“æœåˆ°excelï¼Œå‘ç°ä¸ç®¡æ€ä¹ˆè®¾ç½®ï¼Œæ—¥æœŸè¿™ä¸€åˆ—æ•°æ®æ€»æ˜¯å¸¦æœ‰timeéƒ¨åˆ†ã€‚ åœ¨pyCharmæˆ–è€…Jupyter Notebookæ‰“å°å‡ºæ¥çš„ç»“æœéƒ½æ˜¯æ­£å¸¸çš„ï¼Œä½†å®é™…ä¸Šå¹¶ä¸æ˜¯è¿™æ ·çš„ï¼š å…·ä½“åŸå› æˆ‘ä¹Ÿæ²¡æ‰¾åˆ°ï¼Œå¥½åœ¨æœ‰æ–¹æ³•å¯ä»¥è§£å†³ã€‚ ä½¿ç”¨Seriesçš„dtæ–¹æ³• 1234df['æ—¥æœŸ'] = pd.to_datetime(df['æ—¥æœŸ'], format='%Y-%m-%d').dt.date# æˆ–è€…df['æ—¥æœŸ'] = df['æ—¥æœŸ'].dt.strftime('%Y-%m-%d') ä½¿ç”¨æ—¥æœŸçš„dateæ–¹æ³• 123df['æ—¥æœŸ'] = pd.to_datetime(df['æ—¥æœŸ'], format='%Y-%m-%d')df['æ—¥æœŸ'] = [time.date() for time in df['æ—¥æœŸ']]# è·å–æ—¶é—´éƒ¨åˆ†åˆ™æ˜¯ç”¨time()]]></content>
      <categories>
        <category>pandas</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>æ ¼å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[celeryå¤šé˜Ÿåˆ—]]></title>
    <url>%2Famberwest.github.io%2F2018%2F10%2F25%2Fcelery%E5%A4%9A%E9%98%9F%E5%88%97%2F</url>
    <content type="text"><![CDATA[celeryCeleryæ˜¯åŸºäºåˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’çš„å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—/ä½œä¸šé˜Ÿåˆ—ã€‚å®ƒæ”¯æŒå®æ—¶æ“ä½œï¼Œä¹Ÿæ”¯æŒè°ƒåº¦ã€‚ celeryå·¥ä½œæµç¨‹ï¼šç”Ÿäº§è€…é€šè¿‡celeryå‘é€ä»»åŠ¡åˆ°brokerï¼ˆRedis/RabbitMQï¼‰ï¼Œworkerä»brokeræ¥æ”¶ä»»åŠ¡ï¼Œå®Œæˆä»»åŠ¡ã€‚ 1user --&gt; broker --&gt; worker1, worker2, worker3, ... celeryé»˜è®¤åªæœ‰ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å®é™…æƒ…å†µä½¿ç”¨å¤šä¸ªé˜Ÿåˆ—ï¼Œæ¯”å¦‚ï¼Œæœ‰äº›ä»»åŠ¡ä¸å¤šï¼Œä½†æ˜¯è€—æ—¶é•¿ï¼Œåƒä¸‹è½½å›¾ç‰‡ä¹‹ç±»çš„ï¼Œæˆ‘ä»¬å¯ä»¥å•ç‹¬è®¾ç½®ä¸€ä¸ªé˜Ÿåˆ—ï¼ŒRabbitMQè¿˜å¯ä»¥è®¾ç½®ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œè¿™æ¬¡ç”¨çš„æ˜¯Redisï¼Œæ‰€ä»¥æš‚æ—¶ä¸è€ƒè™‘è¿™ä¸€å—ã€‚ æœ€ç»ˆç»“æœæ–‡ä»¶åˆ—è¡¨å¦‚ä¸‹ï¼š 123456/multi_queue __init__.py app.py celeryconfig.py tasks.py dispatcher.py å®‰è£…1pip install celery é…ç½®celeryä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œæˆ‘å°†celeryæ‰€éœ€è¦çš„é…ç½®éƒ½å†™åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­celeryconfig.pyï¼Œç°åœ¨å·²ç»å¯ä»¥ä¸ç”¨å¤§å†™çš„äº†ï¼Œå…·ä½“æ¯ä¸ªå­—æ®µçš„æ„æ€çœ‹ä»£ç ä¸­çš„æ³¨é‡Šã€‚æ›´å¤šçš„è®¾ç½®å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839# è®¾ç½®brokerä¸­é—´å•†ï¼Œå­˜æ”¾æ¶ˆæ¯broker_url = 'redis://root:password@localhost:6379/4'# å­˜æ”¾æ¶ˆæ¯çŠ¶æ€å’Œç»“æœresult_backend = 'redis://root:password@localhost:6379/4'# Celeryå¯åŠ¨æ—¶ï¼Œä¼šä»importsæŒ‡å®šçš„è·¯å¾„å¯¼å…¥ä»»åŠ¡ï¼Œå¦‚æœæœ‰å¤šä¸ªä»»åŠ¡ï¼Œç»§ç»­æ·»åŠ imports = ['tasks']# é“¾æ¥ä¸¢å¤±æˆ–è€…é”™è¯¯çš„æƒ…å†µä¸‹ï¼Œé‡è¯•å‘å¸ƒæ¶ˆæ¯é˜Ÿåˆ—æ—¶å®šä¹‰é»˜è®¤ç­–ç•¥ï¼Œè·Ÿtask_publish_retryç±»ä¼¼task_publish_retry_policy = &#123; 'max_retries': 3, 'interval_start': 0, 'interval_step': 0.2, 'interval_max': 0.2&#125;# é˜Ÿåˆ—task_queues = &#123; 'add': &#123; 'routing_key': 'add' &#125;, 'download': &#123; 'exchange': 'media', 'routing_key': 'download' &#125;&#125;# è·¯ç”±ï¼Œè¿™é‡Œè®¾ç½®äº†å„ä¸ªtaskå¯¹åº”çš„é˜Ÿåˆ—ï¼Œå…¶ä¸­çš„queueå’Œrouting_keyè¦è·Ÿtask_queueså¯¹task_routes = &#123; 'tasks.add': &#123; 'queue': 'add', 'routing_key': 'add', 'serializer': 'json', &#125;, 'tasks.download_img': &#123; 'queue': 'download', 'routing_key': 'download' &#125;&#125; åˆ›å»ºceleryå®ä¾‹åœ¨app.pyæ–‡ä»¶ä¸­åˆ›å»ºceleryå®ä¾‹ï¼Œå¹¶åŠ è½½é…ç½®ã€‚ 123456from celery import Celery# åå­—å¯ä»¥éšæ„app = Celery('multi')# ä»celeryconfigæ–‡ä»¶ä¸­å¯¼å…¥é…ç½®ï¼Œå¦‚æœä¸åœ¨åŒä¸€çº§ç›®å½•ï¼Œåˆ™è¿™æ ·å†™ï¼šproj.path.to.celeryconfigapp.config_from_object('celeryconfig') ä¸€èˆ¬æ¯”è¾ƒå°çš„ä»»åŠ¡ï¼Œå¯ä»¥ç›´æ¥åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­è¿›è¡Œè®¾ç½®ï¼Œä¸Šé¢ä¸¤ä¸ªæ–‡ä»¶å¯ä»¥æ•´åˆæˆè¿™æ ·ğŸ‘‡ï¼š 12345678910111213141516from celery import Celery# åå­—å¯ä»¥éšæ„app = Celery('multi', broker='redis://root:password@localhost:6379/4', backend='redis://root:password@localhost:6379/4', include=['tasks'], # è·Ÿé…ç½®æ–‡ä»¶ä¸­çš„importsä¸€æ · )# æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œé…ç½®app.conf.update( CELERY_TIMEZONE='Asia/Shanghai', CELERY_ENABLE_UTC=True, CELERY_ACCEPT_CONTENT=['json'], CELERY_TASK_SERIALIZER='json', CELERY_RESULT_SERIALIZER='json',) åˆ›å»ºä»»åŠ¡tasks.pyæ–‡ä»¶ä¸­ï¼Œå®šä¹‰äº†addå’Œdownload_imgä¸¤ä¸ªä»»åŠ¡ï¼Œä½¿ç”¨app.taskå°†ä»»åŠ¡è£…é¥°æˆtaskã€‚ 1234567891011121314151617# tasks.pyimport requestsfrom app import app@app.taskdef add(a, b): print('add a and b: ', a+b) return a + b@app.taskdef download_img(url): print(url) response = requests.get(url) with open('img.jpg', 'wb') as f: for chunk in response.iter_content(1024): f.write(chunk) å¯åŠ¨celeryå› ä¸ºæ–‡ä»¶ä¸­æˆ‘éƒ½æ˜¯ç›´æ¥ä½¿ç”¨æ–‡ä»¶åï¼Œæ‰€ä»¥å¯åŠ¨å‘½ä»¤æ—¶éœ€è¦å…ˆè¿›å…¥/multi_queueè·¯å¾„ä¸‹ï¼Œä¸ç„¶æœ‰äº›æ–‡ä»¶ä¼šæ‰¾ä¸åˆ°ã€‚å¯åŠ¨ä»»åŠ¡æ—¶éœ€è¦æŒ‡å®šå¯¹åº”çš„é˜Ÿåˆ—ï¼Œæ¯”å¦‚å¯åŠ¨addé˜Ÿåˆ—ï¼š 12cd ~/../multi_queuecelery worker -A tasks -c=5 -l info -Q add å‚æ•°è¯´æ˜ï¼š workerï¼šè¿è¡Œworkeræ¨¡å— -A Appï¼š--app APPï¼ŒæŒ‡å®šä½¿ç”¨çš„celeryå®ä¾‹ï¼Œè¿™é‡Œæ˜¯tasks.pyï¼Œå¦‚æœimportsæ²¡æœ‰è®¾ç½®ï¼Œå¯èƒ½è¦ç”¨path.to.tasksè¿™æ ·çš„æ–¹å¼æŒ‡å®š -Qï¼šæŒ‡å®šé˜Ÿåˆ—ï¼Œå¦‚æœæœ‰å¤šä¸ªé˜Ÿåˆ—ï¼Œç”¨é€—å·éš”å¼€ï¼Œhipri,lopri -cï¼š-c CONCURRENCY, --concurrency CONCURRENCYï¼ŒæŒ‡å®šå¹¶å‘æ•°ï¼Œå¯ä»¥ä¸ç”¨ï¼Œé»˜è®¤æ˜¯4 -lï¼š-l LOGLEVEL, --loglevel LOGLEVELï¼ŒæŒ‡å®šæ—¥å¿—çº§åˆ«ï¼Œéå¿…é¡» å…³äºcelery workeræ›´å¤šçš„å‚æ•°å¯ä»¥ä½¿ç”¨helpæŸ¥çœ‹ï¼šcelery worker --helpã€‚ è¿è¡Œä¹‹åï¼Œå¯ä»¥çœ‹åˆ°è¿™æ ·çš„ç»“æœ è°ƒç”¨ä»»åŠ¡å¯åŠ¨celeryä¹‹åï¼Œceleryä¼šä¸€ç›´å¤„äºç›‘å¬çŠ¶æ€ï¼Œç­‰å¾…ä»»åŠ¡ã€‚ä»»åŠ¡çš„è°ƒç”¨å¯ä»¥å†™æˆä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œç„¶åè¿è¡Œè„šæœ¬ï¼Œä¹Ÿå¯ä»¥åœ¨äº¤äº’æ¨¡å¼ä¸‹å¼‚æ­¥è°ƒç”¨ã€‚ä½¿ç”¨apply_async()å’Œsend_tasks()è¿›è¡Œè°ƒç”¨ã€‚ è„šæœ¬è¿è¡Œï¼š ä»»åŠ¡è„šæœ¬ 1234567# dispatcher.pyfrom tasks import download_img, addif __name__ == '__main__': url = 'https://ss0.baidu.com/94o3dSag_xI4khGko9WTAnF6hhy/image/h%3D300/sign=cb94d0439e13b07ea2bd56083cd69113/35a85edf8db1cb1379326b71d054564e92584b7c.jpg' download_img.apply_async(args=(url, ), queue='download') add.apply_async(args=(3,4), queue='add') ç»ˆç«¯å¯åŠ¨ï¼Œè¿™é‡Œæ²¡æœ‰æŒ‡å®šå…·ä½“å“ªä¸ªé˜Ÿåˆ—ï¼Œæ‰€ä»¥ä¼šå¯åŠ¨å·²é…ç½®çš„æ‰€æœ‰é˜Ÿåˆ— 1celery -A tasks worker -l info è¿è¡Œè„šæœ¬ 1python dispatcher.py å¼‚æ­¥è°ƒç”¨ï¼š åœ¨ç»ˆç«¯è¿›å…¥pythonï¼Œè°ƒç”¨ä»»åŠ¡ï¼š 123456# å¯åŠ¨python$ python&gt;&gt;&gt; from tasks import add&gt;&gt;&gt; add.apply_async(args=(3,4), queue='add')&lt;AsyncResult: b914e4f8-f888-4fde-a8df-20f312213c0a&gt; è¿™æ—¶å€™å¯ä»¥çœ‹åˆ°celeryå·²ç»æ¥æ”¶åˆ°ä»»åŠ¡ï¼Œå¹¶è¿”å›ç»“æœï¼š æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä¸èƒ½ç”¨delayæ¥ä»£æ›¿apply_asyncï¼Œåœ¨é»˜è®¤é˜Ÿåˆ—çš„æ—¶å€™ï¼Œä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥ç”¨ï¼Œå¦‚æœå¯åŠ¨celeryæŒ‡å®šé˜Ÿåˆ—ï¼Œç›´æ¥ä½¿ç”¨add.delay(2,3)ï¼Œè¿™ä¸ªä»»åŠ¡ä¼šä¸€ç›´å¤„äºPENDINGçŠ¶æ€ï¼Œç›´åˆ°ä½ ä¸æŒ‡å®šé˜Ÿåˆ—å¯åŠ¨celeryï¼Œä»»åŠ¡æ‰ä¼šè¢«æ‰§è¡Œã€‚ ä¹Ÿä¸èƒ½ä½¿ç”¨add.delay(args=(3,4), queue=&#39;add&#39;)ï¼Œä¼šæŠ¥é”™ã€‚ å¦‚æœè¦å¯åŠ¨å¤šä¸ªworkerï¼Œåªéœ€è¦åœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£å¯åŠ¨å‘½ä»¤å°±å¯ä»¥äº†ã€‚ æ‰©å±•é˜…è¯»åœ¨ç½‘ä¸Šäº†è§£åˆ°ï¼Œæœ‰å¾ˆå¤šäººé‡åˆ°ä»»åŠ¡é‡å¤æ‰§è¡Œçš„é—®é¢˜ï¼Œæˆ‘åªæ˜¯ç®€å•æµ‹è¯•äº†ä¸€ä¸‹ï¼Œè‡ªç„¶æ²¡æœ‰é‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œä¸è¿‡å‘¢ï¼ŒCelery4.0å·²ç»æœ‰è§£å†³æ–¹æ³•äº†ï¼Œè¯¦æƒ…è¯·æˆ³ï¼šcelery-onceã€‚ éœ€è¦åœ¨å¤šä¸ªæœåŠ¡å™¨å¯åŠ¨celeryï¼Œä½¿ç”¨-nå‚æ•°ï¼Œå…·ä½“æŸ¥çœ‹å‘½ä»¤ï¼šcelery worker --helpã€‚]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>celery</tag>
        <tag>å¤šé˜Ÿåˆ—</tag>
        <tag>queue</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€æ•°æ®ç»“æ„ä¸ç®—æ³•ç¬”è®°å…«ã€‘æ’åºï¼ˆä¸‹ï¼‰]]></title>
    <url>%2Famberwest.github.io%2F2018%2F10%2F18%2F%E6%8E%92%E5%BA%8F%EF%BC%88%E4%B8%8B%EF%BC%89%2F</url>
    <content type="text"><![CDATA[å½’å¹¶æ’åºä»€ä¹ˆæ˜¯å½’å¹¶æ’åºå½’å¹¶æ’åºçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼šå…ˆå°†æ•°ç»„ä»ä¸­é—´åˆ†ä¸ºå‰åä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«æ’åºä¹‹åï¼Œå†å°†ä¸¤éƒ¨åˆ†åˆå¹¶åœ¨ä¸€èµ·ã€‚ è¿™é‡Œç”¨åˆ°çš„æ€æƒ³æ˜¯â€œåˆ†è€Œæ²»ä¹‹â€ï¼Œå°†ä¸€ä¸ªå¤§é—®é¢˜åˆ†è§£ä¸ºä¸¤ä¸ªæˆ–å¤šä¸ªç›¸åŒæˆ–ç›¸ä¼¼çš„å­é—®é¢˜ã€‚å°çš„é—®é¢˜è§£å†³äº†ï¼Œå¤§é—®é¢˜ä¹Ÿå°±è§£å†³äº†ã€‚å¤§é—®é¢˜çš„ç­”æ¡ˆå°±æ˜¯å­é—®é¢˜çš„ç­”æ¡ˆçš„åˆå¹¶ã€‚ è¿™æ•´ä¸ªåˆ†æ²»è¿‡ç¨‹éå¸¸ç¬¦åˆé€’å½’æ€æƒ³ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨é€’å½’æ¥å®ç°ã€‚ æ­¥éª¤ï¼š åˆ†è§£å­é—®é¢˜ å°†é—®é¢˜æ‹†åˆ†ä¸ºç›¸äº’ç‹¬ç«‹ä½†ç›¸ä¼¼çš„å­é—®é¢˜ï¼Œå¦‚å°†æ•°ç»„ä¸æ–­åˆ†ç»„ æ±‚è§£å­é—®é¢˜ å­é—®é¢˜å®¹æ˜“è§£å†³å°±ç›´æ¥è§£å†³ï¼Œå¦åˆ™ç»§ç»­æ‹†åˆ†å­é—®é¢˜ï¼Œå¦‚å½“åªæœ‰ä¸€ä¸ªå…ƒç´ æ—¶è¿”å›åŸæ•°ç»„ï¼ˆæœ‰åºï¼‰ åˆå¹¶å­é—®é¢˜çš„è§£ å°†æœ‰åºæ•°ç»„è¿›è¡Œåˆå¹¶ç„¶åè¿”å› 12345678910111213141516171819202122232425262728293031323334353637383940# å½’å¹¶æ’åºï¼šå°†æ•°ç»„åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«æ’åºä¹‹åå†åˆå¹¶# é€’å½’è°ƒç”¨å‡½æ•°def merge_sort(a): """åˆ†æ²»é€’å½’ï¼šaæ˜¯æ•°ç»„""" n = len(a) if n &lt;= 1: return a middle = int(n / 2) # å°†æ•°ç»„åˆ†ä¸ºä¸¤éƒ¨åˆ† left = merge_sort(a[:middle]) right = merge_sort(a[middle:]) # è¿”å›åˆå¹¶ä¹‹åçš„æœ‰åºæ•°ç»„ return merge(left, right) def merge(a1, a2): """åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„""" # tmpä¸´æ—¶æ•°ç»„ï¼Œç”¨äºå­˜æ”¾ç»“æœï¼Œè¿™ä¸ªæ˜¯å¯¼è‡´å½’å¹¶æ’åºç®—æ³•ä¸æ˜¯åŸåœ°æ’åºç®—æ³•çš„åŸå›  i, j, tmp =0, 0, [] while i &lt; len(a1) and j &lt; len(a2): if a1[i] &lt;= a2[j]: tmp.append(a1[i]) i += 1 elif a1[i] &gt;= a2[j]: tmp.append(a2[j]) j += 1 # å°†å‰©ä½™çš„æœ‰åºæ•°æ®ç›´æ¥åˆå¹¶åœ¨ç»“æœä¸­ tmp.extend(a1[i:]) tmp.extend(a2[j:]) return tmpif __name__ == '__main__': # æµ‹è¯•åˆå¹¶æ•°ç»„ l1 = [1,3,7,9] l2 = [2,4,5,7] data = merge(l1, l2) print(data) b = [3,2,1,6,9,3,4,7] res = merge_sort(b) print(res) å½’å¹¶æ’åºçš„æ€§èƒ½åˆ†æ å½’å¹¶æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å— æ˜¯ã€‚åˆå¹¶ä¸¤ä¸ªæœ‰åºå­æ•°ç»„çš„è¿‡ç¨‹ï¼Œå½“é‡åˆ°å€¼ç›¸ç­‰çš„å…ƒç´ ï¼Œæˆ‘ä»¬å¯ä»¥å°†å‰åŠéƒ¨åˆ†æ•°ç»„çš„å…ƒç´ æ’å…¥åˆ°ååŠéƒ¨åˆ†æ•°ç»„çš„å…ƒç´ å‰é¢ï¼Œæ‰€ä»¥åˆå¹¶å‰åï¼Œå…ƒç´ çš„å‰åé¡ºåºä¸å˜ã€‚å½’å¹¶æ’åºç”¨åˆ°ä¸€ä¸ªä¸´æ—¶æ•°ç»„æ¥å­˜æ”¾ç»“æœï¼Œæ‰€ä»¥ä¸æ˜¯åŸåœ°æ’åºç®—æ³•ã€‚ å½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ è¿™é‡Œæ¶‰åŠåˆ°é€’å½’ä»£ç çš„æ—¶é—´å¤æ‚åº¦åˆ†æã€‚ æˆ‘ä»¬å¯ä»¥å‡è®¾æ±‚è§£å¤§å°ä¸ºnçš„åŸé—®é¢˜açš„æ—¶é—´ä¸ºT(n)ï¼Œä¸¤ä¸ªå­é—®é¢˜çš„bã€cçš„æ±‚è§£æ—¶é—´åˆ™æ˜¯T(n/2)ï¼Œåˆå¹¶æ—¶é—´ä¸ºn(mergeå‡½æ•°çš„æ—¶é—´å¤æ‚åº¦ä¸ºn)ã€‚æ¯æ¬¡æ‹†åˆ†é—®é¢˜ï¼Œå­é—®é¢˜æ‰€éœ€è¦æ—¶é—´éƒ½æ˜¯ä¸Šçº§é—®é¢˜æ—¶é—´çš„ä¸€åŠï¼Œæ‰€ä»¥æœ‰ä»¥ä¸‹å…³ç³»ï¼š 1234567T(n) = 2*T(n/2) + n = 2*(2*T(n/4) + n/2) + n = 4*T(n/4) + 2*n = 4*(2*T(n/8) + n/4) + 2*n = 8*T(n/8) + 3*n = 8*(2*T(n/16) + n/8) + 3*n = 16*T(n/16) + 4*n ...... = 2^k * T(n/2^k) + k * n ...... æ ¹æ®ä¸Šé¢çš„æ¨ç®—ï¼Œå¾—åˆ°T(n)=2^k * T(n/2^k) + k * nã€‚å½“T(n/2^k)=T(1)æ—¶ï¼Œä¹Ÿå°±æ˜¯å½“åŸæ•°ç»„æ‹†åˆ†åˆ°åªæœ‰ä¸€ä¸ªå…ƒç´ æ—¶è§£å†³å­é—®é¢˜æ‰€éœ€è¦çš„æ—¶é—´ï¼Œè¿™é‡Œä¸éœ€è¦åˆå¹¶ï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰kné¡¹ï¼Œ2^kåˆ™æ˜¯å­é—®é¢˜çš„ä¸ªæ•°ï¼‰ï¼Œæ ¹æ®å¯¹æ•°å…¬å¼å¯ä»¥æ±‚çš„k=log2nï¼Œä»£å…¥ä¸Šé¢å…¬å¼å°±å¯ä»¥å¾—åˆ°T(n)=Cn+nlog2nï¼Œç”¨å¤§Oæ ‡è®°æ³•æ¥è¡¨ç¤ºï¼Œå¯ä»¥å¾—åˆ°å½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(nlogn)ã€‚ å› ä¸ºå½’å¹¶æ’åºè·Ÿæ•°ç»„çš„æœ‰åºç¨‹åº¦æ— å…³ï¼Œæ‰€ä»¥ä¸è®ºæ˜¯æœ€å¥½æƒ…å†µã€æœ€åæƒ…å†µï¼Œè¿˜æ˜¯å¹³å‡æƒ…å†µï¼Œæ—¶é—´å¤æ‚åº¦éƒ½ä¸ºO(nlogn)ã€‚ å½’å¹¶æ’åºçš„ç©ºé—´å¤æ‚åº¦æ˜¯å¤šå°‘ é€’å½’ä»£ç çš„ç©ºé—´å¤æ‚åº¦ä¸ä¼šåƒæ—¶é—´å¤æ‚åº¦é‚£æ ·ç´¯åŠ ï¼Œè€Œæ˜¯åœ¨å®Œæˆæ¯ä¸€æ¬¡åˆå¹¶æ“ä½œä¹‹åå°±é‡Šæ”¾æ‰æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ã€‚åœ¨ä»»ä½•æ—¶åˆ»ï¼ŒCPUåªä¼šæœ‰ä¸€ä¸ªå‡½æ•°åœ¨æ‰§è¡Œï¼Œé‚£ä¹ˆæœ€å¤§çš„ä¸´æ—¶å†…å­˜ç©ºé—´å°±æ˜¯æ•°ç»„çš„å¤§å°ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦ä¸ºO(n)ã€‚ å¿«é€Ÿæ’åºä»€ä¹ˆæ˜¯å¿«é€Ÿæ’åºå¿«é€Ÿæ’åºçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼šåœ¨å¾…æ’åºæ•°ç»„ä¸­éšæœºå–ä¸€ä¸ªæ•°æ®ä½œä¸ºåŒºåˆ†ç‚¹ï¼Œå°äºè¯¥åŒºåˆ†ç‚¹çš„æ”¾åœ¨å·¦è¾¹ï¼Œå¤§äºè¯¥åŒºåˆ†ç‚¹çš„æ”¾åœ¨å³è¾¹ï¼ŒåŒºåˆ†ç‚¹æ”¾åœ¨ä¸­é—´ã€‚æ ¹æ®åˆ†æ²»ã€é€’å½’çš„æ€æƒ³ï¼Œåˆ†åˆ«å¯¹å·¦å³ä¸¤è¾¹çš„æ•°æ®é‡å¤åˆšåˆšçš„æ“ä½œï¼ˆæ¯æ¬¡æ’åºéƒ½æœ‰ä¸€ä¸ªåŒºåˆ†ç‚¹è¢«ç¡®å®šï¼Œä¸å†å‚ä¸ä¸‹æ¬¡æ’åºï¼‰ï¼Œç›´åˆ°å¾…æ’åºåŒºé—´ä¸º1ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849# å¿«é€Ÿæ’åºdef quick_sort1(a): """æ’åº""" left, right = [], [] if len(a) &lt;= 1: return a value = a[-1] for i in range(len(a) -1): if a[i] &lt; value: left.append(a[i]) else: right.append(a[i]) return quick_sort(left) + [value] + quick_sort(right)def quick_sort(lists, left, right): '''å¿«é€Ÿæ’åº''' # è·³å‡ºé€’å½’åˆ¤æ–­ if left &gt;= right: return lists # é€‰æ‹©å‚è€ƒç‚¹ï¼Œè¯¥è°ƒæ•´èŒƒå›´çš„ç¬¬1ä¸ªå€¼ key = lists[left] low = left high = right # å¾ªç¯åˆ¤æ–­ç›´åˆ°éå†å…¨éƒ¨ while left &lt; right: # ä»å³è¾¹å¼€å§‹æŸ¥æ‰¾å¤§äºå‚è€ƒç‚¹çš„å€¼ while left &lt; right and lists[right] &gt;= key: right -= 1 lists[left] = lists[right] # è¿™ä¸ªä½ç½®çš„å€¼å…ˆæŒªåˆ°å·¦è¾¹ # ä»å·¦è¾¹å¼€å§‹æŸ¥æ‰¾å°äºå‚è€ƒç‚¹çš„å€¼ while left &lt; right and lists[left] &lt;= key: left += 1 lists[right] = lists[left] # è¿™ä¸ªä½ç½®çš„å€¼æŒªåˆ°å³è¾¹ # å†™å›æ”¹æˆçš„å€¼ lists[left] = key # é€’å½’ï¼Œå¹¶è¿”å›ç»“æœ quick_sort(lists, low, left - 1) # é€’å½’å·¦è¾¹éƒ¨åˆ† quick_sort(lists, left + 1, high) # é€’å½’å³è¾¹éƒ¨åˆ† return listsif __name__ == '__main__': b = [3,2,1,6,9,3,4,7] res = quick_sort(b) print(res) å¿«é€Ÿæ’åºçš„æ€§èƒ½åˆ†æ å¿«é€Ÿæ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å— å¿«é€Ÿæ’åºæ˜¯ä¸€ç§åŸåœ°ã€ä¸ç¨³å®šçš„æ’åºç®—æ³•ï¼Œçœ‹ä»£ç ğŸ‘† å¿«é€Ÿæ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ å› ä¸ºå¿«æ’ä¹Ÿæ˜¯ç”¨é€’å½’å®ç°çš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ä¸Šé¢æåˆ°çš„æ–¹å¼æ±‚è§£æ—¶é—´å¤æ‚åº¦ã€‚å¦‚æœæ¯æ¬¡é€‰æ‹©çš„åŒºåˆ†ç‚¹éƒ½èƒ½å°†æ•°ç»„åˆ†ä¸ºå¤§å°ç›¸è¿‘çš„ä¸¤ä¸ªå°åŒºé—´ï¼Œé‚£ä¹ˆæœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦å°±æ˜¯O(nlogn)ã€‚ å¦‚æœåŸæ¥çš„æ•°ç»„å·²ç»æœ‰åºäº†ï¼Œæ¯æ¬¡å–åˆ°çš„åˆ†åŒºç‚¹éƒ½æ˜¯æœ€å¤§ï¼ˆæœ€å°ï¼‰ï¼Œé‚£ä¹ˆå¾—åˆ°çš„ä¸¤ä¸ªåˆ†åŒºå°±éå¸¸ä¸å‡ç­‰ï¼Œæœ€ç³Ÿçš„æƒ…å†µè¦næ¬¡åˆ†åŒºæ“ä½œæ‰èƒ½å®Œæˆæ’åºï¼Œè¿™æ—¶å€™çš„æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦å°±å˜æˆäº†O(n^2)ã€‚ è‡³äºå¹³å‡æ—¶é—´å¤æ‚åº¦ï¼Œé™¤äº†å¯ä»¥ç”¨ä¸Šé¢çš„é€’å½’å…¬å¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨é€’å½’æ ‘ã€‚æ€»çš„æ¥è¯´ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½èƒ½å®ç°O(nlogn)ï¼Œæç«¯æƒ…å†µä¸‹æ‰ä¼šé€€åŒ–åˆ°O(n^2)ã€‚ å¿«é€Ÿæ’åºçš„ç©ºé—´å¤æ‚åº¦æ˜¯å¤šå°‘ åŸåœ°æ’åºç®—æ³•ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºO(1)ã€‚ åº”ç”¨é—®é¢˜ï¼šå¦‚ä½•åœ¨O(n)æ—¶é—´å¤æ‚åº¦å†…æ±‚æ— åºæ•°ç»„Aä¸­çš„ç¬¬Kå¤§å…ƒç´ ï¼Œå¦‚4ï¼Œ2ï¼Œ5ï¼Œ12ï¼Œ3ï¼Œç¬¬ä¸‰å¤§å°±æ˜¯4ã€‚ è§£å†³ï¼šé€‰æ‹©æœ€åä¸€ä¸ªç‚¹ä½œä¸ºåˆ†åŒºç‚¹ï¼Œå°†åŸæ•°ç»„åˆ†ä¸ºä¸‰éƒ¨åˆ†A[0â€¦p-1]ã€A[p]ã€A[p+1â€¦n-1]ã€‚å¦‚æœp+1=kï¼Œé‚£ä¹ˆA[p]å°±æ˜¯ç­”æ¡ˆã€‚å¦‚æœK&gt;p+1ï¼Œé‚£ä¹ˆå°±åœ¨å³åˆ†åŒºç»§ç»­æŸ¥æ‰¾ï¼›å¦‚æœK&lt;p+1ï¼Œæˆ‘ä»¬å°±åœ¨å·¦åˆ†åŒºç»§ç»­æŸ¥æ‰¾ã€‚å› ä¸ºæ¯æ¬¡åˆ†åŒºï¼Œåˆ†åŒºç‚¹çš„ä½ç½®éƒ½æ˜¯ç¡®å®šçš„äº†ï¼Œè€Œä¸‹æ ‡æ˜¯ä»0å¼€å§‹çš„ï¼Œæ‰€ä»¥éœ€è¦åŠ 1ä¹‹åå†åšåˆ¤æ–­ã€‚ï¼ˆæ€è·¯å¾ˆåƒæœ€å°äºŒä¹˜æ³•ï¼‰æ¯æ¬¡éƒ½åªéœ€è¦å¯¹å½“å‰åˆ†åŒºçš„ä¸€åŠæ•°æ®è¿›è¡Œåˆ†åŒºï¼Œä¹Ÿå°±æ˜¯nã€n/2ã€n/4â€¦1ï¼Œæ€»çš„æ—¶é—´å’Œä¸º2n-1ï¼Œä¹Ÿå°±æ˜¯O(n)ã€‚ æ€è€ƒç°åœ¨ä½ æœ‰ 10 ä¸ªæ¥å£è®¿é—®æ—¥å¿—æ–‡ä»¶ï¼Œæ¯ä¸ªæ—¥å¿—æ–‡ä»¶å¤§å°çº¦ 300MBï¼Œæ¯ä¸ªæ–‡ä»¶é‡Œçš„æ—¥å¿—éƒ½æ˜¯æŒ‰ç…§æ—¶é—´æˆ³ä»å°åˆ°å¤§æ’åºã€‚ä½ å¸Œæœ›å°†è¿™10ä¸ªè¾ƒå°çš„æ—¥å¿—æ–‡ä»¶ï¼Œåˆå¹¶ä¸º1ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œåˆå¹¶ä¹‹åçš„æ—¥å¿—ä»ç„¶æŒ‰ç…§æ—¶é—´æˆ³ä»å°åˆ°å¤§æ’åºã€‚å¦‚æœå¤„ç†ä¸Šè¿°æ’åºä»»åŠ¡çš„æœºå™¨å†…å­˜åªæœ‰1GBï¼Œè¯¥å¦‚ä½•å¤„ç† å‚è€ƒæ–‡ç« æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>æ’åº</tag>
        <tag>æ’å…¥æ’åº</tag>
        <tag>å¿«é€Ÿæ’åº</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[browsercookieä½¿ç”¨]]></title>
    <url>%2Famberwest.github.io%2F2018%2F10%2F16%2Fbrowsercookie%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[å®‰è£…ä½ å¯èƒ½éœ€è¦æå‰å®‰è£…ä¸€äº›ä¾èµ–åº“ 1pip install pkgconfig setuptools_scm pytest-runner google-apputils å®‰è£…browsercokie 1pip install browsercookie ä½¿ç”¨é¦–å…ˆï¼Œåœ¨æµè§ˆå™¨æ‰“å¼€ç›®æ ‡ç½‘ç«™ï¼Œè¿›å…¥éœ€è¦ç™»å½•æ‰èƒ½çœ‹åˆ°çš„é¡µé¢ï¼Œå¦‚GitHub profileé¡µé¢ã€‚ 1234567891011import browsercookieimport requestsfrom lxml import etreeurl = "https://github.com/settings/profile"cj = browsercookie.chrome()res = requests.get(url, cookies=cj)response = etree.HTML(res.text)heading = response.xpath('//*[@class="menu-heading"]/text()')print(heading) åœ¨æ‰§è¡Œä»£ç çš„æ—¶å€™å¯èƒ½ä¼šéœ€è¦è¾“å…¥å¯†ç  è¿”å›ç»“æœå¦‚ä¸‹ï¼š 1[&apos;\n Personal settings\n &apos;] å¦‚æœæ²¡æœ‰ç™»å½•ï¼Œç›´æ¥è¯·æ±‚profileé¡µé¢ï¼Œè¿”å›ç»“æœä¸ºç©º 123456url = "https://github.com/settings/profile"res = requests.get(url)response = etree.HTML(res.text)heading = response.xpath('//*[@class="menu-heading"]/text()')print(heading) åœ¨æŠ“å–ä¸€äº›éœ€è¦ç™»å½•çš„ç½‘ç«™ä¿¡æ¯çš„æ—¶å€™ï¼Œå°±å¯ä»¥çœå»æ¨¡æ‹Ÿç™»å½•ï¼Œæˆ–è€…å¤„ç†cookieï¼Œçœä¸‹ä¸å°‘åŠ›æ°”å‘€ï½ å‚è€ƒæ–‡ç« browsercookie]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>cookie</tag>
        <tag>æ¨¡å—</tag>
        <tag>browsercookie</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€æ•°æ®ç»“æ„ä¸ç®—æ³•ç¬”è®°ä¸ƒã€‘æ’åºï¼ˆä¸Šï¼‰]]></title>
    <url>%2Famberwest.github.io%2F2018%2F10%2F15%2F%E6%8E%92%E5%BA%8F%2F</url>
    <content type="text"><![CDATA[å¦‚ä½•åˆ†æä¸€ä¸ªâ€œç®—æ³•â€æ’åºç®—æ³•çš„æ‰§è¡Œæ•ˆç‡1ï¼‰æœ€å¥½æƒ…å†µã€æœ€åæƒ…å†µã€å¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦ åœ¨åˆ†ææ’åºç®—æ³•çš„æ—¶å€™ï¼Œè¦åˆ†åˆ«ç»™å‡ºæœ€å¥½æƒ…å†µã€æœ€åæƒ…å†µã€å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ï¼Œä»¥åŠå¯¹åº”æƒ…å†µä¸‹è¦æ’åºçš„åŸå§‹æ•°æ®æ˜¯ä»€ä¹ˆæ ·çš„ï¼ˆæœ‰åºæˆ–è€…æ— åºï¼‰ã€‚ 2ï¼‰æ—¶é—´å¤æ‚åº¦çš„ç³»æ•°ã€å¸¸æ•°ã€ä½é˜¶ å®é™…å¼€å‘ä¸­ï¼Œéœ€è¦æ’åºçš„æ•°æ®å¯èƒ½æ˜¯10ä¸ªã€100ä¸ªã€1000ä¸ªè¿™ç§å°è§„æ¨¡çš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦å°†æ—¶é—´å¤æ‚åº¦çš„ç³»æ•°ã€å¸¸æ•°ã€ä½é˜¶éƒ½è€ƒè™‘åˆ°ã€‚ 3ï¼‰æ¯”è¾ƒæ¬¡æ•°å’Œäº¤æ¢/ç§»åŠ¨æ¬¡æ•° åŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šæ¶‰åŠåˆ°ä¸¤ç§æ“ä½œï¼Œä¸€æ˜¯å…ƒç´ æ¯”è¾ƒå¤§å°ï¼ŒäºŒæ˜¯å…ƒç´ äº¤æ¢/ç§»åŠ¨ã€‚å› æ­¤éœ€è¦å°†æ¯”è¾ƒæ¬¡æ•°å’Œäº¤æ¢/ç§»åŠ¨æ¬¡æ•°ä¹Ÿè€ƒè™‘è¿›å»ã€‚ æ’åºç®—æ³•çš„å†…å­˜æ¶ˆè€—ç®—æ³•çš„å†…å­˜æ¶ˆè€—å¯ä»¥é€šè¿‡ç©ºé—´å¤æ‚åº¦æ¥è¡¡é‡ï¼Œæ’åºç®—æ³•ä¹Ÿæ˜¯ã€‚æœ¬æ–‡æ¶‰åŠåˆ°çš„ä¸‰ç§æ’åºç®—æ³•éƒ½æ˜¯ç©ºé—´å¤æ‚åº¦ä¸ºO(1)ï¼Œä¹Ÿç§°ä¸ºåŸåœ°æ’åºç®—æ³•ã€‚åŸåœ°æ’åºç®—æ³•æ˜¯ç‰¹æŒ‡ç©ºé—´å¤æ‚åº¦æ˜¯O(1)çš„æ’åºç®—æ³•ï¼Œä¹Ÿå°±æ˜¯å¸¸é‡é˜¶çš„æ—¶é—´å¤æ‚åº¦ã€‚ æ’åºç®—æ³•çš„ç¨³å®šæ€§æ’åºç®—æ³•çš„ç¨³å®šæ€§æ˜¯æŒ‡ï¼Œå¦‚æœå¾…æ’åºçš„åºåˆ—ä¸­å­˜åœ¨å€¼ç›¸ç­‰çš„å…ƒç´ ï¼Œç»è¿‡æ’åºä¹‹åï¼Œç›¸ç­‰å…ƒç´ ä¹‹é—´åŸæœ‰çš„å…ˆåé¡ºåºä¸å˜ã€‚å¦‚æœæ’åºä¹‹åï¼ŒåŸæœ¬çš„å‰åé¡ºåºå‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå¯¹åº”çš„æ’åºç®—æ³•å°±å«åšä¸ç¨³å®šçš„æ’åºç®—æ³•ã€‚ åº”ç”¨ï¼šæˆ‘ä»¬è¦ç»™ç”µå•†å¹³å°çš„è®¢å•æ•°æ®è¿›è¡Œæ’åºï¼ŒæŒ‰ç…§é‡‘é¢ä»å°åˆ°å¤§å¯¹è®¢å•æ•°æ®è¿›è¡Œæ’åºã€‚å¦‚æœé‡‘é¢ç›¸åŒï¼Œé‚£ä¹ˆå°±æŒ‰ç…§ä¸‹å•æ—¶é—´æ¥æ’åºã€‚è¿™æ—¶å€™å°±å¯ä»¥ç”¨åˆ°ç¨³å®šçš„æ’åºç®—æ³•ï¼Œå…ˆå°†è®¢å•éƒ½ä¸‹å•æ—¶é—´æ’åºï¼Œæ’å®Œåºä¹‹åå†å¯¹é‡‘é¢ç›¸åŒçš„è®¢å•ä»å°åˆ°å¤§æ’åºã€‚å› ä¸ºä½¿ç”¨çš„æ˜¯ç¨³å®šçš„æ’åºç®—æ³•ï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡æ’åºä¹‹åï¼Œç›¸åŒé‡‘é¢çš„è®¢å•ä»ç„¶ä¿æŒä¸‹å•æ—¶é—´ä»æ—©åˆ°æ™šã€‚ æœ‰åºåº¦ã€æ— åºåº¦ã€æ»¡æœ‰åºåº¦ä¸€ä¸ªé•¿åº¦ä¸ºnçš„æ•°ç»„ï¼Œæœ‰nï¼ç§æ’åºæ–¹å¼ï¼Œå¦‚æœè¦è®¡ç®—æ’åºç®—æ³•çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ï¼Œæ¶‰åŠåˆ°çš„æ¦‚ç‡è®¡ç®—ä¼šéå¸¸å¤æ‚ï¼Œæ‰€ä»¥ä½¿ç”¨â€œæœ‰åºåº¦â€å’Œâ€œæ— åºåº¦â€è¿™ä¸¤ä¸ªæ¦‚å¿µæ¥è¿›è¡Œåˆ†æã€‚è¿™ä¸ªæ–¹æ³•å¹¶ä¸ä¸¥æ ¼ï¼Œä½†æ˜¯åœ¨å¾ˆå¤šæ—¶å€™å¾ˆå®ç”¨ã€‚ æœ‰åºåº¦æ˜¯æ•°ç»„ä¸­å…·æœ‰æœ‰åºå…³ç³»çš„å…ƒç´ å¯¹çš„ä¸ªæ•°ï¼Œç”¨å…¬å¼è¡¨ç¤ºå¦‚ä¸‹ï¼š 1æœ‰åºå…ƒç´ å¯¹ï¼šå¦‚æœi &lt; jï¼Œæœ‰a[i] &lt;= a[j] å¦‚æ•°ç»„[2, 4, 3, 1, 5, 6]çš„æœ‰åºåº¦ä¸º11ï¼Œå› ä¸ºæœ‰åºå…ƒç´ å¯¹æœ‰ä»¥ä¸‹11ä¸ªï¼š 1(2, 4), (2, 3), (4, 5), (4, 6), (2, 5), (2, 6), (3, 5), (3, 6), (1, 5), (1, 6), (5, 6) å¯¹äºä¸€ä¸ªå€’åºçš„æ•°ç»„æ¥è¯´ï¼Œæœ‰åºåº¦å°±æ˜¯0ï¼›å¦‚æœæ˜¯ä¸€ä¸ªå®Œå…¨æœ‰åºçš„æ•°ç»„ï¼Œæœ‰åºåº¦æ˜¯n(n-1)/2ï¼Œä¹Ÿç§°ä¸ºæ»¡æœ‰åºåº¦ã€‚é‚£ä¹ˆï¼Œé€†åºåº¦åˆ™ä¸æœ‰åºåº¦çš„å®šä¹‰ç›¸åï¼ˆé»˜è®¤ä»å°åˆ°å¤§ä¸ºæœ‰åºï¼‰ã€‚å…¬å¼å¦‚ä¸‹ï¼š 1é€†åºå…ƒç´ å¯¹ï¼šå¦‚æœi &gt; j,æœ‰a[i] &lt; a[j] æ ¹æ®æœ‰åºåº¦å’Œæ— åºåº¦çš„å®šä¹‰ï¼Œå¯ä»¥å¾—åˆ°è¿™ä¹ˆä¸€ä¸ªå…¬å¼ï¼šé€†åºåº¦=æ»¡æœ‰åºåº¦-æœ‰åºåº¦ã€‚ å¯¹å…ƒç´ è¿›è¡Œæ’åºï¼Œå°±æ˜¯ä¸€ä¸ªä¸æ–­å¢åŠ æœ‰åºåº¦ã€å‡å°‘é€†åºåº¦çš„è¿‡ç¨‹ï¼Œç›´åˆ°è¾¾åˆ°æ»¡æœ‰åºåº¦ï¼Œæ’åºå®Œæˆã€‚ å†’æ³¡æ’åºï¼ˆBubble Sortï¼‰å†’æ³¡ç®—æ³•æ¯æ¬¡éƒ½åªæ“ä½œç›¸é‚»çš„ä¸¤ä¸ªæ•°æ®ã€‚å¦‚æœä¸æ»¡è¶³å¤§å°è¦æ±‚ï¼Œå°±å°†å…¶äº’æ¢ã€‚ 12345678910111213141516171819202122# å†’æ³¡ç®—æ³•def bubble_sort(a): """aæ˜¯æ•°ç»„ï¼Œè¿”å›ä»å°åˆ°å¤§æ’åºçš„æ•°ç»„""" n = len(a) # åªæœ‰ä¸€ä¸ªå…ƒç´ å°±ç›´æ¥è¿”å› if n &lt;= 1: return a # å¾ªç¯ï¼Œå°†æ¯ä¸ªå…ƒç´ ä¸ä¸‹ä¸€ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒ for i in range(n): flag = False for j in range(n-i-1): # å¦‚æœå½“å‰å…ƒç´ æ¯”ä¸‹ä¸€ä¸ªå…ƒç´ å¤§ï¼Œäº’æ¢ä½ç½® if a[j] &gt; a[j+1]: a[j], a[j+1] = a[j+1], a[j] flag = True # ä¼˜åŒ–ï¼šæ²¡æœ‰æ•°æ®äº¤æ¢ï¼Œæå‰é€€å‡º if not flag: break return aa=[3,5,4,1,2,6,2,55,6,7,6,4]bubble_sort(a) åˆ†æå†’æ³¡ç®—æ³• å†’æ³¡ç®—æ³•æ˜¯åŸåœ°æ’åºç®—æ³•å— å› ä¸ºåªæ¶‰åŠåˆ°ç›¸é‚»æ•°æ®çš„äº¤æ¢æ“ä½œï¼Œéœ€è¦çš„ç©ºé—´å¤æ‚åº¦ä¸ºO(1)ï¼Œæ‰€ä»¥æ˜¯åŸåœ°æ’åºç®—æ³•ã€‚ å†’æ³¡ç®—æ³•æ˜¯ç¨³å®šçš„æ’åºç®—æ³•å— å†’æ³¡æ’åºä¸­åªæœ‰äº¤æ¢æ‰ä¼šæ”¹å˜ä¸¤ä¸ªå…ƒç´ çš„å‰åé¡ºåºã€‚å½“ç›¸é‚»ä¸¤ä¸ªå…ƒç´ ç›¸ç­‰æ—¶ï¼Œæˆ‘ä»¬ä¸åšäº¤æ¢ï¼Œæ‰€ä»¥å¤§å°ç›¸ç­‰çš„å…ƒç´ åœ¨æ’åºå‰åé¡ºåºä¸æ”¹å˜ï¼Œæ˜¯ç¨³å®šçš„æ’åºç®—æ³•ã€‚ å†’æ³¡æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ æœ€å¥½æƒ…å†µä¸‹ï¼Œè¦æ’åºçš„æ•°æ®å·²ç»æ˜¯æœ‰åºçš„äº†ï¼Œåªéœ€è¦ä¸€æ¬¡å†’æ³¡æ“ä½œï¼Œæ‰€ä»¥æœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼ˆéå†æ•°ç»„ï¼‰ã€‚æœ€åæƒ…å†µåˆ™æ˜¯ï¼Œè¦æ’åºçš„æ•°æ®æ˜¯å€’åºçš„ï¼Œéœ€è¦è¿›è¡Œnæ¬¡å†’æ³¡ï¼Œæ‰€ä»¥æœ€åæ—¶é—´å¤æ‚åº¦ä¸ºO(n^2)ã€‚å¹³å‡æƒ…å†µå¤æ‚åº¦çš„è®¡ç®—ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥æ ¹æ®æœ‰åºåº¦æ¥è®¡ç®—ã€‚ æœ€åæƒ…å†µä¸‹ï¼Œåˆå§‹çŠ¶æ€çš„æœ‰åºåº¦æ˜¯0ï¼Œè¦è¿›è¡Œn(n-1)/2æ¬¡äº¤æ¢ã€‚æœ€å¥½æƒ…å†µæƒ…å†µä¸‹ï¼Œåˆå§‹çŠ¶æ€çš„æœ‰åºåº¦æ˜¯n(n-1)/2ï¼Œä¸éœ€è¦è¿›è¡Œäº¤æ¢ã€‚æˆ‘ä»¬å¯ä»¥å–ä¸¤è€…çš„ä¸­é—´å€¼ä½œä¸ºå¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ï¼Œä¹Ÿå°±æ˜¯n(n-1)/4ï¼Œæ‰€ä»¥å¤æ‚åº¦ä¸ºO(n^2)ã€‚ æ’å…¥æ’åº(Insertion Sort)æ’å…¥æ’åºæ˜¯åœ¨æœ‰åºæ•°ç»„ä¸­æ’å…¥æ–°æ•°æ®ä¹‹åï¼Œä»ç„¶ä¿æŒæ•°æ®çš„æœ‰åºæ€§ã€‚æ‰€ä»¥éœ€è¦éå†æ•°ç»„ï¼Œæ‰¾åˆ°æ•°æ®åº”è¯¥æ’å…¥çš„ä½ç½®å°†å…¶æ’å…¥å³å¯ã€‚ æ’å…¥æ’åºä¹Ÿåªæ¶‰åŠåˆ°ä¸¤ç§æ“ä½œï¼Œä¸€ç§æ˜¯å…ƒç´ æ¯”è¾ƒï¼Œå¦ä¸€ç§æ˜¯å…ƒç´ çš„ç§»åŠ¨ã€‚ è¿‡ç¨‹ï¼šæˆ‘ä»¬éœ€è¦å°†å¾…æ’åºæ•°ç»„åˆ†ä¸ºå·²æ’åºåŒºå’Œæœªæ’åºåŒºï¼Œä¸€å¼€å§‹ï¼Œå·²æ’åºåŒºåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ä¹‹åå°±ä¸æ–­åœ¨æœªæ’åºåŒºä¸­å–å‡ºå…ƒç´ ï¼Œç„¶ååœ¨å·²æ’åºåŒºéå†æŸ¥æ‰¾åˆé€‚çš„ä½ç½®æ’å…¥æ–°å…ƒç´ ï¼ŒåŒæ—¶å°†æ’å…¥ç‚¹ä¹‹åçš„å…ƒç´ éƒ½é¡ºåºå¾€åç§»åŠ¨ä¸€ä½ï¼Œå¹¶ä¿è¯å·²æ’åºåŒºçš„æ•°æ®ä¸€ç›´æœ‰åºã€‚é‡å¤æ•´ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æœªæ’åºåŒºçš„å…ƒç´ ä¸ºç©ºã€‚ 1234567891011121314151617# æ’å…¥æ’åºdef insert_sort(a): n = len(a) if n &lt;= 1: return for i in range(1, n): # å½“å‰å…ƒç´  value = a[i] for j in range(i, 0, -1): if a[j-1] &gt; value: a[j-1], a[j] = value, a[j-1] else: break return ab = [3,2,1,6,5,9,6,1]insert_sort(b) åˆ†ææ’å…¥ç®—æ³• æ’å…¥æ’åºæ˜¯åŸåœ°æ’åºç®—æ³•å— æ’å…¥æ’åºå¹¶ä¸éœ€è¦é¢å¤–çš„å‚¨å­˜ç©ºé—´ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦æ˜¯O(1)ï¼Œæ˜¯åŸåœ°æ’åºç®—æ³•ã€‚ æ’å…¥æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å— å¯¹äºå€¼ç›¸åŒçš„å…ƒç´ ï¼Œæˆ‘ä»¬å¯ä»¥å°†åé¢å‡ºç°çš„å…ƒç´ æ’å…¥åˆ°å‰é¢å‡ºç°å…ƒç´ çš„åé¢ï¼Œè¿™æ ·å°±ä¿æŒäº†åŸæœ¬çš„å‰åé¡ºåºï¼Œä»ä»£ç å®ç°ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ã€‚æ‰€ä»¥æ˜¯ç¨³å®šçš„æ’åºç®—æ³•ã€‚ æ’å…¥æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ æœ€å¥½æƒ…å†µä¸‹ï¼Œå¾…æ’åºæ•°ç»„å·²ç»æ˜¯æœ‰åºçš„äº†ï¼Œæ’å…¥æ’åºç®—æ³•åªæ˜¯å¾ªç¯æ¯”è¾ƒäº†ä¸€éï¼Œå¹¶æ²¡æœ‰æ’å…¥æ“ä½œï¼Œæ‰€ä»¥æœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼ˆéå†æ•°ç»„ï¼‰ã€‚æœ€åæƒ…å†µä¸‹ï¼Œå¾…æ’åºæ•°ç»„æ˜¯å€’åºçš„ï¼Œé‚£ä¹ˆå¾ªç¯æ¯”è¾ƒæ—¶ï¼Œè¿˜éœ€è¦ç§»åŠ¨æ•°æ®ï¼Œæ‰€ä»¥æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸ºO(n^2)ã€‚æ’å…¥æ’åºç±»ä¼¼äºåœ¨æ•°ç»„ä¸­æ’å…¥ä¸€ä¸ªæ•°æ®ï¼Œåªä¸è¿‡è¦å¾ªç¯æ‰§è¡Œnæ¬¡æ’å…¥æ“ä½œï¼Œç±»æ¯”åè€…çš„å¹³å‡æ—¶é—´å¤æ‚åº¦æ˜¯O(n)ï¼Œæ’å…¥æ’åºç®—æ³•çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºO(n^2)ã€‚ é€‰æ‹©æ’åº(Selection Sort)é€‰æ‹©æ’åºæ€è·¯è·Ÿæ’å…¥æ’åºç±»ä¼¼ï¼Œä¹Ÿåˆ†æœªæ’åºåŒºå’Œå·²æ’åºåŒºã€‚ä¸åŒçš„æ˜¯ï¼Œé€‰æ‹©æ’åºæ¯æ¬¡éƒ½ä»æœªæ’åºåŒºé€‰æ‹©æœ€å°å€¼æ’å…¥åˆ°å·²æ’åºåŒºçš„å°¾éƒ¨ï¼Œä¹Ÿå°±æ˜¯å°†ä¸¤è€…äº’æ¢ã€‚ï¼ˆæ‰“ç ´äº†åŸæœ‰æ•°ç»„å…ƒç´ çš„å‰åé¡ºåºï¼‰ 12345678910111213141516171819# é€‰æ‹©æ’åºdef select_sort(a): n = len(a) if n == 1: return a for i in range(n): # æœ€å°å…ƒç´ çš„ä¸‹æ ‡ flag = i # åœ¨æœªæ’åºåŒºé€‰æ‹©æœ€å°å…ƒç´  for j in range(i, n): # ä¸æ–­æ›´æ–°æœ€å°å€¼ if a[j] &lt; a[flag]: # å¦‚æœå…ƒç´ å°äºæœ€å°å…ƒç´ ï¼Œæ›´æ–°ä¸‹æ ‡ flag = j # å°†æœ€å°å…ƒç´ ä¸ä¸‹æ ‡ä¸ºiäº’æ¢ a[flag], a[i] = a[i], a[flag] return aselect_sort(a) åˆ†æé€‰æ‹©æ’åºç®—æ³• é€‰æ‹©æ’åºæ˜¯åŸåœ°æ’åºç®—æ³•å— é€‰æ‹©æ’åºçš„ç©ºé—´å¤æ‚åº¦ä¸ºO(1)ï¼Œæ‰€ä»¥æ˜¯åŸåœ°æ’åºç®—æ³•ã€‚ é€‰æ‹©æ’åºæ˜¯ç¨³å®šçš„æ’åºç®—æ³•å— æ¯æ¬¡é€‰æ‹©å…ƒç´ éƒ½æ˜¯åœ¨æœªæ’åºåŒºé€‰æ‹©æœ€å°å€¼ç„¶åä¸å·²æ’åºåŒºçš„æœ«å°¾(æœªæ’åºçš„ç¬¬ä¸€ä½å…ƒç´ )å…ƒç´ è¿›è¡Œäº¤æ¢ï¼Œä¼šæ‰“ç ´åŸæœ‰å…ƒç´ çš„å‰åé¡ºåºã€‚ é€‰æ‹©æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ ä¸ç®¡å¾…æ’åºæ•°ç»„æ˜¯æœ‰åºè¿˜æ˜¯å€’åºï¼Œæ¯æ¬¡é€‰æ‹©æœ€å°å…ƒç´ çš„æ—¶å€™éƒ½ä¼šå¾ªç¯æ¯”è¾ƒï¼Œæ‰§è¡Œnæ¬¡è¿™æ ·çš„æ“ä½œï¼Œæ‰€ä»¥ä¸ç®¡æœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦ã€æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦å’Œå¹³å‡æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(n^2)ã€‚ ä¸ºä»€ä¹ˆæ’å…¥æ’åºè¦æ¯”å†’æ³¡æ’åºæ›´å—æ¬¢è¿ä»ä¸Šæ–‡å¯ä»¥å¾—çŸ¥ï¼Œè¿™ä¸¤ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(n^2)ï¼Œéƒ½æ˜¯åŸåœ°æ’åºç®—æ³•ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±åœ¨äºæ•°æ®äº¤æ¢éƒ¨åˆ†ã€‚å†’æ³¡æ’åºäº¤æ¢æ“ä½œæœ‰ä¸‰ä¸ªæ“ä½œè¯­å¥ï¼Œè€Œæ’å…¥æ’åºçš„å…ƒç´ ç§»åŠ¨æ“ä½œåªæœ‰ä¸€è¡Œä»£ç ï¼Œæ‰€ä»¥ä»ç†è®ºä¸Šæ¥è¯´ï¼Œæ’å…¥æ’åºæ›´ä¼˜ã€‚ å‚è€ƒæ–‡ç« æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>æ’åº</tag>
        <tag>å†’æ³¡æ’åº</tag>
        <tag>æ’å…¥æ’åº</tag>
        <tag>é€‰æ‹©æ’åº</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€æ•°æ®ç»“æ„ä¸ç®—æ³•ç¬”è®°å…­ã€‘é€’å½’]]></title>
    <url>%2Famberwest.github.io%2F2018%2F10%2F15%2F%E9%80%92%E5%BD%92%2F</url>
    <content type="text"><![CDATA[è¿™æ ·ç†è§£â€œé€’å½’â€çœ‹ç”µå½±æ—¶ï¼Œå¦‚æœå¿˜äº†è‡ªå·±åœ¨ç¬¬å‡ æ’ï¼Œåªéœ€è¦é—®å‰é¢çš„äººæ˜¯ç¬¬å‡ æ’ï¼Œä¸€ç›´åˆ°ç¬¬ä¸€æ’ï¼Œç„¶åå†æŠŠæ•°å­—ä¸€æ’ä¸€æ’ä¼ å›æ¥ï¼Œè¿™æ ·å°±çŸ¥é“ç­”æ¡ˆäº†ã€‚ è¿™æ•´ä¸ªè¿‡ç¨‹å°±æ˜¯æ ‡å‡†çš„é€’å½’æ±‚è§£é—®é¢˜çš„åˆ†è§£è¿‡ç¨‹ï¼Œå»çš„è¿‡ç¨‹å«â€œé€’â€ï¼Œå›æ¥çš„è¿‡ç¨‹å«â€œå½’â€ã€‚å¯ä»¥è¿™æ ·æ¥è¡¨ç¤ºï¼š 12345def f(n): if n == 1: return 1 else: return f(n-1) + 1 æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œå› ä¸ºé€’å½’è°ƒç”¨ä¸€æ¬¡ä¼šåœ¨å†…å­˜æ ˆä¸­ä¿å­˜ä¸€æ¬¡ç°åœºæ•°æ®ï¼Œæ‰€æœ‰éœ€è¦é¢å¤–è€ƒè™‘è¿™éƒ¨åˆ†å¼€é”€ã€‚ é€’å½’éœ€è¦æ»¡è¶³çš„ä¸‰ä¸ªæ¡ä»¶ ä¸€ä¸ªé—®é¢˜çš„è§£å¯ä»¥åˆ†è§£ä¸ºå‡ ä¸ªå­é—®é¢˜çš„è§£ å¦‚ä¸Šé¢ä¾‹å­ï¼Œå°†â€œè‡ªå·±åœ¨å“ªä¸€æ’â€çš„é—®é¢˜ï¼Œåˆ†è§£ä¸ºâ€œå‰ä¸€æ’çš„äººåœ¨å“ªä¸€æ’â€è¿™æ ·çš„å­é—®é¢˜ è¿™ä¸ªé—®é¢˜ä¸åˆ†è§£ä¹‹åçš„å­é—®é¢˜ï¼Œé™¤äº†æ•°æ®è§„æ¨¡ä¸åŒï¼Œæ±‚è§£æ€è·¯å®Œå…¨ä¸€æ · å¦‚ä¸Šé¢ä¾‹å­ï¼Œâ€œè‡ªå·±åœ¨å“ªä¸€æ’â€è¿™ä¸ªé—®é¢˜è·Ÿâ€œå‰ä¸€æ’çš„äººåœ¨å“ªä¸€æ’â€æ˜¯ä¸€æ ·çš„æ±‚è§£æ€è·¯ å­˜åœ¨é€’å½’ç»ˆæ­¢æ¡ä»¶ å¯¹é—®é¢˜è¿›è¡Œåˆ†è§£ï¼Œå¿…é¡»å­˜åœ¨ç»ˆæ­¢æ¡ä»¶ï¼Œä¸èƒ½æ— é™åˆ†è§£ä¸‹å»ã€‚å¦‚ä¸Šé¢ä¾‹å­ä¸­ï¼Œç¬¬ä¸€æ’çš„äººä¸éœ€è¦ç»§ç»­è¯¢é—®åˆ«äººå°±çŸ¥é“è‡ªå·±åœ¨å“ªä¸€æ’ï¼Œè¿™å°±æ˜¯é€’å½’çš„ç»ˆæ­¢æ¡ä»¶ å¦‚ä½•ç¼–å†™é€’å½’ä»£ç  å†™é€’å½’ä»£ç çš„å…³é”®å°±æ˜¯æ‰¾åˆ°å¦‚ä½•å°†å¤§é—®é¢˜åˆ†è§£ä¸ºå°é—®é¢˜çš„è§„å¾‹ï¼Œå¹¶ä¸”åŸºäºæ­¤å†™å‡ºé€’æ¨å…¬å¼ï¼Œç„¶åå†æ¨æ•²ç»ˆæ­¢æ¡ä»¶ï¼Œæœ€åå°†é€’æ¨å…¬å¼å’Œç»ˆæ­¢æ¡ä»¶ç¿»è¯‘æˆä»£ç ã€‚ä¸€å¥è¯æ€»ç»“ï¼šå†™å‡ºé€’æ¨å…¬å¼ï¼Œæ‰¾åˆ°ç»ˆæ­¢æ¡ä»¶ ä¾‹å­ï¼šå‡å¦‚æœ‰nä¸ªå°é˜¶ï¼Œæ¯æ¬¡å¯ä»¥è·¨1ä¸ªå°é˜¶æˆ–è€…2ä¸ªå°é˜¶ï¼Œè¯·é—®èµ°è¿™nä¸ªå°é˜¶ä¸€å…±æœ‰å¤šå°‘ç§èµ°æ³•ï¼Ÿ é€’æ¨å…¬å¼ï¼šå¯ä»¥æ ¹æ®ç¬¬ä¸€æ­¥çš„èµ°æ³•å°†æ‰€æœ‰èµ°æ³•åˆ†ä¸ºä¸¤ç±»ï¼Œç¬¬ä¸€ç±»æ˜¯ç¬¬ä¸€æ­¥èµ°äº†1ä¸ªå°é˜¶ï¼Œç¬¬äºŒç±»æ˜¯ç¬¬ä¸€æ­¥èµ°äº†2ä¸ªå°é˜¶ã€‚æ‰€ä»¥nä¸ªå°é˜¶çš„èµ°æ³•å°±æ˜¯å…ˆèµ°1ä¸ªå°é˜¶ä¹‹ån-1ä¸ªå°é˜¶çš„èµ°æ³•åŠ ä¸Šå…ˆèµ°2ä¸ªå°é˜¶åï¼Œn-2ä¸ªå°é˜¶çš„èµ°æ³•ï¼Œå…¬å¼å¦‚ä¸‹ï¼š 1f(n) = f(n-1) + f(n-2) ç»ˆæ­¢æ¡ä»¶ï¼šå½“åªæœ‰1ä¸ªå°é˜¶æ—¶ï¼Œåªæœ‰ä¸€ç§èµ°æ³•f(1)=1ï¼Œå½“åªæœ‰2ä¸ªå°é˜¶çš„æ—¶å€™ï¼Œæœ‰ä¸¤ç§èµ°æ³•ï¼Œæ‰€ä»¥ç»ˆæ­¢æ¡ä»¶åªæœ‰f(1)=1å¹¶ä¸å¤Ÿï¼Œéœ€è¦åŠ ä¸Šf(2)=2ã€‚ é€’å½’ä»£ç ï¼š 123456def f(n): if n == 1: return 1 if n == 2: return 2 return f(n-1) + f(n-2) ç¼–å†™é€’å½’ä»£ç æ—¶ï¼Œåªè¦é‡åˆ°é€’å½’ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒæŠ½è±¡æˆä¸€ä¸ªé€’æ¨å…¬å¼ï¼Œä¸ç”¨æƒ³ä¸€å±‚å±‚çš„è°ƒç”¨å…³ç³»ï¼Œä¸è¦è¯•å›¾ç”¨äººè„‘å»åˆ†æé€’å½’çš„æ¯ä¸ªæ­¥éª¤ï¼Œå› ä¸ºè¿™æ ·å¾ˆå®¹æ˜“è¿›å…¥ä¸€ä¸ªæ€ç»´è¯¯åŒºã€‚ æ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜Aå¯ä»¥åˆ†è§£ä¸ºè‹¥å¹²å­é—®é¢˜Bã€Cã€Dï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾å­é—®é¢˜Bã€Cã€Då·²ç»è§£å†³ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæ€è€ƒå¦‚ä½•è§£å†³é—®é¢˜Aï¼Œå¹¶æ€è€ƒé—®é¢˜Aä¸å­é—®é¢˜Bã€Cã€Dä¸¤å±‚ä¹‹é—´çš„å…³ç³»å³å¯ã€‚ é€’å½’ä»£ç è¦è­¦æƒ•å †æ ˆæº¢å‡º1.ä¸ºä»€ä¹ˆé€’å½’ä»£ç å®¹æ˜“é€ æˆå †æ ˆæº¢å‡º å‡½æ•°è°ƒç”¨ä¼šä½¿ç”¨æ ˆæ¥ä¿å­˜ä¸´æ—¶å˜é‡ã€‚æ¯è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œéƒ½ä¼šå°†ä¸´æ—¶å˜é‡å°è£…ä¸ºæ ˆå¸§å‹å…¥å†…å­˜æ ˆï¼Œç­‰åˆ°å‡½æ•°æ‰§è¡Œå®Œæˆè¿”å›æ—¶ï¼Œæ‰å‡ºæ ˆã€‚å½“å‡½æ•°è¿”å›æ—¶ï¼Œæ ˆå°±ä¼šå‡ä¸€å±‚æ ˆå¸§ã€‚ç”±äºæ ˆçš„å¤§å°ä¸æ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥æ¬¡æ•°è¿‡å¤šä¼šå¯¼è‡´å †æ ˆä¼šæº¢å‡ºã€‚æ‰€ä»¥å½“é€’å½’æ±‚è§£çš„æ•°æ®è§„æ¨¡è¿‡å¤§ï¼Œè°ƒç”¨å±‚æ¬¡å¤ªæ·±ï¼Œå°±æœ‰å †æ ˆæº¢å‡ºçš„é£é™© 2.å¦‚ä½•é¿å…å‡ºç°å †æ ˆæº¢å‡º å¯ä»¥é€šè¿‡åœ¨ä»£ç ä¸­è®¾ç½®é€’å½’è°ƒç”¨çš„æœ€å¤§æ·±åº¦æ¥è§£å†³é—®é¢˜ï¼Œå¦‚pythonä¸­å¯ä»¥è¿™æ ·è®¾ç½®ï¼š 12import syssys.setrecursionlimit(100000) ä½†æ˜¯å¦‚æœéœ€è¦è®¡ç®—çš„æ·±åº¦è¿‡å¤§ï¼Œé€’å½’æ–¹æ³•å°±ä¸æ˜¯é‚£ä¹ˆå®ç”¨ã€‚ é€’å½’ä»£ç è¦è­¦æƒ•é‡å¤è®¡ç®—ä¸ºé¿å…é‡å¤è®¡ç®—ï¼Œå¯ä»¥ç”¨æ•£åˆ—è¡¨ä¹‹ç±»çš„çš„æ•°æ®ç»“æ„æ¥ä¿å­˜å·²ç»æ±‚è§£è¿‡çš„f(k)ï¼Œå¦‚æœå·²ç»æ±‚è§£è¿‡çš„å°±ç›´æ¥ä»æ•£åˆ—è¡¨å–å€¼è¿”å›ã€‚ 1234567891011res = dict()def f(n): if n == 1: return 1 if n == 2: return 2 if n in res: return res[n] ret = f(n-1) + f(n-2) res.update(&#123;n : ret&#125;) return ret æ”¹å†™é€’å½’ä»£ç ä¸ºéé€’å½’ä»£ç ç”µå½±é™¢ä¾‹å­ï¼Œå¯ä»¥ä¿®æ”¹ä¸º 12345def (n): ret = 1 for i in range(2, n): ret = ret + 1 return ret è·¨å°é˜¶é—®é¢˜ï¼Œå¯ä»¥ä¿®æ”¹ä¸ºï¼š 123456789101112131415def f(n): # ç»ˆæ­¢æ¡ä»¶æœ‰ä¸¤ä¸ª if n == 1: return 1 if n == 2: return 2 # å½“ä¸æ»¡è¶³ç»ˆæ­¢æ¡ä»¶æ—¶ï¼Œæ¯å¢åŠ ä¸€ä¸ªå°é˜¶éƒ½å°†ä¹‹å‰çš„èµ°æ³•è¿›è¡Œå åŠ  ret = 0 pre = 2 prepare = 1 for i in range(3, n): ret = pre + prepre prepre = pre pre = ret return ret å…³äºé€’å½’ä»£ç çš„è°ƒè¯•æ–¹å¼ æ‰“å°æ—¥å¿—æŸ¥çœ‹é€’å½’å€¼ ç»“åˆæ¡ä»¶æ–­ç‚¹è¿›è¡Œè°ƒè¯• å‚è€ƒæ–‡ç« æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>é€’å½’</tag>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€æ•°æ®ç»“æ„ä¸ç®—æ³•ç¬”è®°äº”ã€‘é˜Ÿåˆ—]]></title>
    <url>%2Famberwest.github.io%2F2018%2F10%2F15%2F%E9%98%9F%E5%88%97%2F</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯é˜Ÿåˆ—è·Ÿæ ˆä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ç§æ“ä½œå—é™çš„çº¿æ€§è¡¨æ•°æ®ç»“æ„ï¼Œä¸åŒçš„æ˜¯ï¼Œé˜Ÿåˆ—æ˜¯å…ˆè¿›å…ˆå‡ºã€‚æœ€åŸºæœ¬çš„æ“ä½œåªæœ‰ä¸¤ä¸ªï¼šå…¥é˜Ÿenqueue()ï¼Œä¹Ÿå°±æ˜¯æ”¾ä¸€ä¸ªæ•°æ®åˆ°é˜Ÿåˆ—å°¾éƒ¨ï¼›å‡ºé˜Ÿdequeue()ï¼Œä»é˜Ÿåˆ—å¤´éƒ¨å–å‡ºä¸€ä¸ªå…ƒç´ ã€‚ å…·æœ‰æŸäº›ç‰¹æ€§çš„é˜Ÿåˆ—å¾ªç¯é˜Ÿåˆ—ã€é˜»å¡é˜Ÿåˆ—ã€å¹¶å‘é˜Ÿåˆ—ã€å¾ªç¯å¹¶å‘é˜Ÿåˆ—ç­‰ã€‚ é˜Ÿåˆ—çš„å®ç°1ï¼‰é¡ºåºé˜Ÿåˆ—ï¼šç”¨æ•°ç»„æ¥å®ç° é˜Ÿåˆ—çš„å®ç°éœ€è¦ä¸¤ä¸ªæŒ‡é’ˆï¼šä¸€ä¸ªæ˜¯headæŒ‡é’ˆï¼ŒæŒ‡å‘å¯¹å¤´ï¼›å¦ä¸€ä¸ªæ˜¯tailæŒ‡é’ˆï¼ŒæŒ‡å‘é˜Ÿå°¾ã€‚ä¸‹é¢æ˜¯ç”¨JavaåŸºäºæ•°ç»„å®ç°çš„é˜Ÿåˆ—ï¼Œä»£ç æ¥è‡ªã€Šæ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ã€‹ 12345678910111213141516171819202122232425262728293031323334// ç”¨æ•°ç»„å®ç°çš„é˜Ÿåˆ—public class ArrayQueue &#123;// æ•°ç»„ï¼šitemsï¼Œæ•°ç»„å¤§å°ï¼šnprivate String[] items;private int n = 0;// head è¡¨ç¤ºé˜Ÿå¤´ä¸‹æ ‡ï¼Œtail è¡¨ç¤ºé˜Ÿå°¾ä¸‹æ ‡private int head = 0;private int tail = 0;// ç”³è¯·ä¸€ä¸ªå¤§å°ä¸º capacity çš„æ•°ç»„public ArrayQueue(int capacity) &#123;items = new String[capacity];n = capacity;&#125;// å…¥é˜Ÿpublic boolean enqueue(String item) &#123;// å¦‚æœ tail == n è¡¨ç¤ºé˜Ÿåˆ—å·²ç»æ»¡äº†if (tail == n) return false;items[tail] = item;++tail;return true;&#125;// å‡ºé˜Ÿpublic String dequeue() &#123;// å¦‚æœ head == tail è¡¨ç¤ºé˜Ÿåˆ—ä¸ºç©ºif (head == tail) return null;// ä¸ºäº†è®©å…¶ä»–è¯­è¨€çš„åŒå­¦çœ‹çš„æ›´åŠ æ˜ç¡®ï¼ŒæŠŠ -- æ“ä½œæ”¾åˆ°å•ç‹¬ä¸€è¡Œæ¥å†™äº†String ret = items[head];++head;return ret;&#125;&#125; å½“æœ‰å‡ºé˜Ÿã€å…¥é˜Ÿæ“ä½œæ—¶ï¼ŒheadæŒ‡é’ˆå’ŒtailæŒ‡é’ˆéƒ½è¦å¾€åç§»åŠ¨ã€‚å½“tailç§»åŠ¨åˆ°æœ€å³è¾¹çš„æ—¶å€™ï¼Œå°±ä¸èƒ½ç»§ç»­å¾€é˜Ÿåˆ—é‡Œæ·»åŠ æ•°æ®äº†ï¼Œå³ä½¿æ•°ç»„ä¸­è¿˜æœ‰ç©ºä½™ç©ºé—´ã€‚ åƒæ•°ç»„ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨æ•°æ®æ¬ç§»çš„æ–¹æ³•ï¼Œæ¯æ¬¡å‡ºé˜Ÿæ“ä½œï¼Œéƒ½å°†å‰©ä½™æ•°æ®ç§»åŠ¨åˆ°é˜Ÿå¤´ï¼Œä½†æ˜¯è¿™æ ·å°±ä¼šä½¿å¾—å‡ºé˜Ÿæ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä»åŸæ¥çš„O(1)å˜ä¸ºO(n)ã€‚ åŒæ ·çš„ï¼Œä¹Ÿå¯ä»¥å€Ÿé‰´æ•°ç»„åˆ é™¤æ“ä½œçš„ä¼˜åŒ–æ–¹æ³•â€”â€”å½“æ²¡æœ‰ç©ºä½™ç©ºé—´æ—¶ï¼Œå†é›†ä¸­è§¦å‘ä¸€æ¬¡æ•°æ®çš„æ¬ç§»æ“ä½œã€‚ç°åœ¨ä¿®æ”¹å…¥é˜Ÿå‡½æ•°enqueue()ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819// å…¥é˜Ÿæ“ä½œï¼Œå°† item æ”¾å…¥é˜Ÿå°¾public boolean enqueue(String item) &#123;// tail == n è¡¨ç¤ºé˜Ÿåˆ—æœ«å°¾æ²¡æœ‰ç©ºé—´äº†if (tail == n) &#123;// tail ==n &amp;&amp; head==0ï¼Œè¡¨ç¤ºæ•´ä¸ªé˜Ÿåˆ—éƒ½å æ»¡äº†if (head == 0) return false;// æ•°æ®æ¬ç§»for (int i = head; i &lt; tail; ++i) &#123;items[i-head] = items[i];&#125;// æ¬ç§»å®Œä¹‹åé‡æ–°æ›´æ–° head å’Œ tailtail -= head;head = 0;&#125;items[tail] = item;++tail;return true;&#125; 2ï¼‰é“¾å¼é˜Ÿåˆ—ï¼šç”¨é“¾è¡¨æ¥å®ç° åŒæ ·éœ€è¦ä¸¤ä¸ªæŒ‡é’ˆï¼šheadæŒ‡é’ˆå’ŒtailæŒ‡é’ˆã€‚å…¥é˜Ÿæ—¶ï¼Œtail-&gt;next=new_node, tail=tail-&gt;nextï¼›å‡ºé˜Ÿæ—¶ï¼Œhead=head-&gt;next 3ï¼‰å¾ªç¯é˜Ÿåˆ— ä½¿ç”¨æ•°ç»„å®ç°çš„é˜Ÿåˆ—ï¼Œæˆ‘ä»¬å°†å…¶é¦–å°¾ç›¸è¿ï¼Œæ„æˆä¸€ä¸ªç¯ï¼Œè¿™æ ·å°±æˆäº†å¾ªç¯é˜Ÿåˆ—ã€‚å¾ªç¯é˜Ÿåˆ—å¾ˆå¥½çš„é¿å…äº†å‡ºé˜Ÿæ“ä½œæ—¶çš„æ•°æ®æ¬ç§»ã€‚ å‡è®¾å¾ªç¯é˜Ÿåˆ—å¤§å°ä¸º8ï¼Œå½“å‰head=4ï¼Œtail=7ï¼Œå½“æœ‰æ•°æ®å…¥é˜Ÿæ—¶ï¼ŒtailæŒ‡é’ˆä¸æ›´æ–°ä¸º8ï¼Œè€Œæ˜¯æŒ‡å‘ä¸‹æ ‡ä¸º0çš„ä½ç½®ã€‚å½“æœ‰æ•°æ®ç»§ç»­åŠ å…¥æ—¶ï¼ŒtailåŠ 1ã€‚ å¾ªç¯é˜Ÿåˆ—çš„é˜Ÿç©ºé˜Ÿæ»¡åˆ¤æ–­æ¡ä»¶ä¹Ÿæœ‰äº†å˜åŒ–ï¼šé˜Ÿåˆ—ä¸ºç©ºæ—¶çš„åˆ¤æ–­æ¡ä»¶ä¾ç„¶æ˜¯head=tailã€‚é˜Ÿæ»¡æ—¶ï¼Œ(tail+1)%n=headï¼Œæ‰€ä»¥å¾ªç¯é˜Ÿåˆ—ä¼šæµªè´¹ä¸€ä¸ªæ•°ç»„çš„å‚¨å­˜ç©ºé—´(åŠ 1)ã€‚ 4ï¼‰é˜»å¡é˜Ÿåˆ— é˜»å¡é˜Ÿåˆ—å°±æ˜¯åœ¨é˜Ÿåˆ—çš„åŸºç¡€ä¸Šæ·»åŠ é˜»å¡æ“ä½œï¼Œå…¸å‹çš„â€œç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹â€ã€‚é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œä»é˜Ÿå¤´å–æ•°æ®ä¼šé˜»å¡ç›´åˆ°é˜Ÿåˆ—æœ‰äº†æ•°æ®æ‰ä¼šè¿”å›ã€‚é˜Ÿåˆ—æ»¡äº†ï¼Œæ’å…¥æ•°æ®ä¼šè¢«é˜»å¡åˆ°é˜Ÿåˆ—ä¸­æœ‰ç©ºé—²ä½ç½®åæ‰èƒ½æ’å…¥æ•°æ®ï¼Œç„¶åå†è¿”å›ã€‚ 5ï¼‰å¹¶å‘é˜Ÿåˆ— çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—å«åšå¹¶å‘é˜Ÿåˆ—ã€‚æœ€ç®€å•ç›´æ¥çš„å®ç°æ–¹å¼å°±æ˜¯åœ¨enqueue() ã€dequeue()æ–¹æ³•åŠ ä¸Šé”ã€‚ä½†æ˜¯é”åŠ›åº¦å¤§å¹¶å‘åº¦ä¼šè¾ƒä½ï¼ŒåŒä¸€æ—¶åˆ»ä»…å…è®¸ä¸€ä¸ªå­˜æˆ–å–æ“ä½œã€‚ å®æˆ˜é—®é¢˜ï¼šçº¿ç¨‹æ± æ²¡æœ‰ç©ºé—²çº¿ç¨‹æ—¶ï¼Œæ–°çš„ä»»åŠ¡è¯·æ±‚çº¿ç¨‹èµ„æºï¼Œçº¿ç¨‹æ± è¯¥å¦‚ä½•å¤„ç†ï¼Ÿå„ç§å¤„ç†ç­–ç•¥æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ åŸºäºé“¾è¡¨å¯ä»¥å®ç°ä¸€ä¸ªæ”¯æŒæ— é™æ’é˜Ÿçš„æ— ç•Œé˜Ÿåˆ—(unbounded queue)ï¼Œä½†å¯èƒ½ä¼šé€ æˆè¿‡å¤šçš„è¯·æ±‚é˜Ÿåˆ—æ’é˜Ÿï¼Œè¯·æ±‚å¤„ç†çš„å“åº”æ—¶é—´è¿‡é•¿ç­‰é—®é¢˜ã€‚å¯¹äºå“åº”æ—¶é—´æ¯”è¾ƒæ•æ„Ÿçš„ç³»ç»Ÿæ¥è¯´ï¼Œè¿™ç§è§£å†³æ–¹æ¡ˆå¹¶ä¸åˆé€‚ã€‚ åŸºäºæ•°ç»„å®ç°çš„æœ‰ç•Œé˜Ÿåˆ—(bounded queue)ï¼Œè™½ç„¶é€‚åˆå¯¹å“åº”æ—¶é—´æ•æ„Ÿçš„ç³»ç»Ÿï¼Œä½†æ˜¯å¦‚ä½•è®¾ç½®ä¸€ä¸ªåˆç†çš„é˜Ÿåˆ—å¤§å°ä¹Ÿæ˜¯ä¸ªé—®é¢˜ã€‚é˜Ÿåˆ—å¤ªå¤§åˆ™ç­‰å¾…çš„è¯·æ±‚å¤ªå¤šï¼Œé˜Ÿåˆ—å¤ªå°ä¼šå¯¼è‡´æ— æ³•æ— æ³•å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºã€å‘æŒ¥æœ€å¤§æ€§èƒ½ã€‚ é˜Ÿåˆ—å¯ä»¥åº”ç”¨åœ¨ä»»ä½•æœ‰é™èµ„æºæ± ä¸­ï¼Œç”¨äºæ’é˜Ÿè¯·æ±‚ï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥æ± ç­‰ã€‚å®é™…ä¸Šï¼Œå¯¹äºå¤§éƒ¨åˆ†èµ„æºæœ‰é™çš„åœºæ™¯ï¼Œå½“æ²¡æœ‰ç©ºé—²èµ„æºæ—¶ï¼ŒåŸºæœ¬ä¸Šéƒ½å¯ä»¥é€šè¿‡â€œé˜Ÿåˆ—â€è¿™ç§æ•°æ®ç»“æ„æ¥å®ç°è¯·æ±‚æ’é˜Ÿã€‚ æ€è€ƒé¢˜ï¼š1ã€é™¤äº†çº¿ç¨‹æ± è¿™ç§æ± ç»“æ„ä¼šç”¨åˆ°é˜Ÿåˆ—æ’é˜Ÿè¯·æ±‚ï¼Œä½ è¿˜çŸ¥é“æœ‰å“ªäº›ç±»ä¼¼çš„æ± ç»“æ„æˆ–è€…åœºæ™¯ä¸­ä¼šç”¨åˆ°é˜Ÿåˆ—çš„æ’é˜Ÿè¯·æ±‚ï¼Ÿ 2ã€å¦‚ä½•å®ç°æ— é”å¹¶å‘é˜Ÿåˆ—ï¼Ÿ å‚è€ƒæ–‡ç« æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>é˜Ÿåˆ—</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[scrapyd-clientçš„å®‰è£…ä½¿ç”¨]]></title>
    <url>%2Famberwest.github.io%2F2018%2F10%2F11%2Fscrapyd-client%E7%9A%84%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[scrapyd-clientå¯ä»¥ç”¨æ¥éƒ¨ç½²scrapyé¡¹ç›®ï¼Œå®ƒä¼šå¸®æˆ‘ä»¬æŠŠé¡¹ç›®æ‰“åŒ…æˆeggæ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸ç”¨å†åŠ¨æ‰‹è°ƒç”¨add version.jsonæ¥å£å»éƒ¨ç½²åˆ°scrapydï¼Œæ“ä½œç®€å•ã€‚ å®‰è£…1pip install scrapyd-client å®‰è£…æˆåŠŸä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨å…¶æä¾›çš„scrapyd-deployå·¥å…·æ¥éƒ¨ç½²äº†ã€‚ ä½¿ç”¨1ï¼‰å¯åŠ¨scrapyd 1scrapyd 2ï¼‰ä¿®æ”¹scrapy.cfgæ–‡ä»¶ è¿™é‡Œéœ€è¦ä¿®æ”¹scrapyé¡¹ç›®ä¸‹çš„scrapy.cfgæ–‡ä»¶ï¼ŒåŸæ–‡ä»¶å¦‚ä¸‹ï¼š 123456[settings]default = unfancy.settings[deploy]# url = http://localhost:6800/project = unfancy å¦‚æœåªæ˜¯åœ¨æœ¬åœ°è¿è¡Œï¼Œå°±ç›´æ¥å–æ¶ˆæ³¨é‡Šï¼Œå¦‚æœæ˜¯è¦éƒ¨ç½²åˆ°å…¶ä»–æœåŠ¡å™¨ï¼Œå°±å°†localhostä¿®æ”¹ä¸ºå¯¹åº”çš„ipï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š 123456[deploy]url = http://193.112.107.55:6800/project = unfancy# è¿™é‡Œçš„è´¦å·å¯†ç æ˜¯ç”¨æ¥ç™»å½•æœåŠ¡å™¨çš„ï¼Œå¦‚æœä¸éœ€è¦è´¦å·å¯†ç ï¼Œå°±ä¸ç”¨æ·»åŠ username = scrapypassword = secret å…³äºç™»å½•æœåŠ¡å™¨è¿™ä¸€å—ï¼Œå¯ä»¥ä½¿ç”¨nginxåå‘ä»£ç†æ¥å®ç°ç”¨æˆ·ç™»å½•ã€‚ 3ï¼‰éƒ¨ç½² ç°åœ¨å°±å¯ä»¥åœ¨scrapy.cfgæ‰€åœ¨çš„è·¯å¾„ä¸‹ç›´æ¥æ‰§è¡Œå‘½ä»¤å®Œæˆéƒ¨ç½² 1scrapyd-deploy 4ï¼‰å¯åŠ¨ ä½¿ç”¨scrapyd apiå¯åŠ¨ä»»åŠ¡ï¼Œå…¶ä»–çš„APIè¯·çœ‹å¦ä¸€ç¯‡æ–‡ç« ï¼šscrapydçš„å®‰è£…ä½¿ç”¨ 1234curl http://localhost:6800/schedule.json -d project=unfancy -d spider=fancy # spiderå°±æ˜¯scrapyçˆ¬è™«ä¸­çš„name# è¿”å›ä¿¡æ¯&#123;"jobid": "cd68179acd2911e8914cf45c89a40603", "status": "ok", "node_name": "Pro"&#125; éƒ¨ç½²æˆåŠŸä¹‹åé¡¹ç›®ä¸­å¤šäº†ä¸€äº›æ–‡ä»¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœé¡¹ç›®æœ¬æ¥å°±æœ‰setup.pyæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¼šè¢«ä½¿ç”¨ï¼Œæ²¡æœ‰åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªã€‚ 5ï¼‰æŸ¥çœ‹ æ‰“å¼€æµè§ˆå™¨æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ è¯¦è§£å®Œæ•´çš„éƒ¨ç½²å‘½ä»¤å¦‚ä¸‹ï¼š 1scrapyd-deploy &lt;target&gt; -p &lt;project&gt; --version &lt;version&gt; targetï¼šæœåŠ¡å™¨çš„åå­—ï¼Œåœ¨deployåé¢ï¼Œä¸å†™åˆ™æ˜¯defaultï¼Œéƒ¨ç½²æ—¶å¯ä»¥çœç•¥ï¼Œçœ‹ä¸Šé¢ä¾‹å­ğŸ‘†ã€‚å¦‚æœå†™äº†ï¼Œåœ¨éƒ¨ç½²çš„æ—¶å€™ä¸€å®šè¦åŠ ä¸Šï¼Œå¦åˆ™ä¼šæŠ¥Unknown target: defaulté”™è¯¯ï¼Œçœ‹ä¸‹é¢ä¾‹å­ğŸ‘‡ projectï¼šé¡¹ç›®åç§°ï¼Œä¸€èˆ¬åˆ›å»ºscrapyé¡¹ç›®æ—¶å°±å·²ç»ç»™å®šäº†ï¼Œéƒ¨ç½²æ—¶å¯ä»¥ä¸ç”¨å¸¦ä¸Š versionï¼šè‡ªå®šä¹‰ï¼Œä¸å†™é»˜è®¤æ˜¯å½“å‰æ—¶é—´æˆ³ å¦‚æœæœ‰å¤šå°æœåŠ¡å™¨ï¼Œéœ€è¦æŒ‡å®štargetï¼ŒåŒæ—¶ä¿®æ”¹urlã€‚ 1234567891011[deploy:target1]url = http://193.112.107.55:6800/project = unfancyusername = scrapypassword = secret[deploy:target2]url = http://193.112.107.54:6800/project = unfancyusername = scrapypassword = secret æŸ¥çœ‹å¯ç”¨çš„target 1scrapyd-deploy -l æŸ¥çœ‹æŸä¸ªç‰¹å®šçš„target 1scrapyd-deploy -L target1 åªéƒ¨ç½²å…¶ä»–çš„ä¸€å°æœåŠ¡å™¨ï¼Œè¿›å…¥é¡¹ç›®æ ¹ç›®å½• 1scrapyd-deploy target1 å¦‚æœè¦ä¸€æ¬¡æ€§éƒ¨ç½²é¡¹ç›®åˆ°å¤šå°æœåŠ¡å™¨ï¼ŒåŒæ ·è¿›å…¥é¡¹ç›®æ ¹ç›®å½• 1scrapyd-deploy -a -p &lt;project&gt; å‚è€ƒæ–‡ç« scrapyd-client]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>scrapyd-client</tag>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>éƒ¨ç½²</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[scrapydçš„å®‰è£…ä½¿ç”¨]]></title>
    <url>%2Famberwest.github.io%2F2018%2F10%2F11%2Fscrapyd%E7%9A%84%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[scrapydå¯ä»¥ç®¡ç†å¤šä¸ªé¡¹ç›®ï¼Œæ¯ä¸ªé¡¹ç›®å¯ä»¥ä¸Šä¼ å¤šä¸ªç‰ˆæœ¬ï¼Œä½†æ˜¯åªæœ‰æœ€æ–°çš„ç‰ˆæœ¬ä¼šè¢«ä½¿ç”¨ã€‚æ‰€ä»¥ï¼Œç”¨scrapyå®Œæˆçˆ¬è™«ä»»åŠ¡ä¹‹åï¼Œå¯ä»¥ç”¨scapydæ¥éƒ¨ç½²ç®¡ç†ã€‚ å®‰è£…1pip install scrapyd é…ç½®æ–‡ä»¶unixç³»ç»Ÿé»˜è®¤æ˜¯åœ¨/etc/scrapyd/scrapyd.confï¼Œåº”è¯¥æ˜¯ç‰ˆæœ¬ä¸åŒå§ï¼Œå®‰è£…åå¹¶æ²¡æœ‰çœ‹åˆ°ï¼Œéœ€è¦è‡ªå·±é…ç½®ï¼Œå…·ä½“å‚çœ‹å®˜æ–¹æ–‡æ¡£ 12mkdir /etc/scrapydvim /etc/scrapyd/scrapyd.conf åœ¨é…ç½®æ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹å†…å®¹ï¼ˆå®˜æ–¹ï¼‰ 1234567891011121314151617181920212223242526272829[scrapyd]eggs_dir = eggslogs_dir = logsitems_dir =jobs_to_keep = 5dbs_dir = dbsmax_proc = 0max_proc_per_cpu = 4finished_to_keep = 100poll_interval = 5.0bind_address = 127.0.0.1 # è¿™é‡Œå¯ä»¥ä¿®æ”¹ä¸º0.0.0.0http_port = 6800debug = offrunner = scrapyd.runnerapplication = scrapyd.app.applicationlauncher = scrapyd.launcher.Launcherwebroot = scrapyd.website.Root[services]schedule.json = scrapyd.webservice.Schedulecancel.json = scrapyd.webservice.Canceladdversion.json = scrapyd.webservice.AddVersionlistprojects.json = scrapyd.webservice.ListProjectslistversions.json = scrapyd.webservice.ListVersionslistspiders.json = scrapyd.webservice.ListSpidersdelproject.json = scrapyd.webservice.DeleteProjectdelversion.json = scrapyd.webservice.DeleteVersionlistjobs.json = scrapyd.webservice.ListJobsdaemonstatus.json = scrapyd.webservice.DaemonStatus å¯åŠ¨1scrapyd è¿è¡Œä¹‹åï¼Œåœ¨æµè§ˆå™¨æ‰“å¼€http://localhost:6800ï¼Œå°±å¯ä»¥çœ‹åˆ°ä»¥ä¸‹é¡µé¢ï¼š API1ï¼‰daemonstatus.json æŸ¥çœ‹scrapydå½“å‰çŠ¶æ€ 1curl http://localhost:6800/daemonstatus.json ç¤ºä¾‹ç»“æœ 1&#123; &quot;status&quot;: &quot;ok&quot;, &quot;running&quot;: &quot;0&quot;, &quot;pending&quot;: &quot;0&quot;, &quot;finished&quot;: &quot;0&quot;, &quot;node_name&quot;: &quot;node-name&quot; &#125; 2ï¼‰addversion.json ç»™é¡¹ç›®æ·»åŠ ä¸€ä¸ªç‰ˆæœ¬ï¼Œé¡¹ç›®ä¸å­˜åœ¨åˆ™ä¼šåˆ›å»ºã€‚è¿™ä¸ªæ˜¯ç”¨æ¥éƒ¨ç½²é¡¹ç›®çš„ï¼Œå‰ææ˜¯è¦å…ˆåˆ›å»ºeggæ–‡ä»¶ã€‚ä¸‰ä¸ªå‚æ•°éƒ½æ˜¯å¿…é¡»çš„ 1curl http://localhost:6800/addversion.json -F project=project_name -F version=v1 -F egg=project.egg ç¤ºä¾‹ç»“æœ 1&#123;&quot;status&quot;: &quot;ok&quot;, &quot;spiders&quot;: 3&#125; 3ï¼‰schedule.json è°ƒåº¦å·²ç»éƒ¨ç½²å¥½çš„spiderè¿è¡Œï¼Œè¿”å›job idã€‚ å‚æ•°è¯´æ˜ projectï¼šå¿…é¡»ï¼Œé¡¹ç›®å spiderï¼šå¿…é¡»ï¼Œspider name settingï¼šé€‰å¡«ï¼Œè®¾ç½®scrapyé¡¹ç›® jobidï¼šé€‰å¡«ï¼Œç”¨æ¥éªŒè¯jobï¼Œä¼šè¦†ç›–é»˜è®¤ç”Ÿæˆçš„UUID _versionï¼šé€‰å¡«ï¼Œé€‰æ‹©è¿è¡Œçš„é¡¹ç›®ç‰ˆæœ¬ å…¶ä»–çš„å‚æ•°éƒ½ä¼šä½œä¸ºspiderå‚æ•° 1curl http://localhost:6800/schedule.json -d project=project_name -d spider=spider_name -d setting=DOWNLOAD_DELAY=2 -d arg1=val1 ç¤ºä¾‹ç»“æœï¼Œstatusæ˜¯é¡¹ç›®è¿è¡Œç»“æœï¼Œå¦‚æœå‡ºé”™çš„è¯ä¼šæ˜¯errorï¼Œè¿˜æœ‰message 1&#123;"status": "ok", "jobid": "6487ec79947edab326d6db28a2d86511e8247444"&#125; 4ï¼‰cancel.json å¦‚æœjobæ˜¯æ­£åœ¨è¿è¡Œçš„ï¼Œä¼šè¢«åœæ­¢ï¼Œå¦‚æœæ˜¯pendingçŠ¶æ€ï¼Œåˆ™ä¼šè¢«ç§»é™¤ã€‚ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å¿…é¡»çš„ 1curl http://localhost:6800/cancel.json -d project=project_name -d job=6487ec79947edab326d6db28a2d86511e8247444 ç¤ºä¾‹ç»“æœ 1&#123;"status": "ok", "prevstate": "running"&#125; 5ï¼‰listprojects.json åˆ—å‡ºscrapy serverçš„æ‰€æœ‰é¡¹ç›® 1curl http://localhost:6800/listprojects.json ç¤ºä¾‹ç»“æœ 1&#123;"status": "ok", "projects": ["myproject", "otherproject"]&#125; 6ï¼‰listversions.json è·å–æŸä¸ªé¡¹ç›®çš„æ‰€æœ‰å¯ç”¨ç‰ˆæœ¬ï¼Œç‰ˆæœ¬å·æŒ‰é¡ºåºè¿”å›ï¼Œæœ€åä¸€ä¸ªæ˜¯æœ€è¿‘ä½¿ç”¨çš„ç‰ˆæœ¬ 1curl http://localhost:6800/listversions.json?project=project_name ç¤ºä¾‹ç»“æœ 1&#123;"status": "ok", "versions": ["r99", "r156"]&#125; 7ï¼‰ listspiders.json è¿”å›é¡¹ç›®ä¸­æ‰€æœ‰å¯ç”¨çš„spider 1curl http://localhost:6800/listspiders.json?project=project_name ç¤ºä¾‹ç»“æœ 1&#123;"status": "ok", "spiders": ["spider1", "spider2", "spider3"]&#125; 8ï¼‰listjobs.json è¿”å›é¡¹ç›®ä¸­æ‰€æœ‰çŠ¶æ€çš„ä»»åŠ¡ï¼Œpendingã€runningã€finished 1curl http://localhost:6800/listjobs.json?project=project_name | python -m json.tool ç¤ºä¾‹ç»“æœ 123456789101112131415161718192021222324&#123; "status": "ok", "pending": [ &#123; "project": "myproject", "spider": "spider1", "id": "78391cc0fcaf11e1b0090800272a6d06" &#125; ], "running": [ &#123; "id": "422e608f9f28cef127b3d5ef93fe9399", "project": "myproject", "spider": "spider2", "start_time": "2012-09-12 10:14:03.594664" &#125; ], "finished": [ &#123; "id": "2f16646cfcaf11e1b0090800272a6d06", "project": "myproject", "spider": "spider3", "start_time": "2012-09-12 10:14:03.594664", "end_time": "2012-09-12 10:24:03.594664" &#125; ]&#125; 8) delversion.json åˆ é™¤é¡¹ç›®çš„æŸä¸ªç‰ˆæœ¬ï¼Œå¦‚æœç»™å®šé¡¹ç›®æ²¡æœ‰å…¶ä»–ç‰ˆæœ¬ï¼Œé‚£ä¹ˆæ•´ä¸ªé¡¹ç›®éƒ½ä¼šè¢«ç§»é™¤ 1curl http://localhost:6800/delversion.json -d project=project_name -d version=v1 ç¤ºä¾‹ç»“æœ 1&#123;"status": "ok"&#125; 9) delproject.json åˆ é™¤é¡¹ç›®ä»¥åŠé¡¹ç›®çš„æ‰€æœ‰ç‰ˆæœ¬ 1curl http://localhost:6800/delproject.json -d project=project_name ç¤ºä¾‹ç»“æœ 1&#123;"status": "ok"&#125; å…³äºéƒ¨ç½²éœ€è¦çš„eggæ–‡ä»¶ï¼Œå¯ä»¥ç”¨setuptoolsæ¨¡å—ï¼Œä¸è¿‡æœ‰ç‚¹éº»çƒ¦å‘€ï½æ‰€ä»¥å°±ç›´æ¥ä½¿ç”¨Scrapyd-Clientè¿™ä¸ªç°æˆçš„å·¥å…·æ¥éƒ¨ç½²ã€‚å…·ä½“å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼šscrapyd-clientçš„å®‰è£…ä½¿ç”¨ å‚è€ƒæ–‡ç« Scrapyd API scrapydå’Œscrapyd-clientä½¿ç”¨æ•™ç¨‹]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>scrapyd</tag>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>éƒ¨ç½²</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å•é“¾è¡¨åè½¬çš„pythonå®ç°]]></title>
    <url>%2Famberwest.github.io%2F2018%2F10%2F10%2F%E5%8D%95%E9%93%BE%E8%A1%A8%E5%8F%8D%E8%BD%AC%2F</url>
    <content type="text"><![CDATA[å‚è€ƒäº†çœ‹å›¾ç†è§£å•é“¾è¡¨çš„åè½¬ä¸€æ–‡ï¼Œæ¥¼ä¸»æ€è·¯æ¸…æ™°ï¼Œå›¾ç‰‡å½¢è±¡ç”ŸåŠ¨ï¼Œè®²å¾—é€šä¿—æ˜“æ‡‚ã€‚å½“ç„¶ï¼Œåƒæˆ‘è¿™æ ·ç¬¨çš„äººè¿˜æ˜¯çœ‹äº†å‡ éï¼Œè€Œä¸”ä¸€å¼€å§‹è¿˜çŠ¯äº†ä¸ªå¸¸è¯†æ€§é”™è¯¯ï¼šå¿˜äº†p.nextæ˜¯åŒ…æ‹¬ä¹‹åçš„æ‰€æœ‰æ•°æ®ï¼Œå“ï½çœ‹ä¸æ‡‚çš„æ—¶å€™å¯ä»¥å°è¯•æŠŠæ¯ä¸€è¡Œä»£ç è¿è¡Œä¹‹åçš„ç»“æœç»™ç”»å‡ºæ¥ï¼Œæ–¹ä¾¿ç†è§£ã€‚ 1234567891011121314151617181920class ListNode: """å®ç°é“¾è¡¨""" def __init__(self, x): self.val = x self.next = None # é€ä¸ªåè½¬ï¼šä½¿ç”¨3ä¸ªæŒ‡é’ˆéå†å•é“¾è¡¨ï¼Œé€ä¸ªç‚¹è¿›è¡Œåè½¬ã€‚def reverse_list(head): if head == None or head.next == None: #å°‘äºä¸¤ä¸ªç»“ç‚¹æ²¡æœ‰åè½¬çš„å¿…è¦ return head p = head q = head.next head.next = None # æ—§çš„å¤´æŒ‡é’ˆæ˜¯æ–°çš„å°¾æŒ‡é’ˆï¼Œnextéœ€è¦æŒ‡å‘None while q: r = q.next # å…ˆä¿ç•™ä¸‹ä¸€ä¸ªstepè¦å¤„ç†çš„æŒ‡é’ˆ q.next = p # ç„¶åp qäº¤æ›¿å·¥ä½œè¿›è¡Œåå‘ p = q q = r head = p # æœ€åqå¿…ç„¶æŒ‡å‘Noneï¼Œæ‰€ä»¥è¿”å›äº†pä½œä¸ºæ–°çš„å¤´æŒ‡é’ˆ return head 123456789101112131415# å°¾æ’åè½¬ï¼šä»ç¬¬2ä¸ªç»“ç‚¹åˆ°ç¬¬Nä¸ªç»“ç‚¹ï¼Œä¾æ¬¡é€ç»“ç‚¹æ’å…¥åˆ°ç¬¬1ä¸ªç»“ç‚¹(headç»“ç‚¹)ä¹‹åï¼Œæœ€åå°†ç¬¬ä¸€ä¸ªç»“ç‚¹æŒªåˆ°æ–°è¡¨çš„è¡¨å°¾ã€‚def reverse_list2(head): if head == None or head.next == None: #å°‘äºä¸¤ä¸ªç»“ç‚¹æ²¡æœ‰åè½¬çš„å¿…è¦ return head p = head.next # ç¬¬äºŒä¸ªä¸éœ€è¦å‚ä¸å¾ªç¯ while p.next != None: q = p.next # ç¬¬ä¸€æ¬¡å¾ªç¯ï¼Œhead-&gt;p-&gt;q-&gt;Â·Â·Â· p.next = q.next # ç¬¬ä¸€æ¬¡å¾ªç¯ï¼Œpå’Œqä¹‹é—´çš„é“¾æ¥æ–­å¼€ q.next =head.next # è¿™ä¸ªä¸å…ˆæ‰§è¡Œä¼šå¯¼è‡´æŒ‡é’ˆä¸¢å¤±ï¼Œå†…å­˜æ³„éœ²ã€‚è¿™é‡Œå®ç°äº†ç¬¬äºŒç¬¬ä¸‰ä¸ªåè½¬ head.next = q # å°†headæŒ‡é’ˆæŒ‡å‘q head-&gt;q-&gt;p-&gt;Â·Â·Â· p.next = head # åˆ°æœ€åï¼Œp.nextå·²ç»ä¸ºNoneï¼Œè¿™æ—¶å€™æŒ‡å‘headï¼Œå½¢æˆç¯ head = p.next.next # æ–°çš„headå˜æˆåŸheadçš„next p.next.next = None # æ–­å¼€ç¯ return head 123456789# é€’å½’ï¼šå®ç°åè½¬ def reverse_list3(head): if head.next == None: # åªæœ‰ä¸€ä¸ªçš„æ—¶å€™ï¼Œä¸éœ€è¦åè½¬ return head new_head = func3(head.next) # è¿”å›å·²ç»åè½¬ä¹‹åçš„ç»“æœ head.next.next = head # å½¢æˆç¯ head.next = None # æ–­å¼€ç¯ï¼Œå®Œæˆåè½¬ return new_head # è¿”å›å·²ç»åè½¬ä¹‹åçš„ç»“æœ]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>é“¾è¡¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[centos7å®‰è£…scrapydå‡ºé”™]]></title>
    <url>%2Famberwest.github.io%2F2018%2F10%2F09%2Fcentos7%E5%AE%89%E8%A3%85scrapyd%E5%87%BA%E9%94%99%2F</url>
    <content type="text"><![CDATA[åœ¨centos7ä¸‹å®‰è£…scrapydå‡ºç°ç¼–è¯‘ä¸­æ–­çš„é”™è¯¯ åœ¨ç½‘ä¸Šæ‰¾äº†ä¸€åœˆï¼ŒåŸºæœ¬éƒ½æ˜¯è¯´ç¼ºä¹pythonä¾èµ–åŒ…ï¼Œåªéœ€è¦æ‰§è¡Œyum install python-devå°±å¯ä»¥ã€‚ç»“æœå‘¢ï¼Œæˆ‘ä»python-devä¸€è·¯è¯•åˆ°äº†python3.6.1-devï¼ŒæŠŠç³»ç»Ÿé‡Œå­˜åœ¨çš„ç‰ˆæœ¬éƒ½è¯•äº†ä¸ªéï¼Œè¿˜æ˜¯ä¸è¡Œã€‚åœ¨ä¸´è¦æ”¾å¼ƒçš„æ—¶å€™æ‰¾åˆ°äº†æ­£ç¡®çš„è§£å†³æ–¹æ³•ï¼Œè¯·æˆ³æ–‡ç«  é¦–å…ˆï¼Œç¡®å®æ˜¯ä¾èµ–åŒ…çš„é—®é¢˜ï¼Œä½†æ˜¯è¦æ‰¾åˆ°å¯¹åº”çš„ç‰ˆæœ¬ 1yum search python | grep -i devel æ‰¾åˆ°ç‰ˆæœ¬ä¹‹åå°±å¯ä»¥ç›´æ¥å®‰è£…äº† 1sudo yum install python36-devel.x86_64 æœ€åä¸€æ­¥ 1pip install scrapyd --user çœ‹åˆ°è¿™ä¸ªè¾“å‡ºï¼ŒçœŸçš„æ˜¯æ¿€åŠ¨åˆ°è€æ³ªçºµæ¨ªå•Šï½ï½]]></content>
      <tags>
        <tag>centos7</tag>
        <tag>å®‰è£…</tag>
        <tag>scrapyd</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€æ•°æ®ç»“æ„ä¸ç®—æ³•ç¬”è®°å››ã€‘æ ˆ]]></title>
    <url>%2Famberwest.github.io%2F2018%2F10%2F08%2F%E6%A0%88%2F</url>
    <content type="text"><![CDATA[æ ˆä»€ä¹ˆæ˜¯æ ˆæ ˆæ˜¯ä¸€ç§å…ˆè¿›åå‡ºï¼Œåè¿›å…ˆå‡ºçš„ï¼Œâ€œæ“ä½œå—é™â€çš„çº¿æ€§è¡¨ã€‚æ ˆåªå…è®¸åœ¨ä¸€ç«¯æ’å…¥å’Œåˆ é™¤æ•°æ®ï¼Œä¸èƒ½ä»ä¸­é—´ä»»æ„æŠ½å‡ºã€‚ ä¸ºä»€ä¹ˆé€‰æ‹©æ ˆä»åŠŸèƒ½ä¸Šæ¥è¯´ï¼Œæ•°ç»„æˆ–è€…é“¾è¡¨ç¡®å®å¯ä»¥ä»£æ›¿æ ˆï¼Œä½†æ˜¯æ•°ç»„æˆ–é“¾è¡¨æš´éœ²äº†å¤ªå¤šçš„æ“ä½œå€Ÿå£ï¼Œæ“ä½œä¸Šçš„ç¼ºçµæ´»è‡ªç”±ï¼Œä½†ä½¿ç”¨æ—¶å°±æ¯”è¾ƒä¸å¯æ§ï¼Œå®¹æ˜“å‡ºé”™ã€‚æ‰€ä»¥åœ¨æŸäº›ç‰¹å®šåœºæ™¯ï¼Œæ¯”å¦‚å½“æŸä¸ªæ•°æ®é›†åˆæ ˆçš„ç‰¹æ€§ï¼Œå°±åº”è¯¥é€‰æ‹©æ ˆè¿™ç§æ•°æ®ã€‚ å¦‚ä½•å®ç°ä¸€ä¸ªâ€œæ ˆâ€1ï¼‰é¡ºåºæ ˆï¼šç”¨æ•°ç»„å®ç°çš„æ ˆ 2ï¼‰é“¾å¼æ ˆï¼šç”¨é“¾è¡¨å®ç°çš„æ ˆ ä¸ç®¡æ˜¯é¡ºåºæ ˆè¿˜æ˜¯é“¾å¼æ ˆï¼Œæˆ‘ä»¬å­˜å‚¨æ•°æ®åªéœ€è¦ä¸€ä¸ªå¤§å°ä¸ºnçš„æ•°ç»„å³å¯ã€‚ä½†æ˜¯ä¸ä»£è¡¨ç€ç©ºé—´å¤æ‚åº¦å°±æ˜¯O(n)ï¼Œå› ä¸ºç©ºé—´å¤æ‚åº¦æ˜¯æŒ‡é™¤äº†åŸæœ¬çš„æ•°æ®å­˜å‚¨ç©ºé—´å¤–ï¼Œç®—æ³•è¿è¡Œè¿˜éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ã€‚ ç”¨Javaå®ç°çš„æ ˆï¼Œä»£ç æ¥è‡ªã€Šæ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ã€‹ï¼š 123456789101112131415161718192021222324252627282930313233// åŸºäºæ•°ç»„å®ç°çš„é¡ºåºæ ˆpublic class ArrayStack &#123; private String[] items; // æ•°ç»„ private int count; // æ ˆä¸­å…ƒç´ ä¸ªæ•° private int n; // æ ˆçš„å¤§å° // åˆå§‹åŒ–æ•°ç»„ï¼Œç”³è¯·ä¸€ä¸ªå¤§å°ä¸º n çš„æ•°ç»„ç©ºé—´ public ArrayStack(int n) &#123; this.items = new String[n]; this.n = n; this.count = 0; &#125; // å…¥æ ˆæ“ä½œ public boolean push(String item) &#123; // æ•°ç»„ç©ºé—´ä¸å¤Ÿäº†ï¼Œç›´æ¥è¿”å› falseï¼Œå…¥æ ˆå¤±è´¥ã€‚ if (count == n) return false; // å°† item æ”¾åˆ°ä¸‹æ ‡ä¸º count çš„ä½ç½®ï¼Œå¹¶ä¸” count åŠ ä¸€ items[count] = item; ++count; return true; &#125; // å‡ºæ ˆæ“ä½œ public String pop() &#123; // æ ˆä¸ºç©ºï¼Œåˆ™ç›´æ¥è¿”å› null if (count == 0) return null; // è¿”å›ä¸‹æ ‡ä¸º count-1 çš„æ•°ç»„å…ƒç´ ï¼Œå¹¶ä¸”æ ˆä¸­å…ƒç´ ä¸ªæ•° count å‡ä¸€ String tmp = items[count-1]; --count; return tmp; &#125;&#125; æ”¯æŒåŠ¨æ€æ‰©å®¹çš„é¡ºåºæ ˆå½“æ•°ç»„å†…å­˜ä¸å¤Ÿæ—¶ï¼Œé€šè¿‡é‡ç”³ä¸€ä¸ªæ›´å¤§çš„æ•°ç»„ï¼Œå†å°†åŸæœ¬çš„æ•°æ®å¤åˆ¶è¿‡å»ï¼Œé¡ºåºæ ˆä¹Ÿä¸€æ ·ã€‚ä¸è¿‡åƒè¿™ç§æ”¯æŒåŠ¨æ€æ‰©å®¹çš„é¡ºåºæ ˆåœ¨å®é™…å¼€å‘ä¸­å¹¶ä¸å¸¸è§ã€‚ æ‰€ä»¥ï¼Œå¯¹äºå…¥æ ˆæ“ä½œæ¥è¯´ï¼Œæœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼Œæœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦æ˜¯O(n).å½“å†…å­˜æ»¡äº†ä¹‹åï¼ˆå‡è®¾æ ˆå¤§å°ä¸ºkï¼‰ï¼Œéœ€è¦ç”³è¯·æ›´å¤§çš„å†…å­˜ï¼Œå¹¶ä¸”åškä¸ªæ•°æ®çš„æ¬ç§»æ“ä½œï¼Œç„¶ååœ¨å…¥æ ˆã€‚å› ä¸ºåœ¨å…¥æ ˆæ—¶å¹¶ä¸éœ€è¦å†ç”³è¯·å†…å­˜å’Œæ¬ç§»æ•°æ®ï¼Œæ‰€ä»¥æ ¹æ®å‡æ‘Šè¿˜æ³•å¯ä»¥å¾—åˆ°å¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯O(1)ã€‚ æ ˆçš„åº”ç”¨åœ¨å‡½æ•°è°ƒç”¨ä¸­çš„åº”ç”¨12345678910def main(): a = 1 ret = 2 res = 0 ret = add(3, 5) print(ret) return 0def add(a, b): return a+b åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå…ˆæ˜¯å‹å…¥mainå‡½æ•°ä¸­çš„å˜é‡ï¼Œå†å‹å…¥addå‡½æ•°çš„å˜é‡ã€‚è°ƒç”¨addå‡½æ•°æ—¶ï¼Œä¹Ÿå°±æ˜¯å‡ºæ ˆï¼Œæœ€åæ‰æ˜¯mainå‡½æ•°çš„æ‰§è¡Œç»“æœã€‚æ•´ä¸ªè°ƒç”¨çš„è¿‡ç¨‹å®Œå…¨ç¬¦åˆæ ˆå…ˆè¿›åå‡ºçš„ç‰¹æ€§ã€‚ åœ¨è¡¨è¾¾å¼æ±‚å€¼ä¸­çš„åº”ç”¨ä½¿ç”¨ä¸¤ä¸ªæ ˆæ±‚è§£å¼å­3+5*8-6ï¼Œä¸€ä¸ªç”¨æ¥ä¿å­˜æ“ä½œæ•°ï¼Œä¸€ä¸ªç”¨æ¥ä¿å­˜è¿ç®—ç¬¦ã€‚å…·ä½“è¿‡ç¨‹ï¼šä»å·¦å‘å³éå†è¡¨è¾¾å¼ï¼Œé‡åˆ°æ•°å­—å°±å‹å…¥æ“ä½œæ•°æ ˆï¼›å½“é‡åˆ°è¿ç®—ç¬¦ï¼Œå°±ä¸è¿ç®—ç¬¦æ ˆçš„æ ˆé¡¶å…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœæ¯”è¿ç®—ç¬¦æ ˆé¡¶å…ƒç´ çš„ä¼˜å…ˆçº§é«˜ï¼Œå°±å°†å½“å‰è¿ç®—ç¬¦å‹å…¥æ ˆï¼›å¦‚æœæ¯”è¿ç®—ç¬¦æ ˆé¡¶å…ƒç´ çš„ä¼˜å…ˆçº§ä½æˆ–è€…ç›¸åŒï¼Œå°±ä»è¿ç®—ç¬¦æ ˆä¸­å–å‡ºæ ˆé¡¶è¿ç®—ç¬¦ï¼Œä»æ“ä½œæ•°æ ˆçš„æ ˆé¡¶å–å‡º2ä¸ªæ“ä½œæ•°ï¼Œè®¡ç®—ä¹‹åå°†ç»“æœå‹å…¥æ“ä½œæ•°æ ˆï¼Œç»§ç»­æ¯”è¾ƒã€‚ åœ¨æ‹¬å·åŒ¹é…ä¸­çš„åº”ç”¨å‡è®¾è¡¨è¾¾å¼ä¸­åªæœ‰ä¸‰ç§æ‹¬å·()[]{}ï¼Œå¹¶ä¸”å¯ä»¥ä»»æ„åµŒå¥—ã€‚é‚£ä¹ˆåœ¨ç»™å®šçš„åŒ…å«è¿™ä¸‰ç§æ‹¬å·çš„å­—ç¬¦ä¸²ä¸­ï¼Œå¦‚ä½•æ£€æµ‹å®ƒæ˜¯å¦åˆæ³•ã€‚æ³¨ï¼š{[]}()æ˜¯åˆæ³•çš„ï¼Œ{[}()]åˆ™æ˜¯ä¸åˆæ³•çš„ã€‚ å…·ä½“è¿‡ç¨‹ï¼šä»å·¦åˆ°å³éå†å­—ç¬¦ä¸²ï¼Œå¦‚æœæ˜¯å·¦è¾¹æ‹¬å·å°±å°†å…¶å‹å…¥æ ˆä¸­ï¼Œå¦‚æœæ˜¯å³æ‹¬å·å°±ä»æ ˆé¡¶å–å‡ºä¸€ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœèƒ½å¤Ÿé…å¯¹ï¼Œåˆ™ç»§ç»­æ¯”è¾ƒå‰©ä¸‹çš„å­—ç¬¦ä¸²ã€‚å¦‚æœè¿‡ç¨‹ä¸­é‡åˆ°ä¸èƒ½é…å¯¹çš„å³æ‹¬å·æˆ–è€…æ ˆä¸­æ²¡æœ‰æ•°æ®ï¼Œåˆ™æ˜¯éæ³•æ ¼å¼ã€‚æ•´ä¸ªå­—ç¬¦ä¸²éƒ½æ¯”è¾ƒç»“æŸä¹‹åï¼Œæ ˆä¸ºç©ºåˆ™æ˜¯åˆæ³•æ ¼å¼ï¼Œå¦åˆ™ä¸ºéæ³•æ ¼å¼ã€‚ å®ç°æµè§ˆå™¨é¡µé¢çš„å‰è¿›åé€€åŒæ ·ä½¿ç”¨ä¸¤ä¸ªæ ˆaå’Œbï¼Œé¦–æ¬¡æµè§ˆçš„é¡µé¢ä¾æ¬¡å‹å…¥aï¼Œç‚¹å‡»åé€€æŒ‰é’®æ—¶ï¼Œå°±ä»æ ˆaä¸­å‡ºæ ˆï¼Œå¹¶ä¾æ¬¡æ”¾å…¥æ ˆbã€‚å½“ç‚¹å‡»å‰è¿›æŒ‰é’®æ—¶ï¼Œåˆ™æ˜¯ç›¸åçš„æ“ä½œã€‚ä»æ ˆbä¸­å‡ºæ ˆï¼Œå†æ”¾å…¥æ ˆaã€‚å½“æ ˆä¸ºç©ºæ—¶ï¼Œå°±ä¸èƒ½å†å‰è¿›æˆ–è€…åé€€äº†ã€‚ å¦‚æœåœ¨æµè§ˆçš„è¿‡ç¨‹ä¸­ï¼Œè·³è½¬åˆ°æ–°çš„é¡µé¢ï¼Œè¿™æ—¶å€™å°±æ²¡åŠæ³•å†é€šè¿‡å‰è¿›/åé€€é‡å¤æŸ¥çœ‹äº†ï¼Œæ‰€ä»¥éœ€è¦æ¸…ç©ºå¦ä¸€ä¸ªæ ˆçš„æ•°æ®ã€‚ å‚è€ƒæ–‡ç« æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>æ ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€æ•°æ®ç»“æ„ä¸ç®—æ³•ç¬”è®°ä¸‰ã€‘é“¾è¡¨]]></title>
    <url>%2Famberwest.github.io%2F2018%2F10%2F06%2F%E9%93%BE%E8%A1%A8%2F</url>
    <content type="text"><![CDATA[é“¾è¡¨ä»€ä¹ˆæ˜¯é“¾è¡¨ é“¾è¡¨è·Ÿæ•°ç»„ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ç§çº¿æ€§è¡¨æ•°æ®ç»“æ„ ä¸éœ€è¦è¿ç»­çš„å†…å­˜å—ï¼Œå¯¹å†…å­˜è¦æ±‚å°ï¼Œä¸æ•°ç»„ç›¸å é€šè¿‡æŒ‡é’ˆæŠŠä¸€ç»„é›¶æ•£çš„å†…å­˜å—ä¸²è”åœ¨ä¸€èµ· å†…å­˜å—æ˜¯é“¾è¡¨çš„ç»“ç‚¹ï¼Œä¿å­˜ä¸‹ä¸€ä¸ªç»“ç‚¹çš„åœ°å€çš„æŒ‡é’ˆå«åšåç»§æŒ‡é’ˆnext é“¾è¡¨ç‰¹ç‚¹ æ’å…¥ã€åˆ é™¤æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œåªéœ€è¦æ”¹å˜æŒ‡é’ˆåœ°å€å³å¯(ä¸åŒ…æ‹¬éå†ï¼Œå…·ä½“çœ‹åé¢åˆ†æ) éšæœºè®¿é—®æ•ˆç‡ä½ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œéœ€è¦ä»é“¾å¤´éå†åˆ°é“¾å°¾ ç›¸å¯¹äºæ•°ç»„ï¼Œå› ä¸ºè¦ä¿å­˜æ¯ä¸ªæ•°æ®ç»“ç‚¹çš„åç»§æŒ‡é’ˆï¼Œå†…å­˜ç©ºé—´æ¶ˆè€—æ¯”è¾ƒå¤§ æœ‰å“ªäº›å¸¸è§çš„é“¾è¡¨ç»“æ„å¸¸è§çš„é“¾è¡¨ç»“æ„æœ‰ä¸‰ç§ï¼šå•é“¾è¡¨ã€åŒå‘é“¾è¡¨å’Œå¾ªç¯é“¾è¡¨ã€‚ 1ï¼‰å•é“¾è¡¨ æ¯ä¸ªç»“ç‚¹åªåŒ…å«ä¸€ä¸ªæŒ‡é’ˆï¼Œå³åç»§æŒ‡é’ˆ ç¬¬ä¸€ä¸ªç»“ç‚¹å«åšå¤´ç»“ç‚¹ï¼Œç”¨æ¥è®°å½•é“¾è¡¨çš„åŸºåœ°å€ æœ€åä¸€ä¸ªç»“ç‚¹å«åšå°¾ç»“ç‚¹ï¼ŒæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªç©ºåœ°å€NULLï¼Œè¡¨ç¤ºè¿™æ˜¯é“¾è¡¨ä¸Šæœ€åä¸€ä¸ªç»“ç‚¹ 2ï¼‰å¾ªç¯é“¾è¡¨ è·Ÿå•é“¾è¡¨ç›¸æ¯”ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±åœ¨å°¾ç»“ç‚¹ã€‚å¾ªç¯é“¾è¡¨çš„å°¾ç»“ç‚¹æŒ‡å‘é“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚é€‚åˆç”¨æ¥å¤„ç†å…·æœ‰ç¯å½¢ç»“æ„ç‰¹ç‚¹çš„æ•°æ®ï¼Œæ¯”å¦‚çº¦ç‘Ÿå¤«é—®é¢˜ã€‚ 3ï¼‰åŒå‘é“¾è¡¨ æ¯ä¸ªç»“ç‚¹éƒ½æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘åé¢ç»“ç‚¹çš„åç»§æŒ‡é’ˆnextï¼Œå¦ä¸€ä¸ªæŒ‡å‘å‰é¢ç»“ç‚¹çš„å‰é©±æŒ‡é’ˆprev éœ€è¦é¢å¤–çš„ä¸¤ä¸ªç©ºé—´æ¥ä¿å­˜ä¸¤ä¸ªç»“ç‚¹ æ”¯æŒåŒå‘éå† æ”¯æŒO(1)æ—¶é—´å¤æ‚åº¦çš„æƒ…å†µä¸‹æ‰¾åˆ°å‰é©±ç»“ç‚¹ 4ï¼‰åŒå‘å¾ªç¯é“¾æ¥ å¾ªç¯é“¾è¡¨å’ŒåŒå‘é“¾è¡¨çš„ç»“åˆï¼šé¦–ç»“ç‚¹çš„å‰é©±æŒ‡é’ˆæŒ‡å‘å°¾ç»“ç‚¹ï¼Œå°¾ç»“ç‚¹çš„åç»§æŒ‡é’ˆæŒ‡å‘é¦–ç»“ç‚¹ã€‚ é“¾è¡¨çš„åˆ é™¤æ“ä½œä»é“¾è¡¨ä¸­åˆ é™¤ä¸€ä¸ªæ•°æ®æœ‰ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š 1ï¼‰åˆ é™¤ç»“ç‚¹ä¸­â€œå€¼ç­‰äºæŸä¸ªç»™å®šå€¼â€çš„ç»“ç‚¹ åœ¨å•é“¾è¡¨å’ŒåŒå‘é“¾è¡¨ä¸­ï¼Œéƒ½éœ€è¦ä»å¤´ç»“ç‚¹ä¸€ä¸ªä¸ªä¾æ¬¡éå†å¯¹æ¯”ï¼Œç›´åˆ°æ‰¾åˆ°å€¼ç­‰äºç»™å®šå€¼çš„ç»“ç‚¹ï¼Œç„¶åé€šè¿‡æ”¹å˜æŒ‡é’ˆå°†å…¶åˆ é™¤ã€‚éå†çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œæ ¹æ®åŠ æ³•æ³•åˆ™ï¼Œè¯¥æƒ…å†µä¸‹ï¼Œæ€»çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n) 2ï¼‰åˆ é™¤ç»™å®šæŒ‡é’ˆæŒ‡å‘çš„ç»“ç‚¹ è¦åˆ é™¤æŸä¸ªç»“ç‚¹qéœ€è¦çŸ¥é“å…¶å‰é©±ç»“ç‚¹ï¼Œä½†æ˜¯å•é“¾è¡¨ä¸æ”¯æŒç›´æ¥è·å–å‰é©±ç»“ç‚¹ï¼Œæ‰€ä»¥è¿˜æ˜¯è¦ä»å¤´ç»“ç‚¹å¼€å§‹éå†ï¼Œç›´åˆ°p-&gt;next=q åŒå‘é“¾è¡¨ä¸­çš„ç»“ç‚¹å·²ç»ä¿å­˜äº†å‰é©±ç»“ç‚¹çš„æŒ‡é’ˆï¼Œä¸éœ€è¦åƒå•é“¾è¡¨é‚£æ ·éå†ï¼Œæ‰€ä»¥åˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1) åŒç†ï¼Œè¦åœ¨æŒ‡å®šç»“ç‚¹å‰é¢æ’å…¥ä¸€ä¸ªç»“ç‚¹ï¼Œå•é“¾è¡¨çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼ŒåŒå‘é“¾è¡¨çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1) é“¾è¡¨VSæ•°ç»„ æ•°ç»„ç®€å•æ˜“ç”¨ï¼Œéœ€è¦è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå€ŸåŠ©CPUçš„ç¼“å­˜æœºåˆ¶ï¼Œé¢„è¯»æ•°ç»„ä¸­çš„æ•°æ®ï¼Œè®¿é—®æ•ˆç‡é«˜ æ•°ç»„å¤§å°å±€å®šï¼Œéœ€è¦å ç”¨æ•´å—è¿ç»­å†…å­˜ç©ºé—´ã€‚å¦‚æœå£°æ˜çš„æ•°ç»„è¿‡å¤§ï¼Œç³»ç»Ÿæ²¡æœ‰è¶³å¤Ÿçš„è¿ç»­å†…å­˜ç©ºé—´åˆ†é…ç»™å®ƒï¼Œä¼šå¯¼è‡´â€œå†…å­˜ä¸è¶³â€ã€‚å£°æ˜çš„æ•°ç»„è¿‡å°ï¼Œä¸å¤Ÿç”¨æ—¶éœ€è¦å†ç”³è¯·ä¸€ä¸ªæ›´å¤§çš„å†…å­˜ç©ºé—´ï¼Œå†æ‹·è´åŸæ•°æ®è¿›å»ï¼Œéå¸¸è€—æ—¶ å¦‚æœä»£ç å¯¹å†…å­˜çš„ä½¿ç”¨éå¸¸è‹›åˆ»ï¼Œæ•°ç»„ç›¸å¯¹æ›´é€‚åˆ é“¾è¡¨åœ¨å†…å­˜ä¸­ä¸æ˜¯è¿ç»­å­˜å‚¨ï¼Œå¯¹CPUç¼“å­˜ä¸å‹å¥½ï¼Œæ²¡åŠæ³•æœ‰æ•ˆé¢„è¯» é“¾è¡¨æœ¬èº«å¤§å°æ²¡æœ‰é™åˆ¶ï¼Œæ”¯æŒåŠ¨æ€æ‰©å®¹ é“¾è¡¨ä¸­çš„æ¯ä¸ªç»“ç‚¹éœ€è¦é¢å¤–çš„å†…å­˜ç©ºé—´å­˜å‚¨æŒ‡é’ˆï¼Œå†…å­˜æ¶ˆè€—ä¼šç¿»å€ å¯¹é“¾è¡¨è¿›è¡Œé¢‘ç¹çš„æ’å…¥ã€åˆ é™¤æ“ä½œï¼Œè¿˜ä¼šå¯¼è‡´é¢‘ç¹çš„å†…å­˜ç”³è¯·å’Œé‡Šæ”¾ï¼Œå®¹æ˜“é€ æˆå†…å­˜ç¢ç‰‡ã€‚å¦‚æœæ˜¯Javaè¯­è¨€ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´é¢‘ç¹çš„GC(Carbage Collectionï¼Œ åƒåœ¾å›æ”¶) åº”ç”¨ä»€ä¹ˆæ˜¯ç¼“å­˜ç¼“å­˜æ˜¯ä¸€ç§æé«˜æ•°æ®è¯»å–æ€§èƒ½çš„æŠ€æœ¯ï¼Œåœ¨ç¡¬ä»¶è®¾è®¡ã€è½¯ä»¶å¼€å‘ä¸­éƒ½æœ‰éå¸¸å¹¿æ³›çš„ä½¿ç”¨ï¼Œæ¯”å¦‚å¸¸è§çš„æœ‰CPUç¼“å­˜ã€æ•°æ®åº“ç¼“å­˜ã€æµè§ˆå™¨ç¼“å­˜ç­‰ã€‚ä½†æ˜¯ç¼“å­˜å¤§å°æœ‰é™ï¼Œå½“ç¼“å­˜æ»¡äº†ä¹‹åï¼Œåº”è¯¥æ¸…ç†å“ªäº›æ•°æ®ï¼Ÿå“ªäº›æ•°æ®åˆåº”è¯¥è¢«ä¿ç•™å‘¢ï¼Ÿå¦‚ä½•å†³å®šï¼Ÿ ç¼“å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›å¸¸è§çš„ç¼“å­˜æ·˜æ±°ç­–ç•¥æœ‰ä¸‰ç§ï¼š å…ˆè¿›å…ˆå‡ºç­–ç•¥FIFO(First In First Out) æœ€å°‘ä½¿ç”¨ç­–ç•¥LFU(Least Frequently Used) æœ€è¿‘æœ€å°‘ä½¿ç”¨ç­–ç•¥LRU(Least Recently Used) å¦‚ä½•åŸºäºé“¾è¡¨å®ç°LRUç¼“å­˜æ·˜æ±°ç®—æ³•å½“æˆ‘ä»¬ç»´æŠ¤ä¸€ä¸ªæœ‰åºå•é“¾è¡¨ï¼Œè¶Šé è¿‘é“¾è¡¨å°¾éƒ¨çš„ç»“ç‚¹æ˜¯è¶Šæ—©ä¹‹å‰çš„è®¿é—®(æ¯”è¾ƒä¹…ä¹‹å‰)ã€‚å½“æœ‰ä¸€ä¸ªæ–°çš„æ•°æ®è¢«è®¿é—®æ—¶ï¼Œæˆ‘ä»¬ä»é“¾è¡¨å¤´éƒ¨å¼€å§‹é¡ºåºéå†é“¾è¡¨ å¦‚æœæ­¤æ•°æ®ä¹‹å‰å·²ç»è¢«ç¼“å­˜åœ¨é“¾è¡¨ä¸­ï¼Œæˆ‘ä»¬éå†å¾—åˆ°çš„è¿™ä¸ªæ•°æ®å¯¹åº”çš„ç»“ç‚¹ï¼Œå¹¶å°†å…¶ä»åŸæ¥çš„ä½ç½®åˆ é™¤ï¼Œå†æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨ å¦‚æœæ­¤æ•°æ®æ²¡æœ‰å†ç¼“å­˜é“¾è¡¨ä¸­ï¼Œåˆ†ä¸¤ç§æƒ…å†µ å¦‚æœæ­¤æ—¶ç¼“å­˜æœªæ»¡ï¼Œå°†æ­¤ç»“ç‚¹ç›´æ¥æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨ å¦‚æœæ­¤æ—¶ç¼“å­˜å·²æ»¡ï¼Œå°†é“¾è¡¨å°¾ç»“ç‚¹åˆ é™¤ï¼Œå°†æ–°çš„æ•°æ®ç»“ç‚¹æ’å…¥é“¾è¡¨çš„å¤´éƒ¨ å› ä¸ºä¸ç®¡ç¼“å­˜æœ‰æ²¡æœ‰æ»¡ï¼Œéƒ½éœ€è¦éå†ä¸€éé“¾è¡¨ï¼Œæ‰€ä»¥è¿™æ ·çš„å®ç°æ€è·¯ï¼Œç¼“å­˜è®¿é—®çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(n) è®¾è®¡æ€æƒ³1ï¼‰ç”¨ç©ºé—´æ¢æ—¶é—´ å½“å†…å­˜ç©ºé—´å……è¶³çš„æ—¶å€™ï¼ŒåŒæ—¶ä¹Ÿæ›´åŠ è¿½æ±‚ä»£ç çš„æ‰§è¡Œé€Ÿåº¦ï¼Œå°±å¯ä»¥é€‰æ‹©ç©ºé—´å¤æ‚åº¦ç›¸å¯¹è¾ƒé«˜ã€ä½†æ—¶é—´å¤æ‚åº¦ç›¸å¯¹è¾ƒä½çš„ç®—æ³•æˆ–è€…æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ç¼“å­˜ã€‚æˆ‘ä»¬æŠŠæ•°æ®å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šï¼ŒèŠ‚çœå†…å­˜ï¼Œä½†æ¯æ¬¡æŸ¥è¯¢éƒ½éœ€è¦è¯¢é—®ä¸€ä¸ªç¡¬ç›˜ï¼Œé€Ÿåº¦è¾ƒæ…¢ã€‚é€šè¿‡ç¼“å­˜å¯ä»¥äº‹å…ˆå°†æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€—è´¹äº†å†…å­˜ç©ºé—´ï¼Œä¸è¿‡å¤§å¤§æé«˜äº†æ•°æ®æŸ¥è¯¢çš„é€Ÿåº¦ 2ï¼‰ç”¨æ—¶é—´æ¢ç©ºé—´ ä¸1ï¼‰ç›¸åï¼Œå¦‚æœå†…å­˜ç´§ç¼ºï¼Œæ¯”å¦‚ä»£ç åœ¨æ‰‹æœºæˆ–è€…å•ç‰‡æœºä¸Šè¿è¡Œï¼Œå°±éœ€è¦é€‰æ‹©ç©ºé—´å¤æ‚åº¦ç›¸å¯¹è¾ƒä½ã€ä½†æ—¶é—´å¤æ‚åº¦ç›¸å¯¹é«˜çš„ç®—æ³• å¦‚ä½•è½»æ¾å†™å‡ºæ­£ç¡®çš„é“¾è¡¨ä»£ç ç†è§£æŒ‡é’ˆæˆ–å¼•ç”¨çš„å«ä¹‰å°†æŸä¸ªå˜é‡èµ‹å€¼ç»™æŒ‡é’ˆï¼Œå®é™…ä¸Šå°±æ˜¯å°†è¿™ä¸ªå˜é‡çš„åœ°å€èµ‹å€¼ç»™æŒ‡é’ˆï¼Œæˆ–è€…åè¿‡æ¥è¯´ï¼ŒæŒ‡é’ˆä¸­å­˜å‚¨äº†è¿™ä¸ªå˜é‡çš„å†…å­˜åœ°å€ï¼ŒæŒ‡å‘äº†è¿™ä¸ªå˜é‡ï¼Œé€šè¿‡æŒ‡é’ˆå°±èƒ½æ‰¾åˆ°è¿™ä¸ªå˜é‡ã€‚ä¹Ÿå°±æ˜¯pythonä¸­çš„â€œå¼•ç”¨â€ 12p-&gt;next=q # pç»“ç‚¹ä¸­çš„nextæŒ‡é’ˆå­˜å‚¨äº†qç»“ç‚¹çš„å†…å­˜åœ°å€p-&gt;next=p-&gt;next-&gt;next # pç»“ç‚¹çš„nextæŒ‡é’ˆå­˜å‚¨äº†pç»“ç‚¹çš„ä¸‹ä¸‹ä¸€ä¸ªç»“ç‚¹çš„å†…å­˜åœ°å€ è­¦æƒ•æŒ‡é’ˆä¸¢å¤±å’Œå†…å­˜æ³„æ¼å‡å¦‚æˆ‘ä»¬æƒ³åœ¨ç»“ç‚¹på’Œç›¸é‚»ç»“ç‚¹qä¹‹é—´æ’å…¥ä¸€ä¸ªç»“ç‚¹xï¼Œä»¥ä¸‹ä»£ç å°†ä¼šå‘ç”ŸæŒ‡é’ˆä¸¢å¤±å’Œå†…å­˜æ³„æ¼ 123// é”™è¯¯ï¼ï¼éœ€è¦é¢ å€’ä¸€ä¸‹é¡ºåºp-&gt;next = x; // å°† p çš„ next æŒ‡é’ˆæŒ‡å‘ x ç»“ç‚¹ï¼›x-&gt;next = p-&gt;next; // å°† x çš„ç»“ç‚¹çš„ next æŒ‡é’ˆæŒ‡å‘ b ç»“ç‚¹ï¼› ç¬¬ä¸€è¡Œä»£ç æ‰§è¡Œä¹‹åï¼Œç»“ç‚¹pä¸å†æŒ‡å‘ç»“ç‚¹qäº†ï¼Œè¿™æ—¶å€™å†æ‰§è¡Œç¬¬äºŒè¡Œä»£ç ï¼Œå°±ç›¸å½“äºæŠŠxèµ‹å€¼ç»™x-&gt;nextï¼Œç»“æœxæŒ‡å‘xè‡ªå·±ã€‚å› æ­¤ï¼Œæ•´ä¸ªé“¾è¡¨ä¹Ÿå°±æ–­å¼€äº†ã€‚ åˆ©ç”¨å“¨å…µç®€åŒ–å®ç°éš¾åº¦é’ˆå¯¹é“¾è¡¨çš„æ’å…¥ã€åˆ é™¤æ“ä½œï¼Œéœ€è¦å¯¹æ’å…¥ç¬¬ä¸€ä¸ªç»“ç‚¹å’Œåˆ é™¤æœ€åä¸€ä¸ªç»“ç‚¹çš„æƒ…å†µè¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011121314// æ’å…¥ï¼šå‘ç©ºé“¾è¡¨æ’å…¥ç¬¬ä¸€ä¸ªç»“ç‚¹if (head == null) &#123; head = new_node;&#125;// åœ¨é“¾è¡¨çš„ç»“ç‚¹påæ’å…¥ç»“ç‚¹new_nodenew_node-&gt;next = p-&gt;next;p-&gt;next = new_node;//åˆ é™¤ï¼šåˆ é™¤å°¾ç»“ç‚¹if (head-&gt;next == null) &#123; head = null;&#125;// åˆ é™¤é“¾è¡¨å…¶ä»–ç»“ç‚¹p-&gt;next = p-&gt;next-&gt;next; å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥å“¨å…µç»“ç‚¹(è§£å†³è¾¹ç•Œé—®é¢˜ï¼Œä¸å‚ä¸ä¸šåŠ¡é€»è¾‘)ï¼Œåœ¨ä»»ä½•æ—¶å€™ï¼Œä¸ç®¡é“¾è¡¨æ˜¯ä¸æ˜¯ç©ºï¼ŒheadæŒ‡é’ˆéƒ½ä¼šä¸€ç›´æŒ‡å‘è¿™ä¸ªå“¨å…µç»“ç‚¹ã€‚å¸¦æœ‰å“¨å…µç»“ç‚¹çš„é“¾è¡¨å«å¸¦å¤´é“¾è¡¨ï¼Œç›¸åï¼Œåˆ™å«åšä¸å¸¦å¤´é“¾è¡¨ã€‚çœ‹å›¾(å›¾ç‰‡æ¥è‡ªã€Šæ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ã€‹) åˆ©ç”¨å“¨å…µç®€åŒ–ç¼–ç¨‹éš¾åº¦çš„ä¾‹å­æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚æ’å…¥æ’åºã€å½’å¹¶æ’åºã€åŠ¨æ€è§„åˆ’ç­‰ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ 1234567891011121314151617181920212223242526int find(char* a, int n, char key) &#123; int i = 0; while (i &lt; n) &#123; if (a[i] == key) &#123; return i; &#125; ++i; &#125; return -1;&#125;//ä½¿ç”¨å“¨å…µè¾¹ç•Œï¼Œä»…ä½œç¤ºä¾‹ï¼Œä¸€èˆ¬å¹¶ä¸éœ€è¦è¿½æ±‚è¿™ä¹ˆæè‡´çš„æ€§èƒ½inf find2(char* a, int n, int key) &#123; if (a[n-1] == key) &#123; return n-1; &#125; char tmp = a[n-1]; a[n-1] = key; int i = 0; while (a[i] != key) &#123; ++i; &#125; a[n-1] = tmp; if (i == n-1) return -1; return i;&#125; å½“å­—ç¬¦ä¸²aå¾ˆé•¿çš„æ—¶å€™ï¼Œç¬¬äºŒæ®µä»£ç è¿è¡Œæ›´å¿«äº›ã€‚é€šè¿‡ä¸€ä¸ªå“¨å…µa[n-1] == keyï¼Œçœæ‰äº†ä¸€ä¸ªæ¯”è¾ƒè¯­å¥i&lt;nã€‚ é‡ç‚¹ç•™æ„è¾¹ç•Œæ¡ä»¶å¤„ç†å¸¸ç”¨æ¥æ£€æŸ¥é“¾è¡¨ä»£ç æ˜¯å¦æ­£ç¡®çš„è¾¹ç•Œæ¡ä»¶æœ‰ï¼š å¦‚æœé“¾è¡¨ä¸ºç©ºæ—¶ï¼Œä»£ç æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œ å¦‚æœé“¾è¡¨åªåŒ…å«ä¸€ä¸ªç»“ç‚¹æ—¶ï¼Œä»£ç æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œ å¦‚æœé“¾è¡¨åªåŒ…å«ä¸¤ä¸ªç»“ç‚¹æ—¶ï¼Œä»£ç æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œ ä»£ç é€»è¾‘åœ¨å¤„ç†å¤´ç»“ç‚¹å’Œå°¾ç»“ç‚¹çš„æ—¶å€™ï¼Œæ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œ å¦‚æœé“¾è¡¨ä»£ç åœ¨æ­£å¸¸æƒ…å†µä¸‹èƒ½å·¥ä½œï¼Œä¹Ÿè¦å¯¹æ¯”ç€ä»¥ä¸Šå‡ ä¸ªè¾¹ç•Œæ¡ä»¶ã€‚å¦‚æœéƒ½æ²¡æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆåŸºæœ¬ä¸Šå¯ä»¥è®¤ä¸ºä»£ç æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚å½“ç„¶ï¼Œå…·ä½“çš„è¿˜æ˜¯è¦ç»“åˆå®é™…æƒ…å†µæ¥æ€è€ƒï¼Œæ¯”å¦‚å¯èƒ½ä¼šé‡åˆ°å“ªäº›è¾¹ç•Œæ¡ä»¶æˆ–è€…å¼‚å¸¸æƒ…å†µã€‚ ä¸¾ä¾‹ç”»å›¾ï¼Œè¾…åŠ©æ€è€ƒå¯¹äºæ¯”è¾ƒå¤æ‚çš„é“¾è¡¨æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ä¸¾ä¾‹æ³•å’Œç”»å›¾æ³•ã€‚æ‰¾ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œç”»å‡ºæŒ‡é’ˆå˜åŒ–å‰åçš„é“¾è¡¨ å¤šå†™å¤šç»ƒæœ€åä¸€ä¸ªæŠ€å·§å°±æ˜¯æ²¡æœ‰æŠ€å·§ï¼Œå¤šç»ƒå¤šç»ƒå¤šç»ƒã€‚ã€‚ã€‚ ç»ƒä¹ å¸¸è§çš„é“¾è¡¨æ“ä½œï¼š å•é“¾è¡¨åè½¬ é“¾è¡¨ä¸­ç¯çš„æ£€æµ‹ ä¸¤ä¸ªæœ‰åºçš„é“¾è¡¨åˆå¹¶ åˆ é™¤é“¾è¡¨å€’æ•°ç¬¬nä¸ªç»“ç‚¹ æ±‚é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹ è¿˜æœ‰ä¸Šä¸€å°èŠ‚é—ç•™çš„é—®é¢˜ï¼Œå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦æ˜¯å›æ–‡å­—ç¬¦ä¸²ï¼Ÿï¼Ÿ å‚è€ƒæ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>é“¾è¡¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€æ•°æ®ç»“æ„ä¸ç®—æ³•ç¬”è®°äºŒã€‘æ•°ç»„]]></title>
    <url>%2Famberwest.github.io%2F2018%2F10%2F05%2F%E6%95%B0%E7%BB%84%2F</url>
    <content type="text"><![CDATA[æ•°ç»„ä»€ä¹ˆæ˜¯æ•°ç»„æ•°ç»„æ˜¯ä¸€ç§çº¿æ€§è¡¨æ•°æ®ç»“æ„ï¼Œå®ƒç”¨ä¸€ç»„è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œæ¥å­˜å‚¨ä¸€ç»„å…·æœ‰ç›¸åŒç±»å‹çš„æ•°æ®ã€‚ å¦‚ä½•å®ç°éšæœºè®¿é—®æ˜“é”™ç‚¹ï¼šæ•°ç»„æ”¯æŒéšæœºè®¿é—®ï¼Œæ ¹æ®ä¸‹æ ‡éšæœºè®¿é—®çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œå…¶ä»–çš„æŸ¥æ‰¾ï¼Œå³ä½¿æ˜¯æ’å¥½åºçš„æ•°ç»„ï¼Œç”¨äºŒåˆ†æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯O(logn)ï¼Œå¹¶ä¸æ˜¯O(1)ã€‚ è®¡ç®—æœºä¼šç»™æ¯ä¸ªå†…å­˜å•ä½åˆ†é…ä¸€ä¸ªåœ°å€ï¼Œè®¡ç®—æœºé€šè¿‡åœ°å€æ¥è®¿é—®å†…å­˜ä¸­çš„æ•°æ®ã€‚å½“è®¡ç®—æœºéœ€è¦éšæœºè®¿é—®æ•°ç»„ä¸­çš„æŸä¸ªå…ƒç´ æ—¶ï¼Œå®ƒé¦–å…ˆä¼šé€šè¿‡ä¸‹é¢çš„å¯»å€å…¬å¼ï¼Œè®¡ç®—å‡ºè¯¥å…ƒç´ å­˜å‚¨çš„å†…å­˜åœ°å€ï¼š 12int[] a = new int[10]a[i]_address = base_address + i * data_type_size è®¡ç®—æœºç»™æ•°ç»„a[10]åˆ†é…äº†ä¸€å—è¿ç»­ç©ºé—´1000ï½1039 data_type_sizeï¼šæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„å¤§å°ï¼ˆä¾‹å­ä¸­æ˜¯intï¼Œå¤§å°ä¸º4ä¸ªå­—èŠ‚ï¼‰ base_addressï¼šå†…å­˜å—çš„é¦–åœ°å€ äºŒç»´æ•°ç»„m*nï¼Œa[i]][j](i&lt;m, j&lt;n)çš„å¯»å€å…¬å¼ï¼š 1a[i]_address = base_address + (i*n+j) * data_type_size ä½æ•ˆçš„æ’å…¥æ“ä½œåŠå…¶æ”¹è¿›1ï¼‰æ“ä½œï¼šå°†ä¸€ä¸ªæ•°æ®æ’å…¥åˆ°é•¿åº¦ä¸ºnçš„æ•°æ®ä¸­çš„ç¬¬kä¸ªä½ç½®ï¼Œä¸ºäº†ä¿æŒå†…å­˜æ•°æ®çš„è¿ç»­æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å°†ç¬¬kï½nè¿™éƒ¨åˆ†çš„å…ƒç´ éƒ½é¡ºåºå¾€åç§»ä¸€ä½ï¼Œè¿™æ ·çš„æ’å…¥æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸ºO(n) 2ï¼‰æ”¹è¿›ï¼šå¦‚æœæ•°ç»„æ˜¯æœ‰åºçš„ï¼Œåˆ™æŒ‰1ï¼‰æ¥æ“ä½œã€‚å¦‚æœæ•°ç»„æ˜¯æ— åºçš„ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥å°†ç¬¬kä¸ªå…ƒç´ æ”¾åˆ°æ•°ç»„æœ€åï¼Œå°†éœ€è¦æ’å…¥çš„æ•°æ®ç›´æ¥æ”¾å…¥ä½ç½®kï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1) ä½æ•ˆçš„åˆ é™¤æ“ä½œåŠå…¶æ”¹è¿›1ï¼‰è·Ÿæ’å…¥æ“ä½œç±»ä¼¼ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯O(n) 2ï¼‰æ”¹è¿›ï¼šåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¸ä¸€å®šéå¾—è¿½æ±‚æ•°ç»„ä¸­æ•°æ®çš„è¿ç»­æ€§ã€‚è¿™æ ·åœ¨æ‰§è¡Œåˆ é™¤æ“ä½œæ—¶ï¼Œå¯ä»¥å…ˆè®°å½•å·²ç»åˆ é™¤çš„æ•°æ®ï¼Œç­‰åˆ°æ•°ç»„æ²¡æœ‰å¤šä½™ç©ºé—´å­˜å‚¨æ•°æ®æ—¶ï¼Œå†è§¦å‘æ‰§è¡Œä¸€æ¬¡çœŸæ­£çš„åˆ é™¤æ“ä½œ è­¦æƒ•æ•°æ®çš„è®¿é—®è¶Šç•Œé—®é¢˜åƒpythonã€Javaè¿™äº›è¯­è¨€ä¼šåšè¶Šç•Œæ£€æŸ¥ï¼Œæ‰€ä»¥ä¸ç”¨è€ƒè™‘è¿™ä¸ªé—®é¢˜ã€‚ 123456789int main(int argc, char* argv[])&#123; int i = 0; int arr[3] = &#123;0&#125;; for(; i&lt;=3; i++)&#123; arr[i] = 0; printf("hello world\n"); &#125; return 0;&#125; åœ¨Cè¯­è¨€ä¸­ï¼Œæ•°ç»„è¶Šç•Œæ˜¯ä¸€ç§æœªå†³è¡Œä¸ºã€‚è€Œæ–‡ä¸­è¿™ä¸ªä¾‹å­ä¼šæ— é™å¾ªç¯æ‰“å°â€œhello worldâ€ã€‚å› ä¸ºå‡½æ•°ä½“å†…çš„å±€éƒ¨å˜é‡å­˜åœ¨æ ˆä¸Šï¼Œä¸”æ˜¯è¿ç»­å‹æ ˆã€‚å†Linuxè¿›ç¨‹çš„å†…å­˜å¸ƒå±€ä¸­ï¼Œæ ˆåŒºçš„é«˜åœ°å€ç©ºé—´ï¼Œä»é«˜å‘ä½å¢é•¿ã€‚å˜é‡iå’Œarråœ¨ç›¸é‚»åœ°å€ï¼Œä¸”iæ¯”arrçš„åœ°å€å¤§ï¼Œæ‰€ä»¥arrè¶Šç•Œåˆšå¥½è®¿é—®åˆ°iã€‚å‰ææ˜¯iå’Œarrå…ƒç´ æ˜¯åŒç±»å‹ï¼Œå¦åˆ™è¿™æ®µä»£ç ä»æ˜¯æœªå†³è¡Œä¸ºã€‚ çº¿æ€§è¡¨vséçº¿æ€§è¡¨1ï¼‰æ¯ä¸ªçº¿æ€§è¡¨ä¸Šçš„æ•°æ®æœ€å¤šåªæœ‰å‰å’Œåä¸¤ä¸ªæ–¹å‘ï¼Œå¦‚ï¼šæ•°ç»„ã€é“¾è¡¨ã€é˜Ÿåˆ—ã€æ ˆç­‰ 2ï¼‰éçº¿æ€§è¡¨ä¸­ï¼Œæ•°æ®ä¹‹é—´å¹¶ä¸æ˜¯ç®€å•çš„å‰åå…³ç³»ï¼Œå¦‚ï¼šäºŒå‰æ ‘ã€å †ã€å›¾ç­‰ ä¸ºä»€ä¹ˆå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæ•°ç»„éƒ½æ˜¯ä»0å¼€å§‹ç¼–å·1ï¼‰æ•ˆç‡ä¼˜åŒ– ä¸‹æ ‡æœ€ç¡®åˆ‡çš„å®šä¹‰åº”è¯¥æ˜¯â€œåç§»(offset)â€ã€‚åœ¨å‰é¢ä¾‹å­ä¸­ï¼Œaç”¨æ¥è¡¨ç¤ºæ•°ç»„çš„é¦–åœ°å€ï¼Œa[0]å°±æ˜¯åç§»ä¸º0çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯é¦–åœ°å€ã€‚æ‰€ä»¥è®¡ç®—a[k]çš„å†…å­˜åœ°å€åªéœ€è¦ç”¨è¿™ä¸ªå…¬å¼ï¼š 1a[k]_address = base_address + k * type_size å¦‚æœä¸‹æ ‡æ˜¯ä»1å¼€å§‹ï¼Œé‚£ä¹ˆè®¡ç®—a[k]çš„å†…å­˜åœ°å€çš„å…¬å¼åˆ™å˜æˆï¼š 1a[k]_address = base_address + (k-1) * type_size æ¯æ¬¡éšæœºè®¿é—®æ•°ç»„ï¼ŒCPUéƒ½ä¼šå¤šäº†ä¸€æ¬¡å‡æ³•æŒ‡ä»¤ã€‚ 2ï¼‰å†å²åŸå›  Cè¯­è¨€è®¾è®¡è€…ç”¨0åšä¸‹æ ‡ï¼Œä¹‹åçš„ä¸€äº›é«˜çº§è¯­è¨€éƒ½æ•ˆä»¿äº†å®ƒï¼Œæ²¿ç”¨äº†ä»0å¼€å§‹æŠ€æœ¯çš„ä¹ æƒ¯ã€‚ å› ä¸ºpythonçš„æ•°ç»„ç‰¹æ€§è·ŸCè¯­è¨€å·®åˆ«è¿˜æ˜¯è›®å¤§çš„ï¼Œå¾ˆå¤šç‰¹å¾éƒ½è¦è‡ªå·±å®šä¹‰ï¼Œå¯¹äºè¿™ä¸ªå¯ä»¥æŸ¥çœ‹åŸä½œè€…çš„ä»£ç ç¤ºä¾‹ï¼Œå…¶ä»–è¯­è¨€æˆ‘ä¹Ÿä¸æ‡‚ï¼Œæ‰€ä»¥è¿™ç¯‡ç¬”è®°è¿˜æœ‰ä¸€äº›æ²¡æœ‰æ•´ç†å‡ºæ¥ï¼Œåç»­å†æ›´æ–° å‚çœ‹æ–‡ç« æ•°æ®ç»“æ„ä¸ç®—æ³•]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>æ•°ç»„</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…jupyter notebook]]></title>
    <url>%2Famberwest.github.io%2F2018%2F10%2F02%2F%E5%9C%A8%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E5%AE%89%E8%A3%85jupyter-notebook%2F</url>
    <content type="text"><![CDATA[jupyter notebookæ˜¯ä¸€ä¸ªå¼€æºWebåº”ç”¨ç¨‹åºï¼Œå¯ä»¥åˆ›å»ºå’Œå…±äº«åŒ…å«å®æ—¶ä»£ç ï¼Œæ–¹ç¨‹å¼ï¼Œå¯è§†åŒ–å’Œå™è¿°æ–‡æœ¬çš„æ–‡æ¡£ã€‚ç”¨é€”åŒ…æ‹¬ï¼šæ•°æ®æ¸…ç†å’Œè½¬æ¢ï¼Œæ•°å€¼æ¨¡æ‹Ÿï¼Œç»Ÿè®¡å»ºæ¨¡ï¼Œæ•°æ®å¯è§†åŒ–ï¼Œæœºå™¨å­¦ä¹ ç­‰ç­‰ã€‚æ‰€ä»¥åœ¨å¹³æ—¶çš„å·¥ä½œä¸­ä¹Ÿä¼šç»å¸¸ç”¨åˆ°ã€‚ æœ€è¿‘åœ¨ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒä¸­ä½¿ç”¨notebookæ—¶ï¼Œå‘ç°ç‰ˆæœ¬è·Ÿè™šæ‹Ÿç¯å¢ƒçš„pythonç‰ˆæœ¬å·å¯¹ä¸ä¸Šï¼Œå°±æ‰“ç®—ç›´æ¥upgradeï¼Œäº‹å®è¯æ˜è¿™ç§æƒ³æ³•é”™çš„éå¸¸ç¦»è°±ï¼Œå› ä¸ºç›´æ¥upgradeçš„æ˜¯ç³»ç»Ÿjupyter notebookã€‚æ¥ä¸‹æ¥æ‰æ˜¯åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…å¯¹åº”ç‰ˆæœ¬jupyterçš„æ­£ç¡®æ‰“å¼€æ–¹å¼ã€‚ åœ¨è™šæ‹Ÿç¯å¢ƒä¸‹ åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ ä½¿ç”¨pyenv-virtualenvåˆ›å»ºæ–°çš„è™šæ‹Ÿç¯å¢ƒï¼Œå…·ä½“ä½¿ç”¨æŸ¥çœ‹ï¼špyenvåœ¨centos7å’Œmacä¸‹çš„å®‰è£…ä½¿ç”¨ 1234# åœ¨sampleæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªåŒåçš„åŸºäºpython3.6çš„è™šæ‹Ÿç¯å¢ƒmkdir samplecd samplepyenv virtualenv 3.6.5 sample æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ 1pyenv activate sample å®‰è£…jupyter 1pip install jupyter å¯åŠ¨jupyter 1jupyter notebook è‡³æ­¤ï¼Œå°±å¤§åŠŸå‘Šæˆå•¦ï¼ï¼ï¼ æ·»åŠ python3åˆ°jupyterä¹‹å‰ä¸çŸ¥é“æ€ä¹ˆæ“ä½œï¼Œå±…ç„¶æŠŠpython3ä»jupyter notebookç»™åˆ é™¤äº†ï¼Œéœ€è¦é‡æ–°å®‰è£…ä¸€ä¸‹ 12python3 -m pip install ipykernelpython3 -m ipykernel install --user åˆä¸€ä¸ªå‘ã€‚ã€‚ã€‚ è‡ªä»ä½¿ç”¨pyenvç®¡ç†pythonä¹‹åï¼Œå°±è§‰å¾—ä»¥å‰ç”µè„‘é‡Œè£…çš„python3.5å¥½å¤šä½™ï¼Œå¿ä¸ä½åˆ åˆ åˆ ï¼Œç»“æœå¯¼è‡´jupyterèƒ½æ‰“å¼€ï¼Œä½†æ˜¯æ˜¾ç¤º500é”™è¯¯ï¼Œæç¤ºæ‰¾ä¸åˆ°pythonçš„binè·¯å¾„ã€‚å®‰è£…å‰é¢çš„æ–¹å¼å»ºç«‹è™šæ‹Ÿç¯å¢ƒå†é‡æ–°å®‰è£…ï¼Œè¿˜æ˜¯ä¸è¡Œã€‚ 1234567891011# é”™è¯¯Uncaught exception POST /api/sessions (::1) HTTPServerRequest(protocol=&apos;http&apos;, host=&apos;localhost:8889&apos;, method=&apos;POST&apos;, uri=&apos;/api/sessions&apos;, version=&apos;HTTP/1.1&apos;, remote_ip=&apos;::1&apos;) Traceback (most recent call last): File &quot;/Users/amber/.pyenv/versions/3.5.3/envs/amber/lib/python3.5/site-packages/tornado/web.py&quot;, line 1592, in _execute ... File &quot;/Users/amber/.pyenv/versions/3.5.3/lib/python3.5/subprocess.py&quot;, line 676, in __init__ restore_signals, start_new_session) File &quot;/Users/amber/.pyenv/versions/3.5.3/lib/python3.5/subprocess.py&quot;, line 1282, in _execute_child raise child_exception_type(errno_num, err_msg) FileNotFoundError: [Errno 2] No such file or directory: &apos;/Library/Frameworks/Python.framework/Versions/3.5/bin/python3&apos; æœ€åæ˜¯ç”¨äº†ä¸‹é¢çš„æ–¹å¼å®‰è£…æˆåŠŸçš„ï¼Œå…¶ä»–æ­¥éª¤è·Ÿä¸Šé¢ä¸€æ · 1ipython kernel install --user --name=virtual_env_name å‚è€ƒæ–‡ç« ï¼šinstall jupyter notebook in a virtual environment Installing the IPython kernel]]></content>
      <tags>
        <tag>jupyter</tag>
        <tag>å®‰è£…</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è‡ªå®šä¹‰logging]]></title>
    <url>%2Famberwest.github.io%2F2018%2F09%2F30%2F%E8%87%AA%E5%AE%9A%E4%B9%89logging%2F</url>
    <content type="text"><![CDATA[ç»„ä»¶å…³ç³»loggingæ¨¡å—æœ‰å››å¤§ç»„ä»¶ï¼Œåˆ†åˆ«æ˜¯formatterã€ filterã€ handlerå’Œloggerã€‚è¿™äº›ç»„ä»¶å„è‡ªçš„åŠŸèƒ½åŠå…³ç³»å¦‚ä¸‹ï¼š ç»„ä»¶åç§° å¯¹åº”ç±»å åŠŸèƒ½æè¿° æ—¥å¿—å™¨ Looger æä¾›äº†åº”ç”¨ç¨‹åºå¯æŠ‘åˆ¶ä½¿ç”¨çš„æ¥å£ å¤„ç†å™¨ Handler å°†loggeråˆ›å»ºçš„æ—¥å¿—è®°å½•å‘é€åˆ°åˆé€‚çš„ç›®çš„è¾“å‡º è¿‡æ»¤å™¨ Filter æä¾›äº†æ›´ç»†ç²’åº¦çš„æ§åˆ¶å·¥å…·æ¥å†³å®šè¾“å‡ºå“ªæ¡æ—¥å¿—è®°å½•ï¼Œä¸¢å¼ƒå“ªæ¡æ—¥å¿—è®°å½• æ ¼å¼å™¨ Formatter å†³å®šæ—¥å¿—è®°å½•çš„æœ€ç»ˆè¾“å‡ºæ ·å¼ å…³ç³»æè¿°ï¼š loggeréœ€è¦é€šè¿‡handlerå°†æ—¥å¿—è®°å½•è¾“å‡ºåˆ°ç›®æ ‡ä½ç½®ï¼Œæ¯”å¦‚ï¼šæ–‡ä»¶ã€sys.stdoutã€ç½‘ç»œç­‰ ä¸åŒçš„handlerå¯ä»¥è®²æ—¥å¿—è¾“å‡ºåˆ°ä¸åŒçš„ä½ç½® loggerå¯ä»¥è®¾ç½®å¤šä¸ªhandlerè®²åŒä¸€æ¡æ—¥å¿—è®°å½•è¾“å‡ºåˆ°ä¸åŒçš„ä½ç½® æ¯ä¸ªhandleréƒ½å¯ä»¥è®¾ç½®è‡ªå·±çš„filteræ¥å®ç°æ—¥å¿—è¿‡æ»¤ï¼Œä»è€Œåªä¿ç•™æ„Ÿå…´è¶£çš„æ—¥å¿— æ¯ä¸ªhandleréƒ½å¯ä»¥è®¾ç½®è‡ªå·±çš„formatterå®ç°åŒä¸€æ¡æ—¥å¿—ä»¥ä¸åŒçš„æ ¼å¼è¾“å‡ºåˆ°ä¸åŒçš„åœ°æ–¹ é…ç½®æ—¥å¿—å¸¸ç”¨çš„æ—¥å¿—é…ç½®æœ‰å‡ ç§æ–¹å¼ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯yamlé…ç½®æ–‡ä»¶ï¼Œé…ç½®ç®€å•æ˜äº†ï¼Œä¸è¿‡çµæ´»åº¦ä¸å¤Ÿã€‚(æ³¨ï¼šyamlæ–‡ä»¶å‡ºç°ä¸­æ–‡å¯èƒ½ä¼šæŠ¥é”™) 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748version: 1disable_existing_loggers: False# set the log formatformatters: simple: format: '%(asctime)s - %(name)s - %(levelname)s - %(filename)s - %(lineno)s - %(message)s' datefmt: '%Y-%m-%d %H:%M:%S'handlers: # log to screen console: class: logging.StreamHandler level: DEBUG formatter: simple error_handler: class: logging.handlers.RotatingFileHandler level: ERROR filters: [video] formatter: simple filename: logs/error.log maxBytes: 10485760 # 10MB backupCount: 5 encoding: "utf8" mode: a info_handler: class: logging.handlers.RotatingFileHandler level: DEBUG formatter: simple filename: logs/info.log maxBytes: 10485760 # 10MB backupCount: 5 encoding: "utf8" mode: aloggers: video: level: DEBUG handler: [console, error_handler] propagate: trueroot: level: DEBUG handlers: [console, info_handler, error_handler] propagate: true formatterså®šä¹‰äº†æ—¥å¿—è¾“å‡ºçš„æ ·å¼ï¼Œsimpleæ˜¯formatterçš„idï¼Œhandlerå¯ä»¥ç›´æ¥è°ƒç”¨ handlerså®šä¹‰æ—¥å¿—çš„è¾“å‡ºä½ç½®ã€‚è¿™é‡Œå®šä¹‰äº†ä¸‰ç§æƒ…å†µï¼Œidåˆ†åˆ«æ˜¯consoleã€error_handlerå’Œ info_handlerã€‚consoleæ˜¯ç›´æ¥è¾“å‡ºåˆ°å±å¹•ï¼Œå…¶ä»–ä¸¤ç§åœ¨ä¸åŒçš„æ—¥å¿—çº§åˆ«ä¸‹åˆ†åˆ«å†™å…¥æ–‡ä»¶ã€‚ loggerså®šä¹‰äº†è®°å½•å™¨ï¼ˆloggerï¼‰çš„IDå’Œå¯¹åº”çš„handlerã€‚åœ¨ä»£ç ä¸­å¯ä»¥ä½¿ç”¨logging.getLogger(&#39;video&#39;)æ¥è·å¾—IDå¯¹åº”çš„loggerã€‚ rootåˆ™æ˜¯é»˜è®¤çš„è¾“å‡ºé…ç½®ã€‚å¦‚æœåœ¨è·å–loggerè®°å½•å™¨æ—¶æ²¡æœ‰æä¾›ä»»ä½•ä¿¡æ¯ç»™logging.getLogger(type)ï¼Œæ¯”å¦‚ï¼šå½“typeä¸ºrootï¼Œæˆ–è€…ä¸ºç©ºï¼Œæˆ–è€…æ˜¯ä½¿ç”¨__name__æ—¶ï¼Œå°±ä¼šä½¿ç”¨è¯¥é…ç½®ã€‚ è°ƒç”¨çš„æ—¶å€™ä¹Ÿå¾ˆç®€å•ï¼š 1234567891011121314151617181920import loggingimport logging.configimport yamldef setup_logging(default_path='logging.yaml', default_level=logging.DEBUG): """é…ç½®æ—¥å¿—""" path = os.path.join(BASE_DIR, default_path) if os.path.exists(path): with open(path, 'rt') as f: config = yaml.safe_load(f.read()) logging.config.dictConfig(config) else: logging.basicConfig(level=default_level) print(f'the log setting path &#123;default_path&#125; does not exist')if __name__ == '__main__': setup_logging() logger = logging.getLogger('video') # è¿™é‡Œä¸æŒ‡å®šï¼Œé»˜è®¤ä¼šè°ƒç”¨root logger.info('test') è¿è¡Œä¹‹åä¼šç”Ÿæˆä¸¤ä¸ªæ—¥å¿—æ–‡ä»¶info.logå’Œerror.logï¼Œinfo.logæ–‡ä»¶ä¸­å¤šäº†è¿™ä¹ˆä¸€è¡Œè®°å½•ï¼š 2018-10-01 00:16:51 - video - INFO - utils.py - 154 - test å‚è€ƒæ–‡çŒ®logging.config Good logging practice in Python Pythonä¹‹æ—¥å¿—å¤„ç†ï¼ˆloggingæ¨¡å—ï¼‰]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>logging</tag>
        <tag>æ—¥å¿—</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€æ•°æ®ç»“æ„ä¸ç®—æ³•ç¬”è®°ä¸€ã€‘å¤æ‚åº¦åˆ†æ]]></title>
    <url>%2Famberwest.github.io%2F2018%2F09%2F27%2F%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[å¤§Oå¤æ‚åº¦è¡¨ç¤ºæ³•ä»CPUè§’åº¦æ¥è¯´ï¼Œæ¯ä¸€è¡Œä»£ç éƒ½æœ‰ç±»ä¼¼çš„æ“ä½œï¼šè¯»æ•°æ®-è¿ç®—-å†™æ•°æ®ã€‚è€Œç®—æ³•çš„æ‰§è¡Œæ•ˆç‡å¯ä»¥å¤§æ¦‚ç†è§£ä¸ºç®—æ³•ä»£ç æ‰§è¡Œçš„æ—¶é—´ï¼Œç”¨å¤§Oæ¥è¡¨ç¤ºï¼Œå½¢å¼å¦‚ï¼šT(n)=O(f(n))ã€‚å¤§Oæ—¶é—´å¤æ‚åº¦å®é™…ä¸Šå¹¶ä¸å…·ä½“è¡¨ç¤ºä»£ç çœŸæ­£çš„æ‰§è¡Œæ—¶é—´ï¼Œè€Œæ˜¯è¡¨ç¤ºä»£ç æ‰§è¡Œæ—¶é—´éšæ•°æ®è§„æ¨¡å¢é•¿çš„å˜åŒ–è¶‹åŠ¿ï¼Œæ‰€ä»¥ä¹Ÿç§°ä¸ºæ¸è¿›æ—¶é—´å¤æ‚åº¦ï¼ˆasymptotic time complexityï¼‰ï¼Œç®€ç§°æ—¶é—´å¤æ‚åº¦ã€‚åœ¨è®¡ç®—å¤æ‚åº¦çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ç”¨å¿½ç•¥å…±è¯†ä¸­çš„å¸¸é‡ã€ä½é˜¶ã€ç³»æ•°ï¼Œæœ€éœ€è¦å…³æ³¨æœ€å¤§é˜¶çš„é‡çº§å°±å¯ä»¥ã€‚å…³äºè¿™ä¸€ç‚¹ï¼Œå¯ä»¥ä»æé™çš„è§’åº¦æ¥ç†è§£ï¼Œå½“nè¶‹å‘âˆæ—¶ï¼Œå¸¸é‡åŠä½é˜¶é‡çº§éƒ½å¯ä»¥è¢«å¿½ç•¥ã€‚ æ—¶é—´å¤æ‚åº¦åˆ†æå…³äºæ—¶é—´å¤æ‚åº¦åˆ†ææœ‰ä¸‰ä¸ªæ¯”è¾ƒå®ç”¨çš„æ–¹æ³•ï¼š åªå…³æ³¨å¾ªç¯æ‰§è¡Œæ¬¡æ•°æœ€å¤šçš„ä¸€æ®µä»£ç  12345def cal(n): sum = 0 for i in range(n): sum += i return sum åœ¨è¿™æ®µä»£ç ä¸­ï¼Œsum=0æ˜¯å¸¸é‡çº§çš„æ‰§è¡Œæ—¶é—´ï¼Œä¸næ— å…³ã€‚åœ¨forå¾ªç¯ä¸­ï¼Œä¸¤è¡Œä»£ç éƒ½æ‰§è¡Œäº†næ¬¡ï¼Œæ‰€ä»¥è¿™æ®µä»£ç æ€»çš„æ—¶é—´å¤æ‚åº¦æ˜¯T(n)=O(1+2n)ï¼Œä¹Ÿå°±æ˜¯O(n)ã€‚ åŠ æ³•æ³•åˆ™ï¼šæ€»å¤æ‚åº¦ç­‰äºé‡çº§æœ€å¤§çš„é‚£æ®µä»£ç çš„å¤æ‚åº¦ 12345678910111213def cal(n): sum_1 = sum_2 = sum_3 = 0 for i in range(100): sum_1 += i for j in range(n): sum_2 += j for k in range(n): for l in range(n): sum_3 += k * l return sum_1 + sum_2 + sum_3 è¿™ä¸‰æ®µä»£ç çš„æ—¶é—´å¤æ‚åº¦åˆ†åˆ«æ˜¯O(1)ï¼ŒO(n)å’ŒO(n^2)ï¼Œsum_1è®¡ç®—äº†100æ¬¡ï¼Œä¹Ÿæ˜¯å¸¸é‡çº§ï¼Œæ‰€ä»¥å¤æ‚åº¦ä¸ºO(1)ã€‚ç»¼åˆæ¥çœ‹ï¼Œè¿™ä¸ªå‡½æ•°çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(n^2)ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ€»çš„æ—¶é—´å¤æ‚åº¦å°±ç­‰äºé‡çº§æœ€å¤§çš„é‚£æ®µä»£ç çš„æ—¶é—´å¤æ‚åº¦ã€‚ æˆ‘ä»¬å¯ä»¥å°†ä¸Šè¿°è®¡ç®—è¿‡ç¨‹æŠ½è±¡ä¸ºä»¥ä¸‹å…¬å¼ï¼š 123T1(n) = O(f(n))T2(n) = O(g(n))T(n) = T1(n) + T2(n) = max(O(f(n)), O(g(n))) = O(max(f(n), g(n))) ä¹˜æ³•æ³•åˆ™ï¼šåµŒå¥—ä»£ç çš„å¤æ‚åº¦å°±ç­‰äºåµŒå¥—å†…å¤–ä»£ç å¤æ‚åº¦çš„ä¹˜ç§¯ 1234567891011def cal(n): sum = 0 for k in range(n): sum += k return sumdef cal2(n): sum = 0 for i in range(n): sum += cal(n) return sum ä¹ä¸€çœ‹ï¼Œå¯èƒ½ä¼šè§‰å¾—è¿™ä¸¤ä¸ªå‡½æ•°çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(n)ï¼Œå…¶å®å‘¢ï¼Œcal2è°ƒç”¨äº†calå‡½æ•°ï¼Œæ‰€ä»¥cal2çš„æ—¶é—´å¤æ‚åº¦åº”è¯¥æ˜¯T(n)=O(n*n)=O(n^2)ã€‚ ç±»ä¼¼åœ°ï¼Œå¯ä»¥æŠ½è±¡å‡ºå¦‚ä¸‹å…¬å¼ï¼š 123T1(n) = O(f(n))T2(n) = O(g(n))T = T1(n) * T2(n) = O(f(n)) * O(g(n)) = O(f(n) * g(n)) å¤šä¸ªè§„æ¨¡æ±‚åŠ æ³•ï¼šO(m+n) 123456789def cal(n, m):sum_1 = sum_2 = 0for i in range(n):sum_1 += ifor j in range(m):sum_2 += jreturn sum_1 + sum_2 åœ¨ä»£ç ä¸­ï¼Œå› ä¸ºæ²¡åŠæ³•ç¡®å®šmå’Œnå“ªä¸ªå¤§ï¼Œæ‰€ä»¥å¤æ‚åº¦ä¸ºO(m+n)ã€‚å¯¹åº”çš„åŠ æ³•æ³•åˆ™å°±éœ€è¦ä¿®æ”¹ä¸ºï¼š 123T1(n) = O(f(n))T2(m) = O(g(m))T(n) = T1(n) + T2(m) = O(f(n) + g(m)) ä¹˜æ³•æ³•åˆ™ä»ç„¶æœ‰æ•ˆï¼Œä¸éœ€è¦ä¿®æ”¹ã€‚ å‡ ç§å¸¸è§çš„æ—¶é—´å¤æ‚åº¦å®ä¾‹åˆ†æ å¤šé¡¹å¼é‡çº§ å¸¸é‡é˜¶ï¼šO(1) 12# æ‰§è¡Œä»£ç ä¸éšnå¢å¤§è€Œå¢å¤§ï¼Œåªè¦ä¸å­˜åœ¨å¾ªç¯è¯­å¥ã€é€’å½’è¯­å¥ï¼Œå³ä½¿æœ‰æˆåƒä¸Šä¸‡è¡Œä»£ç ï¼ŒåŒæ ·ä¹Ÿåªæœ‰O(1)sum = 1 å¯¹æ•°é˜¶ï¼šO(logn) 123456# iå…¶å®æ˜¯ä¸ªå…¬æ¯”ä¸º2çš„ç­‰æ¯”åºåˆ—ã€‚içš„å¢é•¿æ¯”è¾ƒï¼Œç”¨å¯¹æ•°å‡½æ•°å¯ä»¥æ±‚å‡ºlog(n, 2)=nå°±å¯ä»¥å¾—è¿è¡Œæ•ˆç‡i = 1n = 100while i &lt; n: # i=i*3ï¼Œä¹Ÿæ˜¯åŒæ ·çš„è¿ç®—è¿‡ç¨‹ï¼Œæ ¹æ®æ¢åº•å…¬å¼ï¼šlog(n, 3)=log(2, 3)*log(n ,2)ï¼Œå¸¸æ•°å¯ä»¥å¿½ç•¥ i = i * 2 çº¿æ€§é˜¶ï¼šO(n) 12345def cal(n): sum = 1 for i in range(n): sum += i * 2 return sum çº¿æ€§å¯¹æ•°é˜¶ï¼šO(nlogn) 12345def cal(n): sum = 1 for i in range(n): while i &lt; n: sum += i * 2 è·Ÿå¯¹æ•°é˜¶ç±»ä¼¼ï¼Œä¸è¿‡ä½¿ç”¨çš„ä¹˜æ³•æ³•åˆ™ å¹³æ–¹é˜¶ï¼šO(n^2) ç«‹æ–¹é˜¶ï¼šO(n^3) kæ–¹é˜¶ï¼šO(n^k) éå¤šé¡¹å¼é‡çº§ï¼Œä¹Ÿå°±æ˜¯NPé—®é¢˜ï¼ˆNon-Deterministic Prolynomialï¼‰ã€‚ éšç€æ•°æ®è§„æ¨¡çš„å¢é•¿ï¼Œç®—æ³•çš„æ‰§è¡Œæ—¶é—´å’Œç©ºé—´å ç”¨æš´å¢ï¼Œè¿™ç±»ç®—æ³•æ€§èƒ½æå·®ï¼Œåº”é¿å…è¿™æ ·çš„ä»£ç ã€‚ æŒ‡æ•°é˜¶ï¼šO(2^n) é˜¶ä¹˜é˜¶ï¼šO(n!) ç©ºé—´å¤æ‚åº¦åˆ†æç©ºé—´å¤æ‚åº¦å…¨ç§°ä¸ºæ¸è¿›ç©ºé—´å¤æ‚åº¦(asymptotic space complexity)ï¼Œè¡¨ç¤ºç®—æ³•çš„å­˜å‚¨ç©ºé—´å’Œæ•°ç»„è§„æ¨¡ä¹‹é—´çš„å¢é•¿å…³ç³»ã€‚ ä¾‹å¦‚ï¼šå­˜å‚¨ä¸€ä¸ªäºŒè¿›åˆ¶æ•°ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯O(logn)bitã€‚8ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºå°±æ˜¯3ä¸ªbitï¼Œ16ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯4ä¸ªbitï¼Œä»¥æ­¤ç±»æ¨ï¼Œnç”¨äºŒè¿›åˆ¶è¡¨ç¤ºå°±æ˜¯lognä¸ªbitã€‚ å¤æ‚åº¦åˆ†æçš„å››ä¸ªçŸ¥è¯†ç‚¹æœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦(best case time complexity)ã€æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦(worst case time complexity)ã€å¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦(average case time complexity)ã€å‡æ‘Šæ—¶é—´å¤æ‚åº¦(amortized time complexity) æœ€å¥½ã€æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦12345678910111213141516def find1(li, n, x): """åœ¨æ— åºåˆ—è¡¨ä¸­æŸ¥æ‰¾å˜é‡xå‡ºç°çš„ä½ç½®ï¼Œæ‰¾ä¸åˆ°è¿”å›-1""" # liæ˜¯åˆ—è¡¨ï¼Œnä¸ºåˆ—è¡¨é•¿åº¦ pos = -1 for i in range(n): if li[i] == x: pos = i return posdef find2(li, n, x): pos = -1 for i in range(n): if li[i] == x: pos = i break return pos åœ¨find1å‡½æ•°ä¸­ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œåœ¨ç¬¬äºŒä¸ªå‡½æ•°ä¸­æ—¶é—´å¤æ‚åº¦å°±ä¸å¥½ç¡®å®šäº†ã€‚æœ€å¥½çš„æƒ…å†µå°±æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ å°±æ˜¯è¦æ‰¾çš„å˜é‡xï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œä¹Ÿå°±æ˜¯æœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦ã€‚æœ€åçš„æƒ…å†µæ˜¯xä¸åœ¨åˆ—è¡¨ä¸­ï¼Œæ•´ä¸ªåˆ—è¡¨éƒ½ä¼šè¢«å¾ªç¯ä¸€éï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œä¹Ÿå°±æ˜¯æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦ã€‚ å¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦è¿˜æ˜¯åˆšæ‰çš„ä¾‹å­ï¼Œè¦æŸ¥æ‰¾çš„å˜é‡xåœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼Œæœ‰n+1ç§æƒ…å†µï¼šåœ¨æ•°ç»„çš„0ï½n-1ä½ç½®ä¸­å’Œä¸åœ¨æ•°ç»„ä¸­ã€‚æˆ‘ä»¬å‡è®¾xåœ¨æ•°ç»„ä¸­å’Œä¸åœ¨æ•°ç»„ä¸­çš„æ¦‚ç‡åˆ†åˆ«ä¸º1/2ï¼ˆä¸ºäº†æ–¹ä¾¿ç†è§£å’Œè®¡ç®—ï¼‰ã€‚é‚£ä¹ˆxåœ¨æ•°ç»„ä¸­æœ‰nç§æƒ…å†µï¼Œæ¯ä¸ªä½ç½®å‡ºç°xçš„æ¦‚ç‡éƒ½ä¸º1/(2n)ï¼Œéœ€è¦æŸ¥æ‰¾çš„å…ƒç´ ä¸ªæ•°åˆ†åˆ«å¯¹åº”ç€1ï½nï¼›xä¸åœ¨æ•°ç»„ï¼Œé‚£ä¹ˆéœ€è¦éå†æ•´ä¸ªæ•°ç»„ï¼Œå³nä¸ªå…ƒç´ ã€‚æ‰€ä»¥å¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦çš„è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š è¿™ä¸ªå€¼æ˜¯æ¦‚ç‡è®ºä¸­çš„åŠ æƒå¹³å‡å€¼/æœŸæœ›å€¼ï¼Œæ‰€ä»¥å¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦å…¨ç§°åº”è¯¥å«åŠ æƒå¹³å‡æ—¶é—´å¤æ‚åº¦æˆ–è€…æœŸæœ›æ—¶é—´å¤æ‚åº¦ã€‚ä¸è¿‡å½“nè¶‹å‘æ— ç©·å¤§æ—¶ï¼Œæ—¶é—´å¤æ‚åº¦è¿˜æ˜¯O(n)ã€‚æ‰€ä»¥åªæœ‰å½“åŒä¸€æ®µä»£ç åœ¨ä¸åŒæƒ…å†µä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦æœ‰é‡çº§çš„å·®è·ï¼Œæˆ‘ä»¬æ‰ä¼šä½¿ç”¨è¿™ä¸‰ç§å¤æ‚åº¦è¡¨ç¤ºæ³•æ¥åŒºåˆ†ã€‚ è¿™ç±»ä»£ç ä¹Ÿæœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼šåªæœ‰åœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¤æ‚åº¦æ‰ä¸ºO(1)ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯O(n)ã€‚è¿™ä¸€ç‚¹è·Ÿå‡æ‘Šæ—¶é—´å¤æ‚åº¦æ˜¯ä¸åŒçš„ã€‚ å‡æ‘Šæ—¶é—´å¤æ‚åº¦å‡æ‘Šæ—¶é—´å¤æ‚åº¦å¯¹åº”çš„åˆ†ææ–¹æ³•æ˜¯æ‘Šè¿˜åˆ†æ/å¹³æ‘Šåˆ†æï¼Œä½¿ç”¨åœºæ™¯éå¸¸æœ‰é™ï¼Œä¹Ÿå¾ˆç‰¹æ®Šã€‚ 123456789101112131415# liæ˜¯ä¸€ä¸ªé•¿åº¦ä¸ºnçš„åˆ—è¡¨li = [0] * ncount = 0def insert(val): """å¾€æ•°ç»„æ’å…¥æ•°æ®""" if (count == len(li)): # å½“countç­‰äºåˆ—è¡¨é•¿åº¦æ—¶ï¼Œå°†åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ•°æ®ç›¸åŠ å¹¶èµ‹ç»™åˆ—è¡¨ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œvalæ’å…¥li[1] sum = 0 for i in range(len(li)): sum += sum + li[i] li[0] = sum count = 1 # å¦‚æœcountæœªåˆ°nï¼Œé‚£ä¹ˆç›´æ¥æ’å…¥åˆ°li[count] li[count] = val; count += 1 insert()æ–¹æ³•è·Ÿå¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸­çš„find()æœ‰ç€ä¸¤å¤„ä¸åŒçš„åœ°æ–¹ï¼š 1ã€åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦éƒ½ä¸ºO(1)ï¼Œåªæœ‰ä¸ªåˆ«æƒ…å†µä¸‹å¤æ‚åº¦æ‰æ¯”è¾ƒé«˜ï¼Œä¸ºO(n)ã€‚ 2ã€O(1)æ—¶é—´å¤æ‚åº¦çš„æ’å…¥å’ŒO(n)æ—¶é—´å¤æ‚åº¦çš„æ’å…¥ï¼Œå‡ºç°çš„é¢‘ç‡æ˜¯éå¸¸æœ‰è§„å¾‹çš„ï¼Œè€Œä¸”æœ‰ä¸€å®šçš„å‰åæ—¶è®¸å…³ç³»ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸€ä¸ªO(n)æ’å…¥ä¹‹åï¼Œç´§è·Ÿç€n-1ä¸ªO(1)çš„æ’å…¥æ“ä½œï¼Œå¾ªç¯å¾€å¤ã€‚ å…·ä½“åˆ†æå¦‚ä¸‹ï¼šæœ€ç†æƒ³çŠ¶æ€ä¸‹ï¼Œå°±æ˜¯count&lt;nï¼Œè¿™æ—¶valç›´æ¥æ’å…¥ï¼Œæœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼›æœ€åçš„æƒ…å†µï¼Œæ˜¯count=nï¼Œéœ€è¦å…ˆåšä¸€æ¬¡æ•°ç»„çš„éå†æ±‚å’Œï¼Œç„¶åå†å°†æ•°æ®æ’å…¥ï¼Œæ‰€ä»¥æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚å¹³å‡æƒ…å†µå¤æ‚åº¦åˆ™æ˜¯O(1)ã€‚å› ä¸ºåœ¨count&lt;nï¼Œå…±nç§æƒ…å†µï¼Œæ¯ç§æƒ…å†µçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ï¼›æœ€åæƒ…å†µåªæœ‰ä¸€ç§ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œæ‰€ä»¥å¹³å‡æ—¶é—´å¤æ‚åº¦å°±æ˜¯ï¼š é’ˆå¯¹å‡æ‘Šæ—¶é—´å¤æ‚åº¦çš„ç‰¹æ®Šæ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ‘Šè¿˜åˆ†ææ³•æ¥åˆ†æã€‚å°±æ‹¿åˆšåˆšçš„ä¾‹å­æ¥è¯´ï¼Œæ¯ä¸€æ¬¡O(n)çš„æ’å…¥æ“ä½œï¼Œéƒ½ä¼šè·Ÿç€n-1æ¬¡O(1)çš„æ’å…¥æ“ä½œï¼Œæ‰€ä»¥æŠŠè€—æ—¶å¤šçš„é‚£æ¬¡æ“ä½œå‡æ‘Šåˆ°æ¥ä¸‹æ¥çš„n-1æ¬¡è€—æ—¶å°‘çš„æ“ä½œä¸Šï¼Œé‚£ä¹ˆè¿™ä¸€ç»„è¿ç»­çš„æ“ä½œçš„å‡æ‘Šæ—¶é—´å¤æ‚åº¦å°±æ˜¯O(1)ã€‚ æ€»è€Œè¨€ä¹‹ï¼Œå¯¹ä¸€ä¸ªæ•°æ®ç»“æ„è¿›è¡Œä¸€ç»„è¿ç»­æ“ä½œä¸­ï¼Œå¤§éƒ¨åˆ†æ—¶é—´å¤æ‚åº¦éƒ½å¾ˆä½ï¼Œåªæœ‰ä¸ªåˆ«æƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦æ¯”è¾ƒé«˜ï¼Œè€Œä¸”è¿™äº›æ“ä½œä¹‹é—´å­˜åœ¨å‰åè¿è´¯çš„æ—¶åºå…³ç³»ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†è¿™ä¸€ç»„æ“ä½œæ”¾åœ¨ä¸€å—å„¿åˆ†æï¼Œçœ‹æ˜¯å¦èƒ½å°†è¾ƒé«˜æ—¶é—´å¤æ‚åº¦é‚£äº›æ“ä½œçš„è€—æ—¶ï¼Œå¹³æ‘Šåˆ°å…¶ä»–é‚£äº›æ—¶é—´å¤æ‚åº¦æ¯”è¾ƒä½çš„æ“ä½œä¸Šã€‚è€Œä¸”ï¼Œåœ¨èƒ½å¤Ÿåº”ç”¨å‡æ‘Šæ—¶é—´å¤æ‚åº¦åˆ†æçš„åœºåˆï¼Œä¸€èˆ¬å‡æ‘Šæ—¶é—´å°±ç­‰äºæœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦ã€‚]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„ä¸ç®—æ³•</category>
      </categories>
      <tags>
        <tag>æ—¶é—´å¤æ‚åº¦</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CentOS7ä¸‹mysqlå®‰è£…å’Œé“¾æ¥]]></title>
    <url>%2Famberwest.github.io%2F2018%2F09%2F25%2Fcentos7%E4%B8%8Bmysql%E5%AE%89%E8%A3%85%E5%92%8C%E9%93%BE%E6%8E%A5%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘å¼„äº†ä¸ªè™šæ‹Ÿæœºç©ä¸€ç©ï¼Œè·Ÿç€è§†é¢‘æ•™ç¨‹å®‰è£…mysqlï¼Œç»“æœé‡åˆ°äº†è›®å¤šé—®é¢˜çš„ã€‚ å®‰è£…centOS7ï¼ˆç•¥è¿‡ï¼‰ç”¨çš„æ˜¯VirtualBoxï¼Œå…·ä½“è¿‡ç¨‹ä»¥åå†æ•´ç† åˆ é™¤åŸæœ‰æ•°æ®åº“å› ä¸ºCentOS7é»˜è®¤æ˜¯å®‰è£…äº†mariadbæ•°æ®åº“ï¼Œæ‰€ä»¥éœ€è¦å…ˆåˆ é™¤å†å®‰è£…mysqlã€‚ å¯åŠ¨è™šæ‹Ÿæœºï¼Œç™»å½• 1ssh test@192.168.0.108 # testæ˜¯ç”¨æˆ·å åˆ é™¤mariadb 12yum search mariadb # æœç´¢mariadbï¼Œå¾—åˆ°å…·ä½“æ•°æ®åº“ç‰ˆæœ¬ï¼Œå¦‚mariadb-libs.x86_64sudo yum remove mariadb-libs.x86_64 æ¸…é™¤åŸæœ‰mysqlç‰ˆæœ¬ 12rpm -qa|grep mysqlsudo yum remove xxxx # xxxxæ˜¯æœç´¢ç»“æœä¸­çš„æ•°æ®åº“ç‰ˆæœ¬ï¼Œä¾æ¬¡åˆ é™¤ åˆ é™¤mysqlé…ç½®æ–‡ä»¶ 12find / -name mysql sudo rm -rf xxxx # xxxxæ˜¯å¯¹åº”çš„é…ç½®æ–‡ä»¶ å®‰è£…mysql ä¸‹è½½mysqlæº æ‰¾åˆ°mysqlä¸‹è½½é“¾æ¥ï¼Œé€‰æ‹©å¯¹åº”çš„mysqlç‰ˆæœ¬åç‚¹å‡»â€˜downloadâ€™ï¼Œè¿›å…¥æ–°çš„é¡µé¢ï¼Œå³é”®å¤åˆ¶ä¸‹è½½é“¾æ¥ 12cd /tmpwget https://dev.mysql.com/get/mysql80-community-release-fc28-1.noarch.rpm å®‰è£…æº 1sudo yum localinstall mysql80-community-release-fc28-1.noarch.rpm æœç´¢ã€å®‰è£…mysql 12yum search mysql sudo yum install mysql-community-server # æ ¹æ®æœç´¢ç»“æœè¿›è¡Œå®‰è£… å®‰è£…å®Œæˆä¹‹åï¼ŒæŸ¥çœ‹æœåŠ¡æ˜¯å¦å¯åŠ¨ 123ps -ef | grep mysql# mysqlæœåŠ¡æ“ä½œç›¸å…³å‘½ä»¤sudo service mysqld restart/start/stop è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç”Ÿæˆä¸´æ—¶å¯†ç  ä¸´æ—¶å¯†ç æ˜¯..for root@localhost:åé¢éƒ¨åˆ† 1cat /var/log/mysqld.log | grep password ç™»å½•mysql 1mysql -uroot -pabc # abcæ˜¯åˆšåˆšç”Ÿæˆçš„ä¸´æ—¶å¯†ç  ä¿®æ”¹å¯†ç  MySQL8.0çš„å¯†ç è§„èŒƒå¾ˆä¸¥æ ¼ï¼Œéœ€è¦ç”±æ•°å­—ã€å¤§å°å†™å­—æ¯å’Œç‰¹æ®Šç¬¦å·ç»„æˆçš„å…«ä½é•¿åº¦ï¼Œæ‰€ä»¥æ²¡åŠæ³•è®¾ç½®ç±»ä¼¼123456è¿™æ ·ç®€å•çš„å¯†ç ã€‚å¯ä»¥é€šè¿‡è°ƒæ•´å¯†ç éªŒè¯è§„åˆ™ï¼Œä¿®æ”¹policyå’Œlengthçš„å€¼ã€‚ä¸è¿‡éœ€è¦å…ˆè®¾ç½®ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å¯†ç å†ä¿®æ”¹å¯†ç éªŒè¯è§„åˆ™ã€‚ 1234mysql&gt; set global validate_password.policy=0;mysql&gt; set global validate_password.length=1;mysql&gt; flush privileges; # æ›´æ–°ï¼Œéœ€è¦å…ˆè®¾ç½®ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å¯†ç æ‰èƒ½æ‰§è¡Œè¯¥è¯­å¥mysql&gt; alter user 'root'@'localhost' identified by '123456'; ä¿®æ”¹å¯†ç ä¹‹åï¼Œè¦é‡æ–°ç™»å½•éªŒè¯ æˆæƒmysqlè¿œç¨‹é“¾æ¥ è®¾ç½®æ•°æ®åº“hostä¸º% ç”µè„‘ä¸Šç”¨çš„mysqlå®¢æˆ·ç«¯æ˜¯navicatï¼Œå¦‚ä¸‹å›¾å¡«å†™é“¾æ¥ä¿¡æ¯ã€‚ é“¾æ¥å¾ˆå¯èƒ½ä¼šå¤±è´¥äº†ï¼Œå› ä¸ºå½“å‰ç”¨æˆ·çš„hostæ˜¯localhostï¼Œä¹Ÿå°±æ˜¯åªèƒ½æœ¬æœºé“¾æ¥ï¼Œéœ€è¦ä¿®æ”¹ä¸ºâ€™%â€™ 1234567# æŸ¥çœ‹ç”¨æˆ·ï¼Œmysqlåº“ä¸­çš„userè¡¨mysql&gt; use mysql;mysql&gt; select Host, User from user \G;# ä¿®æ”¹ç”¨æˆ·hostmysql&gt; update user set host = '%' where Host = 'localhost' and User = 'root';# åˆ·æ–°æƒé™mysql&gt; flush privileges; ä¿®æ”¹mysqlçš„plugin 12345# æŸ¥çœ‹mysql&gt; select host, user, plugin, authentication_string from mysql.user \G;# ä¿®æ”¹mysql&gt; alter user 'root'@'%' identified with mysql_native_password by '123' # 123æ˜¯é‡æ–°è®¾ç½®ä¹‹åçš„å¯†ç mysql&gt; flush privileges; è®¾ç½®ä¹‹åå†è¿›è¡Œé“¾æ¥æµ‹è¯• æŸ¥çœ‹é˜²ç«å¢™ä¹‹ç±»çš„çš„è®¾ç½® å¦‚æœä¸Šé¢è®¾ç½®ä¹‹åè¿˜æ˜¯é“¾æ¥ä¸åˆ°æœ¬åœ°æ•°æ®åº“ï¼Œå¾ˆå¯èƒ½æ˜¯å› ä¸ºè®¾ç½®äº†é˜²ç«å¢™ã€‚ 12# å…³é—­é˜²ç«å¢™sudo service firewalld stop å¼€å¯genelogè¿›å…¥msyqlï¼Œè®¾ç½®å¼€å¯æ—¥å¿—ï¼Œæ–¹ä¾¿è°ƒè¯• 123mysql&gt; set global general_log_file = '/tmp/general.log'mysql&gt; set global general_log=on;mysql&gt; set global generall_log=off; # å…³é—­æ—¥å¿— å®æ—¶æŸ¥çœ‹æ—¥å¿— 1tail -f /tmp/generall.log # generalallçš„è·¯å¾„ æ–°å»ºç”¨æˆ·ç»™æ–°ç”¨æˆ·è®¾ç½®æƒé™çš„è¯­æ³•ä¹Ÿè·Ÿmysql5.7æœ‰æ‰€ä¸åŒäº† 12mysql&gt; create user 'username'@'%' identified by 'password'mysql&gt; GRANT ALL PRIVILEGES ON *.* TO 'username'@'%' WITH GRANT OPTION; å¿˜è®°å¯†ç æ€ä¹ˆåŠå¦‚æœçœŸçš„å¿˜è®°å¯†ç ï¼Œå¯ä»¥ä¿®æ”¹mysqlçš„é…ç½®æ–‡ä»¶ï¼Œä½¿å¾—mysqlä¸éœ€è¦éªŒè¯ç™»å½•ã€‚è¿™æ ·æ“ä½œå…¶å®æ˜¯å¾ˆå±é™©çš„ï¼Œæ‰€ä»¥ä¿®æ”¹å®Œå¯†ç ä¹‹ååº”è¯¥å°½å¿«å°†é…ç½®æ–‡ä»¶æ¢å¤ 123sudo vim /etc/my.conf# æ–‡ä»¶æœ€ååŠ ä¸Šè¿™æ ·çš„ä¸€å¥è¯skip-grant-tables é‡æ–°å¯åŠ¨æœåŠ¡å°±å¯ä»¥å…å¯†ç™»å½•msyql 12sudo service mysqld startmysql -uroot -p ä¿®æ”¹å¯†ç  123mysql&gt; select mysql;mysql&gt; update user set authentication_string=password('1234567') where user='root';mysql&gt; flush privileges; å–æ¶ˆå¯¹my.confæ–‡ä»¶çš„ä¿®æ”¹ å‚è€ƒæ–‡ç« cnetos7å®‰è£… how to grant all privileges to root user in MySQL8.0 è§£å†³MySQL8.0æŠ¥é”™ï¼šUnknown system variable â€˜validate_password_policyâ€™]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>centos</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€è½¬ã€‘SQLAlchemy ORM Tutorial for Python Developers]]></title>
    <url>%2Famberwest.github.io%2F2018%2F09%2F19%2F%E8%BD%AC-SQLAlchemy-ORM-Tutorial-for-Python-Developers%2F</url>
    <content type="text"><![CDATA[åŸæ–‡é“¾æ¥ åˆšå¼€å§‹æ¥è§¦sqlalchemyï¼Œä»¥ä¸ºå¾ˆæ–¹ä¾¿å¾ˆå¥½ç”¨ï¼Œç»“æœåœ¨å„ç§å…³ç³»ä¸­è¢«æ‰“å‡»åˆ°ä¸è¡Œã€‚æ— æ„é—´åœ¨ç½‘ä¸Šçœ‹åˆ°è¿™ç¯‡æ–‡ç« ï¼Œå†™å¾—æŒºé€šä¿—æ˜“æ‡‚çš„ï¼Œè¿˜æœ‰ä¸ªå°ä¾‹å­ï¼Œè‰¯å¿ƒæ•™ç¨‹å•Šï¼å¿ä¸ä½è½¬è½½åˆ°è‡ªå·±çš„ç¬”è®°ä¸­ï¼Œæœ‰æ—¶é—´å†ç”¨è‡ªå·±æ¸£æ¸£çš„è‹±è¯­ç®€å•ç¿»è¯‘ä¸€ä¸‹ï¼Œæ–¹ä¾¿æŸ¥é˜…ã€‚ In this article, we will learn how to use SQLAlchemy as the ORM (Object Relational Database) library to communicate with relational database engines. First, we will learn about some core concepts of SQLAlchemy (like engines and connection pools), then we will learn how to map Python classes and its relationships to database tables, and finally we will learn how to retrieve (query) data from these tables. The code snippets used in this article can be found in this GitHub repository. SQLAlchemy IntroductionSQLAlchemy is a library that facilitates the communication between Python programs and databases. Most of the times, this library is used as an Object Relational Mapper (ORM) tool that translates Python classes to tables on relational databases and automatically converts function calls to SQL statements. SQLAlchemy provides a standard interface that allows developers to create database-agnostic code to communicate with a wide variety of database engines. As we will see in this article, SQLAlchemy relies on common design patterns (like Object Pools) to allow developers to create and ship enterprise-grade, production-ready applications easily. Besides that, with SQLAlchemy, boilerplate code to handle tasks like database connections is abstracted away to let developers focus on business logic. Before diving into the ORM features provided by SQLAlchemy, we need to learn how the core works. The following sections will introduce important concepts that every Python developer needs to understand before dealing with SQLAlchemy applications. Python DBAPIThe Python DBAPI (an acronym for DataBase API) was created to specify how Python modules that integrate with databases should expose their interfaces. Although we wonâ€™t interact with this API directlyâ€”we will use SQLAlchemy as a facade to itâ€”itâ€™s good to know that it defines how common functions like connect, close, commit, and rollback must behave. Consequently, whenever we use a Python module that adheres to the specification, we can rest assured that we will find these functions and that they will behave as expected. In this article, we are going to install and use the most popular PostgreSQL DBAPI implementation available: psycopg. Other Python drivers communicate with PostgreSQL as well, but psycopg is the best candidate since it fully implements the DBAPI specification and has great support from the community. To better understand the DBAPI specification, what functions it requires, and how these functions behave, take a look into the Python Enhancement Proposal that introduced it. Also, to learn about what other database engines we can use (like MySQL or Oracle), take a look at the official list of database interfaces available. SQLAlchemy EnginesWhenever we want to use SQLAlchemy to interact with a database, we need to create an Engine. Engines, on SQLAlchemy, are used to manage two crucial factors: Pools and Dialects. The following two sections will explain what these two concepts are, but for now it suffices to say that SQLAlchemy uses them to interact with DBAPI functions. ä»»ä½•æ—¶å€™ï¼Œåªè¦æˆ‘ä»¬æƒ³ç”¨SQLAlchemyå»è¿æ¥æ•°æ®åº“ï¼Œéƒ½å¿…é¡»å…ˆåˆ›å»ºengineã€‚åœ¨SQLAlchemyä¸­ï¼Œengineæ˜¯ç”¨æ¥ç®¡ç†ä¸¤å¤§é‡è¦éƒ¨åˆ†ï¼šPoolså’ŒDialectsã€‚æ¥ä¸‹æ¥ä¸¤å°èŠ‚å°†ä¼šè§£é‡Šè¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œç°åœ¨åªè¦æ˜ç™½SQLAlchemyæ˜¯ç”¨ä»–ä»¬è·ŸDBAPIäº¤äº’çš„å‡½æ•°å°±å¤Ÿäº†ã€‚ To create an engine and start interacting with databases, we have to import the create_engine function from the sqlalchemy library and issue a call to it: ä¸ºäº†åˆ›å»ºengineå¹¶ä¸æ•°æ®åº“äº¤äº’ï¼Œæˆ‘ä»¬å¿…é¡»ä»sqlalchemyåº“ä¸­å¯¼å…¥create_engineå¹¶ä¸”è°ƒç”¨è¯¥æ–¹æ³•ã€‚ 12from sqlalchemy import create_engineengine = create_engine('postgresql://usr:pass@localhost:5432/sqlalchemy') This example creates a PostgreSQL engine to communicate with an instance running locally on port 5432 (the default one). It also defines that it will use usr and pass as the credentials to interact with the sqlalchemy database. Note that, creating an engine does not connect to the database instantly. This process is postponed to when itâ€™s needed (like when we submit a query, or when create/update a row in a table). è¿™ä¸ªä¾‹å­åœ¨æœ¬åœ°5432ï¼ˆé»˜è®¤ç«¯å£ï¼‰ç«¯å£åˆ›å»ºäº†ä¸€ä¸ªPostgreSQL engineã€‚åŒæ—¶ä¹Ÿå®šä¹‰äº†è¯¥engieä¼šä½¿ç”¨usrå’Œpassä½œä¸ºä¸sqlalchemyæ•°æ®åº“é“¾æ¥çš„å‡­è¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ›å»ºäº†engineå¹¶ä¸ä¼šé©¬ä¸Šè¿æ¥åˆ°æ•°æ®åº“ï¼Œè€Œæ˜¯ç›´åˆ°æˆ‘ä»¬éœ€è¦çš„æ—¶å€™æ‰è¿æ¥ã€‚ï¼ˆæ¯”å¦‚ï¼Œå½“æˆ‘ä»¬æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œæˆ–è€…æ’å…¥/æ›´æ–°è¡¨è®°å½•ï¼‰ã€‚ Since SQLAlchemy relies on the DBAPI specification to interact with databases, the most common database management systems available are supported. PostgreSQL, MySQL, Oracle, Microsoft SQL Server, and SQLite are all examples of engines that we can use alongside with SQLAlchemy. To learn more about the options available to create SQLAlchemy engines, take a look at the official documentation. sqlalchemyæ‰€æ”¯æŒçš„ä¸€äº›å¸¸è§æ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€‚ SQLAlchemy Connection PoolsConnection pooling is one of the most traditional implementations of the object pool pattern. Object pools are used as caches of pre-initialized objects ready to use. That is, instead of spending time to create objects that are frequently needed (like connections to databases) the program fetches an existing object from the pool, uses it as desired, and puts back when done. é“¾æ¥æ± æ˜¯object pool patternæœ€ä¼ ç»Ÿçš„å®è·µã€‚å¯¹è±¡æ± è¢«ç”¨ä½œé¢„åˆå§‹åŒ–å¯¹è±¡å‡†å¤‡ä½¿ç”¨æ—¶çš„ç¼“å­˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¨‹åºåœ¨éœ€è¦çš„æ—¶å€™ç›´æ¥ä»æ± ä¸­è·å–ä¸€ä¸ªå·²å­˜åœ¨çš„å¯¹è±¡ï¼Œç”¨å®Œå†æ”¾å›å»ï¼Œè€Œä¸æ˜¯éœ€è¦é“¾æ¥æ—¶å†èŠ±æ—¶é—´å»åˆ›å»ºå¯¹è±¡ï¼ˆæ¯”å¦‚é“¾æ¥åˆ°æ•°æ®åº“ï¼‰ã€‚ The main reason why programs take advantage of this design pattern is to improve performance. In the case of database connections, opening and maintaining new ones is expensive, time-consuming, and wastes resources. Besides that, this pattern allows easier management of the number of connections that an application might use simultaneously. ç¨‹åºè¿™ä¹ˆè®¾è®¡ä¸»è¦æ˜¯ä¸ºäº†æé«˜æ€§èƒ½ã€‚åœ¨æ•°æ®åº“é“¾æ¥çš„ä¾‹å­ä¸­ï¼Œåˆ›å»ºå¹¶ç»´æŒæ–°çš„å¯¹è±¡æˆæœ¬å¾ˆé«˜ï¼Œè€—æ—¶ä¹Ÿæµªè´¹èµ„æºã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿™ä¸ªè®¾è®¡æ¨¡å¼èƒ½å¤Ÿæ›´å¥½åœ°æ§åˆ¶åº”ç”¨åœ¨åŒä¸€æ—¶é—´èƒ½å¤Ÿä½¿ç”¨çš„é“¾æ¥æ•°ã€‚ There are various implementations of the connection pool pattern available on SQLAlchemy . For example, creating an Engine through the create_engine()function usually generates a QueuePool. This kind of pool comes configured with some reasonable defaults, like a maximum pool size of 5 connections. sqlalchemyçš„é“¾æ¥æ± æ¨¡å¼è¿˜æœ‰å¾ˆå¤šå¯ç”¨çš„å®è·µã€‚æ¯”å¦‚ï¼Œé€šè¿‡create_engine()æ–¹æ³•åˆ›å»ºçš„engineé€šå¸¸ä¼šç”Ÿæˆä¸€ä¸ªQueuePoolã€‚è¿™ç±»æ± ä¼šæœ‰é»˜è®¤çš„è®¾ç½®ï¼Œæ¯”å¦‚æœ€å¤§é“¾æ¥æ± æ•°ä¸º5. As usual production-ready programs need to override these defaults (to fine-tune pools to their needs), most of the different implementations of connection pools provide a similar set of configuration options. The following list shows the most common options with their descriptions: ä¸€èˆ¬æ¥è¯´ï¼Œä¸Šçº¿ç¨‹åºéœ€è¦é‡å†™é»˜è®¤é…ç½®ï¼ˆå¾®è°ƒå·²è‡³ç¬¦åˆéœ€æ±‚ï¼‰ï¼Œå¤§éƒ¨åˆ†é“¾æ¥æ± çš„ä¸åŒå®ç°éƒ½æä¾›äº†ä¸€ç³»åˆ—ç±»ä¼¼çš„è®¾ç½®é€‰é¡¹(???)ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§é€‰é¡¹åŠå…¶æè¿°ï¼š pool_size: Sets the number of connections that the pool will handle.è®¾ç½®æœ€å¤§é“¾æ¥æ± æ•° max_overflow: Specifies how many exceeding connections (relative to pool_size) the pool supports.æŒ‡å®šé“¾æ¥æ± æ”¯æŒçš„è¶…å‡ºè¿æ¥æ•°ï¼ˆç›¸å¯¹äºpool_sizeï¼‰ pool_recycle: Configures the maximum age (in seconds) of connections in the pool.è®¾ç½®é“¾æ¥æ± ä¸­æœ€é•¿é“¾æ¥æ—¶é—´ï¼ˆç§’ï¼‰ pool_timeout: Identifies how many seconds the program will wait before giving up on getting a connection from the pool.æ ‡æ³¨ç¨‹åºåœ¨æ”¾å¼ƒä»æ± ä¸­è·å–é“¾æ¥æ‰€ç­‰å¾…çš„ç§’æ•° To learn more about connection pools on SQLAlchemy, check out the official documentation. SQLAlchemy DialectsAs SQLAlchemy is a facade that enables Python developers to create applications that communicate to different database engines through the same API, we need to make use of Dialects. Most of the popular relational databases available out there adhere to the SQL (Structured Query Language) standard, but they also introduce proprietary variations. These variations are the solely responsible for the existence of dialects. å› ä¸ºSQLAlchemyèƒ½å¤Ÿè®©pythonå¼€å‘è€…å¼€å‘å‡ºé€šè¿‡åŒæ ·çš„APIè¿æ¥åˆ°ä¸åŒçš„æ•°æ®åº“å¼•æ“çš„åº”ç”¨ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Dialectsã€‚ç›®å‰ä¸»æµçš„å…³ç³»æ•°æ®åº“éƒ½éµå¾ªSQLï¼ˆç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼‰æ ‡å‡†ï¼Œä½†ä¹Ÿæœ‰å„è‡ªçš„å˜åŒ–ã€‚è¿™äº›å˜åŒ–æ˜¯dialectså­˜åœ¨çš„åŸå› ï¼ˆdialectsï¼Ÿï¼Ÿï¼‰ For example, letâ€™s say that we want to fetch the first ten rows of a table called people. If our data was being held by a Microsoft SQL Server database engine, SQLAlchemy would need to issue the following query: ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³è¦è·å–peopleè¡¨çš„å‰åè¡Œã€‚å¦‚æœæˆ‘ä»¬çš„æ•°æ®æ˜¯ä¿å­˜åœ¨Microsoft SQL Serveræ•°æ®åº“å¼•æ“ï¼Œsqlalchemyéœ€è¦ä½œå‡ºä»¥ä¸‹æŸ¥è¯¢ï¼š 1SELECT TOP 10 * FROM people; But, if our data was persisted on MySQL instance, then SQLAlchemy would need to issue: ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çš„æ•°æ®æŒä¹…åŒ–ä¸ºMySQLå®ä¾‹ï¼Œé‚£ä¹ˆSQLAlchemyåˆ™éœ€è¦è¿™æ ·å†™ï¼š 1SELECT * FROM people LIMIT 10; Therefore, to know precisely what query to issue, SQLAlchemy needs to be aware of the type of the database that it is dealing with. This is exactly what Dialects do. They make SQLAlchemy aware of the dialect it needs to talk. å› æ­¤ï¼Œä¸ºäº†å‡†ç¡®çŸ¥é“è¦åšå‡ºä½•ç§æŸ¥è¯¢ï¼ŒSQLAlchemyéœ€è¦çŸ¥é“å®ƒæ­£åœ¨å¤„ç†çš„æ•°æ®åº“ç±»å‹ã€‚è¿™å°±æ˜¯dialectsæ‰€åšçš„ã€‚ On its core, SQLAlchemy includes the following list of dialects: Firebird Microsoft SQL Server MySQL Oracle PostgreSQL SQLite Sybase Dialects for other database engines, like Amazon Redshift, are supported as external projects but can be easily installed. Check out the official documentation on SQLAlchemy Dialects to learn more. SQLAlchemy ORMORM, which stands for Object Relational Mapper, is the specialization of the Data Mapper design pattern that addresses relational databases like MySQL, Oracle, and PostgreSQL. As explained by Martin Fowler in the article, Mappersare responsible for moving data between objects and a database while keeping them independent of each other. As object-oriented programming languages and relational databases structure data on different ways, we need specific code to translate from one schema to the other. ORMï¼Œä¹Ÿå°±æ˜¯å…³ç³»å¯¹è±¡æ˜ å°„ï¼Œæ˜¯å…³ç³»æ•°æ®åº“å¦‚MYSQLï¼ŒOracleç­‰çš„æ•°æ®æ˜ å°„è®¾è®¡æ¨¡å¼çš„ä¸“ä¸šåŒ–ã€‚æ­£å¦‚Martin Fowleråœ¨æ–‡ç« ä¸­æ‰€è§£é‡Šçš„é‚£æ ·ï¼ŒMappersï¼ˆæ˜ å°„å™¨ï¼Ÿï¼‰è´Ÿè´£åœ¨å¯¹è±¡å’Œæ•°æ®åº“ä¹‹é—´ç§»åŠ¨æ•°æ®ï¼ŒåŒæ—¶ä¿è¯å®ƒä»¬å½¼æ­¤ç‹¬ç«‹ã€‚å¯¹äºé¢å¯¹å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€å’Œå…³ç³»æ•°æ®åº“ä»¥ä¸åŒçš„æ–¹å¼æ„é€ æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ç‰¹å®šçš„ä»£ç å°†ä¸€ä¸ªæ¨¡å¼è½¬æ¢åˆ°å¦ä¸€ä¸ªæ¨¡å¼ã€‚ For example, in a programming language like Python, we can create a Productclass and an Order class to relate as many instances as needed from one class to another (i.e. Product can contain a list of instances of Order and vice-versa). Though, on relational databases, we need three entities (tables), one to persist products, another one to persist orders, and a third one to relate (through foreign key) products and orders. ä¾‹å¦‚ï¼Œåœ¨åƒpythonè¿™æ ·çš„ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªProductç±»å’Œä¸€ä¸ªOrderç±»ï¼Œä»¥ä¾¿æ ¹æ®éœ€è¦å°†ä¸€ä¸ªç±»ä¸å¦ä¸€ä¸ªç±»ç›¸å…³è”ï¼ˆå³Productå¯ä»¥åŒ…å«Orderå®ä¾‹åˆ—è¡¨ï¼Œåä¹‹äº¦ç„¶ï¼‰ã€‚ç„¶è€Œï¼Œåœ¨å…³ç³»æ•°æ®åº“ï¼Œæˆ‘ä»¬éœ€è¦ä¸‰ä¸ªå®ä½“ï¼ˆè¡¨ï¼‰ï¼Œä¸€ä¸ªä¿å­˜productsï¼Œå¦ä¸€ä¸ªä¿å­˜ordersï¼Œç¬¬ä¸‰ä¸ªé“¾æ¥ï¼ˆé€šè¿‡å¤–é”®ï¼‰productså’Œordersã€‚ As we will see in the following sections, SQLAlchemy ORM is an excellent Data Mapper solution to translate Python classes into/from tables and to move data between instances of these classes and rows of these tables. åœ¨æ¥ä¸‹é‡Œçš„ç« èŠ‚é‡Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°ï¼ŒSQLAlchemyæ˜¯ä¸€ä¸ªå¾ˆèµçš„æ•°æ®æ˜ å°„è§£å†³æ–¹æ³•ï¼Œå—¯ï¼Œç¿»ä¸ä¸‹å»äº†ã€‚ã€‚ã€‚ SQLAlchemy Data TypesWhile using SQLAlchemy, we can rest assured that we will get support for the most common data types found in relational databases. For example, booleans, dates, times, strings, and numeric values are a just a subset of the types that SQLAlchemy provides abstractions for. Besides these basic types, SQLAlchemy includes support for a few vendor-specific types (like JSON) and also allows developers to create custom types and redefine existing ones. To understand how we use SQLAlchemy data types to map properties of Python classes into columns on a relation database table, letâ€™s analyze the following example: ä¸ºäº†ç†è§£æˆ‘ä»¬æ˜¯å¦‚ä½•ä½¿ç”¨SQLAlchemyæ•°æ®ç±»å‹å»æ˜ å°„pythonç±»å±æ€§åˆ°å…³ç³»æ•°æ®åº“è¡¨çš„åˆ—çš„ï¼Œè®©æˆ‘ä»¬æ¥åˆ†æä¸‹é¢è¿™ä¸ªä¾‹å­å§ï¼š 1234567class Product(Base): __tablename__ = 'products' id=Column(Integer, primary_key=True) title=Column('title', String(32)) in_stock=Column('in_stock', Boolean) quantity=Column('quantity', Integer) price=Column('price', Numeric) In the code snippet above, we are defining a class called Product that has six properties. Letâ€™s take a look at what these properties do: åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¸¦æœ‰6ä¸ªå±æ€§çš„Productç±»ã€‚æ¥ä¸‹æ¥çœ‹ä¸‹è¿™äº›å±æ€§éƒ½æœ‰ä»€ä¹ˆä½œç”¨ï¼š The __tablename__ property tells SQLAlchemy that rows of the productstable must be mapped to this class. __tablename__å±æ€§å‘Šè¯‰SQLAlchemy productsè¡¨çš„è¡Œéƒ½å¿…é¡»æ˜ å°„åˆ°è¿™ä¸ªç±»ã€‚ The id property identifies that this is the primary_key in the table and that its type is Integer. id å±æ€§æ˜¯è¡¨çš„primary_keyï¼Œç±»å‹ä¸ºIntegerã€‚ The title property indicates that a column in the table has the same name of the property and that its type is String. titleå±æ€§æŒ‡ç¤ºè¡¨ä¸­æœ‰ä¸€ä¸ªä¸è¯¥å±æ€§ï¼ˆtitleï¼‰åŒåçš„åˆ—ï¼Œåˆ—çš„ç±»å‹æ˜¯ Stringã€‚ The in_stock property indicates that a column in the table has the same name of the property and that its type is Boolean. in_stock å±æ€§è¯´æ˜è¡¨ä¸­ä¹Ÿæœ‰åŒåçš„åˆ—ï¼Œåˆ—çš„ç±»å‹ä¸º Boolean The quantity property indicates that a column in the table has the same name of the property and that its type is Integer. The price property indicates that a column in the table has the same name of the property and that its type is Numeric. Seasoned developers will notice that (usually) relational databases do not have data types with these exact names. SQLAlchemy uses these types as generic representations to what databases support and use the dialect configured to understand what types they translate to. For example, on a PostgreSQL database, the title would be mapped to a varchar column. ç»éªŒä¸°å¯Œçš„å¼€å‘è€…é€šå¸¸ä¼šæ³¨æ„åˆ°å…³ç³»å‹æ•°æ®åº“ä¸ä¼šæœ‰è¿™äº›ç¡®åˆ‡åç§°çš„æ•°æ®ç±»å‹ã€‚SQLAlchemyä½¿ç”¨è¿™äº›ç±»å‹ä½œä¸ºé€šç”¨è¡¨ç¤ºå½¢å¼ï¼Œä»¥æ”¯æŒå’Œä½¿ç”¨é…ç½®çš„æ–¹è¨€æ¥ç†è§£å®ƒä»¬è½¬æ¢ä¸ºçš„ç±»å‹ã€‚æ¯”å¦‚åœ¨PostgreSQLæ•°æ®åº“é‡Œï¼Œtitleå°†ä¼šè¢«æ˜ å°„ä¸ºvarcharåˆ—ã€‚ SQLAlchemy Relationship PatternsNow that we know what ORM is and have look into data types, letâ€™s learn how to use SQLAlchemy to map relationships between classes to relationships between tables. SQLAlchemy supports four types of relationships: One To Many, Many To One, One To One, and Many To Many. ç°åœ¨æˆ‘ä»¬äº†è§£åˆ°ä»€ä¹ˆæ˜¯ORMå’Œå„ç§æ•°æ®ç±»å‹ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬å­¦ä¹ æ€ä¹ˆä½¿ç”¨SQLAlchemyå°†ç±»ä¸­çš„å…³ç³»æ˜ å°„åˆ°è¡¨ä¹‹é—´çš„å…³ç³»ã€‚SQLAlchemyæ”¯æŒå››ç§å…³ç³»ï¼šä¸€å¯¹å¤šï¼Œå¤šå¯¹ä¸€ï¼Œä¸€å¯¹ä¸€å’Œå¤šå¯¹å¤šã€‚ Note that this section will be an overview of all these types, but in the SQLAlchemy ORM in Practice action we will do a hands-on to practice mapping classes into tables and to learn how to insert, extract, and remove data from these tables. The first type, One To Many, is used to mark that an instance of a class can be associated with many instances of another class. For example, on a blog engine, an instance of the Article class could be associated with many instances of the Comment class. In this case, we would map the mentioned classes and its relation as follows: ç¬¬ä¸€ç§ï¼Œä¸€å¯¹å¤šï¼Œç”¨æ¥æ ‡æ³¨ä¸€ä¸ªç±»çš„å®ä¾‹èƒ½å¤Ÿä¸å¦ä¸€ä¸ªç±»çš„å¤šä¸ªå®ä¾‹ç›¸å…³è”ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªåšå®¢ä¸Šï¼Œ Articleç±»çš„ä¸€ä¸ªå®ä¾‹å¯ä»¥å¯¹åº”åˆ° Comment ç±»çš„å¤šä¸ªå®ä¾‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åƒä¸‹é¢è¿™æ ·å¯¹åˆšåˆšæåˆ°çš„ç±»å’Œå…³ç³»è¿›è¡Œæ˜ å°„ï¼š 1234567891011class Article(Base): __tablename__ = 'articles' id = Column(Integer, primary_key=True) comments = relationship("Comment")class Comment(Base): __tablename__ = 'comments' id = Column(Integer, primary_key=True) # å¤šçš„ä¸€æ–¹è®¾ç½®äº†å¤–é”® article_id = Column(Integer, ForeignKey('articles.id')) The second type, Many To One, refers to the same relationship described above but from the other perspective. To give a different example, letâ€™s say that we want to map the relationship between instances of Tire to an instance of a Car. As many tires belong to one car and this car contains many tires, we would map this relation as follows: ç¬¬äºŒç§ç±»å‹ï¼Œå¤šå¯¹ä¸€ï¼Œè·Ÿä¸Šé¢æåˆ°çš„å…³ç³»ä¸€æ ·ï¼Œä½†ä»åæ–¹æ¥è¯´ã€‚ä¸¾ä¸ªä¸åŒçš„ä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦æ˜ å°„Tireå¤šä¸ªå®ä¾‹ï¼ˆå¤šä¸ªè½®èƒï¼‰å’Œä¸€ä¸ªCarå®ä¾‹çš„å…³ç³»ã€‚å› ä¸ºå¾ˆå¤šæ¡è½®èƒå±äºåŒä¸€è¾†è½¦å¹¶ä¸”è¿™è¾†è½¦æ‹¥æœ‰å¤šæ¡è½®èƒï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè¿™æ ·æ¥æ˜ å°„ï¼š 1234567891011class Tire(Base): __tablename__ = 'tires' id = Column(Integer, primary_key=True) # è·Ÿä¸€å¯¹å¤šä¸åŒçš„æ˜¯ï¼Œè¿™æ¬¡relationshipä¹Ÿæ˜¯åœ¨å¤šçš„ä¸€æ–¹ï¼Œè·Ÿå¤–é”®ä¸€èµ· car_id = Column(Integer, ForeignKey('cars.id')) car = relationship("Car")class Car(Base): __tablename__ = 'cars' id = Column(Integer, primary_key=True) The third type, One To One, refers to relationships where an instance of a particular class may only be associated with one instance of another class, and vice versa. As an example, consider the relationship between a Person and a MobilePhone. Usually, one person possesses one mobile phone and this mobile phone belongs to this person only. To map this relationship on SQLAlchemy, we would create the following code: ç¬¬ä¸‰ç§ç±»å‹ï¼Œä¸€å¯¹ä¸€æ˜¯æŒ‡ä¸€ä¸ªç‰¹å®šç±»çš„å®ä¾‹åªèƒ½å…³è”åˆ°å¦ä¸€ä¸ªç±»çš„ä¸€ä¸ªå®ä¾‹è¿™æ ·çš„å…³ç³»ï¼Œåä¹‹äº¦ç„¶ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæƒ³è±¡ä¸€ä¸ªäººå’Œä¸€ä¸ªæ‰‹æœºä¹‹é—´çš„å…³ç³»ã€‚é€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ªäººæ‹¥æœ‰ä¸€ä¸ªæ‰‹æœºï¼ŒåŒæ—¶è¿™ä¸ªæ‰‹æœºä¹Ÿåªå±äºè¿™ä¸ªäººã€‚åœ¨SQLAlchemyæ˜ å°„è¿™æ ·çš„å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥æ¥å†™ï¼š 12345678910111213class Person(Base): __tablename__ = 'people' id = Column(Integer, primary_key=True) # back_populatesçš„å€¼æ˜¯å±æ€§çš„å­—ç¬¦ä¸²åç§°ï¼Œå¿…é¡»åœ¨mapperçš„å¦ä¸€ç«¯ä¸­æ˜¾å¼å®šä¹‰ï¼ˆMobilePhoneï¼‰ # uselistä¸ºFalseï¼Œæ ‡é‡ã€‚åœ¨ä¸€å¯¹å¤šå’Œå¤šå¯¹å¤šä¸­ä¸ºTrueï¼Œå¯¹åº”æ˜¯åˆ—è¡¨ï¼ˆforms a listï¼‰ï¼Œåœ¨å¤šå¯¹ä¸€åˆ™æ˜¯scalar mobile_phone = relationship("MobilePhone", uselist=False, back_populates="person")class MobilePhone(Base): __tablename__ = 'mobile_phones' id = Column(Integer, primary_key=True) person_id = Column(Integer, ForeignKey('people.id')) # åŒæ ·çš„ï¼Œback_populates="mobile_phone"ä¸­çš„mobile_phoneä¹Ÿæ˜¯åœ¨Personä¸­å®šä¹‰çš„äº† person = relationship("Person", back_populates="mobile_phone") In this example, we pass two extra parameters to the relationship function. The first one, uselist=False, makes SQLAlchemy understand that mobile_phone will hold only a single instance and not an array (multiple) of instances. The second one, back_populates, instructs SQLAlchemy to populate the other side of the mapping. The official Relationships API documentationprovides a complete explanation of these parameters and also covers other parameters not mentioned here. åœ¨è¿™é‡Œä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼ é€’ä¸¤ä¸ªå‚æ•°ç»™relationshipå‡½æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°uselist=Falseï¼Œå‘ŠçŸ¥SQLAlchemy mobile_phoneåˆ—ä»…åŒ…å«å•ä¸ªå®ä¾‹ï¼Œè€Œä¸æ˜¯å®ä¾‹åˆ—è¡¨ï¼ˆå¤šä¸ªå®ä¾‹ï¼‰ã€‚ç¬¬äºŒä¸ªå‚æ•°ï¼Œ back_populatesï¼ŒæŒ‡ç¤ºSQLAlchemyå¡«å……åˆ°æ˜ å°„çš„å¦ä¸€ç«¯ã€‚official Realtionships API documentationæä¾›äº†è¿™äº›å‚æ•°çš„å®Œæ•´è§£é‡Šï¼Œä¹ŸåŒ…æ‹¬äº†è¿™é‡Œæ²¡æåˆ°çš„å‚æ•°ã€‚ The last type supported by SQLAlchemy, Many To Many, is used when instances of a particular class can have zero or more associations to instances of another class. For example, letâ€™s say that we are mapping the relationship of instances of Student and instances of Class in a system that manages a school. As many students can participate in many classes, we would map the relationship as follows: SQLAlchemyæ‰€æ”¯æŒçš„æœ€åä¸€ç§ç±»å‹ï¼Œå¤šå¯¹å¤šï¼Œè¢«ç”¨åœ¨å½“ä¸€ä¸ªç‰¹å®šç±»çš„å®ä¾‹ï¼ˆå¤šä¸ªï¼‰ä¸å¦ä¸€ä¸ªç±»çš„å®ä¾‹æœ‰é›¶ä¸ªæˆ–è€…å¤šä¸ªè”ç³»çš„æ—¶å€™ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬åœ¨å­¦æ ¡ç®¡ç†ç³»ç»Ÿä¸­æ˜ å°„ Student å®ä¾‹å’Œ Classå®ä¾‹ã€‚å› ä¸ºå¾ˆå¤šå­¦ç”Ÿå¯ä»¥å‚åŠ å¤šä¸ªè¯¾ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·æ˜ å°„ï¼š 1234567891011121314students_classes_association = Table('students_classes', Base.metadata, Column('student_id', Integer, ForeignKey('students.id')), Column('class_id', Integer, ForeignKey('classes.id')))class Student(Base): __tablename__ = 'students' id = Column(Integer, primary_key=True) # ä¸ºä»€ä¹ˆåªåœ¨è¿™è¾¹å†™ classes = relationship("Class", secondary=students_classes_association)class Class(Base): __tablename__ = 'classes' id = Column(Integer, primary_key=True) In this case, we had to create a helper table to persist the association between instances of Student and instances of Class, as this wouldnâ€™t be possible without an extra table. Note that, to make SQLAlchemy aware of the helper table, we passed it in the secondary parameter of the relationship function. åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªä¸­é—´è¡¨æ¥æŒä¹…åŒ–Student å®ä¾‹å’Œ Classå®ä¾‹ä¹‹é—´çš„å…³è”ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰å¦ä¸€å¼ è¡¨æ˜¯æ²¡åŠæ³•å®ç°çš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†è®©SQLAlchemyçŸ¥é“ä¸­é—´è¡¨çš„å­˜åœ¨ï¼Œæˆ‘ä»¬å°†å®ƒä¼ é€’ç»™relationshipå‡½æ•°çš„secondaryå‚æ•°ã€‚ The above code snippets show just a subset of the mapping options supported by SQLAlchemy. In the following sections, we are going to take a more in-depth look into each one of the available relationship patterns. Besides that, the official documentation is a great reference to learn more about relationship patterns on SQLAlchemy. SQLAlchemy ORM CascadeWhenever rows in a particular table are updated or deleted, rows in other tables might need to suffer changes as well. These changes can be simple updates, which are called cascade updates, or full deletes, known as cascade deletes. For example, letâ€™s say that we have a table called shopping_carts, a table called products, and a third one called shopping_carts_products that connects the first two tables. If, for some reason, we need to delete rows from shopping_carts we will need to delete the related rows from shopping_carts_products as well. Otherwise we will end up with a lot of garbage and unfulfilled references in our database. ä»»ä½•æ—¶å€™ï¼ŒæŸä¸ªè¡¨ä¸­çš„è¡Œè¢«æ›´æ–°äº†æˆ–è€…åˆ é™¤ï¼Œå…¶ä»–è¡¨æ ¼ä¸­çš„è¡Œä¹Ÿåº”è¯¥è¦æœ‰ç›¸åº”çš„å˜åŠ¨ã€‚è¿™äº›å˜åŒ–å¯ä»¥æ˜¯ç®€å•çš„æ›´æ–°ï¼Œç§°ä¸ºçº§è”æ›´æ–°ï¼Œä¹Ÿå¯ä»¥æ˜¯å®Œå…¨åˆ é™¤ï¼Œç§°ä¸ºçº§è”åˆ é™¤ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸‰å¼ è¡¨ï¼Œåˆ†åˆ«æ˜¯shopping_cartsè¡¨ã€productsè¡¨å’Œshopping_carts_productsè¡¨ï¼Œç¬¬ä¸‰å¼ è¡¨æ˜¯ç”¨æ¥è¿æ¥å‰ä¸¤å¼ è¡¨çš„ã€‚å¦‚æœï¼Œå› ä¸ºæŸäº›åŸå› ï¼Œæˆ‘ä»¬ä»shopping_cartsè¡¨ä¸­åˆ é™¤ä¸€äº›è¡Œï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦åœ¨shopping_carts_productsè¡¨åˆ é™¤ä¸ä¹‹ç›¸å…³çš„è¡Œã€‚å¦åˆ™ï¼Œæˆ‘ä»¬çš„æ•°æ®åº“å¯èƒ½ä¼šæœ‰å¤§é‡åƒåœ¾æˆ–è€…æœªå®Œæˆçš„å¼•ç”¨ã€‚ To make this kind of operation easy to maintain, SQLAlchemy ORM enables developers to map cascade behavior when using relationship() constructs. Like that, when operations are performed on parent objects, child objects get updated/deleted as well. The following list provides a brief explanation of the most used cascade strategies on SQLAlchemy ORM: ä¸ºäº†è®©è¿™ç±»æ“ä½œæ›´æ˜“ç»´æŠ¤ï¼ŒSQLAlchemy ORMå…è®¸å¼€å‘è€…é€šè¿‡relationship()æ¥æ˜ å°„çº§è”è¡Œä¸ºã€‚è¿™æ ·ä¸€æ¥ï¼Œåœ¨çˆ¶ç±»ä¸Šçš„æ“ä½œç”Ÿæ•ˆåï¼Œå­ç±»ä¹Ÿä¼šè·Ÿç€æ›´æ–°/åˆ é™¤ã€‚ä»¥ä¸‹åˆ—è¡¨ç®€è¦è¯´æ˜äº†SQLAlchemy ORMä¸Šæœ€å¸¸ç”¨çš„çº§è”ç­–ç•¥ï¼š save-update: Indicates that when a parent object is saved/updated, child objects are saved/updated as well. å½“çˆ¶å¯¹è±¡ä¿å­˜/æ›´æ–°æ—¶ï¼Œå­å¯¹è±¡ä¹Ÿä¼šè·Ÿç€ä¿å­˜/æ›´æ–° delete: Indicates that when a parent object is deleted, children of this object will be deleted as well. å½“çˆ¶å¯¹è±¡è¢«åˆ é™¤æ—¶ï¼Œè¯¥å¯¹è±¡çš„åä»£ä¹Ÿä¼šè¢«åˆ é™¤ delete-orphan: Indicates that when a child object loses reference to a parent, it will get deleted. å½“å­å¯¹è±¡å¤±å»å¯¹çˆ¶å¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œå°±ä¼šè¢«åˆ é™¤ merge: Indicates that merge() operations propagate from parent to children. merge()æ“ä½œä»çˆ¶çº§ä¼ æ’­åˆ°å­çº§ If more information about this feature is needed, the SQLAlchemy documentation provides an excellent chapter about Cascades. SQLAlchemy SessionsSessions, on SQLAlchemy ORM, are the implementation of the Unit of Workdesign pattern. As explained by Martin Fowler, a Unit of Work is used to maintain a list of objects affected by a business transaction and to coordinate the writing out of these changes. This means that all modifications tracked by Sessions (Units of Works) will be applied to the underlying database together, or none of them will. In other words, Sessions are used to guarantee the database consistency. The official SQLAlchemy ORM documentation about Sessions gives a great explanation how changes are tracked, how to get sessions, and how to create ad-hoc sessions. However, in this article, we will use the most basic form of session creation: 1234567891011from sqlalchemy import create_enginefrom sqlalchemy.orm import sessionmaker# create an engineengine = create_engine('postgresql://usr:pass@localhost:5432/sqlalchemy')# create a configured "Session" classSession = sessionmaker(bind=engine)# create a Sessionsession = Session() As we can see from the code snippet above, we only need one step to get sessions. We need to create a session factory that is bound to the SQLAlchemy engine. After that, we can just issue calls to this session factory to get our sessions. SQLAlchemy in PracticeNow that we got a better understanding of the most important pieces of SQLAlchemy, itâ€™s time to start practicing it. In the following sections, we will create a small project based on pipenvâ€”a Python dependency managerâ€”and add some classes to it. Then we will map these classes to tables persisted to a PostgreSQL database and learn how to query data. Starting the Tutorial ProjectTo create our tutorial project, we have to have Python installed on our machine and pipenv installed as a global Python package. The following commands will install pipenv and set up the project. These commands are dependent on Python, so be sure to have it installed before proceeding: 1234567891011# install pipenv globallypip install pipenv# create a new directory for our projectmkdir sqlalchemy-tutorial# change working directory to itcd sqlalchemy-tutorial# create a Python 3 projectpipenv --three Running PostgreSQLTo be able to practice our new skills and to learn how to query data on SQLAlchemy, we will need a database to support our examples. As already mentioned, SQLAlchemy provides support for many different databases engines, but the instructions that follow will focus on PostgreSQL. There are many ways to get an instance of PostgreSQL. One of them is to use some cloud provider like Heroku or ElephantSQL (both of them have free tiers). Another possibility is to install PostgreSQL locally on our current environment. A third option is to run a PostgreSQL instance inside a Docker container. The third option is probably the best choice because it has the performance of an instance running locally, itâ€™s free forever, and because itâ€™s easy to create and destroy Docker instances. The only (small) disadvantage is that we need to install Docker locally. After having Docker installed, we can create and destroy dockerized PostgreSQL instances with the following commands: 12345678910111213# create a PostgreSQL instancedocker run --name sqlalchemy-orm-psql \ -e POSTGRES_PASSWORD=pass \ -e POSTGRES_USER=usr \ -e POSTGRES_DB=sqlalchemy \ -p 5432:5432 \ -d postgres# stop instancedocker stop sqlalchemy-orm-psql# destroy instancedocker rm sqlalchemy-orm-psql The first command, the one that creates the PostgreSQL instance, contains a few parameters that are worth inspecting: --name: Defines the name of the Docker instance. -e POSTGRES_PASSWORD: Defines the password to connect to PostgreSQL. -e POSTGRES_USER: Defines the user to connect to PostgreSQL. -e POSTGRES_DB: Defines the main (and only) database available in the PostgreSQL instance. -p 5432:5432: Defines that the local 5432 port will tunnel connections to the same port in the Docker instance. -d postgres: Defines that this Docker instance will be created based on the official PostgreSQL repository. Installing SQLAlchemy DependenciesIn this tutorial, we will need to install only two packages: sqlalchemy and psycopg2. The first dependency refers to SQLAlchemy itself and the second one, psycopg2, is the PostgreSQL driver that SQLAlchemy will use to communicate with the database. To install these dependencies, we will use pipenv as shown: 12# install sqlalchemy and psycopg2pipenv install sqlalchemy psycopg2 This command will download both libraries and make them available in our Python virtual environment. Note that to run the scripts that we are going to create, we first need to spawn the virtual environment shell. That is, before executing python somescript.py, we need to execute pipenv shell. Otherwise, Python wonâ€™t be able to find the installed dependencies, as they are just available in our new virtual environment. Mapping Classes with SQLAlchemyAfter starting the dockerized PostgreSQL instance and installing the Python dependencies, we can begin to map Python classes to database tables. In this tutorial, we will map four simple classes that represent movies, actors, stuntmen, and contact details. The following diagram illustrates these entitiesâ€™ characteristics and their relations. To start, we will create a file called base.py in the main directory of our project and add the following code to it: 12345678910# coding=utf-8from sqlalchemy import create_enginefrom sqlalchemy.ext.declarative import declarative_basefrom sqlalchemy.orm import sessionmakerengine = create_engine('postgresql://usr:pass@localhost:5432/sqlalchemy')Session = sessionmaker(bind=engine)Base = declarative_base() This code creates: a SQLAlchemy Engine that will interact with our dockerized PostgreSQL database, a SQLAlchemy ORM session factory bound to this engine, and a base class for our classes definitions. Now letâ€™s create and map the Movie class. To do this, letâ€™s create a new file called movie.py and add the following code to it: 1234567891011121314151617# coding=utf-8from sqlalchemy import Column, String, Integer, Datefrom base import Baseclass Movie(Base): __tablename__ = 'movies' id = Column(Integer, primary_key=True) title = Column(String) release_date = Column(Date) def __init__(self, title, release_date): self.title = title self.release_date = release_date The definition of this class and its mapping characteristics is quite simple. We start by making this class extend the Base class defined in the base.pymodule and then we add four properties to it: A __tablename__ to indicate what is the name of the table that will support this class. An id to represent the primary key in the table. A title of type String. A release_date of type Date. The next class that we will create and map is the Actor class. Letâ€™s create a file called actor.py and add the following code to it: 1234567891011121314151617# coding=utf-8from sqlalchemy import Column, String, Integer, Datefrom base import Baseclass Actor(Base): __tablename__ = 'actors' id = Column(Integer, primary_key=True) name = Column(String) birthday = Column(Date) def __init__(self, name, birthday): self.name = name self.birthday = birthday The definition of this class is pretty similar to the previous one. The differences are that the Actor has a name instead of a title, a birthday instead of a release_date, and that it points to a table called actors instead of movies. As many movies can have many actors and vice-versa, we will need to create a Many To Many relationship between these two classes. Letâ€™s create this relationship by updating the movie.py file as follows: 12345678910111213141516171819202122232425# coding=utf-8from sqlalchemy import Column, String, Integer, Date, Table, ForeignKeyfrom sqlalchemy.orm import relationshipfrom base import Basemovies_actors_association = Table( 'movies_actors', Base.metadata, Column('movie_id', Integer, ForeignKey('movies.id')), Column('actor_id', Integer, ForeignKey('actors.id')))class Movie(Base): __tablename__ = 'movies' id = Column(Integer, primary_key=True) title = Column(String) release_date = Column(Date) actors = relationship("Actor", secondary=movies_actors_association) def __init__(self, title, release_date): self.title = title self.release_date = release_date The difference between this version and the previous one is that: we imported three new entities: Table, ForeignKey, and relationship; we created a movies_actors_association table that connects rows of actors and rows of movies; and we added the actors property to Movie and configured the movies_actors_association as the intermediary table. The next class that we will create is Stuntman. In our tutorial, a particular Actor will have only one Stuntman and this Stuntman will work only with this Actor. This means that we need to create the Stuntman class and a One To One relationship between these classes. To accomplish that, letâ€™s create a file called stuntman.py and add the following code to it: 123456789101112131415161718192021# coding=utf-8from sqlalchemy import Column, String, Integer, Boolean, ForeignKeyfrom sqlalchemy.orm import relationship, backreffrom base import Baseclass Stuntman(Base): __tablename__ = 'stuntmen' id = Column(Integer, primary_key=True) name = Column(String) active = Column(Boolean) actor_id = Column(Integer, ForeignKey('actors.id')) actor = relationship("Actor", backref=backref("stuntman", uselist=False)) def __init__(self, name, active, actor): self.name = name self.active = active self.actor = actor In this class, we have defined that the actor property references an instance of Actor and that this actor will get a property called stuntman that is not a list (uselist=False). That is, whenever we load an instance of Stuntman, SQLAlchemy will also load and populate the Actor associated with this stuntman. The fourth and final class that we will map in our tutorial is ContactDetails. Instances of this class will hold a phone_number and an address of a particular Actor, and one Actor will be able to have many ContactDetails associated. Therefore, we will need to use the Many To One relationship pattern to map this association. To create this class and this association, letâ€™s create a file called contact_details.py and add the following source code to it: 123456789101112131415161718192021# coding=utf-8from sqlalchemy import Column, String, Integer, ForeignKeyfrom sqlalchemy.orm import relationshipfrom base import Baseclass ContactDetails(Base): __tablename__ = 'contact_details' id = Column(Integer, primary_key=True) phone_number = Column(String) address = Column(String) actor_id = Column(Integer, ForeignKey('actors.id')) actor = relationship("Actor", backref="contact_details") def __init__(self, phone_number, address, actor): self.phone_number = phone_number self.address = address self.actor = actor As we can see, creating a Many To One association is kinda similar to creating a One To One association. The difference is that in the latter we instructed SQLAlchemy not to use lists. This instruction ends up restricting the association to a single instance instead of a list of instances. Persisting Data with SQLAlchemy ORMNow that we have created our classes, letâ€™s create a file called inserts.py and generate some instances of these classes to persist to the database. In this file, letâ€™s add the following code: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960# coding=utf-8# 1 - importsfrom datetime import datefrom actor import Actorfrom base import Session, engine, Basefrom contact_details import ContactDetailsfrom movie import Moviefrom stuntman import Stuntman# 2 - generate database schemaBase.metadata.create_all(engine)# 3 - create a new sessionsession = Session()# 4 - create moviesbourne_identity = Movie("The Bourne Identity", date(2002, 10, 11))furious_7 = Movie("Furious 7", date(2015, 4, 2))pain_and_gain = Movie("Pain &amp; Gain", date(2013, 8, 23))# 5 - creates actorsmatt_damon = Actor("Matt Damon", date(1970, 10, 8))dwayne_johnson = Actor("Dwayne Johnson", date(1972, 5, 2))mark_wahlberg = Actor("Mark Wahlberg", date(1971, 6, 5))# 6 - add actors to moviesbourne_identity.actors = [matt_damon]furious_7.actors = [dwayne_johnson]pain_and_gain.actors = [dwayne_johnson, mark_wahlberg]# 7 - add contact details to actorsmatt_contact = ContactDetails("415 555 2671", "Burbank, CA", matt_damon)dwayne_contact = ContactDetails("423 555 5623", "Glendale, CA", dwayne_johnson)dwayne_contact_2 = ContactDetails("421 444 2323", "West Hollywood, CA", dwayne_johnson)mark_contact = ContactDetails("421 333 9428", "Glendale, CA", mark_wahlberg)# 8 - create stuntmenmatt_stuntman = Stuntman("John Doe", True, matt_damon)dwayne_stuntman = Stuntman("John Roe", True, dwayne_johnson)mark_stuntman = Stuntman("Richard Roe", True, mark_wahlberg)# 9 - persists datasession.add(bourne_identity)session.add(furious_7)session.add(pain_and_gain)session.add(matt_contact)session.add(dwayne_contact)session.add(dwayne_contact_2)session.add(mark_contact)session.add(matt_stuntman)session.add(dwayne_stuntman)session.add(mark_stuntman)# 10 - commit and close sessionsession.commit()session.close() This code is split into 10 sections. Letâ€™s inspect them: The first section imports the classes that we created, the SQLAlchemy engine, the Base class, the session factory, and date from the datetimemodule. The second section instructs SQLAlchemy to generate the database schema. This generation occurs based on the declarations that we made while creating the four main classes that compose our tutorial. The third section extracts a new session from the session factory. The fourth section creates three instances of the Movie class. The fifth section creates three instances of the Actor class. The sixth section adds actors to movies. Note that the Pain &amp; Gain movie references two actors: Dwayne Johnson and Mark Wahlberg. The seventh section creates instances of the ContactDetails class and defines what actors these instances are associated to. The eighth section defines three stuntmen and also defines what actors these stuntmen are associated to. The ninth section uses the current session to save the movies, actors, contact details, and stuntmen created. Note that we havenâ€™t explicitly saved actors. This is not needed because SQLAlchemy, by default, uses the save-update cascade strategy. The tenth section commits the current session to the database and closes it. To run this Python script, we can simply issue the python inserts.pycommand (letâ€™s not to run pipenv shell first) in the main directory of our database. Running it will create five tables in the PostgreSQL database and populate these tables with the data that we created. In the next section, we will learn how to query these tables. Querying Data with SQLAlchemy ORMAs we will see, querying data with SQLAlchemy ORM is quite simple. This library provides an intuitive, fluent API that enables developers to write queries that are easy to read and to maintain. On SQLAlchemy ORM, all queries start with a Query Object that is extracted from the current session and that is associated with a particular mapped class. To see this API in action, letâ€™s create a file called queries.py and add to it the following source code: 12345678910111213141516171819# coding=utf-8# 1 - importsfrom actor import Actorfrom base import Sessionfrom contact_details import ContactDetailsfrom movie import Movie# 2 - extract a sessionsession = Session()# 3 - extract all moviesmovies = session.query(Movie).all()# 4 - print movies' detailsprint('\n### All movies:')for movie in movies: print(f'&#123;movie.title&#125; was released on &#123;movie.release_date&#125;')print('') The code snippet aboveâ€”that can be run with python queries.py,â€”shows how easy it is to use SQLAlchemy ORM to query data. To retrieve all movies from the database, we just needed to fetch a session from the session factory, use it to get a query associated with Movie, and then call the all() function on this query object. The Query API provides dozens of useful functions like all(). In the following list, we can see a brief explanation about the most important ones: count(): Returns the total number of rows of a query. filter(): Filters the query by applying a criteria. delete(): Removes from the database the rows matched by a query. distinct(): Applies a distinct statement to a query. exists(): Adds an exists operator to a subquery. first(): Returns the first row in a query. get(): Returns the row referenced by the primary key parameter passed as argument. join(): Creates a SQL join in a query. limit(): Limits the number of rows returned by a query. order_by(): Sets an order in the rows returned by a query. To explore the usage of some of these functions, letâ€™s append the following code to the queries.py script: 123456789101112131415161718192021222324252627282930313233343536# 1 - importsfrom datetime import date# other imports and sections...# 5 - get movies after 15-01-01movies = session.query(Movie) \ .filter(Movie.release_date &gt; date(2015, 1, 1)) \ .all()print('### Recent movies:')for movie in movies: print(f'&#123;movie.title&#125; was released after 2015')print('')# 6 - movies that Dwayne Johnson participatedthe_rock_movies = session.query(Movie) \ .join(Actor, Movie.actors) \ .filter(Actor.name == 'Dwayne Johnson') \ .all()print('### Dwayne Johnson movies:')for movie in the_rock_movies: print(f'The Rock starred in &#123;movie.title&#125;')print('')# 7 - get actors that have house in Glendaleglendale_stars = session.query(Actor) \ .join(ContactDetails) \ .filter(ContactDetails.address.ilike('%glendale%')) \ .all()print('### Actors that live in Glendale:')for actor in glendale_stars: print(f'&#123;actor.name&#125; has a house in Glendale')print('') The fifth section of the updated script uses the filter() function to fetch only movies that were released after January the first, 2015. The sixth section shows how to use join() to fetch instances of Movie that the Actor Dwayne Johnson participated in. The seventh and last section, shows the usage of join() and ilike() functions to retrieve actors that have houses in Glendale. Running the new version of the script (python queries.py) now will result in the following output: 123456789101112131415### All movies:The Bourne Identity was released on 2002-10-11Furious 7 was released on 2015-04-02No Pain No Gain was released on 2013-08-23### Recent movies:Furious 7 was released after 2015### Dwayne Johnson movies:The Rock starred in No Pain No GainThe Rock starred in Furious 7### Actors that live in Glendale:Dwayne Johnson has a house in GlendaleMark Wahlberg has a house in Glendale As we can see, using the API is straightforward and generates a code that is readable. To see other functions supported by the Query API, and their description, take a look at the official documentation. â€œQuerying data with SQLAlchemy ORM is easy and intuitive.â€TWEET THIS Securing Python APIs with Auth0Securing Python APIs with Auth0 is very easy and brings a lot of great features to the table. With Auth0, we only have to write a few lines of code to get: A solid identity management solution, including single sign-on User management Support for social identity providers (like Facebook, GitHub, Twitter, etc.) Enterprise identity providers (Active Directory, LDAP, SAML, etc.) Our own database of users For example, to secure Python APIs written with Flask, we can simply create a requires_auth decorator: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677# Format error response and append status codedef get_token_auth_header(): """Obtains the access token from the Authorization Header """ auth = request.headers.get("Authorization", None) if not auth: raise AuthError(&#123;"code": "authorization_header_missing", "description": "Authorization header is expected"&#125;, 401) parts = auth.split() if parts[0].lower() != "bearer": raise AuthError(&#123;"code": "invalid_header", "description": "Authorization header must start with" " Bearer"&#125;, 401) elif len(parts) == 1: raise AuthError(&#123;"code": "invalid_header", "description": "Token not found"&#125;, 401) elif len(parts) &gt; 2: raise AuthError(&#123;"code": "invalid_header", "description": "Authorization header must be" " Bearer token"&#125;, 401) token = parts[1] return tokendef requires_auth(f): """Determines if the access token is valid """ @wraps(f) def decorated(*args, **kwargs): token = get_token_auth_header() jsonurl = urlopen("https://"+AUTH0_DOMAIN+"/.well-known/jwks.json") jwks = json.loads(jsonurl.read()) unverified_header = jwt.get_unverified_header(token) rsa_key = &#123;&#125; for key in jwks["keys"]: if key["kid"] == unverified_header["kid"]: rsa_key = &#123; "kty": key["kty"], "kid": key["kid"], "use": key["use"], "n": key["n"], "e": key["e"] &#125; if rsa_key: try: payload = jwt.decode( token, rsa_key, algorithms=ALGORITHMS, audience=API_AUDIENCE, issuer="https://"+AUTH0_DOMAIN+"/" ) except jwt.ExpiredSignatureError: raise AuthError(&#123;"code": "token_expired", "description": "token is expired"&#125;, 401) except jwt.JWTClaimsError: raise AuthError(&#123;"code": "invalid_claims", "description": "incorrect claims," "please check the audience and issuer"&#125;, 401) except Exception: raise AuthError(&#123;"code": "invalid_header", "description": "Unable to parse authentication" " token."&#125;, 400) _app_ctx_stack.top.current_user = payload return f(*args, **kwargs) raise AuthError(&#123;"code": "invalid_header", "description": "Unable to find appropriate key"&#125;, 400) return decorated Then use it in our endpoints: 1234567891011121314# Controllers API# This doesn't need authentication@app.route("/ping")@cross_origin(headers=['Content-Type', 'Authorization'])def ping(): return "All good. You don't need to be authenticated to call this"# This does need authentication@app.route("/secured/ping")@cross_origin(headers=['Content-Type', 'Authorization'])@requires_authdef secured_ping(): return "All good. You only get this message if you're authenticated" To learn more about securing Python APIs with Auth0, take a look at this tutorial. Alongside with tutorials for backend technologies (like Python, Java, and PHP), the Auth0 Docs webpage also provides tutorials for Mobile/Native appsand Single-Page applications. Next StepsWe have covered a lot of ground in this article. Weâ€™ve learned about basic SQLAlchemy concepts like Engines, Connection Pools, and Dialects. After that, weâ€™ve learned about how SQLAlchemy addresses ORM topics like Relationship Patterns, Cascade strategies, and the Query API. In the end, we applied this knowledge in a small exercise. In summary, we had the chance to learn and practice the most important pieces of SQLAlchemy and SQLAlchemy ORM. In the next article, we are going to use these new skills to implement RESTful APIs with Flaskâ€”the Python microframework for the web. Stay tuned!]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>sqlalchemy</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[requestsè‡ªå®šä¹‰retries]]></title>
    <url>%2Famberwest.github.io%2F2018%2F09%2F17%2Frequests%E8%87%AA%E5%AE%9A%E4%B9%89retries%2F</url>
    <content type="text"><![CDATA[æœ‰æ—¶å€™åœ¨å‘èµ·è¯·æ±‚æ—¶ä¼šå› ä¸ºç½‘ç»œåŸå› è€Œå¯¼è‡´è¯·æ±‚å¤±è´¥ï¼Œæ€»æ˜¯é€šè¿‡æ•è·é”™è¯¯æ¥å¤„ç†ä¹Ÿæ˜¯æŒºçƒ¦çš„ã€‚åœ¨ç½‘ä¸Šæœç´¢äº†ä¸€ç•ªï¼Œæ‰¾åˆ°è¿™ä¹ˆä¸ªæ–¹æ³•ï¼ŒæŒºä¸é”™çš„ï¼Œæ‰€ä»¥åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œäº†ä¿®æ”¹ã€‚ 123456789101112131415161718192021222324252627282930313233343536import requestsfrom requests.adapters import HTTPAdapterfrom urllib3.util.retry import Retrybase_header = &#123; 'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36',&#125;def request_retry_session(retries=3, backoff_factor=0.3, status_forcelist=(500, 502, 504), session=None): """é‡åˆ°ç½‘ç»œé—®é¢˜æœ€å¤šé‡è¯•ä¸‰æ¬¡""" session = session or requests.session() retry = Retry(total=retries, backoff_factor=backoff_factor, status_forcelist=status_forcelist) adapter = HTTPAdapter(max_retries=retry) session.mount('http', adapter=adapter) session.mount('https', adapter=adapter) return sessiondef get_page(url, method='get', params=None, options=&#123;&#125;): """è¯·æ±‚é¡µé¢""" headers = dict(base_header, **options) session = request_retry_session() print('æ­£åœ¨æŠ“å–ï¼š', url) try: if method == 'get': response = session.get(url, params=params, headers=headers) elif method == 'post': response = session.post(url, data=params, headers=headers) if response.status_code == 200: return response except Exception as e: print('ç½‘é¡µè¯·æ±‚å¤±è´¥: ', e) return None ä½¿ç”¨çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯å¾ˆç®€å•çš„ 123url = 'https://httpbin.org/post'html = get_page(url, method='post', params=&#123;'name': 'me'&#125;)print(html.text) Done!]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>requests</tag>
        <tag>retry</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[pythonå¤„ç†å¤šä¸ªsheet]]></title>
    <url>%2Famberwest.github.io%2F2018%2F09%2F17%2Fpython%E5%A4%84%E7%90%86%E5%A4%9A%E4%B8%AAsheet%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨pythonå¤„ç†excelè¡¨ä¸­å¤šä¸ªsheetçš„æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨xlrdè¯»å–æ•°æ®ã€‚ 12345678910111213141516171819import pandas as pdimport xlrdfrom pandas import DataFramefile = 'ä¸´æ—¶è¡¨.xls'# å¤„ç†æ•°æ®ï¼Œåˆå¹¶å¤šä¸ªsheetï¼ŒåŒæ—¶å»é™¤æ°”åŒ–ç‡ä¸ºç©ºçš„rowwb = xlrd.open_workbook(file)# è·å–å…¨éƒ¨çš„å·¥ä½œç°¿sheets = wb.sheets()df = DataFrame()# ä»ç¬¬10ä¸ªsheetå¼€å§‹åˆå¹¶for i in range(10, len(sheets)): # header=1ï¼Œé‚£ä¹ˆæ•°æ®ä¼šä»ç¬¬äºŒè¡Œå¼€å§‹è¯»å– temp_df = pd.read_excel(file, sheet_name=i, header=1, index=False) # how='all'ï¼šåªè¦å­˜åœ¨æ•°æ®ä¸ºç©ºçš„è¡Œéƒ½åˆ é™¤ï¼Œè¿˜æœ‰å…¶ä»–çš„æ–¹æ³• dropna_df = temp_df.dropna(how='all')[:-2] df = df.append(dropna_df)df.head()]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>excel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é€šè¿‡ç»çº¬åº¦è·å–è¯¦ç»†åœ°å€]]></title>
    <url>%2Famberwest.github.io%2F2018%2F09%2F14%2F%E9%80%9A%E8%BF%87%E7%BB%8F%E7%BA%AC%E5%BA%A6%E8%8E%B7%E5%8F%96%E8%AF%A6%E7%BB%86%E5%9C%B0%E5%9D%80%2F</url>
    <content type="text"><![CDATA[å¦‚é¢˜ï¼Œæƒ³è¦é€šè¿‡ç»çº¬åº¦çŸ¥é“é™„è¿‘éƒ½æœ‰å“ªäº›åœ°ç‚¹ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡é«˜å¾·åœ°å›¾æä¾›çš„åœ°ç†é€†åœ°ç†ç¼–ç APIå’Œshapelyåº“æ¥è·å–æ•°æ®ã€‚ä¸å¼€å¿ƒçš„æ˜¯ï¼Œå…¶å®é«˜å¾·åœ°å›¾éƒ½æä¾›äº†åˆé€‚çš„ç«¯å£å¯ä»¥ç›´æ¥æ‹¿åˆ°æ•°æ®ï¼Œçœ¼çæ²¡çœ‹åˆ°ï¼Œå“ï½ä¸è¿‡äº†è§£åˆ°å…¶ä»–çš„çŸ¥è¯†ä¹Ÿæ˜¯å¾ˆå¼€å¿ƒçš„ ç”³è¯·keyè¦ä½¿ç”¨é«˜å¾·åœ°å›¾çš„å¼€æ”¾å¹³å°ï¼Œéœ€è¦å…ˆç”³è¯·keyã€‚ åº”ç”¨ç®¡ç†-&gt;åˆ›å»ºæ–°åº”ç”¨-&gt;å¡«å†™åº”ç”¨ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬åº”ç”¨åç§°ã€ç”¨é€”ï¼ˆé™åˆ¶äº†urlé“¾æ¥çš„å¯ä½¿ç”¨èŒƒå›´ï¼‰ã€‚ è·å–åœ°å›¾è¾¹ç•Œå¦‚æœæ˜¯éœ€è¦æ•´ä¸ªåŸå¸‚æˆ–è€…åŒºçš„çš„è¾¹ç•Œï¼Œé«˜å¾·åœ°å›¾æœ‰APIå¯ä»¥ç›´æ¥è°ƒç”¨ã€‚å¦‚æœæ˜¯éœ€è¦æŸå—åŒºåŸŸï¼Œå¯ä»¥ä½¿ç”¨é«˜å¾·åœ°å›¾çš„åæ ‡æ‹¾å–å™¨ï¼Œä¹Ÿéå¸¸æ–¹ä¾¿ã€‚ åœ¨æµè§ˆå™¨æ‰“å¼€é«˜å¾·åœ°å›¾-&gt;é€‰æ‹©åº•éƒ¨çš„â€œå¼€æ”¾å¹³å°â€-&gt;è¿›å…¥å¼€æ”¾å¹³å°å-&gt;é€‰æ‹©â€åœ°å›¾å·¥å…·â€-&gt;é€‰æ‹©â€åæ ‡æ‹¾å–å™¨â€ï¼Œç„¶åå°±å¯ä»¥åœ¨åæ ‡ä¸Šæ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©èŒƒå›´å¹¶è·å¾—å¯¹åº”çš„åæ ‡ã€‚ æ¯”å¦‚æœ‰è¿™æ ·ä¸€å¼ å›¾éœ€è¦è·å–è¾¹ç•Œï¼Œå°±å¯ä»¥å¤§æ¦‚å¯¹æ¯”ç€æ¥ç‚¹ç‚¹ç‚¹å•¦ï¼ 123456789101112# æ‹¿åˆ°çš„è¾¹ç•Œåæ ‡å€¼origin_points = [(110.987984, 21.506764), (110.990366, 21.514026), (110.993027, 21.530474), (110.999378, 21.535085), (110.998027, 21.540195), (111.01324, 21.542869), (111.025149, 21.543069), (111.026286, 21.535843), (111.035492, 21.524246), (111.01309, 21.499532), (111.005751, 21.491027), (110.995752, 21.494741), (110.987984, 21.506764)]# å¤„ç†æ•°æ®origin_points = list(map(lambda x: (int(x[0] * 1000000), int(x[1] * 1000000)), origin_points))max_long = max([a[0] for a in origin_points])min_long = min([a[0] for a in origin_points])max_lat = max([a[1] for a in origin_points])min_lat = min([a[1] for a in origin_points]) æ•ˆæœå¦‚ä¸‹ï¼š è·å–ç¬¦åˆæ¡ä»¶çš„åæ ‡ç‚¹ å› ä¸ºè¦æŠ“å–çš„åŒºåŸŸæ¯”è¾ƒå°ï¼Œæ‰€ä»¥æ¯ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»ä¹Ÿå°½å¯èƒ½çš„å°ï¼Œä¸è¿‡è¿™æ ·æ‹¿åˆ°çš„æ•°æ®å°±ä¼šæœ‰å¾ˆå¤šé‡å¤çš„ã€‚å…³äºè¿™ä¸€å—çš„è®¡ç®—æ˜¯å‚è€ƒLåŒå­¦_çš„ã€‚ 123456789101112131415# è·å–æ‰€æœ‰å¯èƒ½çš„åæ ‡ç‚¹# çº¬åº¦1åº¦ä¸º111.3195kmï¼Œç»åº¦1åº¦æ˜¯111.319x(cos 0)ã€‚æ¯éš”1kç±³å–ä¸€ä¸ªç‚¹ï¼Œé‚£ä¹ˆä»»æ„ä¸¤ä¸ªåœ°ç‚¹ä¹‹é—´çš„æœ€å¤§è·ç¦»ä¸º2kmï¼Œ# ä¹Ÿå°±æ˜¯æ­£æ–¹å½¢å¯¹è§’çº¿çš„è·ç¦»å¿…é¡»å°äºç­‰äº2ã€‚æ ¹æ®å‹¾è‚¡å®šç†å¾—åˆ°x=1.414214kmï¼Œæœ‰å…­ä½å°æ•°ï¼Œæ‰€ä»¥å–1414214x = 100000 # æ•°æ®é‡å¤ªå°‘ï¼Œå–ä¸ª100ç±³å§t = round(111.319 * cos(21 / 180 * pi), 4) # ä»¥ç”µç™½åŒºä¸­å¿ƒæ¥è®¡ç®—ç»çº¬åº¦ï¼Œä¹Ÿå°±æ˜¯ç»åº¦1åº¦å¯¹åº”çš„é•¿åº¦103.925239kmg = round((max_long - min_long) * t / x) # è¯¥åœ°åŒºæ€»çº¬åº¦å·®å¯ä»¥åˆ’åˆ†ä¸ºå‡ ä¸ªæ•°æ®ç‚¹g1 = [round(min_long + i * x / t) for i in range(g)]h = round((max_lat - min_lat) * 111.3195 / x)h1 = [round(min_lat + i * x / t) for i in range(h)]coords = []while g1: g11 = g1.pop() for j in h1: coords.append((g11, j)) å› ä¸ºçº¬åº¦1Â°ä¸º111.3195kmï¼Œç»åº¦æ¯åº¦ä¸º111.3195cos(çº¬åº¦)ï¼Œéå†ä¹‹åå¾—åˆ°ä»¥ä¸‹çš„æ•°æ®ï¼ˆè“è‰²èŒƒå›´ï¼‰ã€‚ç»è¿‡ç­›é€‰ä¹‹åï¼Œåªæœ‰çº¢è‰²ç‚¹çš„æ•°æ®æ»¡è¶³ã€‚ 123456789101112131415# ç­›é€‰æ•°æ® poly = MultiPoint(origin_points).convex_hull res = [] for p in coords: if poly.contains(Point(p)): res.append(p) print(res) # ç”»å›¾ long = [a[0] for a in origin_points] lat = [a[1] for a in origin_points] plt.plot(long, lat) # åœ°åŒºèŒƒå›´æ›²çº¿ plt.scatter([i[0] for i in coords], [i[1] for i in coords]) # åˆ†å‰²åçš„æ•£ç‚¹å›¾ plt.scatter([i[0] for i in res], [i[1] for i in res], edgecolors='red') # ç¬¦åˆæ¡ä»¶çš„ç‚¹ plt.show() è·å–ç»“æœæ ¹æ®é«˜å¾·åœ°å›¾æä¾›çš„APIæ„å»ºè¯·æ±‚é“¾æ¥ï¼Œç„¶åå‘èµ·è¯·æ±‚å°±å¯ä»¥å•¦ã€‚å…·ä½“éœ€æ±‚å¯ä»¥æŸ¥çœ‹æ‰‹å†Œè¿›è¡Œè®¾ç½®ï¼Œæ¯”å¦‚åªéœ€è¦æŠ“å–ä¸­é¤å…ï¼Œå°±å¯ä»¥è®¾ç½®poitype=&quot;ä¸­é¤å…&quot;ï¼Œè¯¦è§poiç±»å‹. 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364# -*- coding:utf-8 -*-# Time: 2018/9/13 16:54import jsonfrom pprint import pprintimport osimport pandas as pdimport openpyxlfrom pandas import ExcelWriterimport requestsfrom points import get_pointfile = 'é«˜å¾·åœ°å›¾åæ ‡.xlsx'def parse_info(data): res = [] try: if data['info'] == 'OK': for item in data['regeocode']['pois']: d = &#123; 'name': item['name'], 'lon': parse_location(item['location'])[0], 'lat': parse_location(item['location'])[1], 'address': item['address'], &#125; res.append(d) save(res) except Exception as e: print(e)def parse_location(s): return s.split(',')def run(): gd_url = 'https://restapi.amap.com/v3/geocode/regeo?output=json&amp;location=&#123;long&#125;,&#123;lat&#125;&amp;key=&#123;key&#125;&amp;radius=&#123;radius&#125;&amp;extensions=all' key = '47939581b9d62ed52efa9e875c137a13' radius = 100 # æ¯ä¸ªåæ ‡ç‚¹æœç´¢åŠå¾„ for lon, lat in get_point(): print(lon, lat) html = requests.get(gd_url.format(long=lon, lat=lat, radius=radius, key=key)) print(html.text) data = json.loads(html.text, encoding='utf8') parse_info(data)def save(data): columns = ['name', 'lon', 'lat', 'address'] df = pd.DataFrame(data, columns=columns) exist = os.path.exists(file) if not exist: writer = ExcelWriter(file, engine='openpyxl') df.to_excel(writer, sheet_name='Main', header=True, index=False, columns=columns) writer.save() else: book = openpyxl.load_workbook(file) writer = ExcelWriter(file, engine='openpyxl') writer.book = book row = book['Main'].max_row writer.sheets = dict((ws.title, ws) for ws in book.worksheets) df.to_excel(writer, sheet_name='Main', startrow=row, index=False, header=False, columns=columns) writer.save()if __name__ == '__main__': run()]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>é«˜å¾·åœ°å›¾</tag>
        <tag>shapely</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[why are you late]]></title>
    <url>%2Famberwest.github.io%2F2018%2F09%2F11%2Fwhy-are-you-late%2F</url>
    <content type="text"><![CDATA[reasons for being lateThere are various reasons for being late: didnâ€™t hear the alarm She overslept because she didnâ€™t hear her alarm. I slept right through the alarm.(sleep through = oversleep) the alarm didnâ€™t go off If the alarm doesnâ€™t go off, you probably wonâ€™t get up until you naturally wake up. underestimate the time you need You may think you only need 20 minutes to finish a task, but actually it can take up to 40 minutes. I left my phone at home and had to go back. bad sense of direction I went the wrong way Actually people can easily get lost when they go to a new place. traffic jam Sometimes, even though we leave home early and go the right way, we still end up being late because of the heavy traffic. I got stuck/caught in traffic. (æˆ‘å µåœ¨è·¯ä¸Šäº†) There was a traffic jam. vehicle Bus No.38 was supposed to come at 8:40, but it was 5 minutes late. My flight was delayed and I missed my meeting. My car broke down. I couldnâ€™t find a parking space. what to do when youâ€™re lateAs the saying goes, better than late than never. you should call the people and apologize. Iâ€™m sorry, but I am running late. Iâ€™m afraid that Iâ€™m going to be late for work/the meeting/the interview. tell they the reasons for being late person reasons I overslept. I went the wrong way. I left my phone at home and had to go back. objective reasons There was a traffic jam. My flight was delayed. The subway broke down. inform the people how late you are going to be Iâ€™ll be there in 5 minutes. Itâ€™s hard to say, but Iâ€™ll be there as soon as possible. make up for mistakes late for work Sorry, I was late. This wonâ€™t happen again. Iâ€™ll finish my work on time. Iâ€™m terribly sorry. I wonâ€™t be late again. Iâ€™ll be working late tonight. late for job interview Iâ€™m sorry, but Iâ€™m normally on time. late for a meeting Try to make the most of your time Review the meeting minutes. late for date Dinnerâ€™s on me. I will buy you lunch. Iâ€™ll treat you to a movie. how to avoid being late Put your alarm on the other side of room. Set multiple alarms. Leave home early. To plan the route in advance. Put your bag the night before. Set out the clothes in advance.(æå‰å‡†å¤‡å¥½è¡£ç‰©)]]></content>
      <categories>
        <category>è‹±è¯­</category>
      </categories>
      <tags>
        <tag>è‹±è¯­</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç”¨pythonä¸‹è½½å“”å“©å“”å“©è§†é¢‘]]></title>
    <url>%2Famberwest.github.io%2F2018%2F09%2F11%2F%E7%94%A8python%E4%B8%8B%E8%BD%BD%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9%E8%A7%86%E9%A2%91%2F</url>
    <content type="text"><![CDATA[æ²¡æƒ³åˆ°æˆ‘è¿˜ä»æ¥æ²¡ç”¨pythonä¸‹è½½è¿‡è§†é¢‘ï¼Œè¿™æ¬¡å†³å®šæ‹¿Bç«™æ¥ç»ƒä¹ ä¸€ä¸‹ã€‚ ç”¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹é¡µé¢å…ƒç´ ï¼Œä¹Ÿæ²¡æ‰¾åˆ°è§†é¢‘çš„çœŸå®é“¾æ¥ï¼Œåªå¥½ç”¨charlesæŠ“åŒ…ä¸€ä¸‹ã€‚å…·ä½“çš„ä¸‹è½½å’Œè¯ä¹¦å®‰è£…è¿‡ç¨‹å¿½ç•¥ã€‚ è®¾ç½®charles è®¾ç½®proxy settings è®¾ç½®ssl proxy settingsï¼ŒæŠ“å–httpsé“¾æ¥ï¼Œä¸ç„¶ä¼šå‡ºç°ä¹±ç  è®¾ç½®macOS Proxyï¼ŒæŠ“å–PCç«¯æ•°æ® 4.åˆ·æ–°è§†é¢‘é¡µé¢ï¼Œåº”è¯¥å°±ä¼šå‡ºç°å¾ˆå¤šé“¾æ¥äº†ã€‚ä»”ç»†æŸ¥æ‰¾ä¸€ä¸‹ï¼Œå°±å¯ä»¥æ‰¾åˆ°è§†é¢‘é“¾æ¥ ä¸‹è½½è§†é¢‘æ‰¾åˆ°è§†é¢‘é“¾æ¥åï¼Œä»¥ä¸ºå°±å¯å‘èµ·è¯·æ±‚äº†ï¼Œç»“æœæŠŠè‡ªå·±ç»™å‘äº†ä¸€ä¸‹ã€‚å› ä¸ºè§†é¢‘é“¾æ¥çš„è¯·æ±‚å‚æ•°æœ‰ä¸ªåˆ«ä¸€ç›´åœ¨å˜åŒ–ï¼Œå¹¶ä¸”åœ¨å…¨å±€æœç´¢çš„æ—¶å€™ä¹Ÿæ²¡æ‰¾åˆ°ç”Ÿæˆå‚æ•°çš„æ–¹æ³•ã€‚å€’æ˜¯åœ¨é¡µé¢æºç é‡Œå¯ä»¥æ‰¾åˆ°é“¾æ¥ï¼Œè¿˜æ˜¯getè¯·æ±‚ï¼Œå—¯ï¼Œè¿˜æ˜¯åº”è¯¥æ„Ÿåˆ°å¼€å¿ƒçš„ğŸ˜… 12345678910111213141516171819202122232425262728293031323334353637383940414243def download_video(): headers = &#123; 'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36', &#125; video_url = 'https://www.bilibili.com/video/av28518492' res = requests.get(video_url, headers=headers, verify=False) origin_txt = re.findall(r'&lt;script&gt;window.__playinfo__=(\&#123;.*?\&#125;)&lt;/script&gt;', res.text, re.S)[0] origin_json = json.loads(origin_txt, encoding='utf-8') urls = origin_json['durl'] size = 0 chunk = 1024 content_size = sum([i['size'] for i in urls]) print('file size is %0.2f MB' % (content_size / chunk / 1024)) # åˆ›å»ºå­˜æ”¾è§†é¢‘ç‰‡æ®µçš„ä¸´æ—¶æ–‡ä»¶å¤¹ if not os.path.exists('temp_video'): os.makedirs('temp_video') start = time.time() # å¾ªç¯ä¸‹è½½è§†é¢‘ for i, data in enumerate(urls): url = data['url'] header = &#123; 'Origin': 'https://www.bilibili.com', 'Referer': video_url, &#125; headers.update(header) try: response = requests.get(url, headers=headers, verify=False, stream=True) video_path = 'temp_video/' + '&#123;&#125;.mp4'.format(i) # ä¸‹è½½è§†é¢‘ with open(video_path, 'wb') as file: for item in response.iter_content(chunk): file.write(item) # å†™å…¥è§†é¢‘ file.flush() # æ¸…ç©ºç¼“å­˜ size += len(item) print('\r' + '[ä¸‹è½½è¿›åº¦]ï¼š%s %0.2f%%' % ('&gt;' * int(size * 50 / content_size), float(size / content_size) * 100), end='') # end=â€˜â€™ä¸æ¢è¡Œæ‰“å° except Exception as e: print(e) stop = time.time() print('\n' + 'è§†é¢‘ä¸‹è½½å®Œæˆï¼Œè€—æ—¶%.2fç§’' % (stop-start)) åˆå¹¶è§†é¢‘ä¸‹è½½ä¸‹æ¥çš„è§†é¢‘ï¼Œå…¶å®æ˜¯åˆ†æ®µçš„ï¼Œä¸æ–¹é¢æŸ¥çœ‹ï¼Œæ‰€ä»¥è¿˜éœ€è¦å°†è§†é¢‘ç»™åˆå¹¶èµ·æ¥ï¼Œè¿™é‡Œç”¨çš„æ˜¯ffmpegå‘½ä»¤ï¼Œæœ€ååˆå¹¶çš„è§†é¢‘ä¿å­˜ä¸ºoutput.mp4ï¼Œå­˜åœ¨å½“å‰è·¯å¾„ä¸‹ã€‚ ffmpeg -f concat -safe 0 -i file.txt -c copy output.mp4 å…¶ä¸­file.txtæ˜¯æ‰€æœ‰è§†é¢‘ç‰‡æ®µè·¯å¾„ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š 123file &apos;video/v_1.mp4&apos;file &apos;video/v_2.mp4&apos;file &apos;video/v_3.mp4&apos; åˆå¹¶è§†é¢‘æ˜¯ç”¨subprocessæ¨¡å—æ¥è¿è¡Œffmpegå‘½ä»¤ï¼Œè¯¦ç»†ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132def concatenate(path, dest='video'): """ å°†ç»™å®šè·¯å¾„ä¸‹çš„è§†é¢‘è¿›è¡Œåˆå¹¶ï¼ŒåŒæ—¶åˆ é™¤åŸæœ¬çš„è§†é¢‘ :param path: éœ€è¦åˆå¹¶çš„è§†é¢‘æ‰€åœ¨æ–‡ä»¶å¤¹åå­—ï¼Œä¸€èˆ¬æ˜¯è§†é¢‘åå­— :param dest: åˆå¹¶ä¹‹åçš„è§†é¢‘å­˜æ”¾è·¯å¾„ï¼Œé»˜è®¤ä¸ºvideoæ–‡ä»¶å¤¹ :return: """ with open('file.txt', 'a', encoding='utf-8') as f: for root, dirs, files in os.walk(path): for file in files: # å¦‚æœç»™å®šçš„è·¯å¾„ä¸‹æœ‰è§†é¢‘ï¼Œåˆ™å°†è§†é¢‘è·¯å¾„ä¿¡æ¯å†™å…¥åˆ°txtä¸­ if os.path.splitext(file)[1] in ['.flv', '.mkv', '.mp4']: video_path = os.path.join(root, file) line = "file '&#123;&#125;'\n".format(video_path) f.writelines(line) # åˆå¹¶è§†é¢‘ if os.path.exists('file.txt'): if not os.path.exists(dest): os.makedirs(dest) video_save_path = os.path.join(dest, path) try: print('å¼€å§‹åˆå¹¶è§†é¢‘...') print(path) ffmpeg_command = ["ffmpeg", "-f", "concat", "-safe", "0", "-i", "file.txt", "-c", "copy", video_save_path + ".mp4"] subprocess.run(ffmpeg_command) subprocess.run(["rm", "file.txt"]) subprocess.run(["rm", "-r", path]) print('è§†é¢‘åˆå¹¶å®Œæˆï¼') except Exception as e: print('è§†é¢‘åˆå¹¶å¤±è´¥') print(e) ä»£ç ç¤ºä¾‹ å‚è€ƒæ–‡ç« How to join two video files using Python? pythonçˆ¬è™«æŠ“å–Bç«™å°è§†é¢‘æ’è¡Œæ¦œ]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>Bç«™</tag>
        <tag>è§†é¢‘ä¸‹è½½</tag>
        <tag>ffmpeg</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç”¨pythonç”ŸæˆäºŒç»´ç ]]></title>
    <url>%2Famberwest.github.io%2F2018%2F09%2F06%2F%E7%94%A8python%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81%2F</url>
    <content type="text"><![CDATA[ç”¨pythonç”ŸæˆäºŒç»´ç çœŸæ˜¯ç®€å•åˆæ–¹ä¾¿ï¼Œç°åœ¨ç®€å•è®°å½•ä¸€ä¸‹qrcodeåº“çš„ä½¿ç”¨ã€‚ å®‰è£…ä¾èµ–åº“1pip install qrcode ä½¿ç”¨ ä½¿ç”¨qrå‘½ä»¤ å®‰è£…äº†qrcodeä¹‹åï¼Œå°±å¯ä»¥ç”¨ä¸€å¥å‘½ä»¤ç”ŸæˆäºŒç»´ç ï¼Œå¾ˆæ–¹ä¾¿æœ‰æ²¡æœ‰ï¼ï¼ï¼ 1qr "hello world" &gt; test.png ç”¨è„šæœ¬å®ç° å³ä½¿ç”¨è„šæœ¬ï¼Œä¹Ÿå¯ä»¥ä¸€è¡Œä»£ç æå®š 12img = qrcode.make('use make method')img.save('make.png') é«˜çº§ç”¨æ³•å¦‚æœæƒ³è¦æ›´å¤šçš„è®¾ç½®ï¼Œå¯ä»¥ä½¿ç”¨QRCodeç±» 123456789101112qr = qrcode.QRCode( version=1, error_correction=qrcode.constants.ERROR_CORRECT_L, box_size=10, border=4, )qr.add_data('use QRCode')qr.make(fit=True)img = qr.make_image(fill_color='blue', back_color='white') img.save('QRCode.png') å‚æ•°è¯´æ˜ versionï¼š1åˆ°40çš„æ•´æ•°ï¼Œç”¨æ¥æ§åˆ¶äºŒç»´ç çš„å¤§å°ï¼Œæœ€å°æ˜¯1ã€‚ç”ŸæˆäºŒç»´ç æ—¶è®¾ç½®ä¸ºnoneå¹¶ä½¿ç”¨fitå‚æ•°ï¼Œversioné»˜è®¤ä¸º1 rror_correctionï¼šæ§åˆ¶äºŒç»´ç ä½¿ç”¨è¿‡ç¨‹ä¸­çš„å®¹é”™èƒ½åŠ› ERROR_CORRECT_Lï¼šçº¦7%æˆ–è€…æ›´å°‘çš„é”™è¯¯èƒ½å¤Ÿè¢«ä¿®æ­£ ERROR_CORRECT_Mï¼šé»˜è®¤å€¼ã€‚çº¦15%æˆ–è€…æ›´å°‘çš„é”™è¯¯èƒ½å¤Ÿè¢«ä¿®æ­£ ERROR_CORRECT_Qï¼šçº¦25%æˆ–è€…æ›´å°‘çš„é”™è¯¯èƒ½å¤Ÿè¢«ä¿®æ­£ ERROR_CORRECT_Hï¼šçº¦30%æˆ–è€…æ›´å°‘çš„é”™è¯¯èƒ½å¤Ÿè¢«ä¿®æ­£ box_sizeï¼šæ§åˆ¶äºŒç»´ç æ¯ä¸ªâ€œboxâ€œåŒ…å«çš„åƒç´ æ•° borderï¼šé»˜è®¤ä¸º4ï¼Œæœ€å°å€¼ã€‚æ§åˆ¶äºŒç»´ç è¾¹æ¡†æœ‰å¤šå°‘ä¸ªâ€œboxâ€ svgè¿˜å¯ä»¥ä¿å­˜ä¸ºsvgæ ¼å¼ï¼Œæ—¢å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨ä»£ç ä¸­å®ç° 123qr --factory=svg-path "svg" &gt; test.svgqr --factory=svg "Some text" &gt; test.svgqr --factory=svg-fragment "Some text" &gt; test.svg åœ¨pythonä¸­ï¼Œç”¨æ³•å¦‚ä¸‹ 12345678910111213141516def make_svg(method): if method == 'basic': # simple factory, just a set of rects factory = qrcode.image.svg.SvgImage elif method == 'fragment': # Fragment factory (also just a set of rects) factory = qrcode.image.svg.SvgFragmentImage else: # Combined path factory, fixes white space that may occur when zooming factory = qrcode.image.svg.SvgPathImage img = qrcode.make('svg', image_factory=factory) img.save('test.svg')if __name__ == '__main__': make_svg('basic') å‚è€ƒæ–‡ç« qrcode]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>äºŒç»´ç </tag>
        <tag>qrcode</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å›¾ç‰‡åˆ—è¡¨å¸ƒå±€]]></title>
    <url>%2Famberwest.github.io%2F2018%2F08%2F10%2F%E5%9B%BE%E7%89%87%E5%88%97%E8%A1%A8%E5%B8%83%E5%B1%80%2F</url>
    <content type="text"><![CDATA[ä»Šå¤©è¦è§£å†³çš„é—®é¢˜å°±æ˜¯ï¼šå›¾ç‰‡æ°´å¹³å‚ç›´å±…ä¸­ï¼ŒåŒæ—¶è¿˜è¦åœ¨å¤–é¢åŠ ä¸Šè¾¹æ¡†ã€‚æœ€ç»ˆæ•ˆæœå›¾å¦‚ä¸‹ï¼š htmlä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617&lt;div class="pic"&gt; &lt;div class="content"&gt; &lt;div class="out"&gt; &lt;a href="#"&gt;&lt;img src="../day9-11/images/Facebook.png" alt="facebook"&gt;&lt;/a&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class="content"&gt; &lt;div class="out"&gt; &lt;a href="#"&gt;&lt;img src="../day9-11/images/Twitter.png" alt="twitter"&gt;&lt;/a&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class="content"&gt; &lt;div class="out"&gt; &lt;a href="#"&gt;&lt;img src="../day9-11/images/Instagram.png" alt="instagram"&gt;&lt;/a&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt; ç”±äºå›¾ç‰‡çš„å¤§å°ä¸å¤ªä¸€æ ·ï¼Œè¿™é‡Œå¼ºåˆ¶æ€§è®¾ç½®ä¸ºç»Ÿä¸€å®½é«˜ã€‚ 1234img &#123; height: 20px; width: 20px;&#125; ä¸ºäº†è®©ä¸‰ä¸ªå›¾ç‰‡èƒ½å¹¶æ’ï¼Œéœ€è¦è®¾ç½®display: inline-blockï¼ŒåŒæ—¶ä¹Ÿè¦ç»™å®¹å™¨contentå®½é«˜ã€‚å›¾ç‰‡è¾¹æ¡†æ˜¯ä¸ªåœ†å½¢çš„ï¼Œè¿™é‡Œæœ‰ä¸ªæŠ€å·§ï¼Œå°±æ˜¯è®©è¾¹æ¡†çš„radiusä¸º50%ã€‚ 12345678910.content &#123; display: inline-block; margin-left: 15px; position: relative; width: 50px; height: 50px; /*è®¾ç½®è¾¹æ¡†*/ border: 1px solid #acacac; border-radius: 50%;&#125; å› ä¸ºå›¾ç‰‡æ˜¯åœ¨è¾¹æ¡†ä¸­é—´ä½ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬å†ç”¨ä¸€ä¸ªå®¹å™¨div.outæŠŠå†…å®¹åŒ…èµ·æ¥ï¼Œè®¾ç½®absoluteï¼Œå¹¶å°†å…¶top/leftè®¾ç½®ä¸ºçˆ¶å®¹å™¨contentçš„ä¸€åŠã€‚æ ¹æ®å‚è€ƒæ–‡ç« ï¼Œè¿™é‡Œå°±æ˜¯åˆ©ç”¨absoluteçš„åŒ…è£¹æ€§æ¥è·å–åŒ…å«å—çš„å®½åº¦ï¼Œä¹Ÿå°±æ˜¯imgçš„å¤§å°ã€‚è¿™æ ·å°±æŠŠæ•´ä¸ªå›¾ç‰‡çš„å·¦ä¸Šè§’å¯¹å…¶åˆ°å®¹å™¨outçš„ä¸­å¿ƒç‚¹ï¼Œæ­¤æ—¶å›¾ç‰‡å¹¶æ²¡æœ‰å±…ä¸­ï¼Œå› æ­¤è¿˜è¦è®¾ç½®margin-top/margin-leftä¸º-10pxï¼Œä¹Ÿå°±æ˜¯å›¾ç‰‡å®½é«˜çš„ä¸€åŠã€‚ 1234567.out &#123; position: absolute; left: 50%; top: 50%; margin-left: -10px; margin-top: -10px;&#125; å®Œæ•´cssä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435* &#123; margin: 0; padding: 0;&#125;.pic &#123; background-color: black; height: 80px; width: 250px; padding-top: 20px; margin: 20px auto;&#125;.content &#123; display: inline-block; margin-left: 15px; position: relative; width: 50px; height: 50px; border: 1px solid #acacac; border-radius: 50%;&#125;.out &#123; position: absolute; left: 50%; top: 50%; margin-left: -10px; margin-top: -10px;&#125;img &#123; height: 20px; width: 20px;&#125; å¦‚æœå›¾ç‰‡/å†…å®¹çš„å¤§å°ä¸ç¡®å®šï¼Œå°±åƒå‚è€ƒæ–‡ç« ä¸­æåˆ°çš„ä¸€æ ·ï¼Œåœ¨éœ€è¦å±…ä¸­çš„å…ƒç´ å¤–é¢å¥—ä¸€ä¸ªç©ºçš„divå…ƒç´ ï¼Œå†é‡æ–°è®¾ç½®ä¸€ä¸‹å³å¯ã€‚å¦‚ä¸‹ï¼š htmlä»£ç ï¼š 123456&lt;div class="content"&gt; &lt;div class="out"&gt; &lt;div class="in"&gt;&lt;a href="#"&gt;&lt;img src="../day9-11/images/Facebook.png" alt="facebook"&gt;&lt;/a&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt; cssä¿®æ”¹éƒ¨åˆ†å¦‚ä¸‹ï¼Œå…¶ä»–çš„ä¸å˜ï¼š 12345678910111213141516.out &#123; position: absolute; left: 50%; top: 50%;&#125;img &#123; height: 20px; width: 20px;&#125;.in &#123; /*è¿™é‡Œçš„æ¯”ä¾‹å¯èƒ½éœ€è¦æ ¹æ®å†…éƒ¨å…ƒç´ çš„å®½é«˜æ¯”è¿›è¡Œè°ƒæ•´*/ margin-left: -50%; margin-top: -50%;&#125; å‚è€ƒæ–‡ç« ï¼š div+csså›¾ç‰‡åˆ—è¡¨å¸ƒå±€ï¼ˆäºŒï¼‰ æ·±å…¥ç†è§£CSSä¸­çš„marginè´Ÿå€¼]]></content>
      <tags>
        <tag>css</tag>
        <tag>å›¾ç‰‡</tag>
        <tag>å¸ƒå±€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é¼ æ ‡ç»è¿‡å›¾ç‰‡æ—¶å¢åŠ æ–‡å­—]]></title>
    <url>%2Famberwest.github.io%2F2018%2F08%2F09%2F%E9%BC%A0%E6%A0%87%E7%BB%8F%E8%BF%87%E5%9B%BE%E7%89%87%E6%97%B6%E5%A2%9E%E5%8A%A0%E6%96%87%E5%AD%97%2F</url>
    <content type="text"><![CDATA[åœ¨å‰ç«¯å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼Œé¼ æ ‡åœåœ¨å›¾ç‰‡ä¸Šæ—¶æ˜¾ç¤ºæ–‡å­—ä»‹ç»å’Œç¤¾äº¤å›¾æ ‡ç­‰ã€‚å‰åæ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š è¿™é‡Œä¸»è¦æ˜¯ç”¨åˆ°äº†positionå±æ€§ã€‚æœ¬æ–‡ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è®°å½•ä¸€ä¸‹è¯¥æ•ˆæœçš„å®ç°ã€‚ å°†æ–‡å­—æµ®åœ¨å›¾ç‰‡ä¸ŠHTMLä»£ç å¦‚ä¸‹ï¼š 123456&lt;div class="content"&gt; &lt;img src="https://scontent-sea1-1.cdninstagram.com/vp/26fafc3889d4437c79ba872a8260cb1d/5B9DF8FD/t51.2885-15/s480x480/e35/c0.123.1080.1080/30079276_1572484689529899_7245510271010078720_n.jpg" alt="song"&gt; &lt;div class="cover"&gt; Aimee Song &lt;/div&gt;&lt;/div&gt; å›¾ç‰‡å’Œæ–‡å­—æ˜¯åŒçº§çš„ï¼Œéƒ½åœ¨contentç›’å­é‡Œã€‚è¦å®ç°æ–‡å­—æµ®äºå›¾ç‰‡ä¸Šï¼Œéœ€è¦è®¾ç½®çˆ¶ç›’å­positionå±æ€§ä¸ºrelativeï¼Œæ–‡å­—å¯¹åº”ç›’å­ä¸ºabsoluteï¼Œä¹Ÿå°±æ˜¯ç›¸å¯¹äºçˆ¶ç›’å­çš„ç»å¯¹å®šä½ï¼Œè¿™æ ·æ‰èƒ½ä½¿æ–‡å­—æµ®èµ·æ¥ã€‚åŒæ—¶è¿˜éœ€è¦è®¾ç½®inline-blockå±æ€§ï¼Œè¿™æ ·contentä¸‹çš„å…ƒç´ æ—¢å¯ä»¥æ‹¥æœ‰blockå…ƒç´ å¯ä»¥è®¾ç½®widthå’Œheightçš„ç‰¹æ€§ï¼Œè¿˜èƒ½ä¿æŒinlineå…ƒç´ ä¸æ¢è¡Œçš„ç‰¹æ€§ã€‚ cssè®¾ç½®å¦‚ä¸‹ï¼š 123456789.content &#123; position: relative; display: inline-block;&#125;.cover&#123; position: absolute; /*bottomè®¾ç½®æ–‡å­—å¤„äºå›¾ç‰‡çš„ä»€ä¹ˆä½ç½®ï¼Œç›¸åº”çš„è¿˜æœ‰top, left, rightå¯ä»¥è®¾ç½®*/ bottom: 50px;&#125; é¼ æ ‡æ‚¬æµ®ä¸Šä¸€æ­¥å®ç°äº†æ–‡å­—ç½®äºå›¾ç‰‡ä¹‹å‰çš„é™æ€æ•ˆæœï¼Œç°åœ¨ä½¿ç”¨cssçš„hoveræ¥å®ç°é¼ æ ‡ç§»åŠ¨åˆ°çˆ¶çº§èº«ä¸Šæ—¶ï¼Œæ˜¾ç¤ºæ–‡å­—ã€‚æ‰€ä»¥éœ€è¦å…ˆå°†coverå…ƒç´ éšè—ï¼Œæ–°å¢çš„cssä»£ç å¦‚ä¸‹ï¼š 123456.cover&#123; display: none;&#125;.content:hover .cover&#123; display: block;&#125; åˆ°è¿™é‡Œå°±å¯ä»¥å®Œæˆå•¦ï¼å½“ç„¶ï¼Œä¹Ÿå¯ä»¥å¯¹æ–‡å­—å¢åŠ æ ·å¼ï¼Œæ¯”å¦‚æ·»åŠ èƒŒæ™¯é¢œè‰²ï¼Œè®¾ç½®å­—ä½“å¤§å°ä¹‹ç±»çš„ã€‚å…·ä½“è¯·æŸ¥çœ‹demoã€‚ å‚è€ƒæ–‡çŒ®ï¼šé¼ æ ‡æ‚¬æµ®æ§åˆ¶å…ƒç´ éšè—ä¸æ˜¾ç¤º-cssä¸­é¼ æ ‡çš„hoverçŠ¶æ€ è¯¦è§£CSS display:inline-blockçš„åº”ç”¨ å­¦ä¹ csså¸ƒå±€]]></content>
      <tags>
        <tag>css</tag>
        <tag>position</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨githubå±•ç¤ºå‰ç«¯é¡µé¢]]></title>
    <url>%2Famberwest.github.io%2F2018%2F08%2F02%2F%E4%BD%BF%E7%94%A8github%E5%B1%95%E7%A4%BA%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘åœ¨ç™¾åº¦å‰ç«¯æŠ€æœ¯å­¦é™¢å­¦ä¹ å‰ç«¯ï¼Œéœ€è¦å°†è‡ªå·±å†™çš„é™æ€é¡µé¢å±•ç¤ºå‡ºæ¥ã€‚æ ¹æ®ç½‘ç«™æä¾›çš„èµ„æºäº†è§£åˆ°åŸæ¥å¯ä»¥ä½¿ç”¨github pageæ¥å±•ç¤ºå‰ç«¯é¡µé¢ï¼ŒçœŸçš„æ˜¯å¾ˆèµäº†ã€‚ è¦å±•ç¤ºå·²æœ‰ä»£ç çš„repositoryçš„é¡µé¢ï¼Œåªéœ€è¦ä¸‰æ­¥å³å¯ã€‚ åˆ›å»ºgh-pagesåˆ†æ”¯ ä¹‹å‰ä¸Šä¼ çš„ä»£ç éƒ½é»˜è®¤å­˜åœ¨masteråˆ†æ”¯ä¸Šï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºæ–°çš„åˆ†æ”¯å¹¶åˆ‡æ¢ 1git checkout --orphan gh-pages ä¸Šä¼ ä»£ç åˆ‡æ¢åˆ°gh-pagesåˆ†æ”¯ä¹‹åï¼Œéœ€è¦å°†ä¹‹å‰çš„ä»£ç é‡æ–°æäº¤ä¸€é 123git add *git commit -m "first commit"git push -u origin gh-pages è¿™ä¸ªåˆ†æ”¯é‡Œçš„ä»£ç å°±æ˜¯ç”¨æ¥å±•ç¤ºé¡µé¢çš„ é¡µé¢è®¿é—®ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸‹é¢çš„é“¾æ¥å°±å¯ä»¥æŸ¥çœ‹å‰ç«¯é¡µé¢äº†ã€‚ http(s)://&lt;username&gt;.github.io/&lt;projectname&gt; åŸæœ¬çš„é¡µé¢æºç é“¾æ¥é•¿è¿™æ ·ï¼š https://github.com/amberwest/Front_End_Study/blob/master/day3/index.html ç°åœ¨å°†é“¾æ¥ä¿®æ”¹ä¸ºä¸‹é¢è¿™æ ·ï¼Œæ‰“å¼€å°±æ˜¯å¯¹åº”çš„å‰ç«¯é¡µé¢äº†ï¼š https://amberwest.github.io/Front_End_Study/day3/index.htmlã€‚ å‚è€ƒæ–‡ç« æ€ä¹ˆé¢„è§ˆ GitHub é¡¹ç›®é‡Œçš„ç½‘é¡µæˆ– Demoï¼Ÿ]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨pythonç¬¬ä¸‰æ–¹åº“å‘é€é‚®ä»¶]]></title>
    <url>%2Famberwest.github.io%2F2018%2F07%2F26%2F%E4%BD%BF%E7%94%A8python%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6%2F</url>
    <content type="text"><![CDATA[åœ¨pythonä¸­ç”¨æ¥å‘é€é‚®ä»¶çš„ç¬¬ä¸‰æ–¹åº“ä¸»è¦æ˜¯smtplibå’Œyagmailã€‚è¿™é‡Œç®€å•è®°å½•ä¸€ä¸‹è¿™ä¸¤ä¸ªåº“çš„ä½¿ç”¨ã€‚ SMTPæ˜¯å‘é€é‚®ä»¶çš„åè®®ï¼Œpythonå¯¹SMTPçš„æ”¯æŒæœ‰smtplibå’Œemailä¸¤ä¸ªæ¨¡å—ï¼Œemailè´Ÿè´£æ„é€ é‚®ä»¶ï¼Œsmtplibè´Ÿè´£å‘é€é‚®ä»¶ã€‚yagmailåº“ä¹Ÿæ˜¯ç”¨SMTPåè®®æ¥å‘é€é‚®ä»¶çš„ï¼Œä¸è¿‡æ•´ä¸ªè¿‡ç¨‹ç›¸å¯¹äºsmtplibæ¥è¯´å°±ç®€å•å¤šäº†ã€‚ SMTPå‘é€é‚®ä»¶ç°åœ¨æ¥æ„é€ ä¸€ä¸ªç®€å•çš„çº¯æ–‡æœ¬é‚®ä»¶ã€‚ åœ¨è¯¥ä¾‹å­ä¸­ï¼Œå‘ä»¶äººä½¿ç”¨çš„æ˜¯QQé‚®ç®±ï¼Œå¯†ç åˆ™æ˜¯å¼€å¯POP3/SMTPæœåŠ¡æ—¶çš„æˆæƒç ï¼Œå¯¹åº”çš„hostæ˜¯smtp.qq.comã€‚æ”¶ä»¶äººç”¨çš„æ˜¯163é‚®ç®±ï¼Œå¯¹åº”çš„hostæ˜¯smtp.163.comï¼Œå¯ä»¥æŠŠè¿™äº›ä¿¡æ¯éƒ½æš‚æ—¶åœ°å†™å…¥ç¯å¢ƒå˜é‡ï¼Œç„¶åä½¿ç”¨osæ¨¡å—çš„getenvæ–¹æ³•è·å–ã€‚ 1234567891011121314151617181920212223242526272829303132from email.header import Headerfrom email.mime.text import MIMETextfrom email.utils import parseaddr, formataddrimport smtplibimport osusername = '1000000@qq.com'password = 'qq_email_password'host = 'smtp.163.com'to = 'another_email@163.com'def _format_add(s): """æ ¼å¼åŒ–é‚®ä»¶åœ°å€""" name, addr = parseaddr(s) return formataddr((Header(name, 'utf-8').encode(), addr))# MIMETextä¸‰ä¸ªå‚æ•°ï¼š _text, _subtype='plain', _charset=Nonemsg = MIMEText('The first email', 'plain', 'utf-8')msg['From'] = _format_add('spider &lt;%s&gt;' % username)msg['To'] = _format_add('ç®¡ç†å‘˜ &lt;%s&gt;' % to)# å› ä¸ºä¸»é¢˜åŒ…å«ä¸­æ–‡ï¼Œæ‰€ä»¥éœ€è¦Headerå¯¹è±¡è¿›è¡Œç¼–ç msg['Subject'] = Header('æ¥è‡ªSMTPçš„é‚®ä»¶', 'utf-8').encode()# é“¾æ¥å¹¶å‘é€é‚®ä»¶server = smtplib.SMTP(host, 25)# ä½¿ç”¨server.set_debuglevel(1)å¯ä»¥æ‰“å°å‡ºå’ŒSMTPæœåŠ¡å™¨äº¤äº’çš„æ‰€æœ‰ä¿¡æ¯server.set_debuglevel(1)server.login(username, password)# to_addrå¯ä»¥æœ‰å¤šä¸ªé‚®ç®±server.sendmail(from_addr=username, to_addr=[to], msg.as_string())server.quit() yagmailå‘é€é‚®ä»¶yagmailçš„ä½¿ç”¨å°±è¶…çº§ç®€å•ï¼Œä¸ç”¨emailå»æ„å»ºé‚®ä»¶ï¼Œç›´æ¥ä¸Šä»£ç ã€‚ 12345678910import yagmailyag = yagmail.SMTP(user=username, password=password, host=host)# é‚®ç®±æ­£æ–‡contents = ['This is the body']attachments = ['louis.png']# å‘é€é‚®ä»¶, æ²¡æä¾›é‚®ç®±åˆ™é»˜è®¤æ˜¯å‘é€ç»™è‡ªå·±yag.send(to, subject=['test yagmail'], contents=contents, attachments=attachments) ä¸ºäº†é¿å…å¯†ç æš´éœ²åœ¨è„šæœ¬ä¸­ï¼Œå¯ä»¥ä½¿ç”¨keyringæ¨¡å—ï¼Œå°†å¯†ç ä¿å­˜åœ¨ç³»ç»ŸkeyringæœåŠ¡ä¸­ï¼ŒæˆåŠŸè®¾ç½®ä¹‹åå°±ä¸ç”¨åœ¨è„šæœ¬ä¸­æä¾›å¯†ç äº†ã€‚ 123import keyringkeyring.set_password('yagmail', username, password) æ›´å¤šçš„ç”¨æ³•å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚ å®Œæ•´çš„ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253# -*- coding:utf-8 -*-# Time: 2018/7/26 09:57import yagmailfrom email.header import Headerfrom email.mime.text import MIMETextfrom email.utils import parseaddr, formataddrimport smtplibimport osusername = os.getenv('QQ_USERNAME')password = os.getenv('QQ_PASSWORD')host = os.getenv('SMTP_SERVER')to = os.getenv('WY_USERNAME')def spider(): try: 1 / 0 except ZeroDivisionError as e: msg = ''.join(msg) yagmail_send(msg) smtplib_send(msg) print(msg)def yagmail_send(m): """å°†æŠ¥é”™ä¿¡æ¯å‘é€åˆ°é‚®ä»¶""" yag = yagmail.SMTP(username) contents = [m, 'louis.png'] yag.send(to, subject='error from spider', contents=contents)def smtplib_send(m): """ä½¿ç”¨smtplibæ¨¡å—æ¥å‘é€é‚®ä»¶""" msg = MIMEText(m, 'plain', 'utf-8') msg['From'] = _format_add('spider &lt;%s&gt;' % username) msg['To'] = _format_add('ç®¡ç†å‘˜ &lt;%s&gt;' % to) msg['Subject'] = Header('çˆ¬è™«å‡ºé”™ï¼ï¼', 'utf-8').encode() server = smtplib.SMTP(host, 25) server.login(username, password) server.sendmail(username, [to], msg.as_string()) server.quit()def _format_add(s): name, addr = parseaddr(s) return formataddr((Header(name, 'utf-8').encode(), addr))if __name__ == '__main__': spider() å‚è€ƒæ–‡ç« ï¼šSMTPå‘é€é‚®ä»¶ yagmail]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>yagmail</tag>
        <tag>smtplib</tag>
        <tag>email</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[supervisorï¼šé…ç½®åŠä½¿ç”¨]]></title>
    <url>%2Famberwest.github.io%2F2018%2F07%2F24%2Fsupervisor%EF%BC%9A%E9%85%8D%E7%BD%AE%E5%8F%8A%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[supervisoræ˜¯python2å†™çš„ä¸€æ¬¾è¿ç»´å·¥å…·ï¼Œä¸è¿‡ç›®å‰å¹¶ä¸æ”¯æŒpython3ã€‚æ‰€ä»¥ç›´æ¥ç”¨pip3 install supervisoræˆ–è€…pipenvç›´æ¥å®‰è£…éƒ½ä¼šæŠ¥é”™ã€‚è€ŒMacè‡ªå¸¦çš„pythonç‰ˆæœ¬æ˜¯2.7ï¼Œå¯ä»¥ç›´æ¥ç”¨brewæ¥å®‰è£…supervisorï¼Œä¹‹ååœ¨å¯¹åº”çš„é¡¹ç›®æŒ‡å®šè¿è¡Œpython3å»è¿è¡Œä»£ç å³å¯ã€‚ ä¸‹é¢ç®€å•è®°å½•ä¹‹å‰ä½¿ç”¨supervisorçš„è¿‡ç¨‹ï¼š å®‰è£…supervisorç›´æ¥ä½¿ç”¨brewå®‰è£… 1brew install supervisor ç”Ÿæˆé»˜è®¤é…ç½®æ–‡ä»¶å­˜æ”¾é…ç½®æ–‡ä»¶çš„è·¯å¾„å¯ä»¥ä»»æ„æŒ‡å®šï¼Œåªéœ€è¦ç¡®ä¿è·¯å¾„å­˜åœ¨å³å¯ 1echo_supervisord_conf &gt; /usr/local/etc/supervisord.conf å¦å¤–ï¼Œæˆ‘åœ¨etc/ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹æ¥å­˜æ”¾å…¶ä»–é¡¹ç›®çš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚proj.confï¼Œåæ–‡ä¼šæåˆ°ï¼Œç»“æ„å¦‚ä¸‹ï¼š ä¿®æ”¹é…ç½®æ–‡ä»¶æœ€åçš„includeå°¤å…¶é‡è¦ï¼Œå¯ä»¥æ–¹ä¾¿åœ°ä¸ºæ¯ä¸ªé¡¹ç›®å•ç‹¬è®¾ç½®confæ–‡ä»¶ï¼Œè¿™æ ·å°±ä¸ç”¨å…¨éƒ¨å†™åœ¨å…¨å±€é…ç½®é‡Œé¢ï¼Œä¹Ÿæ–¹ä¾¿ä¿®æ”¹ã€‚ å¢åŠ é¡¹ç›®çš„é…ç½®æ–‡ä»¶è¿™ä¸ªé…ç½®æ–‡ä»¶ä¹Ÿå¯ä»¥ç›´æ¥å†™å…¥å…¨å±€é…ç½®æ–‡ä»¶é‡Œçš„(supervisord.conf)ã€‚è¿™é‡Œæ˜¯å•ç‹¬è®¾ç½®ï¼Œå¿…é¡»æ”¾åœ¨supervisor/ä¸‹ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€æ­¥ä¸­incluedeæŒ‡å®šçš„ä½ç½®ã€‚ å¯åŠ¨supervisordsupervisordæ˜¯supervisorçš„æœåŠ¡ç«¯ç¨‹åºï¼Œå¯åŠ¨supervisorç®¡ç†çš„å­è¿›ç¨‹ï¼Œå“åº”æ¥è‡ªclientsçš„è¯·æ±‚ã€‚ åœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š 1supervisord -c /usr/local/etc/supervisord.conf å¦‚æœåœ¨é…ç½®æ–‡ä»¶ä¸­æœ‰å¼€å¯[inet_http_server]å’Œport=127.0.0.1:9001ï¼Œé‚£ä¹ˆæˆåŠŸå¯åŠ¨ä¹‹åå°±å¯ä»¥åœ¨æµè§ˆå™¨é‡Œæ‰“å¼€ï¼ŒæŸ¥çœ‹é¡¹ç›®çš„è¿è¡ŒçŠ¶æ€ï¼Œé‡å¯ã€å…³é—­é¡¹ç›®ç­‰æ“ä½œï¼Œéå¸¸ä¾¿æ·ã€‚ å…³é—­supervisordæ—¶ï¼Œé€šè¿‡ps aux | grep supervisordè·å¾—pidä¹‹åkillã€‚æ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚ å¯åŠ¨supervisorctlsupervisorctlæä¾›äº†ä¸€ä¸ªç±»å‹shellçš„å‘½ä»¤è¡Œç•Œé¢ï¼Œå¯ä»¥å¯¹å­è¿›ç¨‹è¿›è¡Œç›¸å…³æ“ä½œï¼Œæ¯”å¦‚æŸ¥çœ‹çŠ¶æ€ã€å¯åŠ¨/åœæ­¢/é‡å¯å­è¿›ç¨‹ç­‰ã€‚ åœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤(å¯ä»¥ä¸ç”¨æŒ‡å®šé…ç½®æ–‡ä»¶)ï¼š 1supervisorctl [-c â€¦/*.conf] é€€å‡ºsupervisorctlæ—¶ï¼Œåœ¨supervisorctl shellä¸­è¾“å…¥exité€€å‡ºã€‚ è¿›ç¨‹ç»„çš„ä½¿ç”¨supervisoråŒæ—¶è¿˜æä¾›äº†å¦å¤–ä¸€ç§è¿›ç¨‹ç»„çš„ç®¡ç†æ–¹å¼ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥ä½¿ç”¨supervisorctlå‘½ä»¤æ¥ç®¡ç†ä¸€ç»„è¿›ç¨‹ã€‚æ›´[program:x]çš„è¿›ç¨‹ç»„ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œçš„è¿›ç¨‹æ˜¯ä¸€ä¸ªä¸ªçš„[program:x]ã€‚ å½“æ·»åŠ äº†ä¸Šè¿°é…ç½®åï¼Œprogname1å’Œprogname2çš„è¿›ç¨‹åä¼šå˜æˆthegroupname:progname1 å’Œthegroupname:progname2ï¼Œä»¥åå°±è¦ç”¨åä¸¤ä¸ªåå­—æ¥ç®¡ç†è¿›ç¨‹äº†ã€‚ ä»¥åæ‰§è¡Œsupervisorctl stop thegroupname:å°±èƒ½åŒæ—¶ç»“æŸprogname1å’Œprogname2ï¼Œæ‰§è¡Œsupervisorctl stop thegroupname:progname1å°±èƒ½ç»“æŸprogname1`ã€‚ å‚è€ƒæ–‡ç« ï¼šsupervisor(ä¸€)åŸºç¡€ç¯‡ Running Supervisor]]></content>
      <tags>
        <tag>supervisor</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[pythonï¼šå­—ç¬¦ä¸²æ ¼å¼åŒ–æ–¹æ³•]]></title>
    <url>%2Famberwest.github.io%2F2018%2F07%2F22%2Fpython%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[pythonä¸­å¸¸ç”¨çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–æ–¹æ³•æœ‰ï¼š%æ“ä½œç¬¦ã€str.format()æ ¼å¼ï¼Œè¿˜æœ‰python3.6æ–°å¢çš„f-stringsã€‚ä¸è¿‡è¦å°½é‡ä½¿ç”¨formatæ–¹å¼å’Œf-stringsï¼Œè€Œä¸æ˜¯%æ“ä½œç¬¦ã€‚ %æ“ä½œç¬¦åŸºæœ¬å½¢å¼ä¸ºï¼š%[(name)][flags][width].[precision]typecode flagsæ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²è½¬æ¢æ ‡è®°ã€‚ è½¬æ¢æ ‡è®° è§£é‡Š - è¡¨ç¤ºå·¦å¯¹é½ + åœ¨æ­£æ•°å‰é¢åŠ ä¸Š+ â€˜ â€™(a space) è¡¨ç¤ºæ­£æ•°å‰é¢ä¿ç•™ç©ºæ ¼ # åœ¨å…«è¿›åˆ¶æ ‘å‰æ˜¾ç¤ºé›¶(â€˜0â€™)ï¼Œåœ¨åå…­è¿›åˆ¶å‰æ˜¾ç¤ºOxæˆ–è€…OX 0 è¡¨ç¤ºè½¬æ¢å€¼è‹¥ä½æ•°ä¸å¤Ÿç”¨0å¡«å……è€Œéé»˜è®¤çš„ç©ºæ ¼ typecodeæ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²è½¬æ¢ç±»å‹ã€‚ è½¬æ¢ç±»å‹ è§£é‡Š s å­—ç¬¦ä¸²ï¼ˆé‡‡ç”¨str()çš„æ˜¾ç¤ºï¼‰ r å­—ç¬¦ä¸²ï¼ˆé‡‡ç”¨repr()çš„æ˜¾ç¤ºï¼‰ c å•ä¸ªå­—ç¬¦ b äºŒè¿›åˆ¶æ•´æ•° iã€d åè¿›åˆ¶æ•´æ•° o å…«è¿›åˆ¶æ•´æ•° xã€X åå…­è¿›åˆ¶æ•´æ•° eã€E æŒ‡æ•°ï¼ˆåŸºåº•å†™ä¸ºe/Eï¼‰ fã€F æµ®ç‚¹æ•° gã€G å¦‚æœæŒ‡æ•°å¤§äº-4æˆ–è€…å°äºç²¾åº¦å€¼åˆ™å’Œe/Eç›¸åŒï¼Œå…¶ä»–æƒ…å†µå’Œf/Fç›¸åŒ %æ“ä½œç¬¦æ ¼å¼åŒ–å­—ç¬¦ä¸²æœ‰ä»¥ä¸‹å‡ ç§å¸¸è§ç”¨æ³•ï¼š ç›´æ¥æ ¼å¼åŒ–å­—ç¬¦æˆ–è€…æ•°å€¼ 1234&gt;&gt;&gt; price = 99&gt;&gt;&gt; s = 'the price is %+10.2f' % price'the price is +99.00' %+10.2fä¹Ÿå¯ä»¥å†™ä¸º%(price)+10.2fï¼Œæ ¹æ®åŸºæœ¬å½¢å¼%[(name)][flags][width].[precision]typecodeï¼Œå…¶ä¸­nameä¸ºpriceï¼Œflagesä¸º+ï¼Œwidthä¸º10ï¼Œprecisionä¸º2ï¼Œå³ä¿ç•™ä¸¤ä½å°æ•°ï¼Œtypecodeä¸ºfï¼Œå³æµ®ç‚¹æ•°ã€‚ ä»¥å…ƒç»„çš„å½¢å¼æ ¼å¼åŒ– 123&gt;&gt;&gt; s = 'His name is %s, his age is %d' % ('Adam', 22)'His name is Adam, his age is 22' ä»¥å­—å…¸çš„å½¢å¼æ ¼å¼åŒ– 1234&gt;&gt;&gt; data = &#123;'name':'Adam', 'age': 22 &#125;&gt;&gt;&gt; s = 'His name is %(name)s, his age is %(age)d' % data'His name is Adam, his age is 22' .formatæ ¼å¼åŒ–str.format()çš„åŸºæœ¬æ ¼å¼ï¼š[[å¡«å……ç¬¦]å¯¹é½æ–¹å¼][ç¬¦å·][#][0][å®½åº¦][,][.ç²¾ç¡®åº¦][è½¬æ¢ç±»å‹]ã€‚å¡«å……ç¬¦å¯ä»¥æ˜¯é™¤äº†â€{â€œå’Œâ€}â€ä¹‹å¤–çš„ä»»æ„ç¬¦å·ï¼Œè½¬æ¢ç±»å‹è·Ÿ%æ“ä½œç¬¦çš„è½¬æ¢ç±»å‹ç±»ä¼¼ã€‚ å¯¹é½æ–¹å¼ å¯¹é½æ–¹å¼ è§£é‡Š &lt; å·¦å¯¹é½ï¼Œæ˜¯å¤§å¤šæ•°å¯¹è±¡é»˜è®¤çš„å¯¹é½æ–¹å¼ &gt; å³å¯¹é½ï¼Œæ•°å€¼é»˜è®¤çš„å¯¹é½æ–¹å¼ = ä»…å¯¹æ•°å€¼ç±»å‹åˆå°ï¼Œå¦‚æœæœ‰ç¬¦å·çš„è¯ï¼Œåœ¨ç¬¦å·åæ•°å€¼å‰è¿›è¡Œå¡«å……ï¼Œå¦‚-000029 ^ å±…ä¸­å¯¹é½ï¼Œç”¨ç©ºæ ¼è¿›è¡Œå¡«å…… ç¬¦å·åˆ—è¡¨ ç¬¦å· è§£é‡Š + æ­£æ•°å‰åŠ +ï¼Œè´Ÿæ•°å‰åŠ - - æ­£æ•°å‰ä¸åŠ ç¬¦å·ï¼Œè´Ÿæ•°å‰åŠ -ï¼Œä¸ºæ•°å€¼çš„é»˜è®¤å½¢å¼ â€˜ â€˜(ç©ºæ ¼) æ­£æ•°å‰åŠ ç©ºæ ¼ï¼Œè´Ÿæ•°å‰åŠ - è·Ÿ%æ“ä½œç¬¦ä¸åŒçš„ä¸€ç‚¹æ˜¯ï¼Œæœ‰äº›è½¬æ¢ç±»å‹æ˜¯ä¸åŒçš„ è½¬æ¢ç±»å‹ è§£é‡Š !s å­—ç¬¦ä¸²ï¼Œè°ƒç”¨str()æ–¹æ³• !r å­—ç¬¦ä¸²ï¼Œè°ƒç”¨repr()æ–¹æ³• !a ascii() 123456&gt;&gt;&gt; "&#123;0!r:&gt;20&#125;".format("Hello") # '%+20r' % 'Hello'" 'Hello'"&gt;&gt;&gt; "&#123;0:&gt;20&#125;".format("Hello")' Hello' .formatæ–¹æ³•å¸¸è§ç”¨æ³•å¦‚ä¸‹ï¼š ä½¿ç”¨ä½ç½®ç¬¦å· 123&gt;&gt;&gt; "The number &#123;0:,&#125; in hex is: &#123;0:#x&#125;, the number &#123;1&#125; in oct is &#123;1:#0&#125;".format(4746, 45)'The number 4,746 in hex is: 0x128a, the number 45 in oct is 45' ä½¿ç”¨åç§° 123&gt;&gt;&gt; "the max number is &#123;max&#125;, the min number is &#123;min&#125;, the average number is &#123;average:0.3f&#125;".format(max=189, min=12.6, average=23.5)'the max number is 189, the min number is 12.6, the average number is 23.500' å¦‚æœéœ€è¦è¿›è¡Œæ›´å¤šçš„æ ¼å¼å¤„ç†ï¼Œå°±åœ¨:åé¢æ·»åŠ å³å¯ã€‚å¦‚&quot;{0:^20}&quot;.format(&quot;Hello&quot;). é€šè¿‡å±æ€§ 1234567891011&gt;&gt;&gt; class Customer(object):&gt;&gt;&gt; def __init__(self, name, gender):... self.name = name... self.gender = gender &gt;&gt;&gt; def __str__(self):... return "Customer (&#123;self.name&#125;, &#123;self.gender&#125;)".format(self=self) &gt;&gt;&gt; str(Customer('Lisa', 'Female'))'Customer(Lisa, Female)' æ ¼å¼åŒ–å…ƒç»„çš„å…·ä½“é¡¹ ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå‚æ•°çš„é¡ºåºä¸æ ¼å¼åŒ–çš„é¡ºåºä¸å¿…å®Œå…¨ç›¸åŒ 1234567891011&gt;&gt;&gt; point = (1, 3)&gt;&gt;&gt; print('X:&#123;0[0]&#125;; Y:&#123;0[1]&#125;'.format(point))&gt;&gt;&gt; w = [('a', 10), ('b', 20), ('c', 30)]&gt;&gt;&gt; f = 'this is &#123;0[0]&#125;, this is &#123;0[1]&#125;'.format&gt;&gt;&gt; for i in map(f, w):... print(i) this is a, this is 10this is b, this is 20this is c, this is 30 f-stringspython3.6ä¹‹åæ–°å¢äº†f-stringsæ ¼å¼åŒ–è¯­æ³•ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š 1f &apos; &lt;text&gt; &#123; &lt;expression&gt; &lt;optional !s, !r, or !a&gt; &lt;optional : format specifier&gt; &#125; &lt;text&gt; ... &apos; åŸºæœ¬ç”¨æ³•ï¼š 123456&gt;&gt;&gt; import datetime&gt;&gt;&gt; name = 'Fred'&gt;&gt;&gt; age = 50&gt;&gt;&gt; anniversary = datetime.date(1991, 10, 12)&gt;&gt;&gt; f'My name is &#123;name&#125;, my age next year is &#123;age+1&#125;, my anniversary is &#123;anniversary:%A, %B %d, %Y&#125;.''My name is Fred, my age next year is 51, my anniversary is Saturday, October 12, 1991.' æ”¯æŒè¡¨è¾¾å¼ï¼š 1234&gt;&gt;&gt; def foo():... return 20&gt;&gt;&gt; f'result=&#123;foo()&#125;''result=20' æ ¼å¼ç¬¦ï¼š 123456789&gt;&gt;&gt; width = 10&gt;&gt;&gt; precision = 4&gt;&gt;&gt; value = decimal.Decimal('12.34567')&gt;&gt;&gt; f'result: &#123;value:&#123;width&#125;.&#123;precision&#125;&#125;''result: 12.35'# å¦‚æœæ˜¯æ•´æ•°çš„è¯ï¼Œåˆ™ä¸èƒ½ä¼ é€’ç²¾ç¡®åº¦age = 50f'&#123;age:^10&#125;' ä¸åŸå§‹å­—ç¬¦ä¸²ä½¿ç”¨ï¼š 123&gt;&gt;&gt; header = 'Subject'&gt;&gt;&gt; fr'&#123;header&#125;:\s+''Subject:\\s+' ä½¿ç”¨èŠ±æ‹¬å·ï¼š 1234&gt;&gt;&gt; f"&#123;&#123; &#123;10 * 8&#125; &#125;&#125;" # æ³¨æ„ç©ºæ ¼'&#123; 80 &#125;'&gt;&gt;&gt; f"&#123;&#123; 10 * 8 &#125;&#125;"'&#123; 10 * 8 &#125;' ä¸åŒ¿åå‡½æ•°ä½¿ç”¨ï¼š 12&gt;&gt;&gt; f'&#123;(lambda x: x*2)(3)&#125;' '6' åœ¨f-stringsä¸­ä¸èƒ½ä½¿ç”¨\ï¼Œå¯ä»¥ç”¨å•åŒå¼•å·è¿›è¡ŒåŒºåˆ†ï¼Œå¦‚æœéœ€è¦è·¨è¡Œï¼Œåˆ™ä½¿ç”¨ä¸‰ä¸ªå•å¼•å·ã€‚ å‚è€ƒæ–‡ç« ï¼šæé«˜pythonä»£ç ç¼–å†™è´¨é‡çš„91ä¸ªå»ºè®® common string operations Literal String Interpolation]]></content>
      <tags>
        <tag>æ ¼å¼åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[python3ï¼šä»£ç†è®¾ç½®]]></title>
    <url>%2Famberwest.github.io%2F2018%2F07%2F19%2Fpython3-%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[åœ¨çˆ¬è™«è¿‡ç¨‹æœ‰æ—¶å€™éœ€è¦æ›´æ¢ipä»¥é˜²è¢«å°ï¼Œä¸»è¦æœ‰HTTPä»£ç†å’Œsocks5ä»£ç†ã€‚ ä½¿ç”¨requestsè®¾ç½®HTTPä»£ç†12345678import requestsproxies = &#123; "http": "http://127.0.0.1:8118", "https": "http://127.0.0.1:8118",&#125;requests.get("http://httpbin.org/get", proxies=proxies) å¦‚æœä»£ç†éœ€è¦HTTP Basic Authï¼Œå¯ä»¥ä½¿ç”¨http://user:password@host:port/ã€‚ ä½¿ç”¨requestsè®¾ç½®socks5ä»£ç†1ã€å…¨å±€è®¾ç½® ä½¿ç”¨socksæ¨¡å—ï¼Œéœ€è¦å…ˆå®‰è£…ä¾èµ–åº“ 1pip install PySocks 12345678import socksimport socketimport requestssocks.set_default_proxy(socks.SOCKS5, '127.0.0.1', 1080)socket.socket = socks.socksocketresponse = requests.get('http://httpbin.org/get')print(response.text) 2ã€å±€éƒ¨è®¾ç½® requestsä¹Ÿæ”¯æŒsocks5ä»£ç†ï¼Œè·Ÿè®¾ç½®HTTPä»£ç†ä¸€æ ·ï¼Œå¯ä»¥åªä½œç”¨åœ¨éƒ¨åˆ†è¯·æ±‚ä¸Šã€‚ä¸è¿‡éœ€è¦å…ˆå®‰è£…ç¬¬ä¸‰æ–¹åº“ 1pip install requests[socks] ä½¿ç”¨æ–¹æ³•æ˜¯ä¹‹å‰ç±»ä¼¼ï¼Œå¦‚æœéœ€è¦éªŒè¯ï¼Œæ ¼å¼ç±»ä¼¼ï¼šsocks5://user:pass@host:port 123456789101112import requestsproxies = &#123; 'http': 'socks5://127.0.0.1:1080', 'https': 'socks5://127.0.0.1:1080'&#125;try: response = requests.get('http://httpbin.org/get', proxies=proxies) print(response.text)except requests.exceptions.ConnectionError as e: print(e.args) ä½¿ç”¨urllibè®¾ç½®HTTPä»£ç†123456789101112131415from urllib.error import URLErrorfrom urllib.request import ProxyHandler, build_openerproxy = '127.0.0.1:8118'proxy_handler = ProxyHandler(&#123; 'http': 'http://' + proxy, 'https': 'https://' + proxy&#125;)opener = build_opener(proxy_handler)try: response = opener.open('http://httpbin.org/get') print(response.read().decode('utf-8'))except URLError as e: print(e.reason) ä½¿ç”¨urllibè®¾ç½®socks5ä»£ç†12345678910from urllib.request import ProxyHandler, build_opener, urlopenfrom urllib.error import URLErrorproxy_handler = ProxyHandler(&#123;'sock5': 'localhost:1080'&#125;)opener = build_opener(proxy_handler)try: response = urlopen('http://httpbin.org/get') print(response.read())except URLError as e: print(e.reason) urllibä¹Ÿå¯ä»¥åƒrequestsåº“è®¾ç½®å…¨å±€ä»£ç†é‚£æ ·è®¾ç½®socks5ä»£ç†ï¼Œå…·ä½“ä»£ç è·Ÿä¹‹å‰ç±»ä¼¼ï¼š 123456789101112import socksimport socketfrom urllib.request import urlopenfrom urllib.error import URLErrorsocks.set_default_proxy(socks.SOCKS5, '127.0.0.1', 1080)socket.socket = socks.socksockettry: response = urlopen('http://httpbin.org/get') print(response.read())except URLError as e: print(e.reason) æœ€åä¸€ç‚¹è¯´æ˜ï¼Œæˆ‘åœ¨æœ¬åœ°1080ç«¯å£æ­äº†socks5ä»£ç†ï¼Œå¹¶ç”¨privoxyå°†socks5ä»£ç†è½¬ä¸ºHTTPä»£ç†ï¼Œç«¯å£ä¸º8118ã€‚æ‰€ä»¥æµ‹è¯•çš„æ—¶å€™ä½¿ç”¨ä¸åŒç«¯å£ä»£è¡¨ä¸åŒçš„ä»£ç†ç±»å‹ã€‚å…·ä½“è®¾ç½®è¿‡ç¨‹å¯ä»¥æŸ¥çœ‹ä¹‹å‰çš„æ–‡ç« ã€ŠMacç»ˆç«¯ä½¿ç”¨ä»£ç†ã€‹ã€‚]]></content>
      <categories>
        <category>å…¶ä»–</category>
      </categories>
      <tags>
        <tag>ä»£ç†</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[redisåŸºæœ¬æ•°æ®ç»“æ„å’ŒåŸºæœ¬æ“ä½œ]]></title>
    <url>%2Famberwest.github.io%2F2018%2F07%2F12%2Fredis%E5%B8%B8%E7%94%A8API%2F</url>
    <content type="text"><![CDATA[åœ¨ç»ˆç«¯ç™»å½•åˆ°redisæ•°æ®åº“çš„æ­¥éª¤å¦‚ä¸‹ï¼š ç™»å½•redis-server 1redis-server /path/to/the/config/file ç™»å½•redis-cli 1234567# å¦‚æœæ²¡æœ‰å¯†ç å°±ç›´æ¥redis-cliredis-cli -a your-password# ä¹Ÿå¯ä»¥è¿›å…¥åˆ°redisä¹‹åå†ä½¿ç”¨auth your-passwordè¿›è¡ŒéªŒè¯# å¦‚æœæ˜¯è¿œç¨‹è®¿é—®redisæœåŠ¡ï¼Œå‰ææ˜¯ï¼Œè¿œç¨‹redisæœåŠ¡ä¹Ÿå·²ç»å¼€å¯ï¼Œæ–¹å¼å¦‚ä¸Šæ‰€ç¤ºredis-cli -h remote_ip -p port é€‰æ‹©æ•°æ®åº“ 1select 1 é€šç”¨å‘½ä»¤ å‘½ä»¤ è¯´æ˜ å¤‡æ³¨ keys [pattern] éå†ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰é”® è¯¥å‘½ä»¤ä¸€èˆ¬ä¸åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ dbsize æ˜¾ç¤º å½“å‰åº“çš„keyæ•°ç›® exists key æŸ¥çœ‹æŸä¸ªkeyæ˜¯å¦å­˜åœ¨ ttl key æŸ¥çœ‹keyè¿˜æœ‰å¤šå°‘æ—¶é—´æ‰è¿‡æœŸ ç»“æœ&gt;0è¯´æ˜è¿˜æœ‰å¯¹åº”çš„ç§’æ•°æ‰è¿‡æœŸï¼› -1è¯´æ˜keyå­˜åœ¨ï¼Œå¹¶ä¸”æ²¡æœ‰è¿‡æœŸæ—¶é—´ -2è¯´æ˜keyå·²ç»ä¸å­˜åœ¨äº† persist key å»æ‰keyçš„è¿‡æœŸæ—¶é—´ del key1 key2 åˆ é™¤key-value å¯ä»¥åˆ é™¤å¤šä¸ªkeyï¼Œä»¥ç©ºæ ¼éš”å¼€ expire key secondsï¼ˆå…·ä½“ç§’æ•°ï¼‰ keyåœ¨secondsç§’ä¹‹åè¿‡æœŸ type key è¿”å›keyçš„ç±»å‹ flushdb åˆ é™¤å½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰key flushall åˆ é™¤æ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰key config key * æŸ¥çœ‹æ‰€æœ‰çš„å¯é…ç½®é€‰é¡¹ rename key newkey ä¿®æ”¹keyçš„åå­— renamenx key newkey ä»…å½“newkeyä¸å­˜åœ¨æ—¶ï¼Œå°†keyä¿®æ”¹ä¸ºnewkey move key db å°†å½“å‰æ•°æ®åº“çš„keyç§»åŠ¨åˆ°ç»™å®šçš„æ•°æ®åº“dbå½“ä¸­ dump key åºåˆ—åŒ–keyï¼Œå¹¶è¿”å›è¢«åºåˆ—åŒ–çš„å€¼ æ•°æ®ç»“æ„å­—ç¬¦ä¸²ï¼ˆstringï¼‰mgetã€msetæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œå…¶ä»–çš„æ“ä½œéƒ½ä¸ºO(1) API è¯´æ˜ ä¾‹å­ å¤‡æ³¨ set è®¾ç½®/ä¿®æ”¹æ•°æ® set hello world åªèƒ½å¯¹å•ä¸ªæ“ä½œï¼Œgetå’Œdelä¹Ÿæ˜¯ get è·å– get hello del åˆ é™¤ del hello incrã€decr è‡ªå¢ã€è‡ªå‡ incr count keyä¸å­˜åœ¨é‚£ä¹ˆæ‰§è¡Œä¹‹åkeyä¸º1/-1 incrbyã€decrby æŒ‰æŒ‡å®šæ•°å€¼è¿›è¡Œå¢åŠ (å‡å°‘) incrby count 10 incrby/decrby key num setnx keyä¸å­˜åœ¨æ—¶æ‰èƒ½è®¾ç½®æˆåŠŸ setnx php best setnx key value getset æ›´æ–°å¹¶è¿”å›æ—§key getset count 99 getset key newvalue msetã€mget æ‰¹é‡æ“ä½œ mset k1 v1 k2 v2 mset / mget key1 value1 key2 value2 append å°†valueè¿½åŠ åˆ°æ—§çš„valueåé¢ append k1 v3 append key valueï¼Œç±»ä¼¼å­—ç¬¦ä¸²æ‹¼æ¥ strlen è¿”å›keyçš„å­—èŠ‚é•¿åº¦ strlen k1 strlen key incrbyfloat ç»™keyå¢åŠ æµ®ç‚¹æ•° incrbyfloat num 3.5 incrbyfloat key num(float) getrange è·å–å­—ç¬¦ä¸²æŒ‡å®šä¸‹æ ‡çš„æ‰€æœ‰å€¼ getrange hello 1 3 getrange key start endï¼ŒåŒ…æ‹¬end setrange è®¾ç½®æŒ‡å®šä¸‹æ ‡å¯¹åº”çš„å€¼ setrange hello 1 h setrange key index vale åˆ—è¡¨ï¼ˆlistï¼‰ API è¯´æ˜ ä¾‹å­ å¤‡æ³¨ rpush ä»åˆ—è¡¨å³è¾¹æ’å…¥å¤šä¸ªå€¼ rpush listkey c b a rpush key value1 value2 value3 lpush ä»åˆ—è¡¨å·¦è¾¹æ’å…¥å¤šä¸ªå€¼ lpush listkey c b a lpush key value1 value2 value3 linsert åœ¨æŒ‡å®šçš„valueå‰é¢/åé¢æ’å…¥newvalue linsert listkey before a java linsert key before / after value newvalue lpop ä»åˆ—è¡¨å·¦è¾¹å¼¹å‡ºä¸€ä¸ªitem lpop listkey lpop key rpop ä»åˆ—è¡¨å³è¾¹å¼¹å‡ºä¸€ä¸ªitem rpop listkey rpop key lrem åˆ é™¤countä¸ªä¸valueç›¸åŒçš„é¡¹count&gt;0ï¼šä»å·¦åˆ°å³æœ€å¤šåˆ é™¤countä¸ªvalueç›¸ç­‰çš„é¡¹ ï¼›count&lt;0ï¼šä»å³åˆ°å·¦æœ€å¤šåˆ é™¤countä¸ªvalueç›¸ç­‰çš„é¡¹ ï¼› count=0ï¼šåˆ é™¤åˆ—è¡¨ä¸­æ‰€æœ‰ç­‰äºvalueçš„é¡¹ lrem listkey -1 c lrem listkey 0 b lrem key count value lrange è·å–åˆ—è¡¨æŒ‡å®šç´¢å¼•èŒƒå›´æ‰€æœ‰item lrange listkey 2 5 lrange listkey -6 -1 lrange key start end(åŒ…å«endï¼‰ ltrim æŒ‰ç…§ç´¢å¼•èŒƒå›´ä¿®å‰ªåˆ—è¡¨ ltrim listkey 0 6 ltrim key start end lindex æ ¹æ®æŒ‡å®šçš„indexæ¥è·å–å¯¹åº”çš„item lindex listkey 2 lindex key index llen è·å–åˆ—è¡¨é•¿åº¦ llen listkey llen key lset è®¾ç½®åˆ—è¡¨æŒ‡å®šç´¢å¼•å€¼ä¸ºnewvalue lset listkey 3 java lset key index newvalue blpop blpopçš„é˜»å¡ç‰ˆæœ¬ï¼ŒæŒ‡å®šé˜»å¡æ—¶é—´ï¼Œtimeout=0ä¸ºæ°¸ä¸é˜»å¡ï¼ŒO(1) blpop listkey 3 blpop key timeout brpop brpopçš„é˜»å¡ç‰ˆæœ¬ï¼ŒæŒ‡å®šé˜»å¡æ—¶é—´ï¼Œtimeout=0ä¸ºæ°¸ä¸é˜»å¡ï¼ŒO(1) brpop listkey 3 brpop key timeout å¯ä»¥åˆ©ç”¨åˆ—è¡¨çš„ä¸€äº›ç‰¹å¾å®ç°ä¸€äº›åŠŸèƒ½ï¼š 1234567lpush+lpop=stacklpush+rpop=queuelpush+ltrim=capped collectionlpush+brpop=message queue é›†åˆï¼ˆsetï¼‰ API è¯´æ˜ ä¾‹å­ å¤‡æ³¨ sadd å‘é›†åˆkeyæ·»åŠ elementï¼Œåªæœ‰å½“elementä¸å­˜åœ¨æ‰èƒ½æˆåŠŸæ·»åŠ  sadd user:1:follow it music his sports sadd key element1 element2 â€¦ srem å°†é›†åˆkeyä¸­çš„elementå‰”é™¤ srem user:1:follow his seem key element scard è·å–é›†åˆkeyçš„é•¿åº¦ scard user:1:follow scard key sismember åˆ¤æ–­elementæ˜¯å¦å­˜åœ¨äºé›†åˆkey sismember user:1:follow it sismember key element srandmember ä»é›†åˆkeyä¸­éšæœºå–å‡ºä¸€ä¸ªitemï¼ˆä¸spopä¸åŒçš„æ˜¯ï¼Œè¯¥æ–¹æ³•ä¸åˆ é™¤elementï¼‰ srandmember user:1:follow srandmember key smembers è·å–é›†åˆkeyä¸­çš„æ‰€æœ‰item smembers user:1:follow smembers key spop éšæœºå¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼ˆåˆ é™¤ï¼‰ spop user:1:follow spop key sdiff å·®é›† sdiff user:2:follow user:1:follow sdiff key1 key2 sinter äº¤é›† sinter user:1:follow user:2:follow sinter key1 key2 sunion å¹¶é›† sunion user:1:follow user:2:follow sunion key1 key2 é›†åˆçš„ä¸€äº›åº”ç”¨ï¼š 12345sadd = taggingï¼ˆæ ‡ç­¾ç®¡ç†ï¼‰spop/srandmember = random itemï¼ˆéšæœºæ•°ï¼‰sadd + sinter = social graphï¼ˆç¤¾äº¤ï¼Œå¦‚å…³æ³¨ï¼‰ æ•£åˆ—è¡¨ï¼ˆhashï¼‰æ‰€æœ‰apiéƒ½æ˜¯hå¼€å¤´çš„ï¼Œhgetallã€hvalsã€hkeysã€hmgetã€hmsetæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(n) API è¯´æ˜ ä¾‹å­ å¤‡æ³¨ hgetã€hsetã€hdel è·å–ã€æ·»åŠ ã€åˆ é™¤å•ä¸ªfiledçš„å€¼ hset user:1:info age 23 hset user:1:info name Tom hget user:1:info age hset key filed1 value1hget key fileddel key field è¿™ä¸ªä¾‹å­çš„keyæ¯”è¾ƒå¤æ‚ï¼Œä»£è¡¨userä¸­1å·çš„ä¿¡æ¯ï¼Œä¸€èˆ¬å°±æ˜¯hset info name Tom hsetnx fieldä¸å­˜åœ¨æ‰èƒ½è®¾ç½® hsetnx user:1:info hobby football hsetnx key field value hexists åˆ¤æ–­hash keyæ˜¯å¦å«æœ‰filed hexists user:1:info age hexists key field hlen åˆ¤æ–­hash key filedçš„æ•°é‡ hlen user:1:info hlen key hmgetã€hmset æ‰¹é‡æ“ä½œ hmset user:2:info age 30 name kaka page 50 hmget user:2:info age name hmset key field1 value1 filed2 value2 hmget key field1 field2 hincrby æŒ‰æŒ‡å®šçš„æ•°é‡å¢åŠ  hincrby user:1:info pageview 1 hincrby key field numæ²¡æœ‰hdecrby hincrbyfloat å¢åŠ æµ®ç‚¹æ•° hincrbyfloat user:1:info pageview 3.5 hincrbyfloat key field num(float) hgetall è·å–å…¨éƒ¨çš„fields hgetall user:1:info hgetall key hvals è·å–å…¨éƒ¨çš„values hvals user:1:info hvals key hkeys è·å–å…¨éƒ¨çš„keys hkeys user:1:info hkeys key æœ‰åºé›†åˆï¼ˆzsetï¼‰ API è¯´æ˜ ä¾‹å­ å¤‡æ³¨ zadd æ·»åŠ scoreå’Œelemen zadd user:1:ranking 2 kris zadd key score element(å¯ä»¥å¤šå¯¹) zrem åˆ é™¤å…ƒç´  zrem user:1:ranking amber zrem key element (å¯ä»¥å¤šå¯¹) zscore è¿”å›å…ƒç´ çš„åˆ†æ•° zscore user:1:ranking tom zscore key element zincrby å¯¹elementå¢åŠ /å‡å°‘incrScoreåˆ†æ•°ï¼ŒinrcScoreä¸ºè´Ÿæ•°è¡¨ç¤ºå‡å°‘ zincrby user:1:ranking 60 amber zincrby key incrScore element zcard è¿”å›keyçš„å…ƒç´ ä¸ªæ•° zcard user:1:ranking zcard key zrank è¿”å›å…ƒç´ åœ¨keyä¸­çš„æ’å zrank user:1:ranking amber zrank key element zrange åˆ—å‡ºkeyä¸­å…ƒç´ æŒ‡å®šèŒƒå›´çš„å‡åºå…ƒç´ ï¼ˆåˆ†æ•°ï¼‰ zrange user:1:ranking 0 -1 withscores ä¾‹å­è¡¨ç¤ºå¯¹å…¨éƒ¨çš„æ•°æ®æ’å zrange key start end [withscores] zrangebyscore è¿”å›æŒ‡å®šåˆ†æ•°èŒƒå›´å†…çš„å‡åºå…ƒç´ ï¼ˆåˆ†æ•°ï¼‰ zrangebyscore user:1:ranking 15 25 withscores zrangebyscore key minScore maxScore [withscores] zcount è¿”å›æŒ‡å®šåˆ†æ•°èŒƒå›´å†…çš„å…ƒç´ ä¸ªæ•° zcount user:1:ranking 100 180 zcount key minScore maxScore zremrangebyrank åˆ é™¤æŒ‡å®šæ’åå†…çš„å‡åºå…ƒç´  zremrangebyrank user:1:ranking 0 1 zremrangebyrank key start end(åŒ…æ‹¬end) zrevrange åå‘æ’åºï¼Œä¸zrangeç›¸å zrevrange user:1:ranking 0 -1 zrevrange key start end zunionscore/zinterscore é›†åˆé—´æ“ä½œ zunionstore/zinterstore å…³äºkey user:1:infoå’Œusers:1çš„åŒºåˆ«ï¼š]]></content>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è‡ªå®šä¹‰å¼‚å¸¸]]></title>
    <url>%2Famberwest.github.io%2F2018%2F07%2F12%2F%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%2F</url>
    <content type="text"><![CDATA[å¹³æ—¶ç¼–ç¨‹æ—¶éš¾å…ä¼šå‡ºç°é”™è¯¯ï¼Œä¸€èˆ¬å¯ä»¥ä½¿ç”¨tryâ€¦exceptâ€¦æ¥æ•è·ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨raiseè¯­å¥ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œä½¿ç¨‹åºç»ˆæ­¢ã€‚å¦‚æœè¿™äº›éƒ½ä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»§æ‰¿Exceptionç„¶åè‡ªå®šä¹‰å¼‚å¸¸ã€‚ try â€¦ except123456789try: t = 1/0 print(t)except ZeroDivisionError as e: print(e)# å¦‚æœä¸æ¸…æ¥šæ˜¯ä»€ä¹ˆå¼‚å¸¸çš„è¯ï¼Œé‚£ä¹ˆå°±ç›´æ¥ä½¿ç”¨Exceptionexcept Exception as e: print(e) ä½¿ç”¨raiseè¯­å¥1raise ZeroDivisionError('error') è‡ªå®šä¹‰å¼‚å¸¸1234567891011class TestError(Exception): def __init__(self, info): self.info = info Exception.__init__(self) def __str__(self): return self.infoif __name__ == '__main__': t = TestError('test') print(t) å¦‚æœæ˜¯ç‰¹å®šçš„é”™è¯¯ï¼Œå¯ä»¥ç›´æ¥åœ¨strä¸­å®šä¹‰ï¼š 12345678910class TestError(Exception): def __init__(self): Exception.__init__(self) def __str__(self): return repr(â€˜testâ€™)if __name__ == '__main__': t = TestError() print(t)]]></content>
      <tags>
        <tag>exception</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[requestsï¼šå‡ºç°max retries exceeded with urlé”™è¯¯]]></title>
    <url>%2Famberwest.github.io%2F2018%2F07%2F11%2Frequests%EF%BC%9A%E5%87%BA%E7%8E%B0max-retries-exceeded-with-url%E9%94%99%E8%AF%AF%2F</url>
    <content type="text"><![CDATA[ä¹‹å‰å¶ç„¶é‡åˆ°è¿™æ ·ä¸€ä¸ªé”™è¯¯ï¼š å‡ºç°è¿™ä¸ªæƒ…å†µæ˜¯å› ä¸ºåœ¨çŸ­æ—¶é—´å†…æ‰“å¼€å¤ªå¤šçš„httpé“¾æ¥ï¼Œè€Œä¸”è¿™äº›é“¾æ¥éƒ½æ˜¯é»˜è®¤keep-aliveçš„å½¢å¼ã€‚é‚£ä¹ˆå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•æ¥è§£å†³ï¼š è®¾ç½®é‡è¯•æ¬¡æ•°123import requestsrequests.adapters.DEFAULT_RETRIES = 5 åœ¨headersä¸­ä¿®æ”¹Connectionçš„æ–¹å¼ä¸ºä¸æŒä¹…1'Connection': 'close' ç›´æ¥æ•è·å¼‚å¸¸1234try: res = requests.get(url)except requests.exceptions.ConnectionError: print('Connection Error') ä¹Ÿå¯ä»¥æ˜¯å› ä¸ºè¯·æ±‚å¤±è´¥è€Œç”±æœ¬èº«å‘é€é‡æ–°é“¾æ¥çš„é€Ÿåº¦è¿‡å¿«è€Œå¯¼è‡´è¯¥é”™è¯¯123456789import timepage = ''while page == '': try: page = requests.get(url) except: time.sleep(5) continue å…¶å®å‘¢ï¼Œåœ¨é‡åˆ°è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘æ˜¯é‡åˆ°å¦ä¸€ä¸ªé”™è¯¯ï¼š è¿™ä¸ªé”™è¯¯è·Ÿå‰é¢ä¸€ä¸ªå¾ˆåƒï¼ŒåŒºåˆ«åœ¨äºProxyErrorï¼Œå‡ºé”™çš„åŸå› ä¸€èˆ¬æœ‰2ä¸ªï¼š1ã€IPä»£ç†æœåŠ¡å™¨ä¸èƒ½ä½¿ç”¨ï¼›2ã€IPä»£ç†ä½¿ç”¨çš„åè®®ä¸æ­£å¸¸ã€‚ï¼ˆæˆ‘è®¾ç½®ä»£ç†åè®®çš„æ—¶å€™æŠŠhttpå†™æˆäº†httpsï¼‰ å‚è€ƒæ–‡ç« ï¼šå…³äºpythonçˆ¬è™«çš„æ·±å‘ï¼šrequestsæŠ›å‡ºå¼‚å¸¸Max retries exceeded with url pythonä½¿ç”¨IPä»£ç†ç¤ºä¾‹åŠå‡ºé”™è§£å†³æ–¹æ³•]]></content>
      <tags>
        <tag>max retries</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤šä¸ªspiderå†™å…¥csvæ—¶æ•°æ®ä¸¢å¤±]]></title>
    <url>%2Famberwest.github.io%2F2018%2F07%2F08%2F%E5%A4%9A%E4%B8%AAspider%E5%86%99%E5%85%A5csv%E6%97%B6%E6%95%B0%E6%8D%AE%E4%B8%A2%E5%A4%B1%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œéœ€è¦å°†å¤šä¸ªspideræŠ“å–åˆ°çš„æ•°æ®ä¿å­˜åˆ°åŒä¸€ä¸ªcsvæ–‡ä»¶ï¼Œä½†æ˜¯æ•°æ®ä¼šä¸¢å¤±ã€‚åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œå‘ç°æ•°æ®ä¸ä»…ç»å¸¸æ€§ä¸¢å¤±ï¼Œè€Œä¸”æ¯ä¸ªspiderå†™å…¥æ•°æ®å‰éƒ½ä¼šå…ˆå†™å…¥åˆ—åï¼Œå°è¯•é€šè¿‡åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨æ¥å†³å®šæ˜¯å¦å†™å…¥headerï¼Œéƒ½ä¸èƒ½è§£å†³é—®é¢˜ã€‚ä½†æ˜¯å‘¢ï¼Œåˆ†åˆ«å†™å…¥ä¸åŒçš„csvæ–‡ä»¶å´ä¸ä¼šå‡ºç°æ•°æ®ä¸¢å¤±çš„æƒ…å†µï¼Œæœ‰ç‚¹æ‡µï¼Œçœ‹æ¥å¯¹scrapyçš„è¿è¡Œæœºåˆ¶çš„ç†è§£è¿˜æ˜¯ä¸å¤Ÿï¼Œç›®å‰è¿˜æ²¡æ‰¾åˆ°é—®é¢˜æ‰€åœ¨ã€‚ åœ¨åŒäº‹çš„å¸®åŠ©ä¸‹ï¼Œç»ˆäºæ‰¾åˆ°è§£å†³æ–¹æ³•äº†ï¼š 1ã€å…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„csvæ–‡ä»¶ï¼Œåªå†™å…¥header 2ã€å†ç”¨pandaså°†æ•°æ®ä»¥è¿½åŠ çš„æ–¹å¼å†™å…¥ 12345678910111213141516171819202122232425# pipelines.py# -*- coding: utf-8 -*-import csvimport datetimeimport pandas as pdclass ScrapywebspiderPipeline(object): """å°†äº§å“ä¿¡æ¯å†™å…¥åˆ°csv""" columns = ['urls', 'status', 'title','price'] date = datetime.datetime.now().strftime('%Y%m%d%H%M%S') def __init__(self): self.file_name = '&#123;&#125;_&#123;&#125;.csv'.format('spider', self.date) # åˆ›å»ºcsvæ–‡ä»¶ï¼Œå¹¶å†™å…¥å¤´éƒ¨ with open(self.file_name, 'w', newline='', encoding='utf-8') as f: c = csv.DictWriter(f, self.columns) c.writeheader() def process_item(self, item, spider): df = pd.DataFrame([item], columns=self.columns) df.to_csv(self.file_name, mode='a', header=False, index=False) return item åœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºrun.pyï¼Œå†™ä¸Šè¿è¡Œå¤šä¸ªè„šæœ¬çš„ä»£ç  12345678910111213141516# -*- coding:utf-8 -*-# Time: 2018/7/2 16:30from scrapy.crawler import CrawlerProcessfrom scrapy.utils.project import get_project_settingsfrom scrapy.spiderloader import SpiderLoadersettings = get_project_settings()spider_loader = SpiderLoader(settings=settings)spiders = spider_loader.list()process = CrawlerProcess(settings=settings)for spider in spiders: process.crawl(spider)process.start() ç›´æ¥åœ¨ç»ˆç«¯è¿è¡Œï¼ˆåˆ‡åˆ°scrapyé¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼‰ 1python -m run]]></content>
      <tags>
        <tag>scrapy</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[scrapyä¸­pipelineå†™å…¥æ•°æ®çš„æ–¹æ³•]]></title>
    <url>%2Famberwest.github.io%2F2018%2F07%2F08%2Fscrapy%EF%BC%9Apipeline%E5%86%99%E5%85%A5%E6%95%B0%E6%8D%AE%E7%9A%84%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[ç”¨scrapyæ¥æŠ“å–æ•°æ®çœŸçš„æ˜¯éå¸¸æ–¹ä¾¿ï¼Œåœ¨æ•°æ®å­˜å‚¨æ–¹é¢ä¹Ÿæ˜¯å¾ˆæ–¹ä¾¿ï¼ŒåŒæ—¶ä¹Ÿå¾ˆçµæ´»ã€‚è¿™é‡Œæ€»ç»“äº†ä¸€äº›å¸¸ç”¨çš„æ•°æ®å†™å…¥çš„æ–¹æ³•ã€‚ feed exporterä½¿ç”¨scrapyæä¾›çš„exporterså¯ä»¥å¾ˆæ–¹ä¾¿åœ°å°†æ•°æ®å¯¼å‡º 12345678910111213141516# pipelines.pyfrom scrapy.exporters import JsonItemExporterclass JsonExporterPipeline(object): def __init__(self): self.file = open('test.json', 'wb') self.exporter = JsonItemExporter(self.file, encoding='utf-8', ensure_ascii=False) self.exporter.start_exporting() def process_item(self, item, spider): self.exporter.export_item(item) return item def close_spider(self, spider): self.exporter.finish_exporting() self.file.close() å¦‚æœå°†æ•°æ®ä¿å­˜ä¸ºjsonæ–‡ä»¶ï¼Œå…¶å®ä¹Ÿå¯ä»¥åœ¨ç»ˆç«¯ä½¿ç”¨-oæ¥æŒ‡å®šä¿å­˜çš„æ–‡ä»¶è·¯å¾„ã€‚ 1scrapy crawl spider -o test.json feed exportersè¿˜å¯ä»¥å¯¼å‡ºä¸ºå…¶ä»–æ ¼å¼ï¼Œæ¯”å¦‚csvã€xmlç­‰ï¼Œå…·ä½“ç”¨æ³•æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚ 123456789&#123; &apos;json&apos;: &apos;scrapy.exporters.JsonItemExporter&apos;, &apos;jsonlines&apos;: &apos;scrapy.exporters.JsonLinesItemExporter&apos;, &apos;jl&apos;: &apos;scrapy.exporters.JsonLinesItemExporter&apos;, &apos;csv&apos;: &apos;scrapy.exporters.CsvItemExporter&apos;, &apos;xml&apos;: &apos;scrapy.exporters.XmlItemExporter&apos;, &apos;marshal&apos;: &apos;scrapy.exporters.MarshalItemExporter&apos;, &apos;pickle&apos;: &apos;scrapy.exporters.PickleItemExporter&apos;,&#125; json1234567891011121314151617181920212223# pipelines.pyfrom scrapy.exceptions import DropItemimport jsonclass DuplicatesPipeline(object): # è‡ªå®šä¹‰jsonæ–‡ä»¶çš„å¯¼å‡º def __init__(self): self.ids_seen = set() self.file = open('article.json', 'w', encoding="utf-8") def process_item(self, item, spider): # å»é‡ if item['id'] in self.ids_seen: raise DropItem("Duplicate item found: %s" % item) else: self.ids_seen.add(item['id']) lines = json.dumps(dict(item), ensure_ascii=False) + "\n" self.file.write(lines) return item def close_spider(self, spider): self.file.close() csvå†™å…¥csvæ–‡ä»¶å¯ä»¥ä½¿ç”¨csvæ¨¡å—ï¼Œéœ€è¦æå‰æŒ‡å®šåˆ—åã€‚ 1234567891011121314151617# pipelines.pyimport csvclass ScrapywebspiderPipeline(object): def __init__(self): columns = ['name', 'age'] file_name = 'test.csv' # newlineä¸ºç©ºï¼Œå†™å…¥æ—¶ä¸ä¼šå‡ºç°ç©ºè¡Œ file = open(file_name, 'w', newline='', encoding='utf-8') self.writer = csv.DictWriter(file, columns) self.writer.writeheader() def process_item(self, item, spider): # å¯ä»¥å¢åŠ åˆ¤æ–­å»é‡çš„æ¡ä»¶ self.writer.writerow(item) return item excelç”¨pandaså†™å…¥excelæ—¶éœ€è¦æä¾›å†™å…¥çš„è¡Œå·ï¼Œæ‰€ä»¥è¿™é‡Œå¯¹å†™å…¥çš„excelæ–‡ä»¶åšäº†åˆ¤æ–­ã€‚ 123456789101112131415161718192021222324252627282930313233343536# pipelines.pyimport osimport pandasfrom openpyxl import load_workbookclass ExcelPipeline(object): def process_item(self, item, spider): file_path = '&#123;&#125;.xlsx'.format(spider.name) file_is_exist = os.path.exists(file_path) columns = sorted(item.keys()) df = pandas.DataFrame([item], columns=columns) writer = pandas.ExcelWriter(file_path, engine='openpyxl') if not file_is_exist: df.to_excel( writer, header=True, sheet_name=spider.name, index=False, columns=columns, ) writer.save() else: book = load_workbook(file_path) row_start = book[spider.name].max_row writer.book = book writer.sheets = dict((ws.title, ws) for ws in book.worksheets) df.to_excel( writer, header=True, sheet_name=spider.name, index=False, columns=columns, ) writer.save() return item mongodbåœ¨settings.pyæ–‡ä»¶ä¸­è®¾ç½®MONGO_URI,MONGO_DATABASEï¼Œè¿˜éœ€è¦æå‰åœ¨ç»ˆç«¯å¼€å¯mongodæœåŠ¡æ‰èƒ½æ­£å¸¸é“¾æ¥ 1mongod --auth -f /path/to/your/mongod/conf # å¦‚æœæ²¡æœ‰å¯†ç ï¼Œå°±ä¸éœ€è¦æ·»åŠ authå‚æ•° 1234567891011121314151617181920212223242526import pymongoclass MongoPipeline(object): def __init__(self, mongo_uri, mongo_db): self.mongo_uri = mongo_uri self.mongo_db = mongo_db self.table_name = 'test' @classmethod def from_crawler(cls, crawler): return cls( mongo_uri=crawler.settings.get('MONGO_URI'), mongo_db=crawler.settings.get('MONGO_DATABASE') ) def open_spider(self, spider): self.client = pymongo.MongoClient(self.mongo_uri) self.db = self.client[self.mongo_db] def close_spider(self, spider): self.client.close() def process_item(self, item, spider): # è¿™é‡Œçš„self.table_nameæ˜¯è¡¨å,ä¹Ÿå¯ä»¥ç”¨spider.nameæ¥å®šä¹‰ self.db[self.table_name].update(&#123;'id': item.get('id')&#125;, &#123;'$set': dict(item)&#125;, upsert=True, manipulate=False) return item settings.pyæ–‡ä»¶ä¸­å¢åŠ ä»¥ä¸‹å†…å®¹ï¼Œuriä¸­çš„è´¦å·å¯†ç å¯¹åº”ç€database_nameè¿™ä¸ªæ•°æ®åº“ï¼Œæ‰€ä»¥è¿æ¥æˆåŠŸä¹‹ååªçœ‹åˆ°è¿™ä¸ªæ•°æ®åº“ã€‚ 12MONG_URI = &apos;mongodb://user:pwd@ip:port/?authSource=database_name&amp;antuMechainsm=SCRAM-SHA-256&apos;MONGO_DATABASE = &apos;database_name&apos; mysqlè¿™é‡Œç”¨çš„twistedæ¨¡å—è¿›è¡Œå¼‚æ­¥æ’å…¥æ•°æ®ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243# -*- coding: utf-8 -*-# pipelines.pyimport copyfrom Jd.db import create_conn, create_database_and_tables, twisted_insert, handle_errorfrom Jd.items import SummaryItem, CommentItemfrom twisted.enterprise import adbapiclass MysqlTwistedPipeline(object): """ä½¿ç”¨twistedå®ç°å¼‚æ­¥æ’å…¥æ•°æ®åˆ°mysql""" def __init__(self, dbpool): self.dbpool = dbpool # å»ºè¡¨ self.dbpool.runInteraction(create_database_and_tables) @classmethod def from_settings(cls, settings): db_args = dict( host=settings['MYSQL_HOST'], db=settings['MYSQL_DB'], user=settings['MYSQL_USER'], passwd=settings['MYSQL_PASSWORD'], charset='utf8', use_unicode=True, ) dbpool = adbapi.ConnectionPool('pymysql', **db_args) return cls(dbpool) def process_item(self, item, spider): # å¼‚æ­¥æ’å…¥æ•°æ®åˆ°mysqlï¼Œå¦‚æœæœ‰é”™è¯¯åˆ™è¿”å›exceptionï¼Œæ­£ç¡®åˆ™ä¼šè‡ªåŠ¨commitï¼Œä¸éœ€è¦äººä¸ºcommitï¼Œä¹Ÿä¸ç”¨åˆ›å»ºcursor # ä½¿ç”¨æ·±æ‹·è´ï¼Œå°†å¼•ç”¨ä¼ é€’æ”¹ä¸ºå€¼ä¼ é€’ï¼Œæœ‰äº›æ•°æ®é‡å¤æœ‰äº›æ•°æ®ä¸¢å¤±ï¼ˆæ€»æ•°é‡ä¸å˜ï¼‰ asyn_item = copy.deepcopy(item) if isinstance(asyn_item, CommentItem): # runInteraction(callable, *args)ï¼Œå¯è°ƒç”¨çš„å¯¹è±¡ä»¥åŠè¯¥å¯¹è±¡æ‰€éœ€è¦çš„å‚æ•° query = self.dbpool.runInteraction(twisted_insert, asyn_item, 'comment') elif isinstance(asyn_item, SummaryItem): query = self.dbpool.runInteraction(twisted_insert, asyn_item,'summary_comment') # å¤„ç†å¼‚å¸¸ query.addErrback(handle_error, asyn_item, spider) return asyn_item def close_spider(self, spider): self.dbpool.close() è¯¥æ–‡ä»¶ä¸pipelines.pyåœ¨åŒçº§ç›®å½•ä¸‹ï¼Œä¸»è¦æ˜¯å®šä¹‰ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ï¼Œæ¯”å¦‚è¿æ¥æ•°æ®åº“ï¼Œæ’å…¥æ•°æ®ç­‰ã€‚è¿™é‡Œæœ‰ä¸ªç‚¹éœ€è¦æ³¨æ„ï¼šcommentè¡¨ä½¿ç”¨äº†idè‡ªå¢ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ’å…¥æ•°æ®æ—¶æ— æ³•èµ·åˆ°å»é‡çš„ä½œç”¨ï¼Œå› ä¸ºè¿™é‡Œæ˜¯å¯¹å…¨éƒ¨å­—æ®µè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæœ‰é‡å¤å°±æ›´æ–°ï¼Œä½†æ˜¯idè¿™ä¸ªå­—æ®µæ¯æ¬¡éƒ½æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®šunique keyã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172#! -*- coding:utf-8 -*-# db.pyimport pymysqlfrom Jd.settings import *def create_conn(): conn = pymysql.connect(host=MYSQL_HOST, user=MYSQL_PORT, password=MYSQL_PASSWORD, port=MYSQL_PORT, db=MYSQL_DB, charset='utf8') return conndef create_database_and_tables(cursor): # å»ºç«‹jingdongæ•°æ®åº“ # cursor.execute('CREATE DATABASE jingdong') # cursor.execute('use jingdong') # å»ºç«‹commentå’Œsummary_commentä¸¤å¼ è¡¨ cursor.execute("""drop table comment""") cursor.execute("drop table summary_comment") comment_sql = """ CREATE TABLE IF NOT EXISTS comment( id int NOT NULL auto_increment, title VARCHAR (200) DEFAULT NULL , nick_name VARCHAR (20) NOT NULL , comment_time DATETIME NOT NULL , PRIMARY KEY (id), UNIQUE (pid, nick_name, comment_time) )ENGINE=InnoDB """ summary_comment_sql = """ CREATE TABLE IF NOT EXISTS summary_comment( pid VARCHAR (50) NOT NULL , title VARCHAR (50) DEFAULT NULL , PRIMARY KEY (pid) )ENGINE=InnoDB """ cursor.execute(comment_sql) cursor.execute(summary_comment_sql)def twisted_insert(cursor, data, table): """å¼‚æ­¥""" keys = ', '.join(data.keys()) values = ', '.join(['%s'] * len(data)) sql = "INSERT INTO &#123;table&#125;(&#123;keys&#125;) VALUES (&#123;values&#125;) ON DUPLICATE KEY UPDATE".format(table=table, keys=keys, values=values) update = ','.join([" &#123;key&#125; = %s".format(key=key) for key in data]) sql += update try: cursor.execute(sql, tuple(data.values()) * 2) print('insert data successfully') except Exception as e: print(e)def handle_error(failure, item, spider): # å¤„ç†å¼‚å¸¸ print(failure)def insert(conn, data, table): cursor = conn.cursor() keys = ', '.join(data.keys()) values = ', '.join(['%s'] * len(data)) sql = """INSERT INTO &#123;table&#125;(&#123;keys&#125;) VALUES (&#123;values&#125;) ON DUPLICATE KEY UPDATE""".format(table=table, keys=keys, values=values) update = ','.join([" &#123;key&#125; = %s".format(key=key) for key in data]) sql += update try: cursor.execute(sql, tuple(data.values()) * 2) conn.commit() print('insert data successfully') except Exception as e: print('failed to insert data', e) conn.rollback() è¿æ¥mysqlæ‰€éœ€è¦çš„å­—æ®µéƒ½ä¼šåœ¨settings.pyä¸­è¿›è¡Œè®¾ç½® 123456# è¿æ¥mysqlçš„å­—æ®µMYSQL_HOST = &apos;localhost&apos;MYSQL_PORT = 3306MYSQL_USER = &apos;&apos;MYSQL_PASSWORD = &apos;&apos;MYSQL_DB = &apos;jingdong&apos; å…·ä½“ä¾‹å­ä½¿ç”¨è¯·çœ‹ä»£ç ã€‚ å‚è€ƒæ–‡ç« feed exports item pipelines How to write to an existing excel file without overwriting data (using pandas)? Authentication Examples]]></content>
      <tags>
        <tag>scrapy</tag>
        <tag>pipeline</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ ¹æ®éƒ¨åˆ†æ–‡ä»¶åæŸ¥æ‰¾æ–‡ä»¶]]></title>
    <url>%2Famberwest.github.io%2F2018%2F07%2F08%2F%E6%A0%B9%E6%8D%AE%E9%83%A8%E5%88%86%E6%96%87%E4%BB%B6%E5%90%8D%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6%2F</url>
    <content type="text"><![CDATA[åœ¨å·¥ä½œä¸­ï¼Œç»å¸¸éœ€è¦å¯¹æŠ“å–åˆ°çš„æ•°æ®åšè¿›ä¸€æ­¥çš„å¤„ç†ï¼Œä½†ç”±äºæ–‡ä»¶æ˜¯æ ¹æ®åˆ›å»ºæ—¶é—´è‡ªåŠ¨å‘½åçš„ï¼Œæ‰€ä»¥æ²¡åŠæ³•ç›´æ¥åœ¨è„šæœ¬ä¸­å†™å…¥æ–‡ä»¶åï¼Œå¦å¤–å‘¢ï¼Œè¿˜éœ€è¦æ ¹æ®æ–‡ä»¶ååˆ¤æ–­å“ªä¸ªæ˜¯æœ€æ–°åˆ›å»ºçš„æ–‡ä»¶ã€‚æœ€åå†³å®šç”¨osæ¨¡å—æ¥è·å–æŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼Œå¹¶å¯¹æ–‡ä»¶åè¿›è¡Œåˆ¤æ–­ã€‚ osæ¨¡å—çš„walk()å‡½æ•°æ¥æ”¶ä¸€ä¸ªé¡¶çº§ç›®å½•ï¼Œé€šè¿‡ä»ä¸Šåˆ°ä¸‹æˆ–è€…ä»ä¸‹åˆ°ä¸Šçš„æ–¹å¼æ¥éå†ç›®å½•æ ‘ï¼Œå¹¶è¿”å›ä¸€ä¸ªä¸‰å…ƒç»„(dirpath, dirnames, filenames)ï¼Œdirpathæ˜¯ç›¸å¯¹äºæŸ¥æ‰¾ç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼Œdirnamesæ˜¯è¯¥ç›®å½•ä¸‹çš„ç›®å½•ååˆ—è¡¨ï¼Œ filenamesæ˜¯topç›®å½•ä¸‹é¢çš„æ–‡ä»¶ååˆ—è¡¨ã€‚ 1os.walk(top, topdown=True, onerror=None, followlinks=False) è‡³äºæ–‡ä»¶åçš„åˆ¤æ–­ï¼Œæˆ‘ç”¨äº†pythonå†…ç½®å‡½æ•°sorted()ï¼Œé€šè¿‡ä¼ é€’ä¸€ä¸ªåŒ¿åå‡½æ•°ç»™keyï¼Œå°†æ–‡ä»¶åä¸­çš„æ—¶é—´è½¬æˆæ•°å­—ï¼Œç„¶åå€’åºæ’åˆ—å³å¯ã€‚ 1sorted(iterable, *, key=None, reverse=False) 1the_one = sorted(all_files, key=lambda x: int(re.search('(\d+)', x).group(1)), reverse=True)[0] è¯¦ç»†ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627import osdef find_the_latest(start, name): """ æ ¹æ®ç»™å®šçš„è·¯å¾„å’Œæ–‡ä»¶åå­—ï¼Œè¿”å›æ–‡ä»¶çš„è·¯å¾„ :param start: æœç´¢çš„æœ€é¡¶çº§ç›®å½• :param name: è¦æŸ¥æ‰¾çš„ç›®æ ‡æ–‡ä»¶ :return: å¯¹åº”æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ """ for relpath, dirs, files in os.walk(start): # è¯¥æ–‡ä»¶åæ˜¯ä»¥spiderå¼€å¤´çš„ all_files = [t for t in files if name in t and t.startswith('spider')] if len(all_files) == 1: return os.path.normpath(os.path.abspath(all_files[0])) elif len(all_files) &gt; 1: # å¦‚æœæŒ‡å®šç›®å½•ä¸‹å·²ç»æœ‰å¤šä¸ªæ–‡ä»¶ï¼Œå¯¹æ–‡ä»¶åä¸­çš„æ—¶é—´è¿›è¡Œåˆ¤æ–­ the_one = sorted(all_files, key=lambda x: int(re.search('(\d+)', x).group(1)), reverse=True)[0] full_path = os.path.join(start, relpath, the_one) # è¿”å›å¤„ç†è¿‡çš„æ–‡ä»¶è·¯å¾„ return os.path.normpath(os.path.abspath(full_path)) else: return Noneif __name__ == '__main__': # æœç´¢å½“å‰ç›®å½•ä¸‹ä»¥spiderå¼€å¤´çš„æœ€æ–°çš„csvæ–‡ä»¶ find_the_latest(â€˜.â€™, â€™csvâ€™) å‚è€ƒæ–‡ç« ï¼š os sorted]]></content>
      <tags>
        <tag>os</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[vimï¼šç®€å•æ“ä½œ]]></title>
    <url>%2Famberwest.github.io%2F2018%2F07%2F06%2Fvim%EF%BC%9A%E7%AE%80%E5%8D%95%E6%93%8D%E4%BD%9C%2F</url>
    <content type="text"><![CDATA[vimæ˜¯ä»viå‘å±•å‡ºæ¥çš„ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ã€‚ä»£ç è¡¥å®Œã€ç¼–è¯‘ä»¥åŠé”™è¯¯è·³è½¬ç­‰æ–¹ä¾¿å˜æˆçš„åŠŸèƒ½ç‰¹åˆ«ä¸°å¯Œã€‚è¿™é‡Œæ ¹æ®é»‘é©¬ç¨‹åºå‘˜çš„åŸºç¡€è¯¾ç¨‹æ€»ç»“äº†ä¸€äº›vimçš„åŸºæœ¬æ“ä½œã€‚ åŸºæœ¬æ¨¡å¼æ™®é€šæ¨¡å¼æ™®é€šæ¨¡å¼ä¸‹å¯ä»¥ä½¿ç”¨ç¼–è¾‘å™¨å‘½ä»¤ç¼–è¾‘æ–‡æœ¬ï¼Œæ¯”å¦‚åˆ é™¤æ–‡æœ¬ï¼Œç§»åŠ¨å…‰æ ‡ç­‰ã€‚è¿™ä¹Ÿæ˜¯vimå¯åŠ¨åçš„é»˜è®¤æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡æŒ‰â€˜iâ€™è¿›å…¥æ’å…¥æ¨¡å¼ï¼Œå½“ç„¶è¿˜æœ‰å…¶ä»–çš„æ–¹å¼ã€‚ æ’å…¥æ¨¡å¼æ’å…¥æ¨¡å¼ä¸‹å¯ä»¥æ’å…¥æ–‡æœ¬ï¼Œå¯ä»¥æŒ‰ESCè¿›å…¥æ™®é€šæ¨¡å¼ã€‚ å¯è§†æ¨¡å¼å¯è§†æ¨¡å¼ä¸‹ï¼Œé€šè¿‡ç§»åŠ¨å‘½ä»¤å¯ä»¥é€‰ä¸­æ–‡æœ¬åŒºåŸŸå¹¶é«˜äº®æ˜¾ç¤ºï¼Œæ‰§è¡Œéç§»åŠ¨å‘½ä»¤æ—¶ï¼Œå‘½ä»¤ä¼šè¢«æ‰§è¡Œåˆ°è¿™å—é«˜äº®åŒºåŸŸã€‚å¯ä»¥æŒ‰ESCé”®å›åˆ°æ™®é€šæ¨¡å¼ã€‚ å‘½ä»¤è¡Œæ¨¡å¼åœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸­å¯ä»¥è¾“å…¥ä¼šè¢«è§£é‡Šå¹¶æ‰§è¡Œçš„æ–‡æœ¬ã€‚ä¾‹å¦‚æ‰§è¡Œå‘½ä»¤â€™:â€™ï¼Œâ€™/â€˜ï¼Œ â€˜?â€™æˆ–è€…è¿‡æ»¤å‘½ä»¤â€™!â€™ï¼Œvimè¿”å›åˆ°å‘½ä»¤è¡Œæ¨¡å¼ä¹‹å‰çš„æ¨¡å¼ï¼Œé€šå¸¸æ˜¯æ™®é€šæ¨¡å¼ã€‚ åŸºæœ¬å‘½ä»¤è¿›å…¥æ–‡ä»¶1vim æ–‡ä»¶å [+num] # vim t.txt +3 å¦‚æœæ–‡ä»¶åå¯¹åº”æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šæ‰“å¼€æ–°çš„æ–‡ä»¶ï¼Œç¼–è¾‘ä¹‹åä¿å­˜å°±èƒ½ç”Ÿæˆæ–°çš„æ–‡ä»¶ã€‚ +numä»£è¡¨æ‰“å¼€æ–‡ä»¶åå…‰æ ‡å®šä½åˆ°ç¬¬numè¡Œï¼Œåªå¸¦+å…‰æ ‡åˆ™å®šä½åˆ°æ–‡ä»¶çš„æœ€åä¸€è¡Œï¼Œä¸å¸¦+numï¼Œæ‰“å¼€æ–‡ä»¶åå…‰æ ‡ä¼šåœåœ¨æ–‡ä»¶ç¬¬ä¸€è¡Œã€‚ é€€å‡ºåœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸‹è¾“å…¥ä»¥ä¸‹å‘½ä»¤ 12345:w # ä¿å­˜ä¸é€€å‡º:q # é€€å‡ºï¼Œå¦‚æœç¼–è¾‘ä¹‹åæ²¡æœ‰ä¿å­˜åˆ™ä¼šé€€å‡ºå¤±è´¥:q! # å¼ºè¡Œé€€å‡ºï¼Œä¸ä¿å­˜æ”¹åŠ¨:wq # ä¿å­˜å¹¶é€€å‡º:x # ä¿å­˜å¹¶é€€å‡ºï¼Œè·Ÿ:wqçš„æ•ˆæœæ˜¯ä¸€æ ·çš„ å­—ç¬¦ç§»åŠ¨é”®ç›˜ä¸Šçš„hjklåˆ†åˆ«å¯¹åº”å·¦ã€ä¸‹ã€ä¸Šã€å³ç®­å¤´é”®ï¼Œå¦‚æœè¦è¿›è¡Œå¤šæ¬¡ç§»åŠ¨ï¼Œå¯ä»¥å…ˆæŒ‰æ•°å­—å†æŒ‰å¯¹åº”çš„å­—æ¯é”®ï¼Œå¦‚â€˜10jâ€™å°±æ˜¯å‘ä¸‹ç§»åŠ¨10è¡Œã€‚ è¡Œå†…ç§»åŠ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸‹ 123450 # æ•°å­—0ï¼Œç§»åŠ¨åˆ°è¡Œé¦–^ # ç§»åŠ¨åˆ°è¡Œé¦–$ # ç§»åŠ¨åˆ°è¡Œå°¾w # å‘åç§»åŠ¨ä¸€ä¸ªå•è¯ï¼ˆwordï¼‰b # å‘å‰ç§»åŠ¨ä¸€ä¸ªå•è¯ï¼ˆbackï¼‰ è¡Œé—´ç§»åŠ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸‹ 1234gg # æ–‡ä»¶é¡¶éƒ¨G # æ–‡ä»¶å°¾éƒ¨æ•°å­—gg # ç§»åŠ¨åˆ°æŒ‡å®šè¡Œæ•°ï¼ˆ3ggç§»åŠ¨åˆ°ç¬¬ä¸‰è¡Œï¼‰:æ•°å­— # ä¹Ÿæ˜¯ç§»åŠ¨åˆ°æŒ‡å®šè¡Œæ•° å±å¹•ç§»åŠ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸‹ 12345ctrl+b # å‘ä¸‹ç¿»é¡µctrl+f # å‘ä¸Šç¿»é¡µH # å±å¹•é¡¶éƒ¨M # å±å¹•ä¸­éƒ¨L # å±å¹•åº•éƒ¨ æ®µè½ç§»åŠ¨vimä¸­æ˜¯ç”¨ç©ºè¡Œæ¥åŒºåˆ†æ®µè½çš„ï¼Œä»¥ä¸‹å‘½ä»¤ä¹Ÿæ˜¯åœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸‹æ‰§è¡Œçš„ 12&#123; # ä¸Šä¸€æ®µ&#125; # ä¸‹ä¸€æ®µ æ‹¬å·åˆ‡æ¢1% # æ‹¬å·åŒ¹é… æ ‡è®°åœ¨å¼€å‘æ—¶å¦‚æœ‰ä»£ç éœ€è¦ç¨åå¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨æ ‡è®°ï¼Œè¿™æ ·å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™å¿«é€Ÿçš„è·³è½¬ã€‚æ ‡è®°åç§°å¯ä»¥æ˜¯a-zA-Zä¸­ä»»æ„ä¸€ä¸ªå­—æ¯ã€‚æ·»åŠ äº†æ ‡è®°çš„è¡Œå¦‚æœè¢«åˆ é™¤ï¼Œæ ‡è®°åŒæ—¶è¢«åˆ é™¤ã€‚ 12mx # xæ˜¯æ ‡è®°åç§°'x # ç›´æ¥å®šä½åˆ°æ ‡è®°æ‰€åœ¨ä½ç½® é€‰ä¸­æ–‡æœ¬é€‰ä¸­æ–‡æœ¬çš„å‘½ä»¤éœ€è¦åœ¨å¯è§†æ¨¡å¼ä¸‹ï¼Œå¯ä»¥è·Ÿç§»åŠ¨å‘½ä»¤è¿ç”¨ï¼Œå¦‚ggVGèƒ½å¤Ÿé€‰ä¸­æ‰€æœ‰å†…å®¹ 123v # å¯è§†æ¨¡å¼ï¼Œä»å…‰æ ‡ä½ç½®å¼€å§‹å®‰è£…æ™®é€šæ¨¡å¼é€‰æ‹©æ–‡æœ¬V # å¯è§†è¡Œæ¨¡å¼ï¼Œé€‰ä¸­å…‰æ ‡ç»è¿‡çš„å®Œæ•´è¡Œctrl+v # å¯è§†å—æ¨¡å¼ï¼Œå‚ç›´æ–¹å‘é€‰ä¸­æ–‡æœ¬ æ’¤é”€å’Œæ¢å¤æ’¤é”€å‘½ä»¤è¡Œæ¨¡å¼ä¸‹ 12u # undoï¼Œæ’¤é”€ä¸Šæ¬¡å‘½ä»¤ ctrl+r # redoï¼Œæ¢å¤ä¸Šæ¬¡å‘½ä»¤ åˆ é™¤æ–‡æœ¬1234x # åˆ é™¤å…‰æ ‡æ‰€åœ¨å­—ç¬¦ï¼Œæˆ–è€…é€‰ä¸­æ–‡å­—d(ç§»åŠ¨å‘½ä»¤) # åˆ é™¤ç§»åŠ¨å‘½ä»¤é€‰ä¸­çš„å†…å®¹dd # delete åˆ é™¤å…‰æ ‡æ‰€åœ¨è¡Œï¼Œå¯ä»¥nddåˆ é™¤å¤šè¡ŒD # delete åˆ é™¤è‡³è¡Œå°¾ å¸¸è§çš„åˆ é™¤å‘½ä»¤ç»„åˆ 123456dw # ä»å…‰æ ‡ä½ç½®åˆ é™¤åˆ°å•è¯æœ«å°¾d0 # ä»å…‰æ ‡ä½ç½®åˆ é™¤åˆ°æ‰€åœ¨è¡Œçš„èµ·å§‹ä½ç½®d&#125; # ä»å…‰æ ‡ä½ç½®åˆ é™¤è‡³æ®µè½ç»“å°¾ndd # ä»å…‰æ ‡ä½ç½®å‘ä¸‹è¿ç»­åˆ é™¤nè¡Œdä»£ç è¡ŒG # ä»å…‰æ ‡æ‰€åœ¨è¡Œåˆ é™¤è‡³æŒ‡å®šä»£ç è¡Œä¹‹é—´çš„æ‰€æœ‰ä»£ç d'a # ä»å…‰æ ‡ä½ç½®æ‰€åœ¨è¡Œåˆ é™¤åˆ°æ ‡è®°ä¸ºaä¹‹é—´çš„æ‰€æœ‰ä»£ç  å¤åˆ¶ã€ç²˜è´´123y(ç§»åŠ¨å‘½ä»¤) # copyï¼Œå¤åˆ¶yy # copyï¼Œå¤åˆ¶ä¸€è¡Œï¼Œnyyå¯ä»¥å¤åˆ¶å¤šè¡Œï¼Œnä¸ºå…·ä½“æ•°å­—p # pasteï¼Œç²˜è´´ æ›¿æ¢æ›¿æ¢æ¨¡å¼çš„ä½œç”¨å°±æ˜¯ä¸ç”¨è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œå¯¹æ–‡ä»¶è¿›è¡Œè½»é‡çº§çš„ä¿®æ”¹ã€‚Rå‘½ä»¤å¯ä»¥è¿›å…¥æ›¿æ¢æ¨¡å¼ï¼Œæ›¿æ¢å®Œæˆåï¼ŒæŒ‰ä¸‹ESCå¯ä»¥å›åˆ°å‘½ä»¤æ¨¡å¼ã€‚ 12r # replaceï¼Œæ›¿æ¢å½“å‰å­—ç¬¦ï¼Œå‘½ä»¤æ¨¡å¼ä¸‹R # replaceï¼Œæ›¿æ¢å½“å‰è¡Œå…‰æ ‡åçš„å­—ç¬¦ï¼Œéœ€è¦åœ¨æ›¿æ¢æ¨¡å¼ä¸‹ ç¼©è¿›ã€ç¼–æ’å‘½ä»¤è¡Œæ¨¡å¼ä¸‹ 123&gt;&gt; # å‘å³ç¼©è¿›&lt;&lt; # å‘å·¦ç¼©è¿›. # é‡å¤ä¸Šä¸€ä¸ªå‘½ä»¤ æŸ¥æ‰¾1ã€å¸¸è§„æŸ¥æ‰¾ 1/str # æŸ¥æ‰¾str æŸ¥æ‰¾åˆ°å†…å®¹åï¼Œä½¿ç”¨nextè·³è½¬åˆ°ä¸‹ä¸€ä¸ªå‡ºç°çš„ä½ç½® 12n # æŸ¥æ‰¾ä¸‹ä¸€ä¸ªN # æŸ¥æ‰¾ä¸Šä¸€ä¸ª 2ã€å•è¯æŸ¥æ‰¾ å½“è¦æŸ¥æ‰¾å…‰æ ‡æ‰€åœ¨çš„å•è¯æ—¶å¯ä»¥ä½¿ç”¨çš„å‘½ä»¤ 12* # å‘åæŸ¥æ‰¾å…‰æ ‡æ‰€åœ¨çš„å•è¯# # å‘å‰æŸ¥æ‰¾å½“å‰å…‰æ ‡æ‰€åœ¨çš„å•è¯ æŸ¥æ‰¾å¹¶æ›¿æ¢å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š 1:%s///g 1ã€å…¨å±€æ›¿æ¢ ä¸€æ¬¡æ€§æ›¿æ¢æ–‡ä»¶ä¸­æ‰€æœ‰å‡ºç°çš„æ—§æ–‡æœ¬ 1:%s/æ—§æ–‡æœ¬/æ–°æ–‡æœ¬/g 2ã€å¯è§†åŒºæ›¿æ¢ å…ˆé€‰ä¸­è¦æ›¿æ¢çš„æ–‡ä»¶èŒƒå›´ï¼ˆå¯è§†æ¨¡å¼ä¸‹è¿›è¡Œé€‰æ‹©ï¼‰ 1:S/æ—§æ–‡æœ¬/æ–°æ–‡æœ¬/g 3ã€ç¡®è®¤æ›¿æ¢ 1:%s/æ—§æ–‡æœ¬/æ–°æ–‡æœ¬/gc å›è½¦åä¼šæœ‰æç¤ºï¼Œæ ¹æ®æç¤ºè¿›è¡Œé€‰æ‹©å¯¹åº”çš„æ“ä½œï¼š yï¼šyesï¼Œæ›¿æ¢ nï¼šnoï¼Œä¸æ›¿æ¢ aï¼šallï¼Œå…¨éƒ¨ qï¼šquitï¼Œé€€å‡ºæ›¿æ¢ lï¼šlastï¼Œé€€æ¢æœ€åä¸€ä¸ªï¼Œå¹¶æŠŠå…‰æ ‡å®šä½åˆ°è¡Œé¦– ^Eï¼šå‘ä¸‹æ»šå± ^Yï¼šå‘ä¸Šæ»šå± å‘½ä»¤è¡Œå‘½ä»¤ä¸»è¦æ˜¯é’ˆå¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œçš„ï¼šä¿å­˜ã€é€€å‡ºã€ä¿å­˜&amp;é€€å‡ºã€æœç´¢ã€æ›¿æ¢ã€å¦å­˜ã€æ–°å»ºæ–‡ä»¶ã€æµè§ˆæ–‡ä»¶ï¼Œåˆ‡æ¢æ–‡ä»¶ä¹‹å‰ï¼Œå¿…é¡»ç¡®ä¿å½“å‰æ–‡ä»¶å·²ç»è¢«ä¿å­˜äº†ã€‚ 123:e . # editï¼Œä¼šæ‰“å¼€å†…ç½®çš„æ–‡ä»¶æµè§ˆå™¨ï¼Œæµè§ˆå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶:n æ–‡ä»¶å # newï¼Œæ–°å»ºæ–‡ä»¶:w æ–‡ä»¶å # writeï¼Œå¦å­˜ä¸ºæ–°æ–‡ä»¶ï¼Œä½†æ˜¯ä»ç„¶ç¼–è¾‘å½“å‰æ–‡ä»¶ï¼Œå¹¶ä¸ä¼šåˆ‡æ¢æ–‡ä»¶ åˆ†å±å‘½ä»¤å¯ä»¥åŒæ—¶ç¼–è¾‘å’ŒæŸ¥çœ‹å¤šä¸ªæ–‡ä»¶ 12:sp [æ–‡ä»¶å] # split,æ¨ªå‘å¢åŠ åˆ†å±:vsp [æ–‡ä»¶å] # vertical splitï¼Œçºµå‘å¢åŠ åˆ†å± åˆ‡æ¢åˆ†å±çª—å£åˆ†å±çª—å£éƒ½æ˜¯åŸºäºctrl+wè¿™ä¸ªå¿«æ·é”®çš„ 12345w # windowï¼Œåˆ‡æ¢éƒ½ä¸‹ä¸€ä¸ªçª—å£r # reverseï¼Œäº’æ¢çª—å£c # closeï¼Œå…³é—­å½“å‰çª—å£ï¼Œä½†æ˜¯ä¸èƒ½å…³é—­æœ€åä¸€ä¸ªçª—å£q # quitï¼Œé€€å‡ºå½“å‰çª—å£ï¼Œå¦‚æœæ˜¯æœ€åä¸€ä¸ªçª—å£ï¼Œåˆ™å…³é—­vimo # otherï¼Œå…³é—­å…¶ä»–çª—å£ ç¼–è¾‘å‘½ä»¤å’Œæ•°å­—çš„è”ç”¨12345åœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸‹ï¼Œè¾“å…¥æ•°å­—ï¼ˆå¦‚5æ¬¡ï¼‰æŒ‰ä¸‹iè¿›å…¥ç¼–è¾‘æ¨¡å¼åœ¨ç¼–è¾‘æ¨¡å¼ä¸‹è¿›è¡Œæ“ä½œï¼ˆå†™å…¥å†…å®¹æˆ–è€…æ¢è¡Œç­‰æ“ä½œéƒ½ä¼šè¢«å¤åˆ¶ï¼‰æŒ‰ä¸‹ESCè¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼ï¼Œè¿™æ—¶æ­¥éª¤2ã€3çš„æ“ä½œä¼šé‡å¤äº†5æ¬¡å¦‚æœå†æŒ‰ä¸‹.åˆ™ä¼šå°†é‡å¤ä¸Šä¸€ä¸ªæ“ä½œï¼Œä¹Ÿå°±æ˜¯æ­¥éª¤4ï¼Œç›¸å½“äºæ“ä½œäº†10æ¬¡]]></content>
      <tags>
        <tag>vim</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mitmproxyï¼šå®‰è£…é…ç½®]]></title>
    <url>%2Famberwest.github.io%2F2018%2F06%2F27%2Fmitmproxy%EF%BC%9A%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[mitmproxyæ˜¯ä¸€ä¸ªæ”¯æŒHTTPå’ŒHTTPSï¼Œå¹¶å¸¦æœ‰æ§åˆ¶å°çš„æŠ“åŒ…å·¥å…·ã€‚ å®‰è£…macä¸‹ä½¿ç”¨brewå®‰è£…mitmproxyï¼Œä¼šåŒæ—¶å®‰è£…mitmdumpå’Œmitmwebä¸¤ä¸ªç»„ä»¶ã€‚mitmdumpæ˜¯mitmporxyçš„å‘½ä»¤è¡Œç‰ˆæœ¬ï¼Œmitmwebæ˜¯ä¸€ä¸ªåŸºäºwebçš„mitmproxyæ¥å£ã€‚ 1brew install mitmproxy ç»ˆç«¯å¯åŠ¨mitmproxyä»¥ç”ŸæˆCAè¯ä¹¦ 1mitmproxy -p 8888 # ctrl+cå…³é—­ï¼Œé»˜è®¤ç«¯å£æ˜¯8080ï¼Œå¯ä»¥ä½¿ç”¨-pæŒ‡å®šç«¯å£ ç”Ÿæˆçš„è¯ä¹¦æ”¾åœ¨æ ¹ç›®å½•ä¸‹çš„éšè—æ–‡ä»¶.mitmproxy é…ç½®ç”µè„‘é…ç½®è¯ä¹¦ï¼š è¿›å…¥.mitmproxyæ–‡ä»¶å¤¹ï¼Œå°†mitmproxy-ca-cert.pemæ‹‰åˆ°é’¥åŒ™ä¸²è®¿é—®ä¸­ï¼Œç‚¹å‡»é€‰æ‹©â€œå§‹ç»ˆä¿¡ä»»â€ æ‰‹æœºé…ç½®è¯ä¹¦ï¼š 1ã€æŸ¥çœ‹ç”µè„‘çš„ip 1ifconfig en0 | grep inet 2ã€è®¾ç½®æ‰‹æœºhttpä»£ç†ï¼Œä¿®æ”¹æœåŠ¡å™¨å’Œç«¯å£ï¼ˆæ²¡æœ‰æŒ‡å®šåˆ™ä¸ºé»˜è®¤ç«¯å£8080ï¼‰ 3ã€åœ¨æ‰‹æœºæµè§ˆå™¨ä¸­è¾“å…¥mitm.itï¼Œé€‰æ‹©å¯¹åº”çš„è¯ä¹¦è¿›è¡Œå®‰è£…ã€è®¤è¯ è¿™æ ·å°±åŸºæœ¬é…ç½®å®Œæˆäº†ï¼Œæ•´ä¸ªè¿‡ç¨‹è·Ÿcharlesçš„é…ç½®æ˜¯ç±»ä¼¼çš„ï¼Œæ¥ä¸‹æ¥å°±èƒ½åœ¨ç»ˆç«¯ç›‘å¬æ‰‹æœºç«¯çš„æ•°æ®äº†ã€‚ ä½¿ç”¨å¯¹äºæ•°æ®æŠ“å–æ¥è¯´ï¼Œå¯ä»¥é€šè¿‡charlesã€fiddlerç­‰æŠ“åŒ…å·¥å…·å…ˆæ‰¾åˆ°æ•°æ®æ¥å£ï¼Œå†é€šè¿‡mitmproxyæ¥è·å–æ•°æ®ã€‚ mitmdumpå¯ä»¥è¿è¡Œè„šæœ¬ï¼š 1mitmdump -p 8888 -s script.py è„šæœ¬å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829# -*- coding:utf-8 -*-# Time: 2018/6/8 15:40from mitmproxy import ctximport jsonimport csvcolumns = ['title', 'author', 'cover', 'summary', 'price']file = open('books.csv', 'w', newline='', encoding='utf-8')writer = csv.DictWriter(file, columns)writer.writeheader()def response(flow): global writer url = "https://dedao.igetget.com/v3//discover/bookList" if flow.request.url.startswith(url): text = flow.response.text data = json.loads(text) books = data.get('c').get('list') for book in books: data = &#123; 'title': book.get('operating_title'), 'author': book.get('book_author'), 'cover': book.get('cover'), 'summary': book.get('other_share_summary'), 'price': book.get('price') &#125; writer.writerow(data) ctx.log.info(str(data)) è¿™é‡Œæœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„çš„ï¼š mitmproxyéœ€è¦python3.6åŠä»¥ä¸Šæ‰èƒ½è¿è¡Œ ä¾‹å­æ¥è‡ªå´”åº†æ‰çš„ã€Špython3ç½‘ç»œçˆ¬è™«å¼€å‘å®æˆ˜ã€‹ï¼ŒåŸä¾‹æ˜¯å°†æ•°æ®ä¿å­˜åˆ°mongodbï¼Œä½†æ˜¯ä¸€ç›´æœ‰é”™è¯¯ï¼Œæš‚æ—¶è¿˜æ²¡è§£å†³ å‚è€ƒæ–‡ç« ï¼šmitmproxy]]></content>
      <tags>
        <tag>mitmproxy</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[macOS High Sierra å®‰è£…pyspiderå‡ºé”™]]></title>
    <url>%2Famberwest.github.io%2F2018%2F06%2F27%2FmacOS-High-Sierra-%E5%AE%89%E8%A3%85pyspider%E5%87%BA%E9%94%99%2F</url>
    <content type="text"><![CDATA[åœ¨å®‰è£…pyspiderçš„æ—¶å€™ï¼ˆå·²ç»å®‰è£…äº†phantomJSï¼‰ï¼Œå‡ºç°è¿™æ ·çš„é”™è¯¯æç¤ºï¼š 12345 specify the SSL backend manually.&apos;&apos;&apos;) __main__.ConfigurationError: Curl is configured to use SSL, but we have not been able to determine which SSL backend it is using. Please see PycURL documentation for how to specify the SSL backend manually. ----------------------------------------Command &quot;python setup.py egg_info&quot; failed with error code 1 in /private/var/folders/47/d5b7q3_n4vn_1vjptchnm9z00000gp/T/pip-install-ggxo8959/pycurl/ æ ¹æ®é”™è¯¯æç¤ºï¼Œåº”è¯¥æ˜¯æ²¡åŠæ³•è·å–åˆ°opensslçš„å¤´æ–‡ä»¶æ‰å¯¼è‡´pycurlå®‰è£…é”™è¯¯ã€‚ç»è¿‡ä¸€ç•ªæœç´¢ï¼Œäº†è§£åˆ°macOS High SierraæŠŠSSLä»OPenSSL 0.9.8zh åˆ‡æ¢åˆ°LibreSSLã€‚è€Œä¸”é€šè¿‡homebrewå®‰è£…çš„opensslä¹Ÿæ˜¯key-onlyï¼Œç¦æ­¢é€šè¿‡brew link opensslæ·»åŠ è½¯é“¾æ¥ã€‚æ‰€ä»¥éœ€è¦è®¾ç½®ä¸€ä¸‹LDFLAGSï¼ŒCPPFLAGSï¼ŒPYCURL_SSL_LIBRARYï¼Œä»¥ä¾¿ç¼–è¯‘æ—¶èƒ½å¤Ÿæ‰¾åˆ°opensslã€‚ å®‰è£…pycurlï¼š 12345pip uninstall pycurl # å¸è½½åº“export PYCURL_SSL_LIBRARY=opensslexport LDFLAGS=-L/usr/local/opt/openssl/libexport CPPFLAGS=-I/usr/local/opt/openssl/include # opensslç›¸å…³å¤´æ–‡ä»¶è·¯å¾„pip install pycurl --compile --no-cache-dir # é‡æ–°ç¼–è¯‘å®‰è£… æ¥ä¸‹æ¥å®‰è£…pyspiderï¼š 1pip install pyspider å‚è€ƒæ–‡ç« ï¼š Installing PycURL on macOS High Sierra macå¯¼å…¥pycurlå‡ºé”™é‡è£…åè¿˜æ˜¯æŠ¥é”™]]></content>
      <tags>
        <tag>pyspider</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[pandasä¸­reset_indexå’Œset_indexç”¨æ³•]]></title>
    <url>%2Famberwest.github.io%2F2018%2F06%2F20%2Fpandas-reset-index%E5%92%8Cset-index%E7%94%A8%E6%B3%95%2F</url>
    <content type="text"><![CDATA[åœ¨å¤„ç†æ•°æ®çš„æ—¶å€™ï¼Œç»å¸¸éœ€è¦å°†æŠ“å–åˆ°çš„æ•°æ®å’Œè¿è¥æä¾›çš„æ•°æ®è¿›è¡Œä¸€ä¸ªåŒ¹é…æ›´æ–°ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯ä»¥å•†å“çš„é“¾æ¥ä½œä¸ºindexè¿›è¡ŒåŒ¹é…ï¼Œæ‰€ä»¥åœ¨è¯»æ•°æ®çš„æ—¶å€™æˆ‘éƒ½ä¼šä½¿ç”¨index_colæ¥æŒ‡å®šã€‚è¿™æ ·çš„è¯ï¼Œèƒ½è§£å†³æŠ“å–æ•°æ®å’ŒåŸå§‹æ•°æ®çš„åŒ¹é…é—®é¢˜ï¼Œä½†æ˜¯å‘¢ï¼ŒæŠ“å–æ•°æ®å°±å°‘äº†urlsè¿™ä¸€é¡¹ï¼ˆå·²ä½œä¸ºindexï¼‰ï¼Œæœ€åæ›´æ–°å®Œæ•°æ®è¿˜æ˜¯éœ€è¦å°†å•†å“é“¾æ¥ç»™è¡¥ä¸Šã€‚ä½¿ç”¨reset_index()å‡½æ•°å°±å¯ä»¥è½»æ¾è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ reset_index()è¯¥å‡½æ•°èƒ½å¤Ÿå°†è¡Œç´¢å¼•è½¬ä¸ºåˆ—ã€‚ 1DataFrame.reset_index(level=None, drop=False, inplace=False, col_level=0, col_fill=â€) dropä¸ºFalseåˆ™ç´¢å¼•ä¼šè¢«è¿˜åŸä¸ºæ™®é€šåˆ—ï¼Œå¦åˆ™ä¼šä¸¢å¤±ã€‚ å¯¹äºå•ç´¢å¼•é—®é¢˜ï¼Œä½¿ç”¨level=0è·Ÿlevel=â€˜index_nameâ€™çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå¯ä»¥ä¸æä¾›levelå‚æ•°ã€‚ 1dataframe.reset_index(level=0) å¯¹äºå¤šçº§ç´¢å¼•ï¼Œæƒ…å†µç¨å¾®æœ‰ç‚¹ä¸åŒã€‚ 123456import pandas as pdimport numpy as npindex = pd.MultiIndex.from_product([['TX', 'FL', 'CA'], ['North', 'South']], names=['State', 'Direction'])df = pd.DataFrame(index=index, data=np.random.randint(0, 10, (6,4)), columns=list('abcd')) ç›´æ¥è°ƒç”¨reset_index()ï¼Œé»˜è®¤æ˜¯å°†å…¨éƒ¨çº§åˆ«çš„è¡Œç´¢å¼•éƒ½è½¬ä¸ºåˆ—æ•°æ®ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªRangeInddexæ¥ä½œä¸ºæ–°ç´¢å¼•ã€‚ 1df.reset_index() ä½¿ç”¨levelå‚æ•°å¯ä»¥é€‰æ‹©æŒ‡å®šçš„è¡Œç´¢å¼•ã€‚ 123df.reset_index(level=1) # or df.reset_index(level=â€˜Directionâ€™) éœ€è¦è½¬æ¢å¤šä¸ªè¡Œç´¢å¼•æ—¶ä½¿ç”¨åˆ—è¡¨ã€‚ 1df.reset_index(level=[â€˜Stateâ€™,â€™Directionâ€™]) å¦å¤–ï¼Œæˆ‘ä»¬å°†æ•°æ®å…³äºæŸä¸ªå­—æ®µè¿›è¡Œåˆ†ç»„ä¹‹åï¼Œgroupbyçš„é”®å°†ä¼šä½œä¸ºç»“æœçš„indexï¼Œå¦‚æœä¸æƒ³è¦è¿™æ ·ï¼Œå¯ä»¥åœ¨åˆ†ç»„æ—¶è®¾ç½®as_index=Falseï¼Œå°±å¯ä»¥å°†groupbyçš„é”®ä»ç„¶ä½œä¸ºåˆ—æ•°æ®ã€‚ 123df2 = df.reset_index()# è¿™é‡Œçš„first()æ˜¯å–æ¯ä¸ªåˆ†ç»„çš„ç¬¬ä¸€æ¡è®°å½•df2.groupby('Direction', as_index=False).first() set_index()set_index()åˆ™ä¸ä¹‹ç›¸å ï¼Œè¯¥å‡½æ•°ç”¨æ¥è®¾ç½®è¡Œç´¢å¼•ã€‚ 1DataFrame.set_index(keys, drop=True, append=False, inplace=False, verify_integrity=False) å‚æ•°è¯´æ˜ï¼š è®¾ç½®ç´¢å¼•çš„å‚æ•°æ˜¯keys appendæ·»åŠ æ–°ç´¢å¼• dropä¸ºFalseæ—¶ï¼ŒæˆåŠŸè®¾ç½®äº†indexï¼ŒåŒæ—¶åˆ—æ•°æ®ä¸­ä»ç„¶ä¿å­˜ç€indexå­—æ®µ inplaceä¸ºTrueæ—¶ï¼Œä¿®æ”¹äº†åŸå§‹æ•°æ® å•ç´¢å¼•ç›´æ¥ä¼ å…¥å­—ç¬¦ä¸²å³å¯ã€‚ 1df2.set_index('State') å¤åˆç´¢å¼•åˆ™è¾“å…¥åˆ—è¡¨ã€‚ 1df2.set_index(keys=['State', 'Direction']) å¯ä»¥å¾ˆè‡ªç”±çš„è®¾ç½®å¤åˆç´¢å¼•çš„levelï¼Œä¸è¿‡åœ¨è¿™ä¸ªä¾‹å­æ²¡æœ‰ä½“ç°å‡ºæ¥ 1df2.set_index(keys=['Direction', 'State']) å‚è€ƒé“¾æ¥ï¼šHow to convert pandas index in a dataframe to a column?]]></content>
      <categories>
        <category>pandas</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>index</tag>
        <tag>ç´¢å¼•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[pandasä¸­æ ¹æ®æŒ‡å®šlistè¿›è¡Œæ’åº]]></title>
    <url>%2Famberwest.github.io%2F2018%2F06%2F20%2Fpandas%EF%BC%9A%E6%A0%B9%E6%8D%AE%E6%8C%87%E5%AE%9Alist%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F%2F</url>
    <content type="text"><![CDATA[åœ¨å®é™…æ“ä½œä¸­ï¼Œç»å¸¸éœ€è¦æ ¹æ®æŒ‡å®šçš„listå¯¹æ•°æ®æ’åºï¼Œè€Œä¸å•å•æ˜¯æ ¹æ®è¡Œç´¢å¼•ï¼Œæ‰€ä»¥å°±éœ€è¦å°†æ•°æ®ç±»å‹è½¬ä¸ºcategoryã€‚ æ³¨ï¼šä½œä¸ºç±»åˆ«çš„åˆ—è¡¨å…ƒç´ å¿…é¡»å…·æœ‰å”¯ä¸€æ€§ åŸæ•°æ®å¦‚ä¸‹ï¼š 12345import pandas as pddata = &#123;'name': ['li', 'wang', 'zhang', 'hua'], 'grade': ['good', 'good', 'bad', 'excellent']&#125;df = pd.DataFrame(data) ç°åœ¨ï¼Œå°†å­¦ç”ŸæŒ‰æˆç»©ç­‰çº§ä»bad good excellentè¿›è¡Œæ’åº å°†æŸä¸€åˆ—æ•°æ®è½¬ä¸ºcategoryï¼ˆdtypeï¼‰ å°†è¯¥åˆ—æŒ‰ç…§ç»™å®šçš„ç±»åˆ«é‡æ–°å½’ç±» 12345df['grade'] = df['grade'].astype('category')list_custom = ['bad', 'good', 'excellent']df['grade'].cat.reorder_categories(list_custom, inplace=True)# inplace=Trueåœ¨åŸæ•°æ®ä¸Šç”Ÿæ•ˆdf.sort_values('grade', inplace=True) å¦‚æœè¦å°†ç»“æœä¿å­˜åˆ°æ–°çš„å˜é‡ä¸Šï¼Œå¯ä»¥çœç•¥inplaceå‚æ•° 1new_df = df.sort_values(â€˜grade') å¦ä¸€ç§æ–¹æ³•å¦‚ä¸‹ï¼š ç›´æ¥æ„å»ºç±»åˆ«c å°†æŸä¸€åˆ—çš„dtypeè½¬ä¸ºc 123456from pandas.api.types import CategoricalDtypelist_custom = ['bad', 'good', 'excellent']order = CategoricalDtype(list_custom, ordered=True)df['grade'] = df.grade.astype(order)df.sort_values('grade') è¿™ä¸¤ç§æ–¹æ³•ï¼Œä»é€»è¾‘ä¸Šæ¥è®²ï¼Œè¿˜æ˜¯åè€…æ¯”è¾ƒå¥½ç†è§£ã€‚]]></content>
      <tags>
        <tag>pandas</tag>
        <tag>æ’åº</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mongodbå¸¸è§é”™è¯¯]]></title>
    <url>%2Famberwest.github.io%2F2018%2F06%2F14%2Fmongodb%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%2F</url>
    <content type="text"><![CDATA[(code=exited, status=14)ä¸çŸ¥é“æ€ä¹ˆå°±å‡ºç°äº†è¿™ä¸ªé—®é¢˜ã€‚åœ¨ç½‘ä¸Šæ‰¾äº†å¥½ä¸€ç•ªï¼Œæ‰çŸ¥é“æ˜¯å› ä¸ºMongodb SOCKä¸å±äºmongodb groupå’Œuserå¯¼è‡´çš„ã€‚ 12# é”™è¯¯ä¿¡æ¯ï¼Œè‡ªå·±çš„å¿˜è®°æˆªå›¾äº†ï¼Œè¿™æ˜¯æ¥è‡ªå‚è€ƒæ–‡ç« çš„ä¿¡æ¯mongod.service â€” High-performance, schema-free document-oriented database Loaded: loaded (/lib/systemd/system/mongod.service; disabled; vendor preset: enabled) Active: failed (Result: exit-code) since Wed 2016â€“12â€“07 03:43:00 UTC; 3min 9s ago Docs: https://docs.mongodb.org/manual Process: 24453 ExecStart=/usr/bin/mongod â€” quiet â€” config /etc/mongod.conf (code=exited, status=14) Main PID: 24453 (code=exited, status=14) å…·ä½“çš„è§£å†³æ–¹æ³•ï¼š è¿›å…¥tmpç›®å½• 1cd /tmp æŸ¥çœ‹æ˜¯å¦æœ‰mongodb sockæ–‡ä»¶ 1ls *.sock ä¿®æ”¹user:groupæƒé™ 1sudo chown mongodb:mognodb &lt;your_sock&gt; # è¿™é‡Œæˆ‘æ˜¯mongod é‡å¯mongodb 1sudo service mongod start æŸ¥çœ‹mongodbçŠ¶æ€ 1sudo service mongod status æ— æ³•è¿æ¥è¿œç¨‹mongodbæ•°æ®åº“å½“æˆ‘åœ¨æœ¬åœ°å°è¯•è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨æ—¶ï¼Œé‡åˆ°connection attempt failedè¿™ä¸ªé”™è¯¯ã€‚ ä¸€èˆ¬é‡åˆ°è¿™ç§æƒ…å†µï¼Œè¦ä¹ˆæ˜¯è¿œç¨‹æœåŠ¡å™¨æ²¡å¼€å¯mongodæœåŠ¡ï¼Œè¦ä¹ˆå°±æ˜¯æ²¡å¼€æ”¾ç«¯å£ã€‚ 1ã€å¼€å¯è¿œç¨‹mongodæœåŠ¡ 12ssh user@192.122.122.100 # ç™»å½•mongod --auth -f /etc/mongod.conf # Linuxä¸­mongodçš„é…ç½®æ–‡ä»¶é»˜è®¤æ”¾åœ¨/etcä¸‹ï¼Œauthæ˜¯éœ€è¦å¯†ç ç™»å½• ç„¶åå°±å¯ä»¥åœ¨æœ¬åœ°å°è¯•è¿æ¥äº† 2ã€å¼€æ”¾mongodæœåŠ¡ç«¯å£ å¦‚æœå¯åŠ¨mongodæœåŠ¡ä¹‹åè¿˜æ˜¯ä¸è¡Œï¼Œå°±éœ€è¦æ£€æŸ¥ä¸€ä¸‹é˜²ç«å¢™ã€‚åœ¨centos7æŸ¥çœ‹å¼€æ”¾å…³é—­ç«¯å£éƒ½æ˜¯ç”¨é˜²ç«å¢™æ¥æ§åˆ¶çš„ã€‚ å…³é—­mongodæœåŠ¡ 1sudo service mongod stop æŸ¥çœ‹å·²ç»å¼€æ”¾çš„ç«¯å£ 1sudo firewall-cmd --list-ports å¼€å¯ç«¯å£ 1sudo firewall-cmd --zone-public --add-port=27017/tcp --permanent é‡å¯é˜²ç«å¢™ 12firewall-cmd --reloadsudo service firewalld start é‡æ–°å°è¯•è¿æ¥ é”™è¯¯ç 1å’Œé”™è¯¯100å‡ºç°é”™è¯¯ç 1å’Œ100å¾ˆå¯èƒ½å› ä¸ºä¸Šæ¬¡mongodbæ²¡æœ‰æ­£å¸¸å…³é—­. 1ã€å¦‚æœæ˜¯error number 100çš„è¯,ä¸€èˆ¬æ‰¾å‡ºä¹‹å‰çš„è¿›ç¨‹,ç„¶åkillå°±å¯ä»¥ 2ã€æ€æ‰è¿›ç¨‹åä»ç„¶æ— æ³•å¯åŠ¨mongdå®ä¾‹ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯è¢«é”ä½äº†ï¼Œéœ€è¦å°†mongod.lockæ–‡ä»¶åŠå½“å¤©çš„lockæ–‡ä»¶ç»™åˆ é™¤ å…¶å®è¿˜æœ‰ä¸€ä¸ªå½“å¤©çš„æ—¥å¿—æ–‡ä»¶,ä¸è¿‡è¢«æ‰‹åŠ¨åˆ é™¤äº†.å‚è€ƒç½‘ä¸Šçš„åšæ³•: 123find / -name mongod.lock # è¯¥æ–‡ä»¶å°†mongodbé”ä¸Šé˜²æ­¢ç”¨æˆ·æ“ä½œrm -rf mongod.lock # å¡«å†™æ­£ç¡®çš„æ–‡ä»¶åœ°å€rm -rf log.datetime # åˆ é™¤å½“å¤©æ—¥å¿—æ–‡ä»¶ ç„¶åå†å°è¯•å¯åŠ¨mongodb 3ã€ç»è¿‡ä¸Šé¢ä¸¤æ­¥æ“ä½œä¹‹åï¼Œæ‚²å‚¬åœ°å‘ç°è¿˜æ˜¯å¯åŠ¨ä¸äº†mongodå®ä¾‹ã€‚æ— å¥ˆå•Šï¼ï¼ï¼ç»§ç»­æœç´¢ä¹‹åå‘ç°å¯èƒ½æ˜¯å› ä¸ºå­˜å‚¨ç©ºé—´æ»¡äº†ï¼Œéœ€è¦æ¸…ç†ç©ºé—´æˆ–è€…åŠ å¤§å­˜å‚¨ç©ºé—´ 4ã€åˆ é™¤æ•°æ®æ–‡ä»¶ä¹‹åï¼Œå¯ä»¥å¯åŠ¨mongdè¿›ç¨‹ï¼Œä½†æ˜¯ç™»å½•éªŒè¯çš„æ—¶å€™å‡ºé”™ï¼Œé€€å‡ºé‡æ–°ç™»å½•ï¼ˆä»¥ä¸ºæ˜¯å¯†ç ä¹‹ç±»çš„å¼„é”™ï¼‰ï¼Œå¯åŠ¨mongodè¿›ç¨‹åˆå‡ºç°100é”™è¯¯ç ï¼ï¼ï¼è‰æ³¥é©¬ï½ï½ï½ç»§ç»­å¥‹æ–—ï¼æ ¹æ®ç½‘å‹çš„å®è·µï¼Œå¯èƒ½è¿˜éœ€è¦åˆ é™¤storageæ–‡ä»¶ï¼Œç»“æœè¿˜æ˜¯ä¸è¡Œï¼ï¼ï¼ 5ã€æœ€åï¼Œæˆ‘æœ‰ä¸ªå¤§èƒ†çš„çŒœæµ‹ï¼Œå°±æ˜¯åœ¨æ¸…ç†æ•°æ®åº“çš„æ—¶å€™ï¼Œå› ä¸ºä¸æ¸…æ¥šå“ªäº›æ˜¯æ•°æ®ï¼Œå“ªäº›æ˜¯ä¸å¯åˆ æ–‡ä»¶ï¼Œå½“æ—¶ä¸€è‚¡è„‘å…¨æ¸…ç©ºäº†ï¼ˆéƒ½æ˜¯è‡ªå·±å¹³æ—¶çˆ¬ç€ç©çš„æ•°æ®ï¼‰ï¼Œå¯èƒ½å°†ç”¨æˆ·ä¿¡æ¯ä¹Ÿå¯æ¸…ç†äº†ã€‚æ‰€ä»¥æˆ‘æ²¡æœ‰ç”¨è´¦å·å¯†ç ç™»å½•ï¼Œå±…ç„¶ã€‚ã€‚ã€‚æˆã€‚ã€‚ã€‚åŠŸã€‚ã€‚ã€‚äº†ã€‚ã€‚ã€‚ã€‚ è¿›å…¥mongo shellçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯éªŒè¯æˆ‘çš„æƒ³æ³•ï¼Œå—¯ï¼Œè¿˜çœŸæ˜¯è¿™æ ·ï½ï½çœ‹æ¥ä¸å¸¦è„‘å­çœŸä¸è¡Œ ç›¸å…³çŸ¥è¯†ç‚¹MongoDBè¿æ¥è¿œç¨‹æœåŠ¡å™¨çš„å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š 1mongo è¿œç¨‹ä¸»æœºIPæˆ–DNS:MongoDBç«¯å£å·/æ•°æ®åº“å -u user -p password # å¦‚æœæ²¡æœ‰è®¾ç½®è´¦å·å¯†ç å°±å¯ä»¥çœç•¥ä¸å†™ å¸¸è§çš„è¿æ¥æ–¹å¼æœ‰ï¼š 1234567891011# ä½¿ç”¨é»˜è®¤ç«¯å£è¿æ¥MongoDBmongo 192.122.109.55# æŒ‡å®šç«¯å£è¿æ¥MongoDBmongo 192.122.109.55:27017# è¿æ¥MongoDBåˆ°æŒ‡å®šæ•°æ®åº“mongo 192.122.109.55:27017/test# ä½¿ç”¨è´¦å·å¯†ç è¿æ¥åˆ°æŒ‡å®šçš„MongoDBæ•°æ®åº“mongo 192.122.109.55:27017/test -u user -p passwd å‚è€ƒæ–‡ç« MongoDB - Ubuntu 16.04(code=exited, status=14) AWS lightsail problem]]></content>
      <tags>
        <tag>mongodb</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[pyenvåœ¨centos7å’Œmacä¸‹çš„å®‰è£…ä½¿ç”¨]]></title>
    <url>%2Famberwest.github.io%2F2018%2F06%2F14%2Fpyenv%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[ç”±äºmitmproxyéœ€è¦python3.6æ‰èƒ½ä½¿ç”¨ï¼Œæ‰€ä»¥å¾—å®‰è£…æ–°çš„pythonç‰ˆæœ¬ã€‚pyenvå¯ä»¥éå¸¸æ–¹ä¾¿çš„å®‰è£…å¹¶ç®¡ç†pythonç‰ˆæœ¬ï¼Œè¿˜èƒ½é¡ºå¸¦åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå¯ä»¥è¯´æ˜¯éå¸¸è‰¯å¿ƒäº†ï¼ è¿™é‡Œç®€å•è®°å½•ä¸€ä¸‹mac OSä¸‹çš„å®‰è£…ä½¿ç”¨ã€‚ pyenvå®‰è£…pyenv1ã€mac éœ€è¦ç¡®ä¿å·²ç»å®‰è£…äº†Xcode Command Line Tools å’Œ Homebrewã€‚ 1brew install pyenv 2ã€centos7 å®‰è£…pyenvä¾èµ–åŒ… 12yum -y install epel-releaseyum install git gcc zlib-devel bzip2-devel readline-devel sqlite-devel openssl-devel è·å–pyenvæºç  1git clone https://github.com/pyenv/pyenv.git $HOME/.pyenv è®¾ç½®ç¯å¢ƒå˜é‡åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ ï¼Œcentos7åˆ™å°†~/.zshrcæ”¹ä¸º~/.bashrc 123echo 'export PYENV_ROOT="$HOME/.pyenv"' &gt;&gt; ~/.zshrcecho 'export PATH="$PYENV_ROOT/bin:$PATH"' &gt;&gt; ~/.zshrcecho 'eval "$(pyenv init -)"' &gt;&gt; ~/.zshrc # å¯åŠ¨shellçš„æ—¶å€™ï¼Œåˆå§‹åŒ–pyenv ä½¿æ–‡ä»¶ç«‹å³ç”Ÿæ•ˆ 1source ~/.zshrc ä½¿ç”¨pyenvæŸ¥çœ‹å¯å®‰è£…çš„ç‰ˆæœ¬å·,å¦‚æœæ²¡æœ‰3.6åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œéœ€è¦å…ˆæ›´æ–°ä¸€ä¸‹pyenvã€‚ 123cd ~/.pyenv &amp;&amp; git pull # updatepyenv install â€”list # å¯å®‰è£…åˆ—è¡¨ å®‰è£…/å¸è½½æŒ‡å®šç‰ˆæœ¬å·(å¦‚ï¼špython3.6.5) 123pyenv install 3.6.5 # å®‰è£… pyenv uninstall 3.6.5 # å¸è½½ æŸ¥çœ‹å·²å®‰è£…çš„pythonç‰ˆæœ¬ 12pyenv versions # å…¨éƒ¨pyenv version # å½“å‰çš„pythonç‰ˆæœ¬ åˆ‡æ¢åˆ°æŒ‡å®špythonç‰ˆæœ¬ 1234cd â€¦ pyenv local 3.6.5 # å±€éƒ¨ï¼Œå½“å‰ç›®å½•æœ‰æ•ˆ pyenv local system # åˆ‡æ¢åˆ°ç³»ç»Ÿè‡ªå¸¦ç‰ˆæœ¬ pyenv global 3.6.5 # è®¾ç½®å…¨å±€çš„pythonç‰ˆæœ¬ *å·ä»£è¡¨å½“å‰çš„pythonç‰ˆæœ¬å· å–æ¶ˆå·²ç»è®¾ç½®çš„pythonç‰ˆæœ¬ 12pyenv local -â€”unset pyenv global --unset æ¥ä¸‹æ¥å°±å¯ä»¥åˆ›å»ºè™šæ‹Ÿç¯å¢ƒäº†ã€‚ pyenv-virtualenvå…ˆå®‰è£…pyenvçš„æ’ä»¶pyenv-virtualenvï¼Œä½œç”¨è·Ÿvietualenvä¸€æ ·ï¼Œå¯ä»¥ä¸ºæŸä¸ªç›®å½•è®¾ç½®ç‹¬ç«‹çš„pythonç‰ˆæœ¬ï¼Œæ–¹ä¾¿é¡¹ç›®ç®¡ç†ã€‚ 1git clone https://github.com/yyuu/pyenv-virtualenv.git ~/.pyenv/plugins/pyenv-virtualenv å¦‚æœä¸æŒ‡å®špythonç‰ˆæœ¬å·ï¼ˆåªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå°†ä½œä¸ºè™šæ‹Ÿç¯å¢ƒåç§°ï¼‰ï¼Œåˆ™é»˜è®¤æ˜¯å½“å‰ç¯å¢ƒçš„pythonç‰ˆæœ¬å·ï¼Œnameæ˜¯è™šæ‹Ÿç¯å¢ƒçš„åå­— 1pyenv virtualenv 3.6.5 name æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ 1pyenv activate name é€€å‡ºè™šæ‹Ÿç¯å¢ƒ 1pyenv deactivate åˆ é™¤è™šæ‹Ÿç¯å¢ƒ 1234pyenv uninstall name # æˆ–è€…åˆ é™¤å…¶çœŸå®ç›®å½•rm -rf ~/.pyenv/versions/name è‡ªåŠ¨æ¿€æ´»/åœç”¨è™šæ‹Ÿç¯å¢ƒ åœ¨shellä¸­æ·»åŠ ä»¥ä¸‹å‘½ä»¤ï¼Œpyenv-virtualenvå°†åœ¨è¿›å…¥/ç¦»å¼€æœ‰.python-versionåˆ—å‡ºæœ‰æ•ˆè™šæ‹Ÿç¯å¢ƒçš„æ–‡ä»¶çš„ç›®å½•æ—¶ä¼šè‡ªåŠ¨æ¿€æ´»/åœç”¨virtualenvï¼Œè¿™æ ·å°±ä¸ç”¨æ‰‹åŠ¨å»è®¾ç½®ã€‚è®¾ç½®å®Œæˆåéœ€è¦sourceä¸€ä¸‹ 1eval "$(pyenv virtualenv-init -)" pycharmä¸­ä¸ºé¡¹ç›®æ·»åŠ å¯¹åº”çš„è™šæ‹Ÿç¯å¢ƒï¼Œä¹Ÿå°±æ˜¯nameä¸‹çš„pythonã€‚ ä¾‹å­æœ€åå†æ¥ä¸ªå®Œæ•´çš„ä¾‹å­ï¼šåœ¨projectsç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®testï¼Œå¹¶è®¾ç½®é¡¹ç›®ä½¿ç”¨çš„pythonç‰ˆæœ¬ä¸º3.6.1 123456789[~]$ pyenv install 3.6.1 # å®‰è£…python3.6.1ç‰ˆæœ¬[~]$ cd projects/[projects]$ mkidr test[projects]$ cd test[projects test]$ pyenv virtualenv 3.6.1 py36 # åˆ›å»ºä¸€ä¸ªpythonç‰ˆæœ¬ä¸º3.6.1çš„è™šæ‹Ÿç¯å¢ƒï¼Œåä¸ºpy36[projects test]$ pyenv activate py36 # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ(py36)[projects test]$ pyenv versions # å¸¦*çš„å°±æ˜¯å½“å‰çš„ä½¿ç”¨ç¯å¢ƒ# ... start your performance ...(py36)[projects test]$ pyenv deactivate py36 # é€€å‡ºè™šæ‹Ÿç¯å¢ƒ å‚è€ƒpyenv pyenv-virtualenv pythonç‰ˆæœ¬ç®¡ç†]]></content>
      <tags>
        <tag>pyenv</tag>
        <tag>è™šæ‹Ÿç¯å¢ƒ</tag>
        <tag>å¤šç‰ˆæœ¬</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mongodbï¼šè®¾ç½®å¹¶ä½¿ç”¨è´¦å·å¯†ç ç™»å½•]]></title>
    <url>%2Famberwest.github.io%2F2018%2F06%2F14%2Fmongodb%EF%BC%9A%E8%AE%BE%E7%BD%AE%E5%B9%B6%E4%BD%BF%E7%94%A8%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95%2F</url>
    <content type="text"><![CDATA[ç™»å½•mongodb12mongod -f /../mongodb/conf/mongo.conf # å…·ä½“è·¯å¾„æ ¹æ®æ‰€åœ¨ç›®å½•å†³å®šmongo 127.0.0.1:28001 ç”±äºmongodbæ˜¯æ²¡æœ‰é»˜è®¤ç®¡ç†å‘˜è´¦å·çš„ï¼Œæ‰€ä»¥è¦å…ˆæ·»åŠ ç®¡ç†å‘˜è´¦å·ï¼Œå†å¼€å¯æƒé™è®¤è¯ã€‚ åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼ˆå¿…é¡»åœ¨adminæ•°æ®åº“ä¸‹æ‰æ˜¯ç®¡ç†å‘˜è´¦å·ï¼‰1234567891011121314use admindb.createUser( &#123; user: "adminUser", pwd: "adminPass", roles: [ &#123;role: "userAdminAnyDatabase", # ç›´æ¥ç”¨rootä¹Ÿæ˜¯ä¸€æ ·çš„æ•ˆæœ db: "admin"&#125; ] &#125;)# è®¤è¯db.auth("adminUser", "adminPass")# æŸ¥çœ‹ç”¨æˆ·db.getUsers() åˆ›å»ºæ™®é€šç”¨æˆ·ï¼ŒåŒ…æ‹¬ä½¿ç”¨æƒé™ä»¥åŠèƒ½å¤Ÿè®¿é—®çš„æ•°æ®åº“ã€‚123456789101112use foodb.createUser( &#123; user: "simpleUser", pwd: "simplePass", roles: [&#123;role: "readWrite", db: "foo"&#125;, &#123;role: "read", db: "bar"&#125;] &#125;)# è®¤è¯db.auth("simpleUser", "simplePass") æ³¨æ„ï¼šä¸€å®šè¦åˆ‡æ¢åˆ°å¯¹åº”çš„æ•°æ®åº“å†åˆ›å»ºç”¨æˆ· é€€å‡ºmongodbä¹‹åï¼Œå†æ¬¡ç™»å½•éœ€è¦éªŒè¯è´¦å·å¯†ç ã€‚æ²¡æœ‰éªŒè¯ï¼Œä¹Ÿå¯ä»¥æ­£å¸¸ç™»å½•ï¼Œä½†æ˜¯æ²¡åŠæ³•è¿›è¡Œæ“ä½œã€‚åœ¨ç»ˆç«¯æ“ä½œmongodbå¯ä»¥æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š 1ã€ç±»ä¼¼ä¸mysqlï¼Œåœ¨å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼ŒæŒ‡å®šç”¨æˆ·åï¼Œå¯†ç ä»¥åŠå¯¹åº”çš„æ•°æ®åº“åç§°12monogd --auth -f /.../mongodb/conf/mongo.confmongo 127.0.0.1:28001 -u "username" -p "password" --authenticationDatabase "db_name" 2ã€è¿›å…¥å®¢æˆ·ç«¯ä¹‹åå†éªŒè¯12monogd --auth -f /.../mongodb/conf/mongo.confmongo 127.0.0.1:28001 è¿›å…¥å®¢æˆ·ç«¯ä¹‹ååˆ‡æ¢åˆ°å¯¹åº”çš„æ•°æ®åº“ 12use testdb.auth('test', 'test') # username, password pymongoè¿æ¥mongodbåœ¨pythonä¸­å¯ä»¥é€šè¿‡pymongoæ¨¡å—è¿æ¥åˆ°mongodbï¼Œéœ€è¦å…ˆåœ¨ç»ˆç«¯å¼€å¯mongodæœåŠ¡ï¼Œç„¶åæ‰èƒ½æ­£å¸¸ä½¿ç”¨mongodbã€‚ 1ã€ç»ˆç«¯å¼€å¯æœåŠ¡ 1mongod --auth -f /Users/amber/opt/mongodb/conf/mongo.conf 2ã€è¿æ¥ mongodbæ²¡æœ‰è®¾ç½®ç”¨æˆ·æ—¶ï¼Œç›´æ¥è¿æ¥å°±å¯ä»¥ä½¿ç”¨ã€‚ 123456# mongodbæ²¡æœ‰è®¾ç½®è´¦å·å¯†ç client = pymongo.MongoClient('localhost', 28001)db = client['test'] # é€‰æ‹©æ•°æ®åº“collection = db['test'] # é€‰æ‹©collection# æˆ–è€…ç”¨ä¸‹é¢è¿™ç§æ–¹æ³•æ¥è·å¾—collectionï¼Œå°½é‡é¿å…db.testè¿™æ ·çš„å†™æ³•collection = db.get_collection('test') å½“mongodbè®¾ç½®äº†ç”¨æˆ·ï¼Œè¿æ¥æ—¶éœ€è¦éªŒè¯ã€‚ 1234567891011121314151617# æµ‹è¯•çš„æ•°æ®åº“å’Œç”¨æˆ·åå¯†ç éƒ½ä¸ºtest# æ–¹æ³•1ã€ä½¿ç”¨uriuri = 'mongodb://username:password@localhost:28001/db_name'client = pymongo.MongoClient(uri)db = client.get_database() # è·å–uriä¸­å·²ç»æŒ‡å®šè¿æ¥çš„æ•°æ®åº“collection = db['test']# æ–¹æ³•2ã€ç›´æ¥ä½¿ç”¨ç”¨æˆ·åç­‰å­—æ®µï¼Œä¸æŒ‡å®šauthSourceæ—¶é»˜è®¤æ˜¯adminæ•°æ®åº“client = pymongo.MongoClient('localhost', 28001, username='test', password='test', authSource='test')db = client['test']collection = db['test']# æ–¹æ³•3ã€ç›´æ¥è¿æ¥æ•°æ®åº“ä¹‹åå†éªŒè¯client = pymongo.MongoClient('localhost', 28001)db = client['test']db.authenticate('test', 'test')collection = db['test'] é™„å½•roleè§’è‰² æ•°æ®åº“ç”¨æˆ·è§’è‰²ï¼šreadã€readWrite; æ•°æ®åº“ç®¡ç†è§’è‰²ï¼šdbAdminã€dbOwnerã€userAdminï¼› é›†ç¾¤ç®¡ç†è§’è‰²ï¼šclusterAdminã€clusterManagerã€clusterMonitorã€hostManagerï¼› å¤‡ä»½æ¢å¤è§’è‰²ï¼šbackupã€restoreï¼› æ‰€æœ‰æ•°æ®åº“è§’è‰²ï¼šreadAnyDatabaseã€readWriteAnyDatabaseã€userAdminAnyDatabaseã€dbAdminAnyDatabase è¶…çº§ç”¨æˆ·è§’è‰²ï¼šroot å†…éƒ¨è§’è‰²ï¼š__system è§’è‰²è¯´æ˜ readï¼šå…è®¸ç”¨æˆ·è¯»å–æŒ‡å®šæ•°æ®åº“ readWriteï¼šå…è®¸ç”¨æˆ·è¯»å†™æŒ‡å®šæ•°æ®åº“ dbAdminï¼šå…è®¸ç”¨æˆ·åœ¨æŒ‡å®šæ•°æ®åº“ä¸­æ‰§è¡Œç®¡ç†å‡½æ•°ï¼Œå¦‚ç´¢å¼•åˆ›å»ºã€åˆ é™¤ï¼ŒæŸ¥çœ‹ç»Ÿè®¡æˆ–è®¿é—®system.profile userAdminï¼šå…è®¸ç”¨æˆ·å‘system.usersé›†åˆå†™å…¥ï¼Œå¯ä»¥æ‰¾æŒ‡å®šæ•°æ®åº“é‡Œåˆ›å»ºã€åˆ é™¤å’Œç®¡ç†ç”¨æˆ· clusterAdminï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰åˆ†ç‰‡å’Œå¤åˆ¶é›†ç›¸å…³å‡½æ•°çš„ç®¡ç†æƒé™ã€‚ readAnyDatabaseï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„è¯»æƒé™ readWriteAnyDatabaseï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„è¯»å†™æƒé™ userAdminAnyDatabaseï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„userAdminæƒé™ dbAdminAnyDatabaseï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„dbAdminæƒé™ã€‚ rootï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ã€‚è¶…çº§è´¦å·ï¼Œè¶…çº§æƒé™ dbOwner: readWrite + dbAdmin + dbAdmin å‚è€ƒæ–‡ç« ï¼šmongodb Authentication Examples]]></content>
      <tags>
        <tag>mongodb</tag>
        <tag>ç™»å½•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mongodbå®‰è£…]]></title>
    <url>%2Famberwest.github.io%2F2018%2F06%2F14%2Fmongodb%EF%BC%9A%E5%AE%89%E8%A3%85%2F</url>
    <content type="text"><![CDATA[åœ¨centos7ä¸Šå®‰è£…å®˜ç½‘ä¸Šæœ‰å¤šç§å®‰è£…æ–¹å¼ï¼Œè¿™é‡Œåªé€‰æ‹©.rpm Packageæ–¹å¼ï¼Œä¹Ÿæ˜¯å®˜ç½‘æ¨èçš„ã€‚ 1ã€é…ç½®yumå®‰è£…æ‰€éœ€è¦çš„åŒ…ç®¡ç†ç³»ç»Ÿ 1sudo vim /etc/yum.repos.d/mongodb-org-4.0.repo ç„¶ååœ¨æ–‡ä»¶é‡Œå†™å…¥ä»¥ä¸‹å†…å®¹ 123456[mongodb-org-4.0]name=MongoDB Repositorybaseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/4.0/x86_64/gpgcheck=1enabled=1gpgkey=https://www.mongodb.org/static/pgp/server-4.0.asc 2ã€å®‰è£…Mongo DBå®‰è£…åŒ… 1sudo yum install -y mongodb-org å¦‚æœæƒ³è¦å®‰è£…ç‰¹å®šçš„ç‰ˆæœ¬ï¼Œå¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤ 1sudo yum install -y mongodb-org-4.0.2 mongodb-org-server-4.0.2 mongodb-org-shell-4.0.2 mongodb-org-mongos-4.0.2 mongodb-org-tools-4.0.2 æŒ‰ç†è¯´ï¼Œä½ å¯ä»¥æŒ‡å®šä»»ä½•å¯ç”¨çš„MongoDBç‰ˆæœ¬ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦æœ‰å¯ç”¨çš„æ–°ç‰ˆæœ¬ï¼Œyumä¼šè‡ªåŠ¨å‡çº§è½¯ä»¶åŒ…ï¼Œæ‰€ä»¥ä¸ºäº†é˜²æ­¢æ„å¤–ï¼Œå¯ä»¥å°†ä¸‹é¢çš„excludeæŒ‡ä»¤æ·»åŠ åˆ°/etc/yum.confæ–‡ä»¶ä¸­ï¼š 1exclude=mongodb-org,mongodb-org-server,mongodb-org-shell,mongodb-org-mongos,mongodb-org-tools åˆ°è¿™é‡Œå°±å·²ç»å®‰è£…å®Œæˆäº†ï¼Œé…ç½®æ–‡ä»¶é»˜è®¤åœ¨/etc/mongod.confã€‚ macä¸‹çš„å®‰è£…ä½¿ç”¨brewç›´æ¥å®‰è£…12brew updatebrew install mongodb åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º/data/dbæ–‡ä»¶å¤¹ï¼Œç”¨æ¥ä¿å­˜mongodbçš„æ•°æ®ï¼Œå¹¶ä¸”ç»™è¯¥ç›®å½•è®¾ç½®æƒé™12sudo mkdir -P /data/dbsudo chown -R user_name /data # user_nameæ˜¯ç”µè„‘ç”¨æˆ· åœ¨ç»ˆç«¯å¯åŠ¨mongod1mongod åœ¨æ–°çª—å£è¿æ¥æ•°æ®åº“1mongo é€€å‡ºæ—¶éœ€è¦å…ˆè¿›å…¥adminæ•°æ®åº“å†é€€å‡º123use admindb.shutdownServer()exit å°†mongodbå®‰è£…åˆ°æŒ‡å®šè·¯å¾„ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…12curl -o /path/to/download # å®‰è£…åŒ…ä¸‹è½½è·¯å¾„tar -zxvf mongodb-linux-x86_64-3.4.1.tgz # å®‰è£…åŒ…åå­— å°†è§£å‹åçš„æ–‡ä»¶æ‹·è´åˆ°æŒ‡å®šç›®æ ‡1mv mongodb-linux-x86_64-3.4.1 /Users/amber/opt/mongodb æ·»åŠ mongodbçš„binè·¯å¾„åˆ°ç¯å¢ƒå˜é‡PATHä¸­1export PATH=/Users/amber/opt/mongodb/bin:$PATH åœ¨mongodb/ä¸‹åˆ›å»ºå­˜æ”¾æ•°æ®çš„ç›®å½•ï¼Œæ–°å»ºconfï¼Œlogæ–‡ä»¶å¤¹123mkdir -p /data/dbmkdir confmkdir log åœ¨confä¸‹åˆ›å»ºmongo.confé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š123456789101112131415# é»˜è®¤ç«¯å£å·æ˜¯27017port=28001 bind_ip=127.0.0.1logpath=/Users/amber/opt/mongodb/log/28001.loglogappend=Truedbpath=/Users/amber/opt/mongodb/data/28001/# ä¸ºæ¯ä¸€ä¸ªæ•°æ®åº“å®‰è£…æ•°æ®åº“åå»ºç«‹æ–‡ä»¶å¤¹å­˜æ”¾directoryperdb=True# è¿›ç¨‹æ–‡ä»¶ï¼Œæ–¹ä¾¿åœæ­¢mongodbï¼Œæˆ‘ç›´æ¥æ”¾åˆ°äº†å­˜æ”¾æ•°æ®çš„ç›®å½•ä¸‹pidfilepath=/Users/amber/opt/mongodb/data/28001/28001.pid# ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼å¯åŠ¨mongodfork=TrueoplogSize=10240# å¼€å¯æƒé™éªŒè¯ï¼Œæ²¡è®¾ç½®è´¦å·å¯†ç ä¹‹å‰å…ˆæ³¨é‡Šæ‰auth=True ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨mongodï¼ï¼ï¼1mongod -f /../mongodb/conf/mongo.conf # å…·ä½“è·¯å¾„æ ¹æ®æ‰€åœ¨ç›®å½•å†³å®š æ‰“å¼€mongo1mongo 127.0.0.1:28001 é€€å‡ºmongodb123use admindb.shutdownServer()exit å‚è€ƒæ–‡ç« Install MongoDB Community Edition on Red Hat Enterprise or CentOS Linux]]></content>
      <tags>
        <tag>å®‰è£…</tag>
        <tag>mongodb</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Macä¸‹æ›´æ–°pandaså‡ºç°æƒé™é—®é¢˜]]></title>
    <url>%2Famberwest.github.io%2F2018%2F06%2F13%2FMac%E4%B8%8B%E6%9B%B4%E6%96%B0pandas%E5%87%BA%E7%8E%B0%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[åœ¨æ›´æ–°pandasæ—¶å‡ºç°äº†è¿™æ ·çš„é”™è¯¯ï¼š1Could not install packages due to an EnvironmentError: [Errno 1] Operation not permitted çœ‹åˆ°æ²¡æœ‰æƒé™ï¼Œå³ä½¿è§‰å¾—ä¸å¯¹åŠ²è¿˜æ˜¯é»˜é»˜ä½¿ç”¨sudoè¿›è¡Œæ›´æ–°ï¼Œç»“æœè¿˜æ˜¯ä¸è¡Œï¼ä¸Šç½‘ä¸€æœæ‰å‘ç°é—®é¢˜å‡ºç°åœ¨macç³»ç»Ÿä¸Šï¼Œæ›´æ–°ä¹‹åæ–°ç³»ç»Ÿå¤šäº†ä¸ªsipçš„æœºåˆ¶ï¼Œæ‰€ä»¥å³ä½¿ç”¨sudoä¹Ÿæ²¡åŠæ³•è§£å†³é—®é¢˜ã€‚ æœ€åæ‰¾åˆ°ä¸€ä¸ªå®Œç¾çš„è§£å†³æ–¹æ³•ï¼šåŸºäºç”¨æˆ·çš„æƒé™æ¥å®‰è£…/æ›´æ–°(upgrade)åŒ…ã€‚1pip install &lt;package_name&gt; --user -U å‚è€ƒæ–‡ç« ï¼šè§£å†³mac osxä¸‹pipå®‰è£…ipythonæƒé™çš„é—®é¢˜]]></content>
      <tags>
        <tag>Mac</tag>
        <tag>æƒé™</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[pandasä¿®æ”¹åˆ—å]]></title>
    <url>%2Famberwest.github.io%2F2018%2F06%2F13%2Fpandas%EF%BC%9A%E4%BF%AE%E6%94%B9%E5%88%97%E5%90%8D%2F</url>
    <content type="text"><![CDATA[ä¿®æ”¹æ•°æ®çš„åˆ—åï¼Œç”¨åˆ°çš„æ–¹æ³•æ˜¯rename()ã€‚123import pandas as pddf=pd.DataFrame(&#123;0:['apple', 'orange', 'peach'],1:['red', 'yellow', 'pink'], 'total': [10, 11, 12]&#125;) æˆ‘ä»¬å¯ä»¥æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•å°†totalè¿™ä¸ªåˆ—åå˜ä¸ºå¤§å†™ï¼š 12345678# old waydf.rename(columns=&#123;'total': 'TOTAL'&#125;)# new waydf.rename(&#123;'total': 'TOTAL'&#125;, axis=1)# tricky way, è¿™é‡Œä¸é€‚ç”¨ï¼ï¼!df.rename(str.upper, axis='columns') éœ€è¦æ³¨æ„ï¼š ä»¥ä¸Šæ–¹æ³•ä¿®æ”¹åˆ—åå¹¶ä¸æ”¹å˜åŸå§‹æ•°æ®ï¼Œå¯ä»¥å°†ä¿®æ”¹ç»“æœé‡æ–°èµ‹å€¼ç»™å˜é‡ï¼Œæˆ–è€…ä½¿ç”¨å‚æ•°inplace=Trueç›´æ¥åœ¨åŸå§‹æ•°æ®ä¸Šä¿®æ”¹ å¦‚æœè¦ä¿®æ”¹å¤šä¸ªåˆ—åï¼Œä¹Ÿå¯ä»¥ç”¨è¿™äº›æ–¹æ³• axiså¯ä»¥æ˜¯1ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨columns ç¬¬ä¸‰ç§æ–¹å¼æ˜¯å¯¹æ‰€æœ‰åˆ—åéƒ½æ”¹ä¸ºå¤§å†™ï¼Œå¦‚æœåˆ—åä¸­å‡ºç°éstringç±»å‹å°±ä¼šæŠ¥é”™ å¦‚æœæ•°æ®æœ‰å¾ˆå¤šåˆ—ï¼Œæ‰‹åŠ¨å†™å‡ºå…¨éƒ¨çš„åˆ—åå°±å¤ªè´¹åŠ²äº†ã€‚æ‰€ä»¥å¯ä»¥å…ˆè·å–åŸå§‹åˆ—åï¼Œæ¥ç€ä½¿ç”¨dictå’Œzipåˆ›å»ºå¯¹åº”çš„åˆ—åå­—å…¸ã€‚123col = df.columnsnew_col = dict(zip(col, ['fruit', 'color', 'total']))df.rename(columns=new_col, inplace=True)]]></content>
      <categories>
        <category>pandas</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>ä¿®æ”¹åˆ—å</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[pandasä¸­å°†ä¸€åˆ—æ•°æ®è½¬ä¸ºå¤šåˆ—æ•°æ®]]></title>
    <url>%2Famberwest.github.io%2F2018%2F06%2F12%2Fpandas%EF%BC%9A%E5%88%97%E6%95%B0%E6%8D%AE%E8%BD%AC%E4%B8%BA%E5%A4%9A%E5%88%97%E6%95%B0%E6%8D%AE%2F</url>
    <content type="text"><![CDATA[åœ¨å·¥ä½œä¸­ï¼Œæœ‰æ—¶å€™éœ€è¦å°†åŒä¸€ä¸ªå•å…ƒæ ¼é‡Œçš„æ•°æ®è¿›è¡Œæ‹†åˆ†æˆå¤šåˆ—æ•°æ®ï¼Œç„¶åè¿›è¡Œç»Ÿè®¡ã€åˆ†ç±»ç­‰å…¶ä»–æ“ä½œï¼Œè¿™æ—¶å€™get_dummies()æ–¹æ³•å°±å¯ä»¥æ´¾ä¸Šç”¨åœºäº†ã€‚ pandaså’Œpandas.Serieséƒ½æœ‰å„è‡ªçš„get_dummies()æ–¹æ³•ï¼Œåå­—è™½ç„¶ç›¸åŒï¼Œä½†æ˜¯ç»“æœå¹¶ä¸ä¸€æ ·ã€‚Seriesçš„get_dummies()æ¥å—ä¸€ä¸ªsepå‚æ•°ï¼Œé»˜è®¤æ˜¯|ï¼Œæ ¹æ®è¯¥åˆ†éš”ç¬¦å°†stringè¿›è¡Œåˆ‡åˆ†ï¼Œè¿”å›Dataframeã€‚1Series.str.get_dummies(sep=&apos;|&apos;) åœ¨ä¸‹é¢ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œå¯ä»¥çœ‹åˆ°DataFrameä¹Ÿä½¿ç”¨äº†Seriesçš„get_dummies()ï¼Œä½†æ˜¯åªè¿”å›æ‹†åˆ†ä¹‹åçš„DataFrameï¼Œéœ€è¦å†ä½¿ç”¨concatæ–¹æ³•å°†åŸå§‹æ•°æ®åˆå¹¶ã€‚12345678910# Seriesä¸­ä½¿ç”¨from pandas import SeriesSeries(['a|b', 'a', 'a|c']).str.get_dummies()# åœ¨DataFrameä¸­ä½¿ç”¨import pandas as pddf = pd.DataFrame(&#123;'id': [1,2,3], 'labels' : ["a,b,c", "c,a", "d,a,b",]&#125;)df['labels'].str.get_dummies(sep=',') å¦‚æœä½¿ç”¨str.split()æ–¹æ³•ï¼Œä¹Ÿèƒ½æ‹†åˆ†ï¼Œä½†æ˜¯å¹¶ä¸èƒ½è‡ªåŠ¨åˆ†åˆ—ã€‚1df2=pd.DataFrame(df['labels'].str.split(',').tolist()) pandasçš„get_dummies()æ–¹æ³•ï¼š1pandas.get_dummies(data, prefix=None, prefix_sep='_', dummy_na=False, columns=None, sparse=False, drop_first=False, dtype=None) å‚æ•°è¯´æ˜ï¼š dataï¼šåŸå§‹æ•°æ®prefixï¼šæ‹†åˆ†åæ–°åˆ—åˆ—åçš„å‰ç¼€prefix_sepï¼šå‰ç¼€å’ŒåŸå§‹å­—æ®µçš„è¿æ¥ç¬¦dummy_naï¼šæ˜¯å¦å¿½ç•¥NANåˆ—columnsï¼šæŒ‡å®šæ‹†åˆ†çš„åˆ—åï¼Œlist.ä¸æŒ‡å®šåˆ—æ—¶,é»˜è®¤æ˜¯å¯¹æ‰€æœ‰å¯åˆ†çš„åˆ—éƒ½è¿›è¡Œæ‹†åˆ†ã€‚sparseï¼šSerieså’Œå…¨éƒ¨åˆ—æ‹†åˆ†æ—¶è¿”å›â€œç¨€ç–â€Dataframedrop_firstï¼šæ˜¯å¦ç§»é™¤æ‹†åˆ†åçš„ç¬¬ä¸€åˆ—æ•°æ® è¯¥æ–¹æ³•å¹¶ä¸ä¼šå°†åˆ—æ•°æ®stringè¿›è¡Œåˆ†å‰²ï¼Œè€Œæ˜¯å°†æŒ‡å®šåˆ—çš„æ•°æ®çš„æ‰€æœ‰å¯èƒ½å–å€¼éƒ½ä½œä¸ºåˆ—ã€‚ ä¾‹å­å¦‚ä¸‹ï¼š1234import pandas as pddf = pd.DataFrame(&#123;'id': [1,2,3], "sex": ['male', 'female', 'male']&#125;)pd.get_dummies(df, columns=['sex']) å¦‚æœéœ€è¦æ‹†åˆ†çš„åˆ—æ•°æ®æ˜¯å­—å…¸æ—¶ï¼Œä½¿ç”¨str.valuesã€‚è¿™é‡Œä½¿ç”¨äº†popæ–¹æ³•ï¼Œç›´æ¥å°†è¿™ä¸€åˆ—æ•°æ®ç»™åˆ é™¤äº†ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨df[â€˜lablesâ€™]æ¥å¤„ç†ä¹‹åå†åˆ æ‰å¤šä½™åˆ—ã€‚æœ€åä¸€ç‚¹ï¼Œéœ€è¦å®Œæ•´çš„æ•°æ®å¯ä»¥ä½¿ç”¨concatä¹‹ç±»çš„æ–¹æ³•å°†å…¶ä¸åŸå§‹dfè¿›è¡Œåˆå¹¶ã€‚1234import pandas as pddf = pd.DataFrame(&#123;'id': [1,2], 'labels' : [&#123;'a':11,'b':22&#125;, &#123;'c':33&#125;]&#125;)pd.DataFrame(df.pop('labels').values.tolist())]]></content>
      <categories>
        <category>pandas</category>
      </categories>
      <tags>
        <tag>pandas</tag>
        <tag>æ‹†åˆ†æ•°æ®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Macç»ˆç«¯ä½¿ç”¨ä»£ç†]]></title>
    <url>%2Famberwest.github.io%2F2018%2F06%2F11%2FMac%E7%BB%88%E7%AB%AF%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86%2F</url>
    <content type="text"><![CDATA[ç”±äºOS X 10.11ä¹‹åæœ‰SIPå®‰å…¨æœºåˆ¶ï¼Œå·²ç»ä¸èƒ½å¤Ÿç”¨ä¸€æ¡ç®€å•çš„å‘½ä»¤æ¥è§£å†³ï¼Œéœ€è¦å…³é—­SIPæˆ–è€…ä½¿ç”¨proxychains-ngä¹‹ç±»çš„å·¥å…·ã€‚ä½†æ˜¯å‘¢ï¼Œå…³é—­SIPéº»çƒ¦å°±ç®—äº†ï¼Œå±…ç„¶è¿˜æœ‰å®‰å…¨é—®é¢˜ï¼Œåƒæˆ‘è¿™ç§æ¸£æ¸£ï¼ŒçœŸçš„æœ‰ç‚¹æ€•æŠŠè‡ªå·±ç»™å‘äº†ã€‚è€Œprivoxyè¿™ä¸ªè½¯ä»¶åˆšå¥½å®‰è£…åœ¨/usr/localå†…ï¼Œå°±ä¸éœ€è¦å…³é—­SIPã€‚ privoxyæ˜¯ä¸€ä¸ªHTTPåè®®è¿‡æ»¤ä»£ç†ï¼Œå®ƒå¯ä»¥è¿‡æ»¤ç½‘é¡µï¼Œç®¡ç†cookiesï¼Œæ§åˆ¶è®¿é—®ï¼Œé™¤å¹¿å‘Šç­‰ï¼ŒåŒæ—¶è¿˜æ”¯æŒå•ç³»ç»Ÿå¤šç”¨æˆ·ç½‘ç»œã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨privoxyå°†shadowsocksçš„socks5ä»£ç†è½¬ä¸ºhttpä»£ç†ï¼Œè¿™æ ·å°±å¯ä»¥ä¾›ç»ˆç«¯ä½¿ç”¨äº†ã€‚ æ­å»ºæ¢¯å­å®‰è£…å¹¶è®¾ç½®shadowsocksæ ¹æ®ä¹‹å‰çš„è´¦å·å¯†ç ï¼ˆæ­å»ºssæœåŠ¡å™¨æ—¶è®¾ç½®çš„ï¼‰è®¾ç½®sså®¢æˆ·ç«¯ã€‚ssçš„é»˜è®¤ç«¯å£æ˜¯1080ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤æŸ¥çœ‹ï¼š1cat ~/.ShadowsocksX/gfwlist.js | grep proxy å…¶ä¸­ï¼Œproxyå¯¹åº”çš„socks5ä»£ç† å®‰è£…privoxy1brew install privoxy é…ç½®privoxy1vim /usr/local/etc/privoxy/config åœ¨æ–‡ä»¶æœ«å°¾è¾“å…¥ï¼š12listen-address 0.0.0.0:8118forward-socks5 / localhost:1080 . # è½¬å‘socks5åè®® ç¬¬ä¸€è¡Œæ˜¯privoxyç›‘å¬ä»»æ„IPåœ°å€çš„8118ç«¯å£ï¼Œä¹Ÿå°±æ˜¯privoxyçš„é»˜è®¤ç«¯å£ã€‚ç¬¬äºŒè¡Œæ˜¯ssçš„é»˜è®¤ç«¯å£ï¼Œæœ€åè¿˜å¸¦æœ‰ä¸€ä¸ªç©ºæ ¼å’Œå¥å·ï¼Œä¹Ÿå°±å®ç°äº†å°†socks5ä»£ç†è½¬ä¸ºhttpä»£ç†ï¼Œåœ¨çˆ¬è™«ä¸­å¦‚æœè®¾ç½®ä»£ç†å°±å¯ä»¥ä½¿ç”¨http://127.0.0.1:8118ã€‚ å¯åŠ¨privoxy1sudo /usr/local/sbin/privoxy /usr/local/etc/privoxy/config æŸ¥çœ‹privoxyè¿›ç¨‹1ps -ef | grep privoxy è¿”å›ä»¥ä¸‹å†…å®¹è¯´æ˜å¯åŠ¨æˆåŠŸï¼š 1502 4093 1 0 11:48ä¸Šåˆ ?? 0:00.03 privoxy å…³é—­privoxyè¿›ç¨‹çš„è¯ï¼Œç›´æ¥ä½¿ç”¨kill IDï¼ˆæ¯”å¦‚è¿™é‡Œçš„IDæ˜¯4093ï¼‰ï¼›ä»¥åå†å¯åŠ¨ï¼Œéœ€è¦å…ˆè¿›å…¥åˆ°/usr/local/etc/privoxyï¼Œä¸ç„¶å¯èƒ½ä¼šæŠ¥æ‰¾ä¸åˆ°é…ç½®æ–‡ä»¶çš„é”™è¯¯ã€‚ æŸ¥çœ‹ç«¯å£ç›‘å¬æ˜¯å¦æˆåŠŸ1netstat -an | grep 8118 æµ‹è¯•shadowsocks12telnet 127.0.0.1 1086telnet 127.0.0.1 8118 ä½¿ç”¨privoxyåœ¨~/.zshrcä¸­æ·»åŠ å¼€å…³å‡½æ•°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åˆ«åå‘½ä»¤ã€‚ä¾‹å¦‚ï¼š1alias proxy=&apos;export all_proxy=socks5://127.0.0.1:1080&apos; å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š123456789101112function proxy_off()&#123; unset http_proxy unset https_proxy echo -e &quot;å·²å…³é—­ä»£ç†&quot;&#125;function proxy_on() &#123; export no_proxy=&quot;localhost,127.0.0.1,localaddress,.localdomain.com&quot; export http_proxy=&quot;http://127.0.0.1:8118&quot; export https_proxy=$http_proxy echo -e &quot;å·²å¼€å¯ä»£ç†&quot;&#125; ä½¿é…ç½®ç«‹å³ç”Ÿæ•ˆ1source ~/.zshrc å¼€å¯ä»£ç†è¦ç¡®ä¿privoxyå·²ç»å¼€å¯ 1proxy_on å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹IPï¼š1curl ip.cn å…³é—­ä»£ç†1proxy_off å‚è€ƒæ–‡ç« ï¼šMacå‘½ä»¤è¡Œç»ˆç«¯ä¸‹ä½¿ç”¨shadowsocksç¿»å¢™å‘½ä»¤è¡Œä¸‹ä½¿ç”¨ä»£ç†Mac OSXç»ˆç«¯èµ°shadowsocksä»£ç†]]></content>
      <tags>
        <tag>mac</tag>
        <tag>ä»£ç†</tag>
        <tag>privoxy</tag>
      </tags>
  </entry>
</search>
